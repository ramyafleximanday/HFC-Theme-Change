@model IEM.Areas.MASTERS.Models.ForMailEntity
@using IEM.Areas.MASTERS.Models
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ForMailEntity sh = (ForMailEntity)ViewBag.DashBoardheaderser;
    int rowval = 0;

}
@*<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>*@

<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>

@using (Html.BeginForm())
{
    <div class="well">
        <fieldset>
            <legend>Mail Alert</legend>
            <div class=" panel panel-default" style="padding-left: 2%;padding-top: 1%;">
                @*<table class="myTableStyleTab" style="width: 100%;">
                    <tr>
                        <td width="40%"></td>
                        <td width="40%"></td>
                    </tr>
                </table>*@
                <table class="myTableStyleTabNew" style="width: 100%;">


                    <tr style="text-align:center;">
                        <td colspan="6">
                            <div class="borderStyle" style="padding:10px;width:100%">
                                <table class="myTableStyleTab">
                                    <tr>
                                        <td style="width:13%">
                                            <span>Template Name</span> <br />

                                            <input type="text" id="ddlTemplateName" class="textboxStyle required" maxlength="128" name="ddlTemplateName" />
                                        </td>
                                        <td style="width:13%">
                                            <span>Module Name</span> <br />
                                            <select name="ddlModuleType" id="ddlModuleType" class="fstextbox chosen-select" >
                                                @foreach (var pitem in sh.Moduledata)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.Module == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>

                                        <td style="width:13%">
                                            <span>Transaction Type</span> <br />
                                            <select name="ddlTransactionType" id="ddlTransactionType" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.TransactionType)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.TransactionTypeId == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>
                                        <td style="width:13%">
                                            <span>Stage Type</span> <br />
                                            <select name="ddlWorkFlowType" id="ddlWorkFlowType" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.WorkFlowType)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.WorkFlowId == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>
                                        <td style="width:13%">
                                            <span>Trigger Type</span> <br />
                                            <select name="ddlTriggerType" id="ddlTriggerType" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.TriggerType)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.TriggerTypeName == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>



                                    </tr>

                                    <tr>

                                        <td>
                                            <span>Attachment</span> <br />
                                            <input type="radio" name="rblAttachmentflg" id="rblYesa" value="Yes" />&nbsp;Yes
                                            &nbsp;&nbsp;
                                            <input type="radio" name="rblAttachmentflg" id="rblNoa" checked="checked" value="No">&nbsp;No
                                            @*<select name="ddlAttachmentType" id="ddlAttachmentType" class="textboxStyle">
                                    @foreach (var pitem in sh.Attachment)
                                    {
                                    string selectedValue = "";
                                    if (ViewBag.docval == pitem.Value)
                                    {
                                    selectedValue = "selected='selected'";
                                    }
                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                    }
                                    </select>*@
                                        </td>
                                        <td>
                                            <span>Include Approvals</span><br />
                                            <input type="radio" name="rblIncludeflg" id="rblYesi" value="Yes" />&nbsp;Yes
                                            &nbsp;&nbsp;
                                            <input type="radio" name="rblIncludeflg" id="rblNoi" checked="checked" value="No">&nbsp;No
                                        </td>
                                        <td style="width:13%">
                                            <span>Trigger Frequency</span> <br />
                                            <select name="ddlTriggerFreType" id="ddlTriggerFreType" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.TriggerFreType)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.TriggerTypeFreName == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>
                                        <td >
                                            <span>Audience Type</span> <br />
                                            <select name="ddlAudienceType" id="ddlAudienceType" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.AudienceType)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.docval == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>
                                        <td>
                                            <span>Table Name</span> <br />
                                            <select name="ddlTableName" id="ddlTableName" class="fstextbox chosen-select">
                                                @foreach (var pitem in sh.Tables)
                                                {
                                                    string selectedValue = "";
                                                    if (ViewBag.docval == pitem.Value)
                                                    {
                                                        selectedValue = "selected='selected'";
                                                    }
                                                    <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                                }
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td colspan="5">
                                            <span>Fields</span> <br />
                                            <div id="divTablescollist" style="height: 217px; overflow: auto;border:solid; width:99%;">
                                                @foreach (var names in sh.Tablescol)
                                                {
                                                    rowval = rowval + 1;
                                                    var checkBoxId = "chk" + names.Value;
                                                    var tdId = "td" + names.Value;
                                                    <table style=" width:100%;">
                                                        <tr>
                                                            <td width="20px">
                                                                <input type="checkbox" id="@checkBoxId" class="chkclass" value="@names.Value" name="checkbox" />
                                                            </td>
                                                            <td id="@tdId" width="100px">
                                                                <b>@names.Text</b>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="vertical-align:middle;width:30%;" colspan="2">
                            <table class="myTableStyleTab">
                                <tr>
                                    <td>
                                        <span>To/ CC/ BCC </span> <br />
                                        <select name="ddltoType" id="ddltoType" class="textboxStyle">
                                            @foreach (var pitem in sh.ToType)
                                            {
                                                string selectedValue = "";
                                                if (ViewBag.docval == pitem.Value)
                                                {
                                                    selectedValue = "selected='selected'";
                                                }
                                                <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                            }
                                        </select>
                                    </td>
                                    <td>
                                        <span></span> <br />
                                        <select name="ddltochType" id="ddltochType" class="textboxStyle ">
                                            @foreach (var pitem in sh.ToGetType)
                                            {
                                                string selectedValue = "";
                                                if (ViewBag.docval == pitem.Value)
                                                {
                                                    selectedValue = "selected='selected'";
                                                }
                                                <option value="@pitem.Value" @selectedValue>@pitem.Text</option>
                                            }
                                        </select>
                                    </td>
                                    <td>
                                        <a onclick="Selecttobcccc()"> <span style="font-size: 25px;" class="glyphicon glyphicon-arrow-right"></span> </a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td colspan="4" style="text-align:left;width:70%;">
                            <table class="myTableStyleTab" style="width:102%;">
                                <tr>
                                    <td>
                                        <span>To</span> <br />
                                        <input type="text" id="txtto" placeholder="TO" class="textboxStyle" name="txtto" value="@sh.TOid" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span>CC</span> <br />
                                        <input type="text" id="txtcc" placeholder="CC" class="textboxStyle " name="txtcc" value="@sh.CCid" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span>BCC</span> <br />
                                        <input type="text" id="txtbcc" placeholder="BCC" class="textboxStyle " name="txtbcc" value="@sh.BCCid" />
                                    </td>
                                </tr>
                            </table>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <span>Subject</span> <br />
                            <input type="text" id="txtSubject" placeholder="Subject" class="textboxStyle100 required" name="txtSubject" value="@sh.Subject" />
                        </td>
                    </tr>

                    <tr>
                        <td colspan="6">
                            <span>Content</span> <br />
                            <textarea class="textboxStyle" id="txtContent" name="txtContent" style="resize:none ;width:94%;height:300px">@sh.Content</textarea>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <span>Signature</span> <br />
                            <input type="text" id="txtSignature" placeholder="Signature " class="textboxStyle required" name="txtSignature" value="@sh.Signature" />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6" align="right" style="padding-right: 70px;">

                            <input type="button" id="btnsavexpNN" class="btn btn-primary" value="Save" onclick="Saetemplaetee()" />
                            @*<span>&nbsp;&nbsp;&nbsp;&nbsp;</span><input type="button" id="btncanexpNNN" class="btn btn-warning" value="Cancel" onclick="btnaddcancel()" />*@
                            <a href="../Masters/ForMail/Templatedetails" class="btn btn-warning">Cancel</a>
                        </td>
                    </tr>
                    <tr>
                        <td><br /></td>
                    </tr>
                </table>
            </div>
        </fieldset>
    </div>
}
<input type="hidden" id="txtcontentts" />

<script src="~/scripts/tinymce/tinymce.min.js"></script>
<script type="text/javascript">
    tinymce.init({
        selector: "textarea",
        theme: "modern",
        plugins: [
            "advlist autolink lists link  charmap print preview hr anchor pagebreak",
            "searchreplace wordcount visualblocks visualchars code fullscreen",
            "insertdatetime  nonbreaking save table contextmenu directionality",
            "emoticons template paste textcolor colorpicker textpattern imagetools"
        ],
        toolbar1: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",
        toolbar2: "print preview  | forecolor backcolor media image emoticons",
        toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image jbimages",
        image_advtab: true,

        file_browser_callback: "openmanager",
        open_manager_upload_path: 'uploads/',
        templates: [
            { title: 'Test template 1', content: 'Test 1' },
            { title: 'Test template 2', content: 'Test 2' }
        ]
    });

   
</script>

<script type="text/javascript">
    var maxheight;

    function Saetemplaetee() {

        var ModuleType = $("#ddlModuleType").val();
        var TemplateName = $("#ddlTemplateName").val();
        var TransactionType = $("#ddlTransactionType").val();
        var TransactionTypetext = $("#ddlTransactionType option:selected").text();
        var TriggerType = $("#ddlTriggerType").val();
        var TriggerFreType = $("#ddlTriggerFreType").val();
        var AudienceType = $("#ddlAudienceType").val();

        var toType = $("#ddltoType").val();
        var tochType = $("#ddltochType").val();
        // var toType = "0";
        // var tochType = "0";
        var to = $("#txtto").val();
        var cc = $("#txtcc").val();
        var bcc = $("#txtbcc").val();
        //var Triggernodays = $("#txtnoofdays").val();
        var Triggernodays = "0";
        //var TableName = $("#ddlTableName").val();
        var TableName = $("#ddlTableName option:selected").text();
        var Subject = $("#txtSubject").val();
        var Attachmentflg = $("input[name=rblAttachmentflg]:checked").val();
        var Includeflg = $("input[name=rblIncludeflg]:checked").val();
        var Signature = $("#txtSignature").val();
        var TablescolName = $("#txtcontentts").val();
        var Contenttextnew = tinyMCE.activeEditor.getContent({ format: 'raw' });
        var WorkFlow = $("#ddlWorkFlowType").val();
        //var newtext = Contenttext;
        //var Contenttext = $("#txtContent").val();
        //alert(tinyMCE.activeEditor.getContent());
        //alert(tinyMCE.activeEditor.getContent({ format: 'raw' }));
        //alert(tinyMCE.get('txtContent').getContent());
        //alert(tinyMCE.activeEditor.getContent({ format: 'text' }));
        //return false;

        if (TemplateName == null || TemplateName == "") {
            jAlert("Please Select TemplateName.", "Message");
            $("#ddlTemplateName").focus();
            return false;
        }
        if (ModuleType == null || ModuleType == "" || ModuleType == "0") {
            jAlert("Please Select ModuleType.", "Message");
            $("#ddlModuleType").focus();
            return false;
        }

        if (TransactionType == null || TransactionType == "" || TransactionType == "0") {
            jAlert("Please Select TransactionType.", "Message");
            $("#ddlTransactionType").focus();
            return false;
        }
        if (TriggerType == null || TriggerType == "" || TriggerType == "0") {
            jAlert("Please Select TriggerType.", "Message");
            $("#ddlTriggerType").focus();
            return false;
        }
        else {
            var modulecodeD = $("#ddlModuleType option:selected").text();
            if (modulecodeD != "EOW") {
                if ($("#ddlTriggerType").val() != "S") {
                    if (WorkFlow == null || WorkFlow == "" || WorkFlow == "0") {
                        jAlert("Please Select Stage Type.", "Message");
                        $("#ddlWorkFlowType").focus();
                        return false;
                    }
                }
            }
        }
        if (TriggerFreType == null || TriggerFreType == "" || TriggerFreType == "0") {
            jAlert("Please Select Trigger Frequency Type.", "Message");
            $("#ddlTriggerFreType").focus();
            return false;
        }
        //else {
        //    var TriggerFreType4 = $("#ddlTriggerFreType option:selected").text();
        //    if (TriggerFreType4 != "Immediate") {
        //        if (Triggernodays == null || Triggernodays == "") {
        //            jAlert("Please Enter No of Days.", "Message");
        //            $("#ddlAudienceType").focus();
        //            return false;
        //        }
        //    }
        //}

        if (AudienceType == null || AudienceType == "" || AudienceType == "0") {
            jAlert("Please Select AudienceType.", "Message");
            $("#ddlAudienceType").focus();
            return false;
        }
        //if (toType == null || toType == "" || toType == "0") {
        //    jAlert("Please Select ToType.", "Message");
        //    $("#ddltoType").focus();
        //    return false;
        //}
        //if (tochType == null || tochType == "" || tochType == "0") {
        //    jAlert("Please Select User.", "Message");
        //    $("#ddltoType").focus();
        //    return false;
        //}
        if (to == null || to == "") {
            jAlert("Please Enter To.", "Message");
            $("#txtto").focus();
            return false;
        }

        if (TableName == null || TableName == "" || TableName == "0") {
            jAlert("Please Select TableName.", "Message");
            $("#ddlTableName").focus();
            return false;
        }
        if (Subject == null || Subject == "") {
            jAlert("Please Enter Subject.", "Message");
            $("#txtSubject").focus();
            return false;
        }
        if (Attachmentflg == 'undefined' || Attachmentflg == null) {
            jAlert("Please Select Attachment Flag.", "Message");
            //$("#rblstatus").focus();
            return false;
        }
        if (Includeflg == 'undefined' || Includeflg == null) {
            jAlert("Please Select Include Approvals.", "Message");
            //$("#rblstatus").focus();
            return false;
        }
        if (Signature == null || Signature == "") {
            jAlert("Please Enter Signature.", "Message");
            $("#txtSignature").focus();
            return false;
        }

        var ForMailEntityCreate = {
            "Content": Contenttextnew,
            "ModuleName": ModuleType,
            "TemplateName": TemplateName,
            "TransactionTypeId": TransactionType,
            "TransactionTypeName": TransactionTypetext,
            "TriggerTypeName": TriggerType,
            "TriggerTypeFreName": TriggerFreType,
            "WorkFlowId": WorkFlow,
            "Triggernodays": Triggernodays,
            "AudienceName": AudienceType,
            "ToTypeName": toType,
            "ToGetTypeName": tochType,
            "TOid": to,
            "CCid": cc,
            "BCCid": bcc,
            "TablesName": TableName,
            "Subject": Subject,
            "AttachmentName": Attachmentflg,
            "Includeflg": Includeflg,
            "TablescolName": TablescolName,
            "Signature": Signature
        };
        $.post('../ForMail/_ForMailEntityCreate', ForMailEntityCreate,
        function (data) {
            if (data == "Success") {
                jAlert("Saved Successfully.", "Message", function () {
                    location.href = '@Url.Action("Templatedetails", "ForMail")?' + new Date().getTime();
                });

            }
            else {
                jAlert(data, "Message");
                return false;
            }
        }, 'json');

    }
</script>
<script>
    @*function btnaddcancel() {
        location.href = '@Url.Action("Templatedetails", "MailAlert")?' + new Date().getTime();
    }*@
    function changeFunction(id) {
        if (id.checked) {
            var row = $(id).closest('tr');
            var tds = row.find('b');
            var tdsappend = "<b>[" + tds.text() + "]</b>";

            tinymce.activeEditor.execCommand('mceInsertContent', false, tdsappend);
            var text = id.value;
            var data = $("#txtcontentts").val();
            var newdata = data;
            if (newdata == "") {
                $("#txtcontentts").val(text);
            }
            else {
                var str = newdata + "," + text;
                $("#txtcontentts").val(str);
            }
        }
        else {
            tinyMCE.triggerSave();
            var content = $('#txtContent').val();
            var row = $(id).closest('tr');
            var tds = row.find('b');
            var withoutbold = "<strong>[" + tds.text() + "]</strong>";
            var tdsappend = "<b>[" + tds.text() + "]</b>";
            content = content.replace(withoutbold, '');
            $('#txtContent').focus();
            tinyMCE.activeEditor.setContent(content);
            $('#txtContent').focus();

            var newval;
            var str = $("#txtcontentts").val();
            var splitString = str.split(',');
            var valu = id.value;
            for (var i = 0; i < splitString.length; i++) {
                var stringPart = splitString[i];
                if (stringPart != valu) {
                    continue;
                }
                else {
                    if (splitString.length == 1) {
                        newval = "";
                    }
                    else if (i == 0) {
                        var removableval = valu + ",";
                        newval = str.replace(removableval, '');
                    }
                    else {
                        var removableval = "," + valu
                        newval = str.replace(removableval, '');
                    }

                    $("#txtcontentts").val(newval);
                }
                break;
            }
            $('#txtContent').focusin();
        }


        //var txtarea = document.getElementById("txtContent");
        //var scrollPos = txtarea.scrollTop;
        //var strPos = 0;
        //var br = ((txtarea.selectionStart || txtarea.selectionStart == '0') ?
        //    "ff" : (document.selection ? "ie" : false));
        //if (br == "ie") {
        //    txtarea.focus();
        //    var range = document.selection.createRange();
        //    range.moveStart('character', -txtarea.value.length);
        //    strPos = range.text.length;
        //}
        //else if (br == "ff") strPos = txtarea.selectionStart;

        //var front = (txtarea.value).substring(0, strPos);
        //var back = (txtarea.value).substring(strPos, txtarea.value.length);
        //txtarea.value = front + text + back;
        //strPos = strPos + text.length;
        //if (br == "ie") {
        //    txtarea.focus();
        //    var range = document.selection.createRange();
        //    range.moveStart('character', -txtarea.value.length);
        //    range.moveStart('character', strPos);
        //    range.moveEnd('character', 0);
        //    range.select();
        //}
        //else if (br == "ff") {
        //    txtarea.selectionStart = strPos;
        //    txtarea.selectionEnd = strPos;
        //    txtarea.focus();
        //}
        //txtarea.scrollTop = scrollPos;
    }

    $(document).ready(function () {
        stylesSelect = $('#txtnoofdays');
        stylesSelect.attr('disabled', true);
        $("#ddltochType").empty();
        $("#ddltochType").append("<option value='0' >--Select--</option>");
       $("#ddltochType_chosen").trigger('chosen:updated');
        $("#ddlTableName").empty();
        $("#ddlTableName").append("<option value='0' >--Select--</option>");
        $("#ddlTableName_chosen").trigger('chosen:updated')
        $("#ddlTransactionType").empty();
        $("#ddlTransactionType").append("<option value='0' >--Select--</option>");
        $("#ddlTransactionType_chosen").trigger('chosen:updated')
     
        $('#ddlModuleType').change(function () {
            var brandID = $(this).val();
            if (brandID != "0") {
                var modulecode = $("#ddlModuleType option:selected").text();
                if (modulecode == "EOW") {
                    var stylesSelect = $('#ddlWorkFlowType');
                    stylesSelect.attr('disabled', true);
                    $("#ddlWorkFlowType").trigger('chosen:updated')
                }
                else {
                    var stylesSelect = $('#ddlWorkFlowType');
                    stylesSelect.attr('disabled', false);
                    $("#ddlWorkFlowType").trigger('chosen:updated')
                }
                var Student =
               {
                   "TransactionTypeId": brandID
               };
                $.ajax({
                    url: '../ForMail/GetTransaction/',
                    data: JSON.stringify(Student),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#ddlTransactionType").empty();
                        if (data.length > 0) {
                            $("#ddlTransactionType").append("<option  value='0' >--Select--</option>");
                            for (var i = 0; i < data.length; i++) {
                                var stylesSelect = $('#ddlTransactionType');
                                stylesSelect.attr('disabled', false);

                                $("#ddlTransactionType").append("<option value=" + data[i].TransactionTypeId + " >" + data[i].TransactionTypeName + "</option>");
                            }
                            $("#ddlTransactionType").trigger('chosen:updated')
                        }
                        if (data.length == 0) {
                            var stylesSelect = $('#ddlTransactionType');
                            stylesSelect.attr('disabled', true);
                            $("#ddlTransactionType").trigger('chosen:updated')

                        }
                    },
                    error: function (result) {
                        jAlert("Error.", "Error");
                        return false;
                    }
                });

            }
            else {
                $("#ddlTransactionType").empty();
                $("#ddlTransactionType").append("<option value='0' >--Select--</option>");
                $("#ddlTransactionType").trigger('chosen:updated')

            }
        });
        $('#ddlWorkFlowType').change(function () {
            var TriggerType = $("#ddlTriggerType").val();
            if (TriggerType != "0") {
                if (TriggerType == "S") {
                    $("#ddlWorkFlowType").val("0");
                }
            }
        });

        $('#ddlTransactionType').change(function () {
            var TransactionTypeId = $(this).val();
            if (TransactionTypeId != "0") {
            
                var transactiontype = $("#ddlTransactionType option:selected").text();
                var modulename = $("#ddlModuleType option:selected").text();

                var ForMailEntity =
               {
                   "TransactionTypeName": transactiontype,
                   "ModuleName": modulename
               };

                var modulecode = $("#ddlModuleType option:selected").text();
                if (modulecode == "EOW") {
                    var stylesSelect = $('#ddlWorkFlowType');
                    stylesSelect.attr('disabled', true);
                    $("#ddlWorkFlowType").trigger('chosen:updated')
                    var brandId = "0";
                    Selecttable(brandId);

                }
                else {
                    var stylesSelect = $('#ddlWorkFlowType');
                    stylesSelect.attr('disabled', false);
                    $("#ddlWorkFlowType").trigger('chosen:updated')

                    $.ajax({
                        url: '../ForMail/GetWorkFlow/',
                        data: JSON.stringify(ForMailEntity),
                        type: 'POST',
                        async: false,
                        cache: false,
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var brandId = "0";
                            Selecttable(brandId);
                            $("#ddlWorkFlowType").empty();
                            $("#ddltochType").empty();
                            if (data.length > 0) {
                                $("#ddlWorkFlowType").append("<option value='0' >--Select--</option>");
                                for (var i = 0; i < data.length; i++) {
                                    var stylesSelect = $('#ddlWorkFlowType');
                                    stylesSelect.attr('disabled', false);

                                    $("#ddlWorkFlowType").append("<option value=" + data[i].WorkFlowId + " >" + data[i].WorkFlowName + "</option>");
                                }
                                $("#ddlWorkFlowType").trigger('chosen:updated')
                            }
                            if (data.length == 0) {
                                var stylesSelect = $('#ddlWorkFlowType');
                                stylesSelect.attr('disabled', true);
                                $("#ddlWorkFlowType").trigger('chosen:updated')

                            }
                        },
                        error: function (result) {
                            jAlert("Error.", "Error");
                            return false;
                        }
                    });
                }
                $.ajax({
                    url: '../ForMail/GetuserCategory/',
                    data: JSON.stringify(ForMailEntity),
                    type: 'POST',
                    async: false,
                    cache: false,
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#ddltochType").empty();
                        if (data.length > 0) {
                            $("#ddltochType").append("<option value='0' >--Select--</option>");
                            for (var i = 0; i < data.length; i++) {
                                var stylesSelect = $('#ddltochType');
                                stylesSelect.attr('disabled', false);
                                $("#ddltochType").append("<option value=" + data[i].ToGetTypeId + " >" + data[i].ToGetTypeName + "</option>");
                            }
                            $("#ddltochType").trigger('chosen:updated')
                        }
                        if (data.length == 0) {
                            var stylesSelect = $('#ddltochType');
                            stylesSelect.attr('disabled', true);
                            $("#ddltochType").trigger('chosen:updated')
                        }
                    },
                    error: function (result) {
                        jAlert("Error.", "Error");
                        return false;
                    }
                });
            }
            else {
                $("#ddltochType").empty();
                $("#ddltochType").append("<option value='0' >--Select--</option>");
                $("#ddltochType").trigger('chosen:updated')
                $("#ddlWorkFlowType").empty();
                $("#ddlWorkFlowType").append("<option value='0' >--Select--</option>");
                $("#ddlWorkFlowType").trigger('chosen:updated')
            }
        });
        $('#ddlTriggerType').change(function () {
            var TriggerType = $(this).val();
            stylesSelect = $("#ddlWorkFlowType");
            var modulecodeD = $("#ddlModuleType option:selected").text();
            if (modulecodeD != "EOW") {
                if (TriggerType == "S") {
                    $("#ddlWorkFlowType").val("0");
                    stylesSelect.attr('disabled', true);
                    $("#ddlWorkFlowType").trigger('chosen:updated')
                }
                else {
                    stylesSelect.attr('disabled', false);
                    $("#ddlWorkFlowType").trigger('chosen:updated')
                }
            }
        });

        function Selecttable(brandId) {
            // var brandID = $("#ddlTransactionType option:selected").text();
            var brandID = $("#ddlTransactionType").val();
            var Student =
                {
                    "TransactionTypeId": brandID
                };
            $.ajax({
                url: '../ForMail/GetuserCategorynew/',
                data: JSON.stringify(Student),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#ddlTableName").empty();
                    if (data.length > 0) {
                        $("#ddlTableName").append("<option value='0' >--Select--</option>");
                        for (var i = 0; i < data.length; i++) {
                            var stylesSelect = $('#ddlTableName');
                            stylesSelect.attr('disabled', false);
                            $("#ddlTableName").append("<option value=" + data[i].TablescolId + " >" + data[i].TablescolName + "</option>");
                        }

                        $("#ddlTableName").trigger('chosen:updated')
                    }
                    if (data.length == 0) {
                        var stylesSelect = $('#ddlTableName');
                        stylesSelect.attr('disabled', true);
                        $("#ddlTableName").trigger('chosen:updated')
                    }
                },
                error: function (result) {
                    jAlert("Error.", "Error");
                    return false;
                }
            });
        }

        $('#ddlTableName').change(function () {
            $("#divTablescollist").empty();
            var brandID = $(this).val();
            if (brandID != "0") {
                var brandIDtext = $("#ddlTableName option:selected").text();
                var Student =
               {
                   "TransactionTypeId": brandID
               };
                $.ajax({
                    url: '../ForMail/GetuserCategoryfillchk/',
                    data: JSON.stringify(Student),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#divTablescollist").empty();
                        var table = $('<table style="width: 100%;"></table>');

                        //var newrow = "<tr><td><span>&nbsp;&nbsp;&nbsp;</span><input type='checkbox' id='" + ids + "' value='ddddddddddd'  /><span>&nbsp;</span>" + names + "</td></tr>";
                        // table.append(newrow);
                        maxheight = data.length;
                        if (data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                var ids = data[i].TablesId;
                                var names = data[i].TablesName;
                                var newrow = "<tr><td><span>&nbsp;&nbsp;&nbsp;</span><input onchange='changeFunction(this)' type='checkbox' id='" + ids + "' value='" + ids + "'  /><span>&nbsp;</span><b>" + names + "</b></td></tr>";
                                table.append(newrow);
                            }
                            $('#divTablescollist').append(table);
                        }
                        if (data.length == 0) {
                            $("#divTablescollist").empty();
                        }
                    },
                    error: function (result) {
                        jAlert("Error.", "Error");
                        return false;
                    }
                });
            }
            else {
                //   $("#ddltochType").empty();
                // $("#ddltochType").append("<option value='0' >--Select--</option>");
            }
        });

    });

    function Selecttobcccc() {
        var ToType = $("#ddltoType option:selected").text();
        if (ToType == "-- Select --" || ToType == "0" || ToType == "") {
            jAlert("Please ToType.", "Message");
            $("#ddltoType").focus();
            return false;
        }
        else if (ToType == "To") {
            var tochType = $("#ddltochType option:selected").text();
            if (tochType == "--Select--") {
                jAlert("Please User.", "Message");
                $("#ddltochType").focus();
                return false;
            }
            else {
                var txtto = $("#txtto").val();
                var already = txtto;
                if (txtto == "") {
                    $("#txtto").val(tochType);
                }
                else {
                    var res = already.split(",");
                    for (var i = 0; i < res.length; i++) {
                        var exitsvalues = res[i];
                        if (exitsvalues == tochType) {
                            jAlert("Already Exits User.", "Message");
                            $("#ddltochType").focus();
                            return false;
                        }
                    }
                    var addtext = already + "," + tochType;
                    $("#txtto").val(addtext);
                }
            }
        }
        else if (ToType == "Cc") {
            var tochType = $("#ddltochType option:selected").text();
            if (tochType == "--Select--") {
                jAlert("Please User.", "Message");
                $("#ddltochType").focus();
                return false;
            }
            else {
                var txtcc = $("#txtcc").val();
                var already = txtcc;
                if (txtcc == "") {
                    $("#txtcc").val(tochType);
                }
                else {
                    var res = already.split(",");
                    for (var i = 0; i < res.length; i++) {
                        var exitsvalues = res[i];
                        if (exitsvalues == tochType) {
                            jAlert("Already Exits User.", "Message");
                            $("#ddltochType").focus();
                            return false;
                        }
                    }
                    var addtext = already + "," + tochType;
                    $("#txtcc").val(addtext);
                }
            }
        }
        else if (ToType == "Bcc") {
            var tochType = $("#ddltochType option:selected").text();
            if (tochType == "--Select--") {
                jAlert("Please User.", "Message");
                $("#ddltochType").focus();
                return false;
            }
            else {
                var txtbcc = $("#txtbcc").val();
                var already = txtbcc;
                if (txtbcc == "") {
                    $("#txtbcc").val(tochType);
                }
                else {
                    var res = already.split(",");
                    for (var i = 0; i < res.length; i++) {
                        var exitsvalues = res[i];
                        if (exitsvalues == tochType) {
                            jAlert("Already Exits User.", "Message");
                            $("#ddltochType").focus();
                            return false;
                        }
                    }
                    var addtext = already + "," + tochType;
                    $("#txtbcc").val(addtext);
                }
            }
        }
    }
</script>

<script>
    $(document).ready(function () {
  
        $("#ddlModuleType").chosen({});
        $("#ddlModuleType_chosen").css("width", "100%");
        $("#ddlModuleType_chosen").addClass('required');

        $("#ddlModuleType").keyup(function () {
            var txtContractFrom = $("#ddlModuleType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlModuleType_chosen").removeClass('required');
                $("#ddlModuleType_chosen").addClass('valid');
            }
            else {
                $("#ddlModuleType_chosen").removeClass('valid');
                $("#ddlModuleType_chosen").addClass('required');
            }
        });
        $("#ddlModuleType").change(function () {
            var txtContractFrom = $("#ddlModuleType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlModuleType_chosen").removeClass('required');
                $("#ddlModuleType_chosen").addClass('valid');
            }
            else {
                $("#ddlModuleType_chosen").removeClass('valid');
                $("#ddlModuleType_chosen").addClass('required');
            }
        });

        $("#ddlWorkFlowType").chosen({});
        $("#ddlWorkFlowType_chosen").css("width", "100%");
        $("#ddlWorkFlowType_chosen").addClass('required');


        $("#ddlWorkFlowType").keyup(function () {
            var txtContractFrom = $("#ddlModuleType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlWorkFlowType_chosen").removeClass('required');
                $("#ddlWorkFlowType_chosen").addClass('valid');
            }
            else {
                $("#ddlWorkFlowType_chosen").removeClass('valid');
                $("#ddlWorkFlowType_chosen").addClass('required');
            }
        });
        $("#ddlWorkFlowType").change(function () {
            var txtContractFrom = $("#ddlModuleType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlWorkFlowType_chosen").removeClass('required');
                $("#ddlWorkFlowType_chosen").addClass('valid');
            }
            else {
                $("#ddlWorkFlowType_chosen").removeClass('valid');
                $("#ddlWorkFlowType_chosen").addClass('required');
            }
        });



        $("#ddlTransactionType").chosen({});
        $("#ddlTransactionType_chosen").css("width", "100%");
        $("#ddlTransactionType_chosen").addClass('required');

        $("#ddlTransactionType").keyup(function () {
            var txtContractFrom = $("#ddlTransactionType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTransactionType_chosen").removeClass('required');
                $("#ddlTransactionType_chosen").addClass('valid');
            }
            else {
                $("#ddlTransactionType_chosen").removeClass('valid');
                $("#ddlTransactionType_chosen").addClass('required');
            }
        });
        $("#ddlTransactionType").change(function () {
            var txtContractFrom = $("#ddlTransactionType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTransactionType_chosen").removeClass('required');
                $("#ddlTransactionType_chosen").addClass('valid');
            }
            else {
                $("#ddlTransactionType_chosen").removeClass('valid');
                $("#ddlTransactionType_chosen").addClass('required');
            }
        });

        $("#ddlTriggerType").chosen({});
        $("#ddlTriggerType_chosen").css("width", "100%");
        $("#ddlTriggerType_chosen").addClass('required');

        $("#ddlTriggerType").keyup(function () {
            var txtContractFrom = $("#ddlTriggerType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTriggerType_chosen").removeClass('required');
                $("#ddlTriggerType_chosen").addClass('valid');
            }
            else {
                $("#ddlTriggerType_chosen").removeClass('valid');
                $("#ddlTriggerType_chosen").addClass('required');
            }
        });
        $("#ddlTriggerType").change(function () {
            var txtContractFrom = $("#ddlTriggerType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTriggerType_chosen").removeClass('required');
                $("#ddlTriggerType_chosen").addClass('valid');
            }
            else {
                $("#ddlTriggerType_chosen").removeClass('valid');
                $("#ddlTriggerType_chosen").addClass('required');
            }
        });


        $("#ddlTriggerFreType").chosen({});
        $("#ddlTriggerFreType_chosen").css("width", "100%");
        $("#ddlTriggerFreType_chosen").addClass('required');

        $("#ddlTriggerFreType").keyup(function () {
            var txtContractFrom = $("#ddlTriggerFreType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTriggerFreType_chosen").removeClass('required');
                $("#ddlTriggerFreType_chosen").addClass('valid');
            }
            else {
                $("#ddlTriggerFreType_chosen").removeClass('valid');
                $("#ddlTriggerFreType_chosen").addClass('required');
            }
        });
        $("#ddlTriggerFreType").change(function () {
            var txtContractFrom = $("#ddlTriggerFreType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTriggerFreType_chosen").removeClass('required');
                $("#ddlTriggerFreType_chosen").addClass('valid');
            }
            else {
                $("#ddlTriggerFreType_chosen").removeClass('valid');
                $("#ddlTriggerFreType_chosen").addClass('required');
            }
        });


        $("#ddlTableName").chosen({});
        $("#ddlTableName_chosen").css("width", "100%");
        $("#ddlTableName_chosen").addClass('required');
        $("#ddlTableName").keyup(function () {
            var txtContractFrom = $("#ddlTableName").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTableName_chosen").removeClass('required');
                $("#ddlTableName_chosen").addClass('valid');
            }
            else {
                $("#ddlTableName_chosen").removeClass('valid');
                $("#ddlTableName_chosen").addClass('required');
            }
        });
        $("#ddlTableName").change(function () {
            var txtContractFrom = $("#ddlTableName").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlTableName_chosen").removeClass('required');
                $("#ddlTableName_chosen").addClass('valid');
            }
            else {
                $("#ddlTableName_chosen").removeClass('valid');
                $("#ddlTableName_chosen").addClass('required');
            }
        });


        $("#ddlAudienceType").chosen({});
        $("#ddlAudienceType_chosen").css("width", "100%");
        $("#ddlAudienceType_chosen").addClass('required');
        $("#ddlAudienceType").keyup(function () {
            var txtContractFrom = $("#ddlAudienceType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlAudienceType_chosen").removeClass('required');
                $("#ddlAudienceType_chosen").addClass('valid');
            }
            else {
                $("#ddlAudienceType_chosen").removeClass('valid');
                $("#ddlAudienceType_chosen").addClass('required');
            }
        });
        $("#ddlAudienceType").change(function () {
            var txtContractFrom = $("#ddlAudienceType").val();
            if (txtContractFrom.trim() != "0") {
                $("#ddlAudienceType_chosen").removeClass('required');
                $("#ddlAudienceType_chosen").addClass('valid');
            }
            else {
                $("#ddlAudienceType_chosen").removeClass('valid');
                $("#ddlAudienceType_chosen").addClass('required');
            }
        });

        $("#ddlTemplateName").keyup(function () {
            var txtContractFrom = $("#ddlTemplateName").val();
            if (txtContractFrom.trim() != "") {
                $("#ddlTemplateName").removeClass('required');
                $("#ddlTemplateName").addClass('valid');
            }
            else {
                $("#ddlTemplateName").removeClass('valid');
                $("#ddlTemplateName").addClass('required');
            }
        });
        $("#ddlTemplateName").change(function () {
            var txtContractFrom = $("#ddlTemplateName").val();
            if (txtContractFrom.trim() != "") {
                $("#ddlTemplateName").removeClass('required');
                $("#ddlTemplateName").addClass('valid');
            }
            else {
                $("#ddlTemplateName").removeClass('valid');
                $("#ddlTemplateName").addClass('required');
            }
        });

        $("#txtnoofdays").keyup(function () {
            var txtContractFrom = $("#txtnoofdays").val();
            if (txtContractFrom.trim() != "") {
                $("#txtnoofdays").removeClass('required');
                $("#txtnoofdays").addClass('valid');
                getmonth(txtContractFrom);
            }
            else {
                $("#txtnoofdays").removeClass('valid');
                $("#txtnoofdays").addClass('required');
            }
        });
        $("#txtnoofdays").change(function () {
            var txtContractFrom = $("#txtnoofdays").val();
            if (txtContractFrom.trim() != "") {
                $("#txtnoofdays").removeClass('required');
                $("#txtnoofdays").addClass('valid');
                getmonth(txtContractFrom);
            }
            else {
                $("#txtnoofdays").removeClass('valid');
                $("#txtnoofdays").addClass('required');
            }
        });

        $("#txtto").keyup(function () {
            var txtContractFrom = $("#txtto").val();
            if (txtContractFrom.trim() != "") {
                $("#txtto").removeClass('required');
                $("#txtto").addClass('valid');
            }
            else {
                $("#txtto").removeClass('valid');
                $("#txtto").addClass('required');
            }
        });
        $("#txtto").change(function () {
            var txtContractFrom = $("#txtto").val();
            if (txtContractFrom.trim() != "") {
                $("#txtto").removeClass('required');
                $("#txtto").addClass('valid');
            }
            else {
                $("#txtto").removeClass('valid');
                $("#txtto").addClass('required');
            }
        });

    
        $("#txtSubject").keyup(function () {
            var txtContractFrom = $("#txtSubject").val();
            if (txtContractFrom.trim() != "") {
                $("#txtSubject").removeClass('required');
                $("#txtSubject").addClass('valid');
            }
            else {
                $("#txtSubject").removeClass('valid');
                $("#txtSubject").addClass('required');
            }
        });
        $("#txtSubject").change(function () {
            var txtContractFrom = $("#txtSubject").val();
            if (txtContractFrom.trim() != "") {
                $("#txtSubject").removeClass('required');
                $("#txtSubject").addClass('valid');
            }
            else {
                $("#txtSubject").removeClass('valid');
                $("#txtSubject").addClass('required');
            }
        });

        $("#txtSignature").keyup(function () {
            var txtContractFrom = $("#txtSignature").val();
            if (txtContractFrom.trim() != "") {
                $("#txtSignature").removeClass('required');
                $("#txtSignature").addClass('valid');
            }
            else {
                $("#txtSignature").removeClass('valid');
                $("#txtSignature").addClass('required');
            }
        });
        $("#txtSignature").change(function () {
            var txtContractFrom = $("#txtSignature").val();
            if (txtContractFrom.trim() != "") {
                $("#txtSignature").removeClass('required');
                $("#txtSignature").addClass('valid');
            }
            else {
                $("#txtSignature").removeClass('valid');
                $("#txtSignature").addClass('required');
            }
        });
    });

   
</script>

<style>
    .myTableStyleTab td a span {
        font-weight: normal;
        cursor: pointer;
        font-size: 12px;
        color: black;
    }

        .myTableStyleTab td a span:hover {
            font-weight: normal;
            cursor: pointer;
            font-size: 12px;
            color: black;
        }
</style>
