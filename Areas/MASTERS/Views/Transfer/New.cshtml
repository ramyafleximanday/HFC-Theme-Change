@model  IEM.Areas.MASTERS.Models.TransferDataModel
@{
    ViewBag.Title = "Index";
}

<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>
    @using (Html.BeginForm())
    {

        <table class="myTableStyleTabNew" style="width:100%;">
            <tr>
                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Transfer From</span>
                    <br />
                    @Html.DropDownList("cnm", (IEnumerable<SelectListItem>)ViewBag.Employee, "-----Select-----", new { @class = "fstextbox  chosen-select", @style = "display: block;", @id = "Employeeid", @Name = "Employee" })
                </td>
                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Transfer To</span>
                    <br />
                    @Html.DropDownList("cnm", (IEnumerable<SelectListItem>)ViewBag.Module, "-----Select-----", new { @class = "fstextbox  chosen-select", @style = "display: block;", @id = "Moduleid", @Name = "Module" })
                </td>
            </tr>
            <tr>
                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Module</span>
                    <br />
                    @Html.DropDownList("cnm", (IEnumerable<SelectListItem>)ViewBag.OwnerShip, "-----Select-----", new { @class = "fstextbox  chosen-select", @style = "display: block;", @id = "TransferOwnershipid", @Name = "OwnerShip" })
                </td>
                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Transfer Date</span>
                    <br />
                    <input type="text"
                           name="TransferDate"
                           id="TransferDateId"
                           value="@ViewBag.TransferDate"
                           class="fstextbox "
                           maxlength="32" style="width:100%" />

                </td>
            </tr>
            <tr>

                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Ownership</span>
                    <br />
                    @if (@Model.OwnerShip != null)
                    {
                        <div id="divStudentlist" style=" overflow: auto;border:solid;height:200px;padding-left: 2%;padding-top: 4%;padding-bottom: 4%;">

                            @foreach (var names in @Model.OwnerShip)
                            {
                                var checkBoxId = "chk" + names.Value;
                                var tdId = "td" + names.Value;
                                <table>
                                    <tr>
                                        <td style="min-height:20px;">
                                            <input type="checkbox" id="@checkBoxId" class="chkclass" value="@names.Value" />
                                        </td>
                                        <td id="@tdId" style="min-height:20px;">
                                            @names.Text
                                        </td>
                                    </tr>
                                </table>
                            }
                        </div>
                    }
                </td>
                <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>Remarks</span>
                    <br />
                    <input type="text"
                           name="Remarks"
                           id="RemarksId"
                           value="@ViewBag.Remarks"
                           class="fstextbox "
                           maxlength="80" style="width:100%" />
                </td>
            </tr>
            <tr>
                <td colspan="2" style="width:100%; padding:0px 10px 0px 3px; text-align:center;">
                 
                        <button type="button" id="btnsave" class="btn btn-primary" value="Save" onclick="Save()" style="margin-top:20px;">
                    <span class="glyphicon glyphicon-floppy-disk" style="color:white; font-size:12px;"></span> Save</button>
                   
                    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" style="margin-top:20px;">
                        <span style="color:white;font-size:12px;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                    </button>
                   
                </td>
            </tr>
        </table>
    }
<script>
    $("#Employeeid").change(function () {
        var Employee = $("#Employeeid option:selected").val();
        var Module = $("#Moduleid option:selected").val();
        var Ownership = $("#TransferOwnershipid option:selected").val();
        var Remarks = $("#RemarksId").val();
        var date = $("#TransferDateId").val();
        var SelectOwner = null;
        SelectOwner = [];
        $('input:checkbox:checked').each(function () {
            SelectOwner.push($(this).attr('value'));
        });
        if (Employee == "" || Module == "" || Ownership == "" || date == "") {
            $("#btnsave").attr("disabled", true);
            return false;
        }
        else {
            $("#btnsave").attr("disabled", false);
        }
    });
    $("#Moduleid").change(function () {
        var Employee = $("#Employeeid option:selected").val();
        var Module = $("#Moduleid option:selected").val();
        var Ownership = $("#TransferOwnershipid option:selected").val();
        var Remarks = $("#RemarksId").val();
        var date = $("#TransferDateId").val();
        var SelectOwner = null;
        SelectOwner = [];
        $('input:checkbox:checked').each(function () {
            SelectOwner.push($(this).attr('value'));
        });
        if (Employee == "" || Module == "" || Ownership == "" || date == "") {
            $("#btnsave").attr("disabled", true);
            return false;
        }
        else {
            $("#btnsave").attr("disabled", false);
        }
    });
    $("#TransferOwnershipid").change(function () {
        var Employee = $("#Employeeid option:selected").val();
        var Module = $("#Moduleid option:selected").val();
        var Ownership = $("#TransferOwnershipid option:selected").val();
        var Remarks = $("#RemarksId").val();
        var date = $("#TransferDateId").val();
        var SelectOwner = null;
        SelectOwner = [];
        $('input:checkbox:checked').each(function () {
            SelectOwner.push($(this).attr('value'));
        });
        if (Employee == "" || Module == "" || Ownership == "" || date == "") {
            $("#btnsave").attr("disabled", true);
            return false;
        }
        else {
            $("#btnsave").attr("disabled", false);
        }
    });
    $("#TransferDateId").change(function () {
        var Employee = $("#Employeeid option:selected").val();
        var Module = $("#Moduleid option:selected").val();
        var Ownership = $("#TransferOwnershipid option:selected").val();
        var Remarks = $("#RemarksId").val();
        var date = $("#TransferDateId").val();
        var SelectOwner = null;
        SelectOwner = [];
        $('input:checkbox:checked').each(function () {
            SelectOwner.push($(this).attr('value'));
        });
        if (Employee == "" || Module == "" || Ownership == "" || date == "") {
            $("#btnsave").attr("disabled", true);
            return false;
        }
        else {
            $("#btnsave").attr("disabled", false);
        }
    });
    $('#TransferOwnershipid').change(function () {
        var Ownership = $("#TransferOwnershipid option:selected").text();
        var Student =
             {
                 "ModuleName": Ownership
             };
        $.ajax({
            url: '../Transfer/onchange/',
            data: JSON.stringify(Student),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#divStudentlist").empty();
                var table = $('<table style="width: 100%;"></table>');
                if (data.length > 0) {
                    for (var i = 0; i < data.length; i++) {
                        var ids = data[i].OwnerShipId;
                        var names = data[i].OwnerShipName;
                        var newrow = "<tr><td><span>&nbsp;&nbsp;&nbsp;</span><input type='checkbox' id='" + ids + "' value='" + ids + "'  /><span>&nbsp;</span>" + names + "</td></tr>";
                        table.append(newrow);
                    }
                    $('#divStudentlist').append(table);
                }
                if (data.length == 0) {
                    $("#divStudentlist").empty();
                }
            }
        });
    });

    function Save() {
        var Employee = $("#Employeeid option:selected").val();
        var Module = $("#Moduleid option:selected").val();
        var Ownership = $("#TransferOwnershipid option:selected").val();
        var Remarks = $("#RemarksId").val();
        var date = $("#TransferDateId").val();
        var SelectOwner = null;
        SelectOwner = [];
        $('input:checkbox:checked').each(function () {
            SelectOwner.push($(this).attr('value'));
        });
        if (Employee == "" || Module == "" || Ownership == "" || date == "") {
            jAlert("You Can't Add Empty Values", "Information");
            return false;
        }
        var Student = {
            "TranferFrom": Employee,
            "TransferTo": Module,
            "ModuleId": Ownership,
            "Remarks": Remarks,
            "SelectedOwner": SelectOwner,
            "TransferDate": date
        };
        $.ajax({
            url: '../Transfer/AddOwner/',
            data: JSON.stringify(Student),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            success: function (result) {
                isSuccess = result;
                jAlert(result, "Information", function (r) {
                    if (r == true) {
                        window.parent.jQuery('#ForPartialViewMode').dialog('close');
                        location = '../Transfer/Index';
                    }
                });

            },
        })
    }
    function GotoIndex() {
        window.parent.jQuery('#ForPartialViewMode').dialog('close');
    }
    $("#TransferDateId").datepicker({
        changeMonth: true,
        changeYear: true,
        maxDate: '-id',
        dateFormat: 'dd-mm-yy',
    });
    $(document).ready(function () {
        $("#Employeeid").chosen({});
        $("#Moduleid").chosen();
        $("#TransferOwnershipid").chosen();

        $("#Employeeid_chosen, #Moduleid_chosen ,#TransferOwnershipid_chosen").addClass("mychosen").css('width', '100%');
        $("#btnsave").attr("disabled", true);
    });
</script>
