@model IEM.Areas.MASTERS.Models.iem_mst_tax_rate


<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/Rmax_Site.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>
@{
    var viewfor = (string)ViewBag.viewfor;
    if (viewfor == "edit")
    {
        ViewBag.viewmode = "";
    }
    else if (viewfor == "view")
    {
        ViewBag.viewmode = "disabled";
    }
    else if (viewfor == "Delete")
    {
        ViewBag.viewmode = "disabled";
    }
    if (@Model.taxrate_taxsubtype_flag == "Y")
    { ViewBag.yes = "checked"; }
    else
    { ViewBag.no = "checked"; }

    if (@Model.taxrate_change_flag == "Y")
    { ViewBag.yes1 = "checked"; }
    else
    { ViewBag.no1 = "checked"; }

    if (@Model.taxrate_active_flag == "Y")
    { ViewBag.yes2 = "checked"; }
    else
    { ViewBag.no2 = "checked"; }
}

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

    <table class="myTableStyleTabNew" style="width:100%;">
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;display:none ;">
                <input name="DocNameID" id="_Taxrategid" type="text" placeholder="DocName ID" data-val="true" value="@Model.taxrate_gid" />

            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocGrpName">
                    <span>Tax</span>
                    @if (viewfor == "view")
                    {
                        @Html.DropDownListFor(e => e.taxrate_tax_gid, Model.Gettaxratetaxname, "--Select Tax --", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_tax_gid", @disabled = "disabled" })
                    }
                    @if (viewfor == "edit")
                    {
                        @Html.DropDownListFor(e => e.taxrate_tax_gid, Model.Gettaxratetaxname, "--Select Tax --", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_tax_gid" })
                    }
                    @if (viewfor == "Delete")
                    {
                        @Html.DropDownListFor(e => e.taxrate_tax_gid, Model.Gettaxratetaxname, "--Select Tax --", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_tax_gid", @disabled = "disabled" })
                    }

                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <span>  Sub-Tax Flag</span>
                <br />
                <input type="radio" id="Yes" value="Y" checked="@ViewBag.yes" name="Radiotypename1" @ViewBag.viewmode>
                Yes &nbsp;
                <input type="radio" id="No" value="N" checked="@ViewBag.no" name="Radiotypename1" @ViewBag.viewmode>
                No
            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocGrpName">
                    <span> Sub-Tax</span>
                    @if (viewfor == "view")
                    {
                        @Html.DropDownListFor(e => e.taxrate_taxsubtype_gid, Model.Gettaxratetaxsubname, "--Select Sub Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_taxsubtype_gid", @disabled = "disabled" })
                    }
                    @if (viewfor == "edit" && ViewBag.no == "checked")
                    {
                        @Html.DropDownListFor(e => e.taxrate_taxsubtype_gid, Model.Gettaxratetaxsubname, "--Select Sub Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_taxsubtype_gid", @disabled = "disabled" })
                    }
                    @if (viewfor == "edit" && ViewBag.no != "checked")
                    {
                        @Html.DropDownListFor(e => e.taxrate_taxsubtype_gid, Model.Gettaxratetaxsubname, "--Select Sub Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_taxsubtype_gid" })
                    }
                    @if (viewfor == "Delete")
                    {
                        @Html.DropDownListFor(e => e.taxrate_taxsubtype_gid, Model.Gettaxratetaxsubname, "--Select Sub Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "taxrate_taxsubtype_gid", @disabled = "disabled" })
                    }

                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocNameName">
                    <span> Tax Rate </span>
                    <br />
                    <input name="DocNameName" id="_Taxratename" type="text" maxlength="8" 
                           value="@Model.taxrate_rate" class="fstextbox valid " @ViewBag.viewmode style="display: block; " />
                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <span> Allow Rate Change</span>
                <br />
                <input type="radio" id="Yes" value="Y" checked="@ViewBag.yes1" name="Radiotypename2" @ViewBag.viewmode>
                Yes &nbsp;
                <input type="radio" id="No" value="N" checked="@ViewBag.no1" name="Radiotypename2" @ViewBag.viewmode>
                No
            </td>

        </tr>
        <tr>
            <td>
                <span>Period From</span>
                <br />
                <input type="text"
                       name="cbfenddate"
                       id="cbfendate_id"
                       maxlength="10" value="@Model.taxrate_period_from" @ViewBag.viewmode
                       class="fstextbox  valid"
                       />
            </td>
        </tr>
        <tr>
            <td>
                <span>Period To</span>
                <br />
                <input type="text"
                       name="cbfenddate1"
                       id="cbfendate_id1"
                       maxlength="10" value="@Model.taxrate_period_to" @ViewBag.viewmode
                       class="fstextbox  valid"
                        />
            </td>
        </tr>
        <tr>
            <td>
                <span> Active</span>
                <br />
                <input type="radio" id="Yes" value="Y" checked="@ViewBag.yes2" name="Radiotypename3" @ViewBag.viewmode>
                Yes &nbsp;
                <input type="radio" id="No" value="N" checked="@ViewBag.no2" name="Radiotypename3" @ViewBag.viewmode>
                No
            </td>

        </tr>
        <tr>
            <td colspan="2" align="center">
                @*<input type="button" class="btn btn-primary" value="Save" onclick="SAVE()" @ViewBag.viewmode />
                    <input type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" />*@
                @if (viewfor == "view")
                {
                    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()"> <span style="color:white;" class="glyphicon glyphicon-remove"></span>Close</button>

                }
                @if (viewfor == "edit")
                {
                    <button type="button" class="btn btn-primary" id="btnsave" value="Save" onclick="SAVE()"> <span class="glyphicon glyphicon-floppy-save" style="color:white;"></span>Save</button>
                    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()"> <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span>Cancel</button>
                }
                @if (viewfor == "Delete")
                {
                    <button type="button" class="btn btn-danger" value="Delete" onclick="Delete()"> <span class="glyphicon glyphicon-trash" style="color:white;"></span>Delete</button>
                    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()"> <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span>Cancel</button>
                }
            </td>
        </tr>
    </table>
}
<script type="text/javascript">
    $(document).ready(function () {

        $("#taxrate_tax_gid").chosen({});
        $("#taxrate_tax_gid_chosen").css("width", "100%");

        $("#taxrate_taxsubtype_gid").chosen({});
        $("#taxrate_taxsubtype_gid_chosen").css("width", "100%");


        var objDate = new Date();
        var Presentyear = objDate.getFullYear();
        //$("#cbfendate_id").datepicker({
        //    yearRange: '1900:' + Presentyear,
        //    changeMonth: true,
        //    changeYear: true,
        //    maxDate: 'd',
        //    dateFormat: 'dd-mm-yy'
        //});
        //$("#cbfendate_id1").datepicker({
        //    yearRange: '1900:' + Presentyear,
        //    changeMonth: true,
        //    changeYear: true,
        //    maxDate: 'd',
        //    dateFormat: 'dd-mm-yy'
        //});

        $("#cbfendate_id").datepicker({
            yearRange: '1900:' + Presentyear,
            numberOfMonths: 1,
            changeMonth: true,
            changeYear: true,
            maxDate: 'd',
            dateFormat: 'dd-mm-yy',
            onSelect: function (selected) {
                $("#cbfendate_id1").datepicker("option", "minDate", selected);
                ChangeFromDate();
            }
        });

        $("#cbfendate_id1").datepicker({
            changeYear: true,
            numberOfMonths: 1,
            changeMonth: true,
            dateFormat: 'dd-mm-yy',
            onSelect: function (selected) {
                $("#cbfendate_id").datepicker("option", "maxDate", selected);
                ChangeToDate();
            }
        });

        //$("#cbfendate_id").change(function () {
        //    var txtDate = $("#cbfendate_id").val();
        //    if (txtDate.trim() != "") {
        //        var taxratenm = $("#_Taxratename").val();
        //        var dt = $('#cbfendate_id').val();
        //        var dt1 = $('#cbfendate_id1').val();
        //        var taxnamegid = $("#taxname_gid").val();
        //        var taxsubflag = $('input[name=Radiotypename1]:checked').val();
        //        if (taxsubflag == 'N') {
        //            if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
        //                $("#btnsave").attr("disabled", true);
        //            }
        //            else {
        //                $("#btnsave").removeAttr('disabled');
        //            }
        //        }
        //        else {
        //            var taxsubname = $("#taxsubtype_gid").val();

        //            if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "" || taxsubname == "" || taxsubname == null) {
        //                $("#btnsave").attr("disabled", true);
        //            }
        //            else {
        //                $("#btnsave").removeAttr('disabled');
        //            }
        //        }

        //        $("#cbfendate_id").removeClass('required');
        //        $("#cbfendate_id").addClass('valid');
        //    }
        //    else {
        //        $("#cbfendate_id").removeClass('valid');
        //        $("#cbfendate_id").addClass('required');
        //    }
        //});
        //$("#cbfendate_id1").change(function () {
        //    var txtDate = $("#cbfendate_id1").val();
        //    if (txtDate.trim() != "") {
        //        var taxratenm = $("#_Taxratename").val();
        //        var dt = $('#cbfendate_id').val();
        //        var dt1 = $('#cbfendate_id1').val();
        //        var taxnamegid = $("#taxname_gid").val();
        //        var taxsubflag = $('input[name=Radiotypename1]:checked').val();
        //        if (taxsubflag == 'N') {
        //            if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
        //                $("#btnsave").attr("disabled", true);
        //            }
        //            else {
        //                $("#btnsave").removeAttr('disabled');
        //            }
        //        }
        //        else {
        //            var taxsubname = $("#taxsubtype_gid").val();

        //            if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "" || taxsubname == "" || taxsubname == null) {
        //                $("#btnsave").attr("disabled", true);
        //            }
        //            else {
        //                $("#btnsave").removeAttr('disabled');
        //            }
        //        }
        //        $("#cbfendate_id1").removeClass('required');
        //        $("#cbfendate_id1").addClass('valid');
        //    }
        //    else {
        //        $("#cbfendate_id1").removeClass('valid');
        //        $("#cbfendate_id1").addClass('required');
        //    }
        //});

    });

    //$("#_Taxratename").keyup(function (event) {
    //    if (event.which >= 37 && event.which <= 40) {
    //        event.preventDefault();
    //    }

    //    var currentval = $(this).val();
    //    var testDecimal = testDecimals(currentval);
    //    if (testDecimal.length > 1) {
    //        currentval = currentval.slice(0, -1);
    //    }
    //    $(this).val(replaceCommas(currentval));
    //});

    $("#_Taxratename").ready(function () {
        var currentval = $("#_Taxratename").val();
        $("#_Taxratename").val(replaceCommas(currentval));
    });

    
    
    //function isEvent(evt) {
    //    return false;
    //}
    $('#taxrate_tax_gid').change(function () {

        var ddlid = $(this).val();

        var expensen =
            {
                "taxrate_tax_gid": ddlid
            };

        $.ajax({
            url: '@Url.Action("Taxratesub", "IEM_TAX_RATE")',

            data: JSON.stringify(expensen),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {

                $("#taxrate_taxsubtype_gid").empty();

                if (data.length > 0) {
                    //    $("#taxrate_taxsubtype_gid").append("<option value='0' >--Select Tax Sub Type--</option>");

                    for (var i = 0; i < data.length; i++) {
                        $('#taxrate_taxsubtype_gid').attr('disabled', false);

                        $("#taxrate_taxsubtype_gid").append("<option value=" + data[i].taxsub_gid + " >" + data[i].taxsub_name + "</option>");
                    }


                    $("#taxrate_taxsubtype_gid").chosen({});
                    $("#taxrate_taxsubtype_gid_chosen").css("width", "100%");
                    $("#taxrate_taxsubtype_gid").trigger('chosen:updated');

                }

                if (data.length == 0) {
                    $("#taxrate_taxsubtype_gid").append("<option value='0' >--Select Tax Sub Type--</option>");
                    $('#taxrate_taxsubtype_gid').attr('disabled', true);
                    $("#taxrate_taxsubtype_gid").trigger('chosen:updated');
                }
                if (data.length == null) {

                }
            },
            error: function (result) {
                alert("Error");
            }
        });
    });
    //$("#cbfendate_id").change(function () {
    //    var dt1 = $('#cbfendate_id').val();
    //    var dt2 = $('#cbfendate_id1').val();

    //    if (dt1 < dt2) {

    //        jAlert('Period From Date Should Not be Less than or Equal To Period To Date', "Error");

    //    }
    //    var taxratenm = $("#_Taxratename").val();
    //    var dt = $('#cbfendate_id').val();
    //    var dt1 = $('#cbfendate_id1').val();
    //    var taxnamegid = $("#taxrate_tax_gid").val();
    //    if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
    //        $("#btnsave").attr("disabled", true);
    //    }
    //    else {
    //        $("#btnsave").removeAttr('disabled');
    //    }
    //});
    $("#taxrate_tax_gid").change(function () {
        var taxratenm = $("#_Taxratename").val();
        var dt = $('#cbfendate_id').val();
        var dt1 = $('#cbfendate_id1').val();
        var taxnamegid = $("#taxrate_tax_gid").val();
        if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
            $("#btnsave").attr("disabled", true);
        }
        else {
            $("#btnsave").removeAttr('disabled');
        }
    });
    $("#_Taxratename").keyup(function (event) {
        if (event.which >= 37 && event.which <= 40) {
            event.preventDefault();
        }

        var currentval = $(this).val();
        var testDecimal = testDecimals(currentval);
        if (testDecimal.length > 1) {
            currentval = currentval.slice(0, -1);
        }
        $(this).val(replaceCommas(currentval));

        var taxratenm = $("#_Taxratename").val();
        var dt = $('#cbfendate_id').val();
        var dt1 = $('#cbfendate_id1').val();
        var taxnamegid = $("#taxrate_tax_gid").val();
        if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
            $("#btnsave").attr("disabled", true);
        }
        else {
            $("#btnsave").removeAttr('disabled');
        }


        var txtSupplierName = $("#_Taxratename").val();
        if (txtSupplierName.trim() != "") {
            $("#_Taxratename").removeClass('required');
            $("#_Taxratename").addClass('valid');
        }
        else {
            $("#_Taxratename").removeClass('valid');
            $("#_Taxratename").addClass('required');
        }
    });
    $('input[name=Radiotypename1]').change(function () {

        if ($('input[name=Radiotypename1]:checked').val() == 'Y') {

            $('#taxrate_taxsubtype_gid').attr('disabled', false);
            $("#taxrate_taxsubtype_gid").trigger('chosen:updated');
            var ddlid = $("#taxrate_tax_gid").val();

            var expensen =
                {
                    "taxrate_tax_gid": ddlid
                };

            $.ajax({
                url: '@Url.Action("Taxratesub", "IEM_TAX_RATE")',

                data: JSON.stringify(expensen),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',

                success: function (data) {

                    $("#taxrate_taxsubtype_gid").empty();

                    if (data.length > 0) {
                        //$("#taxrate_taxsubtype_gid").append("<option value='0' >--Select Tax Sub Type--</option>");

                        for (var i = 0; i < data.length; i++) {
                            $('#taxrate_taxsubtype_gid').attr('disabled', false);
                            $("#taxrate_taxsubtype_gid").trigger('chosen:updated');

                            $("#taxrate_taxsubtype_gid").append("<option value=" + data[i].taxsub_gid + " >" + data[i].taxsub_name + "</option>");
                        }
                    }

                    if (data.length == 0) {
                        $("#taxrate_taxsubtype_gid").append("<option value='0' >--Select Tax Sub Type--</option>");
                        $('#taxrate_taxsubtype_gid').attr('disabled', true);
                        $("#taxrate_taxsubtype_gid").trigger('chosen:updated');
                    }
                    if (data.length == null) {

                    }
                },
                error: function (result) {
                    alert("Error");
                }
            });
        }
        else {
            $('#taxrate_taxsubtype_gid').attr('disabled', true);
            $("#taxrate_taxsubtype_gid").empty();
            $("#taxrate_taxsubtype_gid").trigger('chosen:updated');
        }
    });
    function SAVE() {
        var taxgid = $('#_Taxrategid').val();

        var taxratenm = $('#_Taxratename').val().replace(",", "");
        if (taxratenm <= 0) {
            jAlert("TAX Rate Should be Greater than Zero !", "Information");
            return false;
        }
        var taxsubflag = $('input[name=Radiotypename1]:checked').val();
        var taxsubname = $("#taxrate_taxsubtype_gid").val();
        var taxratechange = $('input[name=Radiotypename2]:checked').val();
        var dt = $('#cbfendate_id').val();
        var dt1 = $('#cbfendate_id1').val();
        var avtive = $('input[name=Radiotypename3]:checked').val();
        var taxnamegid = $("#taxrate_tax_gid").val();
        if (taxsubflag == 'N') {
            taxsubname = 0;
        }
        else {
            taxsubname = $("#taxrate_taxsubtype_gid").val();
        }

        var taxModel1 = {
            "taxrate_taxsubtype_flag": taxsubflag, "taxrate_taxsubtype_gid": taxsubname,
            "taxrate_rate": taxratenm, "taxrate_change_flag": taxratechange, "taxrate_period_from": dt,
            "taxrate_period_to": dt1, "taxrate_active_flag": avtive, "taxrate_tax_gid": taxnamegid,
            "taxrate_gid": taxgid
        };

        $.post('../IEM_TAX_RATE/edittaxrate', taxModel1,
             //function (data) {

             //    jAlert('Record updated successfully !', "Information", function (r) {
             //        if (r == true) {
             //            location = '../IEM_TAX_RATE/Index';
             //        }
             //    });
             //}
             function (data) {
                 if (data != "success") {
                     jAlert(data, "Information", function (r) {
                         if (r == true) {
                             return false;
                         }
                     });
                 }
                 else {
                     jAlert('Record Updated successfully !', "Information", function (r) {
                         if (r == true) {
                             location = '../IEM_TAX_RATE/Index';
                         }
                     });

                 }
             }
        , 'json');

    }
    function Delete() {
        var id = $("#_Taxrategid").val();
        var taxModel = { "taxrate_gid": id }
        jConfirm("Do you want to delete this Tax Rate? ", "Delete Tax Rate", function (j) {
            if (j == true) {
                $.post('../IEM_TAX_RATE/Delettaxrate', taxModel,
                     function (data) { if (data == 0) { location = location.href; } else { location = '../IEM_TAX_RATE/Index'; } }, 'json');
            }
            else { return false; }
        });
    }
    function GotoIndex() {

        window.parent.jQuery('#ForPartialView').dialog('close');
    }
    function ChangeFromDate() {
        var txtDate = $("#cbfendate_id").val();
        if (txtDate.trim() != "") {
                var taxratenm = $("#_Taxratename").val();
                var dt = $('#cbfendate_id').val();
                var dt1 = $('#cbfendate_id1').val();
                var taxnamegid = $("#taxrate_tax_gid").val();
                var taxsubflag = $('input[name=Radiotypename1]:checked').val();
                if (taxsubflag == 'N') {
                    if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
                        $("#btnsave").attr("disabled", true);
                    }
                    else {
                        $("#btnsave").removeAttr('disabled');                    }
                }
                else {
                    var taxsubname = $("#taxrate_taxsubtype_gid").val();

                    if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "" || taxsubname == "" || taxsubname == null) {
                        $("#btnsave").attr("disabled", true);
                    }
                    else {
                        $("#btnsave").removeAttr('disabled');
                    }
                }

                $("#cbfendate_id").removeClass('required');
                $("#cbfendate_id").addClass('valid');
            }
            else {
                $("#cbfendate_id").removeClass('valid');
                $("#cbfendate_id").addClass('required');
            }
    }
    function ChangeToDate() {
        var txtDate = $("#cbfendate_id1").val();
        if (txtDate.trim() != "") {
                var taxratenm = $("#_Taxratename").val();
                var dt = $('#cbfendate_id').val();
                var dt1 = $('#cbfendate_id1').val();
                var taxnamegid = $("#taxrate_tax_gid").val();
                var taxsubflag = $('input[name=Radiotypename1]:checked').val();
                if (taxsubflag == 'N') {
                    if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "") {
                        $("#btnsave").attr("disabled", true);
                    }
                    else {
                        $("#btnsave").removeAttr('disabled');
                    }
                }
                else {
                    var taxsubname = $("#taxrate_taxsubtype_gid").val();
                    if (taxnamegid == "" || taxratenm == "" || dt == "" || dt1 == "" || taxsubname == "" || taxsubname == null) {
                        $("#btnsave").attr("disabled", true);
                    }
                    else {
                        $("#btnsave").removeAttr('disabled');
                    }
                }
                $("#cbfendate_id1").removeClass('required');
                $("#cbfendate_id1").addClass('valid');
            }
            else {
                $("#cbfendate_id1").removeClass('valid');
                $("#cbfendate_id1").addClass('required');
            }
    }
</script>