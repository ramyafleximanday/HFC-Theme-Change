@model IEM.Areas.FLEXIBUY.Models.woraiser
<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

@{
    ViewBag.Title = "woraiser";
    Layout = "~/Views/Shared/LayoutEmpty.cshtml";
    var viewfor = (string)Session["viewfor"];
   
    ViewBag.viewmode = "disabled";
    Session["prgid"] = Model.woheadGid;
}
<input type="hidden" id="hid_uomgid" value="@Model.uomgid" />
<input type="hidden" id="hid_prodservgid" value="@Model.prodservicegid" />
<input type="hidden" id="hid_tempcontent" value="@Model.tempName" />
<input type="hidden" id="hid_tempname" value="@Model.templname" />
<input type="hidden" id="hid_tempaddcontent" value="@Model.additionTemplate" />
<input type="hidden" id="hid_requestfor" value="@Model.requestforgid" />
<input type="hidden" id="hid_vendorgid" value="@Model.vendorgid" />
@*<input type="hidden" id="dev_amount" value="@Model.devamount" />*@
@*<input type="hidden" id="cbf_headamount" value="@Model.cbfheadAmount" />*@
<input type="hidden" id="hid_dept" value="@Model.department" />
<input type="hidden" id="hid_woamount" value="@Model.overTotal" />
<input type="hidden" id="hid_itType" value="@Model.itType">
<input type="hidden" id="hid_woheadgid" value="@Model.woheadGid">
<input type="hidden" id="hid_wocancelgid" value="@Model.woCancelGid" />
<input type="hidden" id="hid_woclosuregid" value="@Model.woClosureGid" />
<input type="hidden" id="hid_womak_remarks" value="@Model.remarks" />

<div class="well">

    <span style="color: rgb(52, 108, 196);">WO Header</span>

    <br /><br />
    @using (Html.BeginForm())
    {
        <div class="borderStyle panel panel-default " align="center">
            <table class="myTableStyleTabNew" width="100%">
                <tr>
                    <td style="padding:10px;">
                        <span>WO Ref No</span>
                        <br />
                        <input type="text"
                               name="txtworefno"
                               id="txtworefno"
                               disabled="disabled"
                               value="@Model.worefno"
                               class="textboxStyle valid valid" />
                    </td>
                    <td style="padding:10px;">
                        <span>WO Date </span>
                        <br />
                        <input type="text"
                               id="txtwodate"
                               maxlength="10"
                               value="@Model.wodate"
                               disabled="disabled"
                               class="textboxStyle valid " @ViewBag.viewmode />
                    </td>
                    <td style="padding:10px;">
                        <span>Raised By</span>
                        <br />
                        <input type="text"
                               name="txtraisedby"
                               id="txtraisedby"
                               value="@Model.raisedby"
                               class="textboxStyle valid" @ViewBag.viewmode />
                    </td>
                    <td nowrap="nowrap" colspan="3" style="padding:10px;">
                        <span>Vendor Name</span>
                        <br />
                        <input type="text"
                               name="txtvendorname"
                               id="txtvendorname"
                               disabled="disabled"
                               value="@Model.vendorName"
                               class="textboxStyle valid" />
                    </td>
                    @*<td width="138px">
                            <span>Project Manager </span>
                            <br />
                            @if (viewfor == "edit" || viewfor=="amend")
                            {
                                @Html.DropDownList("projmanagergid", Model.projmanagerList, "--Select--", new { @class = "textboxStyle valid" })
                            }
                            else
                            {
                                @Html.DropDownList("projmanagergid", Model.projmanagerList, "--Select--", new { @class = "textboxStyle valid", @disabled = "disabled" })
                            }
                        </td>*@
                </tr>
                @*<tr>
                        <td></td>
                    </tr>*@
                <tr>
                    <td style="padding:10px;">
                        <span>Department</span>
                        <br />
                        <input type="text"
                               name="txtdepartment"
                               id="txtdepartment"
                               disabled="disabled"
                               value="@Model.department"
                               class="textboxStyle valid" />
                    </td>

                    <td style="padding:10px;">
                        <span>Type</span>
                        <br />
                        <div style="margin-top:5px;">
                            <input type="radio" id="id_rdapp" name="it" value="Application" @ViewBag.viewmode />
                            Application
                            <input type="radio" id="id_rdinfar" name="it" value="Infrastructure" @ViewBag.viewmode />
                            Infrastructure
                        </div>
                    </td>
                    <td nowrap="nowrap" colspan="3" style="padding:10px;">
                        <span>Description(Vendor Note)</span>
                        <br />
                        <input type="text"
                               name="txt_vendornote"
                               class="textboxStyleBig valid"
                               value="@Model.vendorNote"
                               id="txtvendornote" @ViewBag.viewmode />
                    </td>
                </tr>
            </table>
        </div>

        <span style="color: rgb(52, 108, 196);">Frequency</span>

        <br /><br />
        <div id="podetailsgrid">
            <div>
                @Html.Partial("WoEditDetails")
            </div>
        </div>
    }

    <span style="color: rgb(52, 108, 196);">WO Template</span>

    <br />
    <table class="myTableStyleTabNew">
      
        <tr>
            <td>
                <span>Terms and Condtions</span>
                <br />
                <div>
                        <table>
                            <tr>
                                <td>
                                    <div style="margin-left: 492px;">
                                        <span>Template</span>
                                    </div>
                                </td>
                                <td>
                                    &nbsp;
                                </td>
                                <td>
                                    <div>
                                        <b id="temp_name"></b>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    <textarea style="width:1193px;height:344px;resize:none"
                              draggable="false" id="txtWoTempl" class="textareaStyle" @ViewBag.viewmode></textarea>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td>
                <span>Additional Terms and Conditions</span>
                <div>
                    <textarea style="width:1193px;height:200px;resize:none"
                              draggable="false" id="txtWoTempl1" class="textareaStyle"></textarea>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                &nbsp;
            </td>
        </tr>
    </table>
   
    <div id="tabsat" style="height:300px;font-size:14px;">
        <ul>
            <li><a href="#tabs-1">Audit Trail</a></li>
        </ul>
        <div id="tabs-1">
            @Html.Partial("tab_auditrailWO")
        </div>

    </div>
   

    <input hidden="hidden" id="ss" value="" />
    <input hidden="hidden" id="potemplate" value="" />
    <input hidden="hidden" id="dd" value="" />
    @*<input hidden="hidden" id="bulk" value="" />
        <input hidden="hidden" id="hid_excel" value="" />*@
    <div id="ForWOTemplate"></div>
</div>
<script type="text/javascript">
    var temp_name = $("#hid_tempname").val();
    $("#temp_name").text(temp_name);

    $(document).ready(function () {

        var makerrem_desc = $("#hid_womak_remarks").val();
        $("#desc_womaker_id").val(makerrem_desc);
        $("#desc_womaker_id").attr("disabled", true);

        var additionTemplate = $("#hid_tempaddcontent").val();
        var templateContent = $("#hid_tempcontent").val();
        $('#txtWoTempl').val(templateContent);
        $('#txtWoTempl').attr("disabled", true);
        $("#txtWoTempl1").val(additionTemplate);



        $("#idpodate", "#idpoendDate").attr("maxlength", "10");
        $("#txtvendornote").attr("maxlength", "256");
        $("#txtporefno").attr('disabled', 'disabled');
        $("#txtwoendDate").keypress(function (event) {
            return isDate(event);
        });
        var department = $("#hid_dept").val();
        if (department == "PIP") {
            $("#id_rdapp").attr("checked", false);
            $('[name="it"]').attr("disabled", true);
            //$("#id_dept").attr("disabled", true);
        }
        var itType = $("#hid_itType").val();
        if (itType == 'A') {
            $("#id_rdapp").attr("checked", true);
        }
        else {
            $("#id_rdinfar").attr("checked", true);
        }
        var pickerOpts = {
            changeMonth: true,
            changeYear: true,
            yearRange: '1950:2100',
            currentText: "Now",
            dateFormat: "dd-mm-yy"
        };

        $("#projmanagergid").change(function () {
            var projmanager = $("#projmanagergid").val();
            // var selectedValue = $("#projmanagergid option:selected").text();
            if (projmanager.trim() != "") {
                $("#projmanagergid").removeClass('required');
                $("#projmanagergid").addClass('valid');
            }
            else {
                $("#projmanagergid").removeClass('valid');
                $("#projmanagergid").addClass('required');
            }
        });
        $("#txtvendornote").keyup(function () {
            var vendorNote = $("#txtvendornote").val();
            if (vendorNote.trim() != "") {
                $("#txtvendornote").removeClass('required');
                $("#txtvendornote").addClass('valid');
            }
            else {
                $("#txtvendornote").removeClass('valid');
                $("#txtvendornote").addClass('required');
            }
        });
        $("#txt_remarks").keyup(function () {
            var remarks = $("#txt_remarks").val();
            if (remarks.trim() != "") {
                $("#txt_remarks").removeClass('required');
                $("#txt_remarks").addClass('valid');
            }
            else {
                $("#txt_remarks").removeClass('valid');
                $("#txt_remarks").addClass('required');
            }
        });
        //$("txtpodate").datepicker(pickerOpts);
        $("#txtwoendDate").change(function () {

            var dt = $('#txtwodate').val();
            var dt2 = $('#txtwoendDate').val();
            if (dt2.trim() != "") {
                $("#txtwoendDate").removeClass('required');
                $("#txtwoendDate").addClass('valid');
            }
            else {
                $("#txtwoendDate").removeClass('valid');
                $("#txtwoendDate").addClass('required');
            }
            var start_date = dt.split('-');
            var startDate = new Date(start_date[2], start_date[1], start_date[0]);
            var end_date = dt2.split('-');
            var endDate = new Date(end_date[2], end_date[1], end_date[0]);
            if (startDate > endDate) {
                jAlert('WO Enddate Should Not be Lesser than WO date', "Error");
                $("#txtwoendDate").val(dt);
            }
        });

        $("#txtwodate").change(function () {
            var dt = $('#txtwodate').val();
            var dt2 = $('#txtwoendDate').val();
            var start_date = dt.split('-');
            var startDate = new Date(start_date[2], start_date[1], start_date[0]);
            var end_date = dt2.split('-');
            var endDate = new Date(end_date[2], end_date[1], end_date[0]);
            if (startDate > endDate) {
                jAlert('WO Enddate Should Not be Lesser than WO date', "Error");
                $("#txtwoendDate").val(dt);
            }
        });

        $("#txtwoendDate").datepicker(pickerOpts)

        $("#ss").val("");
        $("#dd").val("");
        $("#bulk").val("");
        $("#potemplate").val("");
        $("#hid_excel").val("");

        if ($("#templateGid").val() != "--Select--") {

            var tempGid = $("#templateGid").val();
            $("#templateGid").removeClass('required');
            $("#templateGid").addClass('valid');
            $.ajax({
                url: '@Url.Action("TemplateDetails", "poraiser")?' + new Date().getTime(),
                dataType: 'json',
                data: { id: tempGid },
                success: function (msg) {
                    if (msg == 0) {
                        jAlert("Error Occured", "Error");
                        return false;
                    }
                    else {
                        $("#txtWoTempl").attr("value", msg);
                        $("#txtWoTempl").attr("readonly", true);
                    }
                    //if ($("#txtTemplateArea").val() != null || $("#txtTemplateArea").val() != "") {
                    //    $("#txtTemplateArea").addClass("valid");
                    //}
                },
                error: function () { }
            });
        }
    });
    var objTemplate;
    function CreateWoTemplate() {
        if ($('#potemplate').val() == "") {
            $("#potemplate").val("asd");
            objTemplate = $("[id$='ForWOTemplate']");
            objTemplate.dialog({
                autoOpen: false,
                modal: true,
                cache: false,
                show: 'fade-in',
                close: 'fade-out',
            });
        }
        objTemplate.load('@Url.Action("CreateWoTemplate", "WoRaiser")');
        objTemplate.dialog({ title: 'Create Template', width: '892', height: '575' });
        objTemplate.dialog("open");
    }
    $("#templateGid").change(function () {
        var templategid = $("#templateGid option:selected").text();
        if (templategid == "--Select--") {
            $("#txtWoTempl").val("");
        }
        if ($("#templateGid").val() != "--Select--") {
            var tempGid = $("#templateGid").val();
            if (tempGid.trim() != "") {
                $("#templateGid").removeClass('required');
                $("#templateGid").addClass('valid');
            }
            else {
                $("#templateGid").removeClass('valid');
                $("#templateGid").addClass('required');
            }
            $.ajax({
                url: '@Url.Action("TemplateDetails", "WoRaiser")?' + new Date().getTime(),
                dataType: 'json',
                data: { id: $(this).val() },
                success: function (msg) {
                    if (msg == 0) {
                        jAlert("Error Occured", "Error");
                        return false;
                    }
                    else {
                        $("#txtWoTempl").attr("value", msg);
                        $("#txtWoTempl").attr("disabled", true);
                    }
                    //if ($("#txtTemplateArea").val() != null || $("#txtTemplateArea").val() != "") {
                    //    $("#txtTemplateArea").addClass("valid");
                    //}
                },
                error: function () { }
            });
        }
    });

    //$("#monthId").change(function () {
    //    if ($("#monthId").val() != "--Select--") {
    //        var month = $("#monthId").val();
    //        if (month.trim() != "") {
    //            $("#monthId").removeClass('required');
    //            $("#monthId").addClass('valid');
    //        }
    //        else {
    //            $("#monthId").removeClass('valid');
    //            $("#monthId").addClass('required');
    //        }
    //    }

    //});

    function UpdateWodetails() {
        var wodate = $('#txtwodate').val();
        //var woendDate = $('#txtwoendDate').val();
        //var txtraisedby = $('#dropbranch').val();
        // var projmanagergid = $("#projmanagergid").val();
        //var e = document.getElementById("projmanagergid");
        // var selectedmanager = e.options[e.selectedIndex].text;
        //var department = $("#txtdepartment").val();
        //var vendorName = $("#txtvendorname").val();
        var itType = $("input[name='it']:checked").val();
        var vendorNote = $('#txtvendornote').val();
        var tempgid = $('#templateGid').val();
        //var e = document.getElementById("templateGid");
        //var selectedtemplate = e.options[e.selectedIndex].text;
        var templategid = $("#templateGid option:selected").text();
        var additionTemplate = $("#txtWoTempl1").val();
        var overTotal = $("#grandtotal").text();
        //var uomgid = $("#hid_uomgid").val();
        //var prodservgid = $("#hid_prodservgid").val();
        //var requestfor = $("#hid_requestfor").val();
        //var vendorgid = $("#hid_vendorgid").val();
        //var monthName = $("#monthId option:selected").text();
        //var monthName1 = $("#monthId1 option:selected").text();
        var obfAmount = $("#hid_woamount").val();
        var freqid = $("#freqId").val();
        var woheadgid = $("#hid_woheadgid").val();

        if (parseFloat(overTotal) < parseFloat(obfAmount)) {
            jAlert("Total Amount Should Match with WO Amount '" + obfAmount + "' ", "Error");
            return false;
        }
        if (parseFloat(overTotal) == parseFloat(0) || parseFloat(overTotal) == "" || parseFloat(overTotal) == null) {
            jAlert("Total Amount Cannot be Empty or Zero", "Error");
            return false;
        }
        if (wodate == null || wodate == "") {

            jAlert("Please Select WO Date.", "Error");
            return false;
        }
        //if (woendDate == null || woendDate == "") {

        //    jAlert("Please Select WO End Date.", "Error");
        //    return false;
        //}
        //if (selectedmanager == "--Select--") {

        //    jAlert("Please Select Project Manager", "Error");
        //    return false;
        //}
        if (vendorNote == null || vendorNote == "") {

            jAlert("Please Enter Vendor Note", "Error");
            return false;
        }
        if (templategid == "--Select--") {
            jAlert("Please Select WO Template");
            return false;
        }
        else {
            var objwoheader =
            {
                //"woenddate": woendDate,
                //"projmanagergid": projmanagergid,
                "itType": itType,
                "vendorNote": vendorNote,
                "templateGid": tempgid,
                "additionTemplate": additionTemplate,
                "overTotal": overTotal,
                "woheadgid": woheadgid
            };
            $.post('@Url.Action("SaveWoDetails","WoRaiserEdit")', objwoheader,
               function (data) {
                   if (data == 0) {
                       jAlert("Error Occured", "Error");
                       return false;
                   }
                   else {
                       if (data == "Updated Successfully") {
                           jAlert("Updated Successfully", "Success", function (e) {
                               if (e == true) {
                                   var viewfor = "refresh";
                                   //location = '@Url.Action("WoSummary", "WoSummary")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                               }
                           });
                       }
                       else {
                           if (data == "") {
                               jAlert("Please Add Frequency and WO Details", "Message");
                           }
                           else {
                               jAlert(data, "Error");
                           }
                           return false;
                       }
                   }
               }, 'json');
        }
    }
    function UpdateWo() {
        var wodate = $('#txtwodate').val();
        //  var woendDate = $('#txtwoendDate').val();
        //var txtraisedby = $('#dropbranch').val();
        //var projmanagergid = $("#projmanagergid").val();
        //var e = document.getElementById("projmanagergid");
        //  var selectedmanager = e.options[e.selectedIndex].text;
        //var department = $("#txtdepartment").val();
        //var vendorName = $("#txtvendorname").val();
        var itType = $("input[name='it']:checked").val();
        var vendorNote = $('#txtvendornote').val();
        var tempgid = $('#templateGid').val();
        //var e = document.getElementById("templateGid");
        //var selectedtemplate = e.options[e.selectedIndex].text;
        var templategid = $("#templateGid option:selected").text();
        var additionTemplate = $("#txtWoTempl1").val();
        var overTotal = $("#grandtotal").text();
        //var uomgid = $("#hid_uomgid").val();
        //var prodservgid = $("#hid_prodservgid").val();
        //var requestfor = $("#hid_requestfor").val();
        //var vendorgid = $("#hid_vendorgid").val();
        //var monthName = $("#monthId option:selected").text();
        //var monthName1 = $("#monthId1 option:selected").text();
        var obfAmount = $("#hid_woamount").val();
        var freqid = $("#freqId").val();
        var woheadgid = $("#hid_woheadgid").val();
        var action = $("#btn_submitwo").val();

        if (parseFloat(overTotal) < parseFloat(obfAmount)) {
            jAlert("Total Amount Should Match with WO Amount '" + obfAmount + "' ", "Error");
            return false;
        }
        if (parseFloat(overTotal) == parseFloat(0) || parseFloat(overTotal) == "" || parseFloat(overTotal) == null) {
            jAlert("Total Amount Cannot be Empty or Zero", "Error");
            return false;
        }
        if (wodate == null || wodate == "") {

            jAlert("Please Select WO Date.", "Error");
            return false;
        }
        if (vendorNote == null || vendorNote == "") {

            jAlert("Please Enter Vendor Note", "Error");
            return false;
        }
        if (templategid == "--Select--") {
            jAlert("Please Select WO Template");
            return false;
        }
        else {
            var objwoheader =
            {
                //"woenddate": woendDate,
                //"projmanagergid": projmanagergid,
                "itType": itType,
                "vendorNote": vendorNote,
                "templateGid": tempgid,
                "additionTemplate": additionTemplate,
                "overTotal": overTotal,
                "woheadgid": woheadgid,
                "actionName": action
            };
            $.post('@Url.Action("SaveWoDetails","WoRaiserEdit")', objwoheader,
               function (data) {
                   if (data == 0) {
                       jAlert("Error Occured", "Error");
                       return false;
                   }
                   else {
                       if (data == "Updated Successfully") {
                           jAlert("Updated Successfully", "Success", function (e) {
                               if (e == true) {
                                   var viewfor = "refresh";
                                   //location = '@Url.Action("WoSummary", "WoSummary")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                               }
                           });
                       }
                       else {
                           if (data == "") {
                               jAlert("Please Add Frequency and WO Details", "Message");
                           }
                           else {
                               jAlert(data, "Error");
                           }
                           return false;
                       }
                   }
               }, 'json');
        }
    }
    function SubmitAmendWo() {
        //var wodate = $('#txtwodate').val();
        //  var woendDate = $('#txtwoendDate').val();
        //var txtraisedby = $('#dropbranch').val();
        //var projmanagergid = $("#projmanagergid").val();
        //var e = document.getElementById("projmanagergid");
        //  var selectedmanager = e.options[e.selectedIndex].text;
        //var department = $("#txtdepartment").val();
        //var vendorName = $("#txtvendorname").val();
        var itType = $("input[name='it']:checked").val();
        var vendorNote = $('#txtvendornote').val();
        var tempgid = $('#templateGid').val();
        //var e = document.getElementById("templateGid");
        //var selectedtemplate = e.options[e.selectedIndex].text;
        var templategid = $("#templateGid option:selected").text();
        var additionTemplate = $("#txtWoTempl1").val();
        var overTotal = $("#grandtotal").text();
        //var uomgid = $("#hid_uomgid").val();
        //var prodservgid = $("#hid_prodservgid").val();
        //var requestfor = $("#hid_requestfor").val();
        //var vendorgid = $("#hid_vendorgid").val();
        //var monthName = $("#monthId option:selected").text();
        //var monthName1 = $("#monthId1 option:selected").text();
        var obfAmount = $("#hid_woamount").val();
        var freqid = $("#freqId").val();
        var woheadgid = $("#hid_woheadgid").val();
        var action = "amend";

        if (parseFloat(overTotal) < parseFloat(obfAmount)) {
            jAlert("Total Amount Should Match with WO Amount '" + obfAmount + "' ", "Error");
            return false;
        }
        if (parseFloat(overTotal) == parseFloat(0) || parseFloat(overTotal) == "" || parseFloat(overTotal) == null) {
            jAlert("Total Amount Cannot be Empty or Zero", "Error");
            return false;
        }
        if (vendorNote == null || vendorNote == "") {

            jAlert("Please Enter Vendor Note", "Error");
            return false;
        }
        if (templategid == "--Select--") {
            jAlert("Please Select WO Template");
            return false;
        }
        else {
            var objwoheader =
            {
                "itType": itType,
                "vendorNote": vendorNote,
                "templateGid": tempgid,
                "additionTemplate": additionTemplate,
                "overTotal": overTotal,
                "woheadgid": woheadgid,
                "actionName": action
            };
            $.post('@Url.Action("SaveWoDetails","WoRaiserEdit")', objwoheader,
               function (data) {
                   if (data == 0) {
                       jAlert("Error Occured", "Error");
                       return false;
                   }
                   else {
                       if (data == "Updated Successfully") {
                           jAlert("Updated Successfully", "Success", function (e) {
                               if (e == true) {
                                   var viewfor = "refresh";
                                   location = '@Url.Action("WoSummary", "WoSummary")?viewfor=' + viewfor + '&' + new Date().getTime();
                               }
                           });
                       }
                       else {
                           if (data == "") {
                               jAlert("Please Add Frequency and WO Details", "Message");
                           }
                           else {
                               jAlert(data, "Error");
                           }
                           return false;
                       }
                   }
               }, 'json');
        }
    }
    function BacktoWoSummary() {

        @*location = '@Url.Action("WoAmendSummary", "WoAmendment")?' + new Date().getTime();*@
        location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
    }
    function BacktoWoAmendSummary()
    {
        location = '@Url.Action("WoAmendSummary", "WoAmendment")?' + new Date().getTime();
    }
    function DeleteWoSummary() {
        var wono = $("#txtworefno").val();
        var woheadgid = $("#hid_woheadgid").val();
        jConfirm("Do you want to delete this '" + wono + "'?", "Confirm", function (r) {
            if (r == true) {
                var objdel =
                {
                    "woheadGid": woheadgid,
                };
                $.post('@Url.Action("WoSummaryDelete", "WoRaiserEdit")?' + new Date().getTime(), objdel,
                     function (data) {
                         if (data == 0) {
                             jAlert("Error Occured", "Error");
                             return false;
                         }
                         else {
                             jAlert("Wo Deleted Successfully", "Success", function (e) {
                                 if (e == true) {
                                     location = '@Url.Action("WoSummary", "WoSummary")?' + new Date().getTime();
                                 }
                             });
                         }
                     }, 'json');
            }
        });
    }
    function CancelWoSummary() {
        var wono = $("#txtworefno").val();
        var remarks = $("#desc_id").val();
        var woheadgid = $("#hid_woheadgid").val();
        if (remarks == null || remarks == "") {
            jAlert("Remarks is mandatory", "Error", function (e) {
                if (e == true) {
                    $("#desc_id").focus();
                }
            });
            return false;
        }
        else {
            jConfirm("Do you want to cancel this '" + wono + "'?", "Confirm", function (r) {
                if (r == true) {
                    var objdel =
                    {
                        "remarks": remarks,
                        "woheadGid": woheadgid
                    };
                    $.post('../WoRaiserEdit/WoSummaryCancel?' + new Date().getTime(), objdel,
                         function (data) {
                             if (data == 0) {
                                 jAlert("Error Occured", "Error");
                                 return false;
                             }
                             else {
                                 jAlert("Wo Submitted Successfully", "Success", function (e) {
                                     if (e == true) {
                                         //location = '@Url.Action("WoSummary","WoSummary")?' + new Date().getTime();
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                         }, 'json');
                }
            });
        }
    }
    function ApproveForCancel() {
        var remarks = $("#desc_check_id").val();
        var wocancelgid = $("#hid_wocancelgid").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        jConfirm("Do you want to Approve this '" + wono + "' for Cancellation?", "Confirm", function (r) {
            if (r == true) {

                var objCancel =
                {
                    "remarks": remarks,
                    "woCancelGid": wocancelgid,
                    "woheadGid": woheadgid
                };

                $.post('@Url.Action("WoCancelApprove", "WoCancellation")?' + new Date().getTime(), objCancel,
                     function (data) {
                         if (data == 0) {
                             jAlert("Error Occured", "Error");
                             return false;
                         }
                         else {
                             jAlert("Wo Cancelled Successfully", "Success", function (e) {
                                 if (e == true) {
                                     //location = '@Url.Action("WoCancelCheckerSummary", "WoCancellation")?' + new Date().getTime();
                                     location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                 }
                             });
                         }
                     }, 'json');
            }
        });
    }
    //}
    function ApproveForChecker() {
        var remarks = $("#desc_check_id").val();
        //   var pocancelgid = $("#hid_pocancelgid").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        //if (remarks == null || remarks == "") {
        //    jAlert("Remarks is mandatory", "Error", function (e) {
        //        $("#desc_check_id").focus();
        //    });
        //    return false;
        //}
        //else {
        jConfirm("Do you want to Approve this '" + wono + "' ?", "Confirm", function (r) {
            if (r == true) {

                var objCancel =
                {
                    "remarks": remarks,
                    "woheadGid": woheadgid
                };
                @*$.ajax({
                    url: '@Url.Action("PoCancelApprove", "PoCancellation")',
                    type: 'POST',
                    datatype:'json',
                    data: objCancel,
                    success: function (data) {
                        if (data != null)
                        {
                            jAlert("Po Cancelled Successfully", "Success", function (e) {
                                if (e == true) {
                                    location = '@Url.Action("PoCheckerSummary","PoCancellation")';
                                }
                            });
                        }
                    },
                    error: function () {
                        jAlert("something seems wrong", "Error");
                    }
                });*@
                $.post('@Url.Action("WoCheckerApprove", "WoChecker")?' + new Date().getTime(), objCancel,
                     function (data) {
                         if (data == 0) {
                             jAlert("Error Occured", "Error");
                             return false;
                         }
                         else {
                             if (data == "success" || data == "Success") {

                                 jAlert("Wo Approved Successfully", "Success", function (e) {
                                     if (e == true) {
                                         @*//location = '@Url.Action("WoCheckerSummary", "WoChecker")?' + new Date().getTime();*@
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                             else {
                                 //alert(data);
                                 jAlert(data, "Error");
                                 return false;
                             }
                         }
                     }, 'json');
            }
        });
    }
    //}
    function RejectForCancel() {
        var remarks = $("#desc_check_id").val();
        var wocancelgid = $("#hid_wocancelgid").val();
        var woheadgid = $("#hid_woheadgid").val();
        var action = "rejected";
        var wono = $("#txtworefno").val();
        if (remarks == null || remarks == "") {
            jAlert("Remarks is Mandatory", "Error", function (e) {
                if (e == true) {
                    $("#desc_check_id").focus();
                }
            });
            return false;
        }
        else {
            jConfirm("Do you want to Reject this '" + wono + "' for Cancellation?", "Confirm", function (r) {
                if (r == true) {
                    var objCancel =
                    {
                        "remarks": remarks,
                        "woCancelGid": wocancelgid,
                        "woheadGid": woheadgid,
                        "viewCancel": action
                    };

                    $.post('@Url.Action("WoCancelApprove", "WoCancellation")?' + new Date().getTime(), objCancel,
                         function (data) {
                             if (data == 0) {
                                 jAlert("Error Occured", "Error");
                                 return false;
                             }
                             else {
                                 jAlert("Wo Rejected Successfully", "Success", function (e) {
                                     if (e == true) {
                                         //location = '@Url.Action("WoCancelCheckerSummary", "WoCancellation")?' + new Date().getTime();
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                         }, 'json');
                }
            });
        }
    }
    function RejectForChecker() {
        var remarks = $("#desc_check_id").val();
        // var pocancelgid = $("#hid_pocancelgid").val();
        var woheadGid = $("#hid_woheadgid").val();
        var action = "rejected";
        var wono = $("#txtworefno").val();

        if (remarks == null || remarks == "") {
            jAlert("Remarks is Mandatory", "Error", function (e) {
                if (e == true) {
                    $("#desc_check_id").focus();
                }

            });
            return false;
        }
        else {
            jConfirm("Do you want to Reject this '" + wono + "'?", "Confirm", function (r) {
                if (r == true) {
                    var objCancel =
                    {
                        "remarks": remarks,
                        "woheadGid": woheadGid,
                        "viewCancel": action
                    };
                    $.post('@Url.Action("WoCheckerApprove", "WoChecker")?' + new Date().getTime(), objCancel,
                         function (data) {
                             if (data == 0) {
                                 jAlert("Error Occured", "Error");
                                 return false;
                             }
                             else {
                                 jAlert("Wo Rejected Successfully", "Success", function (e) {
                                     if (e == true) {
                                         //location = '@Url.Action("WoCheckerSummary", "WoChecker")?' + new Date().getTime();
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                         }, 'json');
                }
            });
        }
    }
    function MakerClosure() {
        var remarks = $("#desc_id").val();
        //   var pocancelgid = $("#hid_pocancelgid").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        if (remarks == null || remarks == "") {
            jAlert("Remarks is Mandatory", "Error", function (e) {
                $("#desc_id").focus();
            });
            return false;
        }
        else {
            jConfirm("Do you want to Approve this '" + wono + "' ?", "Confirm", function (r) {
                if (r == true) {
                    var objdel =
                    {
                        "remarks": remarks,
                        "woheadGid": woheadgid,
                    };
                    $.post('@Url.Action("WoSummaryClosure", "WoClosure")?' + new Date().getTime(), objdel,
                          function (data) {
                              if (data == 0) {
                                  jAlert("Error Occured", "Error");
                                  return false;
                              }
                              else {
                                  jAlert("Wo Submitted Successfully", "Success", function (e) {
                                      if (e == true) {
                                          location = '@Url.Action("WoClosureSummary", "WoClosure")?' + new Date().getTime();
                                      }
                                  }); 0
                              }
                          }, 'json');
                }
            });
        }
    }
    function CheckerAppClosure() {
        var remarks = $("#desc_check_id").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        var woclosuregid = $("#hid_woclosuregid").val();
        //if (remarks == null || remarks == "") {
        //    jAlert("Remarks is mandatory", "Error", function (e) {
        //        $("#desc_check_id").focus();
        //    });
        //    return false;
        //}
        //else {
        jConfirm("Do you want to Approve this '" + wono + "' ?", "Confirm", function (r) {
            if (r == true) {
                var objdel =
                {
                    "remarks": remarks,
                    "woheadGid": woheadgid,
                    "woClosureGid": woclosuregid
                };
                $.post('@Url.Action("WoSummaryClosure", "WoClosureChecker")?' + new Date().getTime(), objdel,
                      function (data) {
                          if (data == 0) {
                              jAlert("Error Occured", "Error");
                              return false;
                          }
                          else {
                              jAlert("Wo Closed Successfully", "Success", function (e) {
                                  if (e == true) {
                                      location = '@Url.Action("WoClosureCheckerSummary", "WoClosureChecker")?' + new Date().getTime();
                                  }
                              });
                          }
                      }, 'json');
            }
        });
        //}
    }
    function RejectForWoClosureChecker() {
        var remarks = $("#desc_check_id").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        var woclosuregid = $("#hid_woclosuregid").val();
        var viewfor = "reject";
        if (remarks == null || remarks == "") {
            jAlert("Remarks is Mandatory", "Error", function (e) {
                $("#desc_check_id").focus();
            });
            return false;
        }
        else {
            jConfirm("Do you want to Approve this '" + wono + "' ?", "Confirm", function (r) {
                if (r == true) {
                    var objdel =
                    {
                        "remarks": remarks,
                        "woheadGid": woheadgid,
                        "woClosureGid": woclosuregid,
                        "viewfor": viewfor
                    };
                    $.post('@Url.Action("WoSummaryClosure", "WoClosureChecker")?' + new Date().getTime(), objdel,
                          function (data) {
                              if (data == 0) {
                                  jAlert("Error Occured", "Error");
                                  return false;
                              }
                              else {
                                  jAlert("Wo Rejected Successfully", "Success", function (e) {
                                      if (e == true) {
                                          location = '@Url.Action("WoClosureCheckerSummary", "WoClosureChecker")?' + new Date().getTime();
                                      }
                                  });
                              }
                          }, 'json');
                }
            });

        }
    }
    function BacktoClosureCheckSummary() {
        location = '@Url.Action("WoClosureCheckerSummary", "WoClosureChecker")?' + new Date().getTime();
    }
    function BacktoCheckSummary() {
        location = '@Url.Action("WoCheckerSummary", "WoChecker")?' + new Date().getTime();
    }
    function BacktoWoCancelSummary() {
        location = '@Url.Action("WoCancelCheckerSummary", "WoCancellation")?' + new Date().getTime();
    }
    function BacktoClosureSummary() {
        location = '@Url.Action("WoClosureSummary", "WoClosure")?' + new Date().getTime();
    }
    var currentTab = 0;
    $(function () {
        $("#tabsat").tabs({
            select: function (e, i) {
                currentTab = i.index;
            }
        });
    });

    function ApproveDelmatforWo()
    {
        var remarks = $("#desc_check_id").val();
        //   var pocancelgid = $("#hid_pocancelgid").val();
        var woheadgid = $("#hid_woheadgid").val();
        var wono = $("#txtworefno").val();
        var delmat = "delmat";

        jConfirm("Do you want to Approve this '" + wono + "' ?", "Confirm", function (r) {
            if (r == true) {

                var objCancel =
                {
                    "remarks": remarks,
                    "woheadGid": woheadgid,
                    "delmatView":delmat
                };
                $.post('@Url.Action("WoDelmatApprove", "WoChecker")?' + new Date().getTime(), objCancel,
                     function (data) {
                         if (data == 0) {
                             jAlert("Error Occured", "Error");
                             return false;
                         }
                         else {
                             if (data == "success" || data == "Success") {

                                 jAlert("Wo Approved Successfully", "Success", function (e) {
                                     if (e == true) {
                                         @*//location = '@Url.Action("WoCheckerSummary", "WoChecker")?' + new Date().getTime();*@
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                             else {
                                 jAlert(data, "Error");
                                 return false;

                             }
                         }
                     }, 'json');
            }
        });
    }
    function RejectDelmatforWo()
    {
        var remarks = $("#desc_check_id").val();
        // var pocancelgid = $("#hid_pocancelgid").val();
        var woheadGid = $("#hid_woheadgid").val();
        var action = "rejected";
        var wono = $("#txtworefno").val();

        if (remarks == null || remarks == "") {
            jAlert("Remarks is Mandatory", "Error", function (e) {
                if (e == true) {
                    $("#desc_check_id").focus();
                }

            });
            return false;
        }
        else {
            jConfirm("Do you want to Reject this '" + wono + "'?", "Confirm", function (r) {
                if (r == true) {
                    var objCancel =
                    {
                        "remarks": remarks,
                        "woheadGid": woheadGid,
                        "viewCancel": action
                    };
                    $.post('@Url.Action("WoCheckerApprove", "WoChecker")?' + new Date().getTime(), objCancel,
                         function (data) {
                             if (data == 0) {
                                 jAlert("Error Occured", "Error");
                                 return false;
                             }
                             else {
                                 jAlert("Wo Rejected Successfully", "Success", function (e) {
                                     if (e == true) {
                                         //location = '@Url.Action("WoCheckerSummary", "WoChecker")?' + new Date().getTime();
                                         location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                     }
                                 });
                             }
                         }, 'json');
                }
            });
        }
    }
    function BackToFlexiDashforWo()
    {
        location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
    }
    function RaiseTicket() {
        var refflagname = "WO";
        var itemrefno = $("[id=txtworefno]").val();
        if ($('#potemplate').val() == "") {
            $("#potemplate").val("asd");
            objTemplate = $("[id$='ForWOTemplate']");
            objTemplate.dialog({
                autoOpen: false,
                modal: true,
                cache: false,
                show: 'fade-in',
                close: 'fade-out',
            });
        }
        objTemplate.load('../../RaiseTickets/SingleTicketNormal?refname=' + refflagname + '&itemrefno=' + itemrefno + '&' + new Date().getTime());
        objTemplate.dialog({
            title: 'Raise Ticket',
            width: 1100,
            height: 500
        });
        objTemplate.dialog("open");
    }
</script>