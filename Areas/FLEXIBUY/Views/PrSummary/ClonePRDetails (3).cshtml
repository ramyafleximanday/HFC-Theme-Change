@model IEM.Areas.FLEXIBUY.Models.PrSumEntity
<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

@{
    ViewBag.Title = "ClonePRDetails";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    cursor {
        cursor: pointer;
    }

    panelwidth {
        width: 100%;
    }

    .lblwth {
        width: 170px;
    }

    .txtwth {
        width: 150px;
    }

    .serWidth5 {
        width: 5% !important;
    }

    .serWidth10 {
        width: 10% !important;
        text-align: center;
    }

    .serWidth15 {
        width: 15% !important;
    }

    .serWidth20 {
        width: 20% !important;
    }

    .serWidth30 {
        width: 30% !important;
    }
</style>

<b>    <span style="color: rgb(52, 108, 196);">Clone PR </span></b>
<div class="well">
   


    <div class="panel panel-default">

        <table class="myTableStyleTabNew" align="center" width="100%">
            <tr>

                <td style="padding:10px; width:20%;">

                    <div>
                        <span>PR Ref No.</span>
                        <br />

                        <div>
                            <input type="text"
                                   name="txtprrefno"
                                   class="textboxStyle"
                                   disabled="disabled"
                                   id="txtprrefno" value="@Model.prHead.newPrRefNo" style="width:100%;"/>
                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">
                    <div>
                        <span>PR Date</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtprdate"
                                   class="textboxStyle"
                                   style="display:block; width:100%;"
                                   id="txtprdate" value="@Model.prHead.prDate" />

                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">

                    <div>

                        <span>PR Raised by</span>
                        <br />

                        <div>
                            <input type="text"
                                   name="txtprraisedby"
                                   class="textboxStyle"
                                   style="display:block; width:100%;"
                                   disabled="disabled"
                                   id="txtprraisedby" value="@Model.prHead.prRaisedBy" />
                        </div>
                    </div>
                </td>
                <td style="padding:10px; width:20%;">
                    <div>
                        <span>BSCC</span>
                        <br />

                        <div>
                            @Html.DropDownList("dropFCCC", Model.ddlFCCC, "--Select Fccc--", new { @class = "textboxStyle", @id = "dropFCCC", @style = "width:100%;", @disabled = "disabled" })

                        </div>
                    </div>
                </td>
                <td style="padding:10px; width:20%;">
                    <div>
                        <span>Request by</span>
                        <br />
                        <div>
                            @Html.DropDownList("dropRequestfor", Model.ddlRequestfor, "--Select Request--", new { @class = "textboxStyle ", @id = "dropRequestfor", @disabled = "disabled", @style = "width:100%;" })
                        </div>
                    </div>
                </td>

            </tr>
            <tr>
                <td style="padding:10px;">
                    <div>
                        @{

                            var expense = (string)Session["rblExpenses"];
                            if (expense != "")
                            {
                                if (expense == "C")
                                {
                                    <div>
                                        <span>Expenses</span>
                                        <br />
                                    </div>

                                    <div class="radio-inline">
                                        <span id="lblcapex">
                                            <input type="radio" id="id_rdcap" name="mode1" value="Capex" checked="checked"  />
                                            Capex
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblopex">
                                            <input type="radio" id="id_rdope" name="mode1" value="Opex"  />
                                            Opex
                                        </span>
                                    </div>

                                }
                                else
                                {
                                    <div class="radio-inline">
                                        <span id="lblcapex">
                                            <input type="radio" id="id_rdcap" name="mode1" value="Capex"  />
                                            Capex
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblopex">
                                            <input type="radio" id="id_rdope" name="mode1" value="Opex" checked="checked"  />
                                            Opex
                                        </span>
                                    </div>
                                }
                            }
                        }
                    </div>
                  
                </td>
                <td style="padding:10px;">
                    <div>
                        @{


                            var branchtype = (string)Session["rblBranchType"];
                            if (branchtype != "")
                            {
                                if (branchtype == "S")
                                {
                                    <div>
                                        <span>Branch </span>
                                        <br />
                                    </div>

                                    <div class="radio-inline">
                                        <span id="lblsingle">
                                            <input type="radio" id="id_rdsing" name="mode2" value="Single" checked="checked" />
                                            Single
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblmultiple">
                                            <input type="radio" id="id_rdmult" name="mode2" value="Multiples" />
                                            Multiple
                                        </span>
                                    </div>
                                }
                                else
                                {
                                    <div>
                                        <span>Branch </span>
                                        <br />
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblsingle">
                                            <input type="radio" id="id_rdsing" name="mode2" value="Single" />
                                            Single
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblmultiple">
                                            <input type="radio" id="id_rdmult" name="mode2" value="Multiples" checked="checked" />
                                            Multiple
                                        </span>
                                    </div>
                                }
                            }
                        }
                    </div>
                   
                </td>
                <td style="padding:10px;">
                  <br />
                    <div>
                        @{
                            var rblprodserv = (string)Session["rblProductService"];
                            if (rblprodserv != "")
                            {
                                if (rblprodserv == "P")
                                {
                                    <div class="radio-inline" style="padding:10px;">
                                        <span id="lblprod">
                                            <input type="radio" id="id_rdprod" name="modenew" value="Product" checked="checked" onchange="selprocomm()" disabled="disabled" />
                                            Product
                                        </span>
                                    </div>
                                    <div class="radio-inline" style="padding:10px;">
                                        <span id="lblserv">
                                            <input type="radio" id="id_rdserv" name="modenew" value="Service" onchange="selprocomm()" disabled="disabled" />
                                            Service

                                        </span>
                                    </div>
                                }
                                else
                                {

                                    <div class="radio-inline" style="padding:10px;">
                                        <span id="lblprod">
                                            <input type="radio" id="id_rdprod" name="modenew" value="Product" onchange="selprocomm()" disabled="disabled" />
                                            Product
                                        </span>
                                    </div>
                                    <div class="radio-inline" style="padding:10px;">
                                        <span id="lblserv">
                                            <input type="radio" id="id_rdserv" name="modenew" value="Service" checked="checked" onchange="selprocomm()" disabled="disabled" />
                                            Service

                                        </span>
                                    </div>
                                }
                            }
                        }
                    </div>
                </td>
                <td style="padding:10px;">
                    <div>
                        <span>Branch</span>
                        <br />
                        <div>
                            @Html.DropDownList("dropBranch", Model.ddlBranch, "--Select Branch--", new { @class = "textboxStyle", @id = "dropBranch", @style = "width:100%;", @disabled = "disabled" })
                        </div>
                    </div>
                </td>

                <td style="padding:10px;">
                    <div>
                        <span>PR Description</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtprdesc"
                                   class="textboxStyle"
                                   style="display:block;width:100%;"
                                   id="txtprdesc" value="@Model.prHead.prDesc" />

                        </div>
                    </div>
                </td>

                <td style="padding:20px;">
                    <div style="padding:10px 10px 0px 0px;text-align:right;">
                        @*<input type="button" class="btn btn-link" title="View Attachment" value="View Attachment" name="command" id="@Model.prHead.prRefNo" onclick="viewattach(id)" />*@
                        @*<button type="button" class="btn btn-primary" title="View Attachment" value="View Attachment" name="command" id="@Model.prHead.prGid" onclick="viewattach(id)">ADD Attachment</button>*@
                    </div>
                </td>

            </tr>
            <tr></tr>

        </table>


    </div>
    <input hidden="hidden" id="pp" />
    <input hidden="hidden" id="ss" />

    <div id="ProductDetailgrid" style="margin-top: -25px;" class="hovertable2"></div>
    <div id="tabsat" style="height:200px; font-size:14px; overflow-y:auto; margin-top: 5px;">
        <ul>
            <li><a href="#tabs-1">Audit Trail</a></li>
            <li><a href="#tabs-2">Attachments</a></li>
        </ul>
        <div id="tabs-1" style="padding-left:14px; padding-right:14px;">
            @Html.Partial("tab_auditrail")
        </div>
       <div id="tabs-2" style="padding-left:14px; padding-right:14px;">
                @Html.Partial("PRAttach")
            </div>
    </div>
</div>



<table class="myTableStyleTab" align="center">
    <tr>
        <td>
            <div style="padding:10px 10px 0px 0px;text-align:right;">
                @*<input class="btn btn-primary" id="btnSave" type="button" value="Save" />*@
                <button id="btnSave" type="button" class="btn btn-primary" value="Save" >
                    <span style="color:white;" class="glyphicon glyphicon-floppy-disk"></span> Save
                </button>
                @*<input class="btn btn-warning" type="button" value="Cancel" onclick="Cancel()" />*@
                <button id="btnSave" type="button" onclick="Cancel()" class="btn btn-warning" value="Cancel">
                    <span style="color:white;" class="glyphicon glyphicon-remove-circle"></span> Cancel
                </button>
            </div></td></tr></table>

            <input hidden="hidden" id="mm" />

            <div id="ForPartialViewnew8hh"></div>

            <script>

                var currentTab = 0;
                $(function () {
                    $("#tabsat").tabs({
                        select: function (e, i) {
                            currentTab = i.index;
                        }
                    });
                });
                $('#txtprdate').change(function () {
                    if ($('#txtprdate').val() != null) {


                        $('#txtprdate').removeClass('required');
                        $('#txtprdate').addClass('valid');
                    }
                    else {
                        $('#txtprdate').addClass('required');
                        $('#txtprdate').removeClass('valid');
                    }
                });
                $('#txtprdesc').keyup(function () {
                    if ($('#txtprdesc').val() != null) {


                        $('#txtprdesc').removeClass('required');
                        $('#txtprdesc').addClass('valid');
                    }
                    else {
                        $('#txtprdesc').addClass('required');
                        $('#txtprdesc').removeClass('valid');
                    }
                });

                $('#dropBranch').change(function () {
                    if ($('#dropBranch').val() != null) {


                        $('#dropBranch').removeClass('required');
                        $('#dropBranch').addClass('valid');
                    }
                    else {
                        $('#dropBranch').addClass('required');
                        $('#dropBranch').removeClass('valid');
                    }
                });
                $('#dropFCCC').change(function () {
                    if ($('#dropFCCC').val() != null) {


                        $('#dropFCCC').removeClass('required');
                        $('#dropFCCC').addClass('valid');
                    }
                    else {
                        $('#dropFCCC').addClass('required');
                        $('#dropFCCC').removeClass('valid');
                    }
                });

                function Cancel() {
                    location = '@Url.Action("PrSummary1", "PrSummary")?' + new Date().getTime();
                }
                var objDialog8;

                function viewattach(id) {

                    if ($("#mm").val() == "") {
                        $('#mm').val('anu');
                        sessionStorage["type"] = "clone"
                        //alert(sessionStorage);
                        objDialog8 = $("[id$='ForPartialViewnew8hh']");
                        objDialog8.dialog({
                            autoOpen: false,
                            modal: true,
                            show: 'fade-in',
                            close: 'fade-out',
                            cache: false,
                            width: 600,
                            height: 400
                        });
                    }

                    // objDialog8.load('../../PrSummary/cloneprattachment?id=' + id);viewprattachment
                    objDialog8.load('@Url.Action("editprattachment", "PrSummary")?id=' + id + '&' + new Date().getTime());
                    objDialog8.dialog({ title: 'CLONE PR Attachment List' });
                    objDialog8.dialog("open");
                }
                $(document).ready(function () {
                    function dateformat() {
                        dateformat: 'dd-mm-yyyy';
                    }
                    $("#txtprdate").datepicker({

                        dateFormat: 'dd-mm-yy',
                        maxDate: new Date()
                    });
                    $('#ss').val('');
                    $('#pp').val('');
                    $('#mm').val('');

                    var url;
                    var goid = $('input[name=modenew]:checked').val();
                    var id = $('#prrefno').val();

                    if (goid == "Product") {

                        $.ajax({
                            url: '@Url.Action("ClonePro", "PrSummary")?id=' + id + '&' + new Date().getTime(),
                            type: 'POST',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(goid),
                            success: function (data) {
                                if (data == 0) {
                                    jAlert("Error Occured", "Error", function () {
                                        return false;
                                    });
                                    return false;
                                }
                                else {
                                    $("#ProductDetailgrid").empty().append(data);
                                }
                            },
                            error: function () {
                                jAlert("something seems wrong");
                            }
                        });


                    }
                    else {
                        $.ajax({
                            url: '@Url.Action("CloneSer", "PrSummary")?id=' + id + '&' + new Date().getTime(),
                            type: 'POST',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(goid),
                            success: function (data) {
                                if (data == 0) {
                                    jAlert("Error Occured", "Error", function () {
                                        return false;
                                    });
                                    return false;
                                }
                                else {
                                    $("#ProductDetailgrid").empty().append(data);
                                }
                            },
                            error: function () {
                                jAlert("something seems wrong");
                            }
                        });
                    }
                    function selprocomm() {

                        var url;
                        var goid = $('input[name=modenew]:checked').val();

                        if (goid == "Product") {

                            $('#id_rdcap').attr('checked', true);
                            $('#id_rdope').attr('checked', false);
                            $.ajax({
                                url: '@Url.Action("ClonePro", "PrSummary")?' + new Date().getTime(),
                                type: 'POST',
                                contentType: "application/json; charset=utf-8",
                                data: JSON.stringify(goid),
                                success: function (data) {
                                    if (data == 0) {
                                        jAlert("Error Occured", "Error", function () {
                                            return false;
                                        });
                                        return false;
                                    }
                                    else {
                                        $("#ProductDetailgrid").empty().append(data);
                                    }
                                },
                                error: function () {
                                    jAlert("something seems wrong");
                                }
                            });
                        }
                        else {

                            $('#id_rdcap').attr('checked', false);
                            $('#id_rdope').attr('checked', true);
                            $.ajax({
                                url: '@Url.Action("CloneSer", "PrSummary")?' + new Date().getTime(),
                                type: 'POST',
                                contentType: "application/json; charset=utf-8",
                                data: JSON.stringify(goid),
                                success: function (data) {
                                    if (data == 0) {
                                        jAlert("Error Occured", "Error", function () {
                                            return false;
                                        });
                                        return false;
                                    }
                                    else {
                                        $("#ProductDetailgrid").empty().append(data);
                                    }
                                },
                                error: function () {
                                    jAlert("something seems wrong");
                                }
                            });
                        }


                    }
                });


                $("#btnSave").click(function () {
                    //alert('get');
                    var prrefno = $("#txtprrefno").val();
                    var prdate = $('#txtprdate').val();
                    var expense = $('input[name=mode1]:checked').val();
                    var branchtype = $("input[name='mode2']:checked").val();
                    var prfccc = $("#dropFCCC").val();
                    var prbranchgid = $("#dropBranch").val();
                    var prrequestforgid = $("#dropRequestfor").val();
                    var prdesc = $("#txtprdesc").val();
                    var prraisedby = $("#txtprraisedby").val();

                    if (prdate == null || prdate == "") {
                        jAlert("Please select date!", "Error");
                        return false;
                    }
                    if (prraisedby == null || prraisedby == "") {
                        jAlert("Please enter raised by!", "Error");
                        return false;
                    }
                    if (prdesc == null || prdesc == "") {
                        jAlert("Please enter description!", "Error");
                        return false;
                    }

                    if (prfccc == null || prfccc == "" || prfccc == 0) {
                        jAlert("Please select fccc!", "Error");
                        return false;
                    }
                    if (prbranchgid == null || prbranchgid == "" || prbranchgid == 0) {
                        jAlert("Please select branch!", "Error");
                        return false;
                    }
                    if (prrequestforgid == null || prrequestforgid == "" || prrequestforgid == 0) {
                        jAlert("Please select request for gid!", "Error");
                        return false;
                    }


                    var prheader = {
                        "prRefNo": prrefno,
                        "prDate": prdate,
                        "prFcc": prfccc,
                        "prExpense": expense,
                        "prBranchType": branchtype,
                        "prBranch": prbranchgid,
                        "prDesc": prdesc,
                        "prReqFor": prrequestforgid,
                        "prRaisedBy": prraisedby

                    }
                    $.post('@Url.Action("savecloneprraiser", "PrSummary")', prheader,
                 function (data) {
                     //if (data == 0) { alert("ss"); } else { jAlert("Saved Successfully"); }
                     if (data == 0) {
                         //location = location.href;
                         jAlert("Error Occured", "Error", function () {
                             return false;
                         });
                         return false;
                     } else { jAlert("Saved Successfully"); location = '@Url.Action("PrSummary1", "PrSummary")?' + new Date().getTime(); }
                 }, 'json');

                });



            </script>
