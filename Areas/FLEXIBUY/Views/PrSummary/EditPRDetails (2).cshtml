@model IEM.Areas.FLEXIBUY.Models.PrSumEntity
<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

@{
    ViewBag.Title = "EditPRDetails";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    cursor {
        cursor: pointer;
    }

    panelwidth {
        width: 100%;
    }

    .lblwth {
        width: 170px;
    }

    .txtwth {
        width: 150px;
    }

    .serWidth5 {
        width: 5% !important;
    }

    .serWidth10 {
        width: 10% !important;
        text-align: center;
    }

    .serWidth15 {
        width: 15% !important;
    }

    .serWidth20 {
        width: 20% !important;
    }

    .serWidth30 {
        width: 30% !important;
    }
</style>

<b>    <span style="color: rgb(52, 108, 196);">Edit PR </span></b>
<div class="well">

    <b>    <span style="color: rgb(52, 108, 196);">PR Header</span></b>

    <div >
      

        <div class="panel panel-default">

            <table class="myTableStyleTabNew" align="center" width="100%">
                <tr>

                    <td style="padding:10px; width:20%">
                        <div>
                            <span>PR Ref No.</span>
                            <br />

                            <div>
                                <input type="text"
                                       name="txtprrefno"
                                       class="textboxStyle"
                                       disabled="disabled"
                                       id="txtprrefno" value="@Model.prHead.prRefNo" style="width:100%;" />
                            </div>
                        </div>
                    </td>

                    <td style="padding:10px; width:20%">
                        <div>
                            <span>PR Date</span>
                            <br />
                            <div>
                                <input type="text"
                                       name="txtprdate"
                                       class="textboxStyle"
                                       style="display:block;width:100%;"
                                       disabled="disabled"
                                       id="txtprdate" value="@Model.prHead.prDate" />
                            </div>
                        </div>
                    </td>

                    <td style="padding:10px; width:20%">
                        <div>
                            <span>PR Raised by</span>
                            <br />
                            <div>
                                <input type="text"
                                       name="txtprraisedby"
                                       class="textboxStyle "
                                       style="display:block;width:100%;"
                                       disabled="disabled"
                                       id="txtprraisedby" value="@Model.prHead.prRaisedBy" />
                            </div>
                        </div>
                    </td>
                    <td style="padding:10px; width:20%">
                        <div>
                            <span>BSCC</span>
                            <br />

                            <div>
                                @Html.DropDownList("dropFCCC", Model.ddlFCCC, "--Select Fccc--", new { @class = "textboxStyle", @id = "dropFCCC", @style = "width:100%;", @disabled = "disabled" })

                            </div>
                        </div>
                    </td>
                    <td style="padding:10px; width:20%">
                        <div>
                            <span>Request by</span>
                            <br />
                            <div>
                                @Html.DropDownList("dropRequestfor", Model.ddlRequestfor, "--Select Request--", new { @class = "textboxStyle", @id = "dropRequestfor", @disabled = "disabled", @style = "width:100%;" })
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="padding:10px;">

                        @{

                            var expense = (string)Session["rblExpenses"];
                            if (expense != "")
                            {
                                if (expense == "C")
                                {
                                    <div>
                                        <span>Expenses</span>
                                    </div>

                                    <div class="radio-inline">
                                        <span id="lblcapex">
                                            <input type="radio" id="id_rdcap" name="mode1" value="Capex" disabled="disabled" checked="checked"  />
                                            Capex
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblopex">
                                            <input type="radio" id="id_rdope" name="mode1" value="Opex" disabled="disabled" />
                                            Opex
                                        </span>
                                    </div>

                                }
                                else
                                {
                                    <div>
                                        <span>Expenses</span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblcapex">
                                            <input type="radio" id="id_rdcap" name="mode1" value="Capex" disabled="disabled" />
                                            Capex
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblopex">
                                            <input type="radio" id="id_rdope" name="mode1" value="Opex" checked="checked" disabled="disabled" />
                                            Opex
                                        </span>
                                    </div>
                                }
                            }
                        }
                    </td>

                    <td style="padding:10px;">
                        @{


                            var branchtype = (string)Session["rblBranchType"];
                            if (branchtype != "")
                            {
                                if (branchtype == "S")
                                {
                                    <div>
                                        <span>Branch </span>
                                    </div>

                                    <div class="radio-inline">
                                        <span id="lblsingle">
                                            <input type="radio" id="id_rdsing" name="mode2" value="Single" disabled="disabled" checked="checked" />
                                            Single
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblmultiple">
                                            <input type="radio" id="id_rdmult" name="mode2" value="Multiples" disabled="disabled" />
                                            Multiple
                                        </span>
                                    </div>
                                }
                                else
                                {
                                    <div>
                                        <span>Branch </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblsingle">
                                            <input type="radio" id="id_rdsing" name="mode2" value="Single" />
                                            Single
                                        </span>
                                    </div>
                                    <div class="radio-inline">
                                        <span id="lblmultiple">
                                            <input type="radio" id="id_rdmult" name="mode2" value="Multiples" checked="checked" />
                                            Multiple
                                        </span>
                                    </div>
                                }
                            }
                        }
                    </td>
                    <td style="padding:10px;">
                        <br />
                        <div>
                            @{
                                var rblprodserv = (string)Session["rblProductService"];
                                if (rblprodserv != "")
                                {
                                    if (rblprodserv == "P")
                                    {
                                        <div class="radio-inline">
                                            <span id="lblprod">
                                                <input type="radio" id="id_rdprod" name="modenew" value="Product" checked="checked" onchange="selprocomm()" disabled="disabled" />
                                                Product
                                            </span>
                                        </div>
                                        <div class="radio-inline">
                                            <span id="lblserv">
                                                <input type="radio" id="id_rdserv" name="modenew" value="Service" onchange="selprocomm()" disabled="disabled" />
                                                Service

                                            </span>
                                        </div>
                                    }
                                    else
                                    {

                                        <div class="radio-inline" style="padding:10px;">
                                            <span id="lblprod">
                                                <input type="radio" id="id_rdprod" name="modenew" value="Product" onchange="selprocomm()" disabled="disabled" />
                                                Product
                                            </span>
                                        </div>
                                        <div class="radio-inline" style="padding:10px;">
                                            <span id="lblserv">
                                                <input type="radio" id="id_rdserv" name="modenew" value="Service" checked="checked" onchange="selprocomm()" disabled="disabled" />
                                                Service

                                            </span>
                                        </div>
                                    }
                                }
                            }
                        </div>


                    </td>
                    <td style="padding:10px;">
                        <div>
                            <span>Branch</span>
                            <br />
                            <div>
                                @Html.DropDownList("dropBranch", Model.ddlBranch, "--Select Branch--", new { @class = "textboxStyle", @id = "dropBranch", @style = "width:100%;",@disabled = "disabled" })
                            </div>
                        </div>
                    </td>
                    <td style="padding:10px;">
                        <div>
                            <span>PR Description</span>
                            <br />
                            <div>
                                <input type="text"
                                       name="txtprdesc"
                                       c class="textboxStyle valid"
                                       style="display:block;width:100%;"
                                       id="txtprdesc" value="@Model.prHead.prDesc" />

                            </div>
                        </div>
                    </td>
                    @*<td style="padding:10px;">
                        <div style="padding:10px 10px 0px 0px;text-align:right;">
                            <button type="button" id="@Model.prHead.prGid" name="command" class="btn btn-primary" onclick="viewattach(id)" value="Add Attachment">
                                <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Add Attachment
                            </button>

                        </div>
                    </td>*@
                </tr>
                <tr></tr>
            </table>
        </div>
    </div>
    <input hidden="hidden" id="pp" />
    <input hidden="hidden" id="ss" />


    <div id="ProductDetailgrid" class="hovertable2"></div>
    <div id="tabsat" style="height:300px; font-size:14px; overflow-y:auto; margin-top:7px;">
            <ul>
                <li><a href="#tabs-1">Audit Trail</a></li>
                <li><a href="#tabs-2">Attachments</a></li>
            </ul>
            <div id="tabs-1">
                @Html.Partial("tab_auditrail")
            </div>
            <div id="tabs-2">
                @Html.Partial("PRattach")
            </div>
        </div>



    <table class="myTableStyleTabNew" align="center">
        <tr>
            <td style="padding:10px 10px 0px 0px;text-align:center;">
                <div>

                    <button type="button" id="btnSave" name="command" class="btn btn-primary" value="Save">
                        <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Save
                    </button>
                    <button type="button" id="btnSubmit" name="command" class="btn btn-success" value="Submit">
                        <span class="glyphicon glyphicon-floppy-saved" style="color:white;"></span> Submit
                    </button>

                    <button type="button" id="btncancel" class="btn btn-warning" value="Cancel" onclick="Cancel()">
                        <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                    </button>
                </div>
            </td>
        </tr>
    </table>



</div>
<input hidden="hidden" id="ll" />
<div id="ForPartialViewnew7hh"></div>

<script>


    $('#txtprdate').change(function () {
        if ($('#txtprdate').val() != null) {


            $('#txtprdate').removeClass('required');
            $('#txtprdate').addClass('valid');
        }
        else {
            $('#txtprdate').addClass('required');
            $('#txtprdate').removeClass('valid');
        }
    });
    $('#txtprdesc').keyup(function () {
        if ($('#txtprdesc').val() != null && $('#txtprdesc').val() != "") {


            $('#txtprdesc').removeClass('required');
            $('#txtprdesc').addClass('valid');
        }
        else {
            $('#txtprdesc').addClass('required');
            $('#txtprdesc').removeClass('valid');
        }
    });

    $('#dropBranch').change(function () {
        if ($('#dropBranch').val() != null) {


            $('#dropBranch').removeClass('required');
            $('#dropBranch').addClass('valid');
        }
        else {
            $('#dropBranch').addClass('required');
            $('#dropBranch').removeClass('valid');
        }
    });
    $('#dropFCCC').change(function () {
        if ($('#dropFCCC').val() != null) {


            $('#dropFCCC').removeClass('required');
            $('#dropFCCC').addClass('valid');
        }
        else {
            $('#dropFCCC').addClass('required');
            $('#dropFCCC').removeClass('valid');
        }
    });
    function Cancel() {
        //location = "@Url.Action("PrSummary1", "PrSummary")?" + new Date().getTime();
        location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
    }
    var objDialog7;

    function viewattach(id) {

        if ($("#ll").val() == "") {
            $('#ll').val('anu');
            sessionStorage["type"] = "Edit"
            objDialog7 = $("[id$='ForPartialViewnew7hh']");
            objDialog7.dialog({
                autoOpen: false,
                modal: true,
                show: 'fade-in',
                close: 'fade-out',
                cache: false,
                width: 700,
                height: 500
            });
        }

        //  objDialog7.load('../PrSummary/editprattachment?id=' + id + '&' + new Date().getTime());
        objDialog7.load('@Url.Action("editprattachment", "PrSummary")?id=' + id + '&' + new Date().getTime());
        objDialog7.dialog({ title: ' Attachment List' });
        objDialog7.dialog("open");
    }


    $(document).ready(function () {
        function dateformat() {
            dateformat: 'dd-mm-yyyy';
        }
        $("#txtprdate").datepicker({

            dateFormat: 'dd-mm-yy',
            maxDate: new Date()
        });

        $('#ss').val('');
        $('#pp').val('');
        $('#ll').val('');

        var url;
        var goid = $('input[name=modenew]:checked').val();
        var id = $('#prrefno').val();

        if (goid == "Product") {

            $.ajax({
                url: '@Url.Action("EditPro", "PrSummary")?id=' + id + '&' + new Date().getTime(),
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    jAlert("something seems wrong");
                }
            });


        }
        else {
            $.ajax({
                url: '@Url.Action("EditSer", "PrSummary")?id=' + id + '&' + new Date().getTime(),
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    jAlert("something seems wrong");
                }
            });
        }
        function selprocomm() {

            var url;
            var goid = $('input[name=modenew]:checked').val();
            // alert(goid);
            if (goid == "Product") {
                $('#id_rdcap').attr('checked', true);
                $('#id_rdope').attr('checked', false);
                $.ajax({
                    url: '@Url.Action("EditPro", "PrSummary")?' + new Date().getTime(),
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(goid),
                    success: function (data) {
                        if (data == 0) {
                            jAlert("Error Occured", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        else {
                            $("#ProductDetailgrid").empty().append(data);
                        }
                    },
                    error: function () {
                        jAlert("something seems wrong");
                    }
                });
            }
            else {
                $('#id_rdcap').attr('checked', false);
                $('#id_rdope').attr('checked', true);

                $.ajax({
                    url: '@Url.Action("EditSer", "PrSummary")?' + new Date().getTime(),
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(goid),
                    success: function (data) {
                        if (data == 0) {
                            jAlert("Error Occured", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        else {
                            $("#ProductDetailgrid").empty().append(data);
                        }
                    },
                    error: function () {
                        jAlert("something seems wrong");
                    }
                });
            }


        }
    });



    $("#btnSave").click(function () {
        var existrow = $('.save-btn1').length;
        if (existrow != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var existrow1 = $('.save').length;
        if (existrow1 != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var prrefno = $("#txtprrefno").val();
        var prdate = $('#txtprdate').val();
        var expense = $('input[name=mode1]:checked').val();
        var branchtype = $("input[name='mode2']:checked").val();
        var prfccc = $("#dropFCCC").val();
        var prbranchgid = $("#dropBranch").val();
        var prrequestforgid = $("#dropRequestfor").val();
        var prdesc = $("#txtprdesc").val();
        var prraisedby = $("#txtprraisedby").val();

        if (prdate == null || prdate == "") {
            jAlert("Please select date!", "Error");
            return false;
        }
        if (prraisedby == null || prraisedby == "") {
            jAlert("Please enter raised by!", "Error");
            return false;
        }
        if (prdesc == null || prdesc == "") {
            jAlert("Please enter description!", "Error");
            return false;
        }

        if (prfccc == null || prfccc == "" || prfccc == 0) {
            jAlert("Please select bscc!", "Error");
            return false;
        }
        if (prbranchgid == null || prbranchgid == "" || prbranchgid == 0) {
            jAlert("Please select branch!", "Error");
            return false;
        }
        if (prrequestforgid == null || prrequestforgid == "" || prrequestforgid == 0) {
            jAlert("Please select request for gid!", "Error");
            return false;
        }
        //  alert(prraisedby);
        if (parseInt($("#grid2 tr").length) < 2) {
            jAlert("Please Add PR Details", "Error", function () {
                return false;
            });
            return false;
        }
        var prheader = {
            "prRefNo": prrefno,
            "prDate": prdate,
            "prFcc": prfccc,
            "prExpense": expense,
            "prBranchType": branchtype,
            "prBranch": prbranchgid,
            "prDesc": prdesc,
            "prReqFor": prrequestforgid,
            "prRaisedBy": prraisedby

        }
        @*$.post('@Url.Action("saveeditprraiser1", "PrSummary")', prheader,
     function (data) {
         //if (data == 0) { alert("ss"); } else { jAlert("Saved Successfully"); }
         if (data == 0) { location = location.href; } else { jAlert("Saved Successfully"); location = '@Url.Action("PrSummary1", "PrSummary")'; }
     }, 'json');*@
        showProgress();
        $.ajax({
            url: "@Url.Action("saveeditprraiser1", "PrSummary")",
            type: 'POST',
            data: prheader,
            success: function (data) {
                hideProgress();
                if (data == 0) {
                    jAlert("Error Occured", "Error", function () {
                        return false;
                    });
                    return false;
                }
                else {
                    jAlert("Saved Successfully","Success");
                    @*location = '@Url.Action("PrSummary1", "PrSummary")';*@
                    location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                }
            },
            error: function () {
                jAlert("something seems wrong");
            }
        });

    });

    $("#btnSubmit").click(function () {
        var existrow = $('.save-btn1').length;
        if (existrow != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var existrow1 = $('.save').length;
        if (existrow1 != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var prrefno = $("#txtprrefno").val();
        var prdate = $('#txtprdate').val();
        var expense = $('input[name=mode1]:checked').val();
        var branchtype = $("input[name='mode2']:checked").val();
        var prfccc = $("#dropFCCC").val();
        var prbranchgid = $("#dropBranch").val();
        var prrequestforgid = $("#dropRequestfor").val();
        var prrequestforname = $("#dropRequestfor option:selected").text();
        var prdesc = $("#txtprdesc").val();
        var prraisedby = $("#txtprraisedby").val();

        if (prdate == null || prdate == "") {
            jAlert("Please select date!", "Error");
            return false;
        }
        if (prraisedby == null || prraisedby == "") {
            jAlert("Please enter raised by!", "Error");
            return false;
        }
        if (prdesc == null || prdesc == "") {
            jAlert("Please enter description!", "Error");
            return false;
        }

        if (prfccc == null || prfccc == "" || prfccc == 0) {
            jAlert("Please select fccc!", "Error");
            return false;
        }
        if (prbranchgid == null || prbranchgid == "" || prbranchgid == 0) {
            jAlert("Please select branch!", "Error");
            return false;
        }
        if (prrequestforgid == null || prrequestforgid == "" || prrequestforgid == 0) {
            jAlert("Please select request for gid!", "Error");
            return false;
        }
        //  alert(prraisedby);
        if (parseInt($("#grid2 tr").length) < 2) {
            jAlert("Please Add PR Details", "Error", function () {
                return false;
            });
            return false;
        }
        var prheader = {
            "prRefNo": prrefno,
            "prDate": prdate,
            "prFcc": prfccc,
            "prExpense": expense,
            "prBranchType": branchtype,
            "prBranch": prbranchgid,
            "prDesc": prdesc,
            "prReqFor": prrequestforgid,
            "prRaisedBy": prraisedby,
            "requestForName": prrequestforname

        }
        showProgress();
        $.post('@Url.Action("saveeditprraiser", "PrSummary")', prheader,
     function (data) {
         //if (data == 0) { alert("ss"); } else { jAlert("Saved Successfully"); }
         hideProgress();
         if (data == 0) {
             //location = location.href;
             jAlert("Error Occured", "Error", function () {
                 return false;
             });
             return false;
         } else {
             jAlert("Saved Successfully");
             //location = '@Url.Action("PrSummary1", "PrSummary")';
             location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
         }
     }, 'json');

    });
    var currentTab = 0;
    $(function () {
        $("#tabsat").tabs({
            select: function (e, i) {
                currentTab = i.index;
            }
        });
    });
</script>
