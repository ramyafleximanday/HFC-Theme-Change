@model IEM.Areas.FLEXIBUY.Models.PrSumEntity
@{
    ViewBag.Title = "DelmateView";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int rowNum = 0;
}

<style>
    .pipsl {
        width: 3% !important;
        padding: 3px !important;
        min-width: 30px !important;
    }

    .pipProductGroup {
        width: 10% !important;
        padding: 3px !important;
        min-width: 150px !important;
    }

    .pipProductCode {
        width: 6% !important;
        padding: 3px !important;
        min-width: 100px !important;
    }

    .pipProductName {
        width: 16% !important;
        padding: 3px !important;
        min-width: 200px !important;
    }

    .pipProductDescription {
        width: 21% !important;
        padding: 3px !important;
        min-width: 250px !important;
    }

    .pipUnit {
        width: 5% !important;
        padding: 3px !important;
        min-width: 70px !important;
    }

    .pipQuantity {
        width: 6% !important;
        padding: 3px !important;
        min-width: 80px !important;
        text-align: center !important;
    }

    .pipRate {
        width: 9% !important;
        padding: 3px !important;
        min-width: 100px !important;
        text-align: right;
    }

    .pipestimation {
        width: 8% !important;
        padding: 3px !important;
        min-width: 100px !important;
        text-align: right;
    }

    .pipAttach {
        width: 9% !important;
        padding: 3px !important;
        min-width: 100px !important;
    }

    .pipAction {
        width: 6% !important;
        padding: 3px !important;
        min-width: 60px !important;
        text-align: center;
    }

    .pipWidth5 {
        width: 5% !important;
        padding: 3px !important;
    }

    .pipWidth10 {
        width: 10% !important;
        padding: 3px !important;
    }

    .pipWidth15 {
        width: 15% !important;
        padding: 3px !important;
    }

    .pipWidth20 {
        width: 20% !important;
        padding: 3px !important;
    }

    .pipWidth25 {
        width: 25% !important;
        padding: 3px !important;
    }

    .pipWidth30 {
        width: 30% !important;
        padding: 3px !important;
    }
</style>

<b>
    <span style="color: rgb(52, 108, 196);">Delmate View</span>
</b>
<div>
    @Html.HiddenFor(a => a.prHead.prGid, new { @id = "hdfprhgid" })
</div>
<div class="well" style="padding:10px;">
    @{
        var rblprodserv = (string)Session["rblProductService"];
        if (rblprodserv != "")
        {
            if (rblprodserv == "P")
            {
                <div class="radio-inline">
                    <span id="lblprod">
                        <input type="radio" id="id_rdprod" name="modenew" value="Product" checked="checked" disabled="disabled" onchange="selprocomm()" />
                        Product
                    </span>
                </div>
                <div class="radio-inline">
                    <span id="lblserv">
                        <input type="radio" id="id_rdserv" name="modenew" value="Service" disabled="disabled" onchange="selprocomm()" />
                        Service

                    </span>
                </div>
            }
            else
            {

                <div class="radio-inline">
                    <span id="lblprod">
                        <input type="radio" id="id_rdprod" name="modenew" value="Product" disabled="disabled" onchange="selprocomm()" />
                        Product
                    </span>
                </div>
                <div class="radio-inline">
                    <span id="lblserv">
                        <input type="radio" id="id_rdserv" name="modenew" value="Service" checked="checked" disabled="disabled" onchange="selprocomm()" />
                        Service

                    </span>
                </div>
            }
        }
    }
    <div class="panel panel-default">

        <table class="myTableStyleTabNew" width="100%" align="center">
            <tr>

                <td style="padding:10px; width:20%;">
                    <div>
                        <span>PR Ref No.</span>
                        <br />

                        <div>
                            <input type="text"
                                   name="txtprrefno"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="prrefno" value="@Model.prHead.prRefNo" />
                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">
                    <div>
                        <span>PR Date</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtprdate"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="prdate" value="@Model.prHead.prDate" />

                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">

                    <div>

                        <span>PR Raised by</span>
                        <br />

                        <div>
                            <input type="text"
                                   name="txtprraisedby"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="prraisedby" value="@Model.prHead.prRaisedBy" />
                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:40%;" colspan="2">
                    <div>
                        <span>PR Description</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtprdesc"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="prdesc" value="@Model.prHead.prDesc" />

                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="padding:10px; width:20%;">
                    <div>
                        <span>FCCC</span>
                        <br />

                        <div>
                            <input type="text"
                                   name="txtprfccc"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="prfccc" value="@Model.prHead.prFcc" />


                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">
                    <div>
                        <span>Branch</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtbranch"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="branch" value="@Model.prHead.prBranch" />

                        </div>
                    </div>
                </td>

                <td style="padding:10px; width:20%;">
                    <div>
                        <span>Request for</span>
                        <br />
                        <div>
                            <input type="text"
                                   name="txtreqfor"
                                   class="textboxStyleBig"
                                   disabled="disabled"
                                   id="reqfor" value="@Model.prHead.prReqFor" />
                        </div>
                    </div>
                </td>
                <td style="padding:10px; width:20%;">

                    @{

                        var expense = (string)Session["rblExpenses"];
                        if (expense != "")
                        {
                            if (expense == "C")
                            {
                                <div>
                                    <span>Expenses</span>
                                </div>

                                <div class="radio-inline">
                                    <span id="lblcapex">
                                        <input type="radio" id="id_rdcap" name="mode1" value="Capex" checked="checked" disabled="disabled" />
                                        Capex
                                    </span>
                                </div>
                                <div class="radio-inline">
                                    <span id="lblopex">
                                        <input type="radio" id="id_rdope" name="mode1" value="Opex" disabled="disabled" />
                                        Opex
                                    </span>
                                </div>

                            }
                            else
                            {
                                <div class="radio-inline">
                                    <span id="lblcapex">
                                        <input type="radio" id="id_rdcap" name="mode1" value="Capex" disabled="disabled" />
                                        Capex
                                    </span>
                                </div>
                                <div class="radio-inline">
                                    <span id="lblopex">
                                        <input type="radio" id="id_rdope" name="mode1" value="Opex" checked="checked" disabled="disabled" />
                                        Opex
                                    </span>
                                </div>
                            }
                        }
                    }
                </td>
                <td style="padding:10px; width:20%;">
                    @{


                        var branchtype = (string)Session["rblBranchType"];
                        if (branchtype != "")
                        {
                            if (branchtype == "S")
                            {
                                <div>
                                    <span>Branch </span>
                                </div>

                                <div class="radio-inline">
                                    <span id="lblsingle">
                                        <input type="radio" id="id_rdsing" name="mode2" value="Single" checked="checked" disabled="disabled" />
                                        Single
                                    </span>
                                </div>
                                <div class="radio-inline">
                                    <span id="lblmultiple">
                                        <input type="radio" id="id_rdmult" name="mode2" value="Multiples" disabled="disabled" />
                                        Multiple
                                    </span>
                                </div>
                            }
                            else
                            {
                                <div class="radio-inline">
                                    <span id="lblsingle">
                                        <input type="radio" id="id_rdsing" name="mode2" value="Single" disabled="disabled" />
                                        Single
                                    </span>
                                </div>
                                <div class="radio-inline">
                                    <span id="lblmultiple">
                                        <input type="radio" id="id_rdmult" name="mode2" value="Multiples" checked="checked" disabled="disabled" />
                                        Multiple
                                    </span>
                                </div>
                            }
                        }
                    }
                </td>
            </tr>
            <tr style="display:none;">

                <td colspan="6" style="padding:10px;" align="center">
                    <div>
                        @*<input type="button" class="btn btn-link" title="View Attachment" value="View Attachment" name="command" id="@Model.prHead.prRefNo" onclick="viewattach(id)" />*@
                        <input type="button" class="btn btn-link" title="View Attachment" value="View Attachment" name="command" id="@Model.prHead.prGid" onclick="viewattach(id)" />
                    </div>
                </td>
            </tr>

        </table>
    </div>

    @{
        var grid = new WebGrid(source: Model.lstproduct, canSort: true, canPage: true, rowsPerPage: 5, ajaxUpdateContainerId: "wgProductList", ajaxUpdateCallback: "D()", selectionFieldName: "SelectedRow");
        grid.Pager(WebGridPagerModes.All);
    }

    @functions {
        public static string Sorter(string columnName, string columnHeader, WebGrid grid)
        {
            return string.Format("{0} {1}", columnHeader, grid.SortColumn == columnName ?
                grid.SortDirection == SortDirection.Ascending ? "▲" :
                "▼" : string.Empty);
        }
    }
    <div style="height:120px; width:100%; overflow:auto;">
        @if (rblprodserv == "P")
        {
            @grid.GetHtml(
         tableStyle: "table table-bordered table-hover table-responsive",
        htmlAttributes: new { id = "grid" },
        columns: grid.Columns
            (
                //Here I am going to add checkbox column
                //grid.Column("srNo", "srNo", style: "col-sm-1"),
                                       grid.Column("SL", format: a => rowNum = rowNum + 1, style: "pipsl"),
     grid.Column(header: "Product Group", format: @<text>

                                        <label id="lblProductGroup">@item.product_Group</label></text>, canSort: false,style: "pipProductGroup" ),

                   grid.Column(header: "Product Code",format: @<text>
                <label id="lblProductCode">@item.product_Code</label></text>,canSort: false, style: "pipProductCode"),
                   grid.Column(header: "Product Name",format: @<text>
                <label id="lblProductName">@item.product_Name</label> </text>,canSort: false, style: "pipProductName"),
                     grid.Column(header: "Product Description",format: @<text>
                <label id="lblProductDesc">@item.product_Description</label> </text>,canSort: false, style: "pipProductDescription"),

                                    grid.Column(header: "Unit", format: @<text>
                <label id="lblProductUnit">@item.product_Unit</label> </text>,canSort: false, style: "pipUnit"),

                     grid.Column(header: "Quantity", format: @<text>
                <label id="lblProductQuantity">@item.product_Qty</label> </text>, canSort: false, style: "pipQuantity"),

        grid.Column(header: "Rate", format: @<text>
                <label id="lblProductQuantity">@item.product_rate</label> </text>, canSort: false, style: "pipRate rightAlign"),

        grid.Column(header: "Estimation", format: @<text>
                <label id="lblProductQuantity">@item.product_cost</label> </text>, canSort: false, style: "pipestimation rightAlign"),

                     grid.Column(header: "Action", style: "pipAttach", format: @<text>
                <input type="button" id="@item.prDet_Gid" class="btn btn-link" title="View Quotation" style="padding:4px;" value="view quotation" onclick="attach(id)" />
                    </text>)))



        }
        @if (rblprodserv == "S")
        {
            @grid.GetHtml(
         tableStyle: "table table-bordered table-hover table-responsive",
        htmlAttributes: new { id = "grid" },
        columns: grid.Columns
            (
                //Here I am going to add checkbox column
                //grid.Column("srNo", "srNo", style: "col-sm-1"),
                                            grid.Column("SL", format: a => rowNum = rowNum + 1, style: "pipWidth5"),
     grid.Column(header: "Service Group", format: @<text>
                                        <label id="lblProductGroup">@item.service_Group</label></text>, canSort: false,style: "pipWidth15" ),
                   grid.Column(header: "Service Code",format: @<text>
                <label id="lblServiceCode">@item.service_Code</label></text>,canSort: false, style: "pipWidth10"),
                   grid.Column(header: "Service Name",format: @<text>
                <label id="lblServiceName">@item.service_Name</label> </text>,canSort: false, style: "pipWidth15"),
                     grid.Column(header: "Service Description",format: @<text>
                <label id="lblServiceDesc">@item.service_Description</label> </text>, canSort: false, style: "pipWidth25"),
         grid.Column(header: "Rate", format: @<text>
                <label id="lblProductQuantity">@item.product_rate</label> </text>, canSort: false, style: "pipWidth10 rightAlign"),

        grid.Column(header: "Estimation", format: @<text>
                <label id="lblProductQuantity">@item.product_cost</label> </text>, canSort: false, style: "pipWidth10 rightAlign"),

            grid.Column(header: "Action", style: "pipWidth10", format: @<text>

                @*@Html.Raw("<a data-modal='' href='../../PIPInputsOnPRQuotation/PIPattach/" + @Model.prHead.prRefNo + "' id='" + @Model.prHead.prRefNo + "' title='Attach Quotation'>  <input type='button'id='Attach_Quotation' class='btn btn-link' value='Attach Quotation' name='command' /> </a>")*@
                @*<input type="button" id="btnAttach_Quotation" class="btn btn-link" title="Attach Quotation" value=" Attach quotation" />*@
                <input type="button" id="@item.prDet_Gid" class="btn btn-link" title="View Quotation" value="view quotation" onclick="attach(id)" />
                @*<span class='btn btn-link' title="Attach Quotation" id="btnAttach_Quotation"><label id="sdf0001" > @rowNum</label></span>*@
        </text>)))


        }
    </div>
    <label>Page: @(grid.PageIndex + 1) of @grid.PageCount</label>
    <div id="tab" style="height:100%;font-size:14px;">
        <ul>
            <li><a href="#tabs-1">Audit Trail</a></li>
            <li><a href="#tabs-2">Attachments</a></li>
        </ul>
        <div id="tabs-1">
            @Html.Partial("tab_auditrail")
        </div>
        <div id="tabs-2">
            @Html.Partial("viewprattachment")
        </div>
    </div>
    <div>

        <table align="center" class="myTableStyleTabNew">
            <tr>
                <td style="padding:10px;">
                    <span>Remarks</span>
                    <textarea name="txt_remarks"
                              class="textboxStyle"
                              style="display:block;width:437px;height:89px;"
                              maxlength="264"
                              id="description_delmat"></textarea>
                </td>
                <td style="vertical-align:bottom">
                    <a class="btn btn-info" style="color:black;" title="Raise Tickets" onclick="RaiseTicket()"> <b>?</b> </a>
                </td>
            </tr>

        </table>

    </div>

    <table class="myTableStyleTabNew" align="center">
        <tr>
            <td>

                <div style="padding:10px 10px 0px 0px;text-align:center;">
                    @*<input type="button" class="btn btn-primary" value="Approved" onclick="parapproval()" />
                        <input type="button" class="btn btn-success" value="Reject" onclick="parrejected()" />*@
                    @*<input type="button" class="btn btn-warning " value="Cancel" onclick="back()" />*@
                    <button type="button" id="btnapprove" name="command" class="btn btn-success" onclick="parapproval()" value="Submit">
                        <span class="glyphicon glyphicon-thumbs-up" style="color:white;"></span> Approve
                    </button>
                    &nbsp;
                    <button type="button" id="btnreject" class="btn btn-danger" value="Delete" onclick="parrejected()">
                        <span style="color:white;" class="glyphicon glyphicon-thumbs-down"></span> Reject
                    </button>
                    &nbsp;
                    <button type="button" id="btncancel" class="btn btn-warning" value="Back" onclick="back()">
                        <span style="color:white;" class="glyphicon glyphicon-eye-close"></span> Back
                    </button>
                </div>
            </td>
        </tr>
    </table>

</div>
<input hidden="hidden" id="aa" />

<div id="ForPartialViewnew5hh"></div>
<script>
    function back() {
        //location = '@Url.Action("Delmate", "Delmet")';
        location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
    }
    $(document).ready(function () {
        $('#aa').val('');
        var currentTab4 = 0;
        $(function () {
            $("#tab").tabs({
                select: function (e, i) {
                    currentTab4 = i.index;
                }
            });
        });
    });
    var objDialog5;

    function viewattach(id) {

        if ($("#aa").val() == "") {
            $('#aa').val('anu');

            objDialog5 = $("[id$='ForPartialViewnew5hh']");
            objDialog5.dialog({
                autoOpen: false,
                modal: true,
                show: 'fade-in',
                close: 'fade-out',
                cache: false,
                width: 600,
                height: 400
            });
        }

        objDialog5.load('@Url.Action("ViewQuatation", "Prsupervisior")?id=' + id + '&' + new Date().getTime());
        objDialog5.dialog({ title: 'PR Attachment List' });
        objDialog5.dialog("open");
    }

    function parapproval() {
        //var parm = $('#prrefno').val(); hdfprhgid
        var parm = $('#hdfprhgid').val();

        $.ajax({
            url: '@Url.Action("CheckApproverIsExists", "PIPInputsOnPR")?refgid=' + parm + '&refname=PR&' + new Date().getTime(),
            type: 'POST',
            async: false,
            cache: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                //if (data == 1) {
                //    jAlert("You Have Already Approved This PR", "Warning", function () {
                //        return false;
                //    });
                //}
                if (data == 2) {
                    jAlert("You Cannot Approve Now.Something Seems Wrong", "Error", function () {
                        return false;
                    });
                }
                else {
                    var remarks = $("#description_delmat").val();
                    var pr = {
                        "prGid": parm,
                        "prRemarks": remarks
                    }
                    showProgress();
                    $.post('@Url.Action("SuperApprove", "Delmet")?' + new Date().getTime(), pr,
                           function (data) {
                               hideProgress();
                               if (data == 0) {
                                   jAlert("Error Occured", "Error", function () {
                                       return false;
                                   });
                                   return false;
                               } else {
                                   jAlert("Approved Successfully", "Success", function () {
                                       location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                   });
                               }
                           }, 'json');
                   
                }
            },
            error: function (result) {
                jAlert("Something went wrong", "Error");
            }
        });

       
    }

    function parrejected() {
        var prRemarks = $('#description_delmat').val();
        // var parm = $('#prrefno').val();
        var parm = $('#hdfprhgid').val();

        $.ajax({
            url: '@Url.Action("CheckApproverIsExists", "PIPInputsOnPR")?refgid=' + parm + '&' + new Date().getTime(),
            type: 'POST',
            async: false,
            cache: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                //if (data == 1) {
                //    jAlert("You Have Already Approved This PR", "Warning", function () {
                //        return false;
                //    });
                //}
                //else
                if (data == 2) {
                    jAlert("You Cannot Approve Now.Something Seems Wrong", "Error", function () {
                        return false;
                    });
                }
                else {
                    if (prRemarks == null || prRemarks.toString().trim() == "") {
                        jAlert("Please enter Remarks", "Error", function () {
                            $('#description_delmat').val("");
                            $('#description_delmat').focus();
                            return false;
                        });
                        return false;
                    }
                    else {
                        var prhead = {
                            "prGid": parm,
                            "prRemarks": prRemarks
                        };
                        showProgress();
                        $.post('@Url.Action("SuperReject", "Delmet")?' + new Date().getTime(), prhead,
                         function (data) {
                             hideProgress();
                             if (data == 0) {
                                 jAlert("Error Occured", "Error", function () {
                                     return false;
                                 });
                                 return false;
                             } else {
                                 jAlert("Rejected Successfully", "Success", function () {
                                     location = '@Url.Action("Index","flexibuydashboard")?redirect=yes' + '&' + new Date().getTime();
                                 });
                                                                 
                             }
                         }, 'json');

                    }

                }
            },
            error: function (result) {
                jAlert("Something went wrong", "Error");
            }
        });

        
    }
    function attach(id) {

        if ($("#aa").val() == "") {
            $('#aa').val('anu');
            //alert(id);
            objDialog5 = $("[id$='ForPartialViewnew5hh']");
            objDialog5.dialog({
                autoOpen: false,
                modal: true,
                show: 'fade-in',
                close: 'fade-out',
                cache: false,
                width: 600,
                height: 400
            });
        }

        objDialog5.load('@Url.Action("ViewQuatation", "Prsupervisior")?id=' + id + '&' + new Date().getTime());
        objDialog5.dialog({ title: 'PRsupervisor Quotations' });
        objDialog5.dialog("open");
    }

    function selprocomm() {

        var url;
        var goid = $('input[name=modenew]:checked').val();
        if (goid == "Product") {
            $('#id_rdcap').attr('checked', true);
            $('#id_rdope').attr('checked', false);

        }
        else {

            $('#id_rdcap').attr('checked', false);
            $('#id_rdope').attr('checked', true);

        }

    }
    function RaiseTicket() {
        var refflagname = "PR";
        var itemrefno = $("[id=prrefno]").val();
        if ($("#aa").val() == "") {
            $('#aa').val('iem');
            objDialog5 = $("[id$='ForPartialViewnew5hh']");
            objDialog5.dialog({
                autoOpen: false,
                modal: true,
                show: 'fade-in',
                close: 'fade-out',
                cache: false
            });
        }
        objDialog5.load('../../RaiseTickets/SingleTicketNormal?refname=' + refflagname + '&itemrefno=' + itemrefno + '&' + new Date().getTime());
        objDialog5.dialog({
            title: 'Raise Ticket',
            width: 1100,
            height: 500
        });
        objDialog5.dialog("open");
    }
</script>