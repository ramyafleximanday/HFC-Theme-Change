    @model IEM.Areas.FLEXIBUY.Models.GRNInward
    <link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
    @{
        ViewBag.Title = "View1";
        Layout = "~/Views/Shared/_Layout.cshtml";
        var viewfor = (string)Session["viewfor"];
        if (viewfor == "edit")
        {
            ViewBag.viewmode = "";
        }
        else if (viewfor == "view")
        {
            ViewBag.viewmode = "disabled";
        }
    }
    <input type="hidden" id="hid_poheadGid" value="@Model.poheadGid" />
    <input type="hidden" id="hid_dcno" value="@Model.grnDcNo" />
    <input type="hidden" id="hid_grnRefno" value="@Model.grnRefNo" />
    <input type="hidden" id="hid_grninvNo" value="@Model.grnInvoiceNo" />
    <input type="hidden" id="hid_grnRemarks" value="@Model.grnRemarks" />
    <input type="hidden" id="hid_grnheadgid" value="@Model.grnheadgid" />
    <input type="hidden" id="hid_grndetgid" value="@Model.grndetgid" />
    <input type="hidden" id="hid_Viewmode" value="@viewfor" />

    @*<h2>GRN Inward</h2>*@
<b>
    <span style="color: rgb(52, 108, 196);">GRN Inward</span>
</b>
    <div class="well">
        @*<h4>GRN Header</h4>*@
        
            <span style="color: rgb(52, 108, 196);">GRN Header</span>
        
        @using (Html.BeginForm())
        {
            <div class="borderStyle panel panel-default ">
                <table class="myTableStyleTabNew" align="center" width="100%">
                    <tr>
                        <td style="padding:10px;">
                            <span>GRN Ref No</span>
                            <br />
                            <input type="text"
                                   name="txtgrnrefno"
                                   id="txtgrnrefno"
                                   disabled="disabled"
                                   class="textboxStyle required" @ViewBag.viewmode />
                        </td>
                        <td style="padding:10px;">
                            <span>GRN Date </span>
                            <br />
                            <input type="text"
                                   id="txtgrndate"
                                   maxlength="10"
                                   disabled="disabled"
                                   value="@string.Format("{0:yyyy-MM-dd}", Model.grnDate)"
                                   class="textboxStyle valid" />
                        </td>
                        <td style="padding:10px;">
                            <span>Raised By</span>
                            <br />
                            <input type="text"
                                   name="txtraisedby"
                                   id="txtraisedby"
                                   disabled="disabled"
                                   value="@Model.raisedBy"
                                   class="textboxStyle valid" />
                        </td>
                        <td style="padding:10px;">
                            <span>Vendor Name</span>
                            <br />
                            <input type="text"
                                   name="txtvendorname"
                                   id="txtvendorname"
                                   disabled="disabled"
                                   value="@Model.vendorName"
                                   class="textboxStyle valid" />
                        </td>
                    </tr>
                    @*<tr>
                            <td></td>
                        </tr>*@
                    <tr>
                        <td style="padding:10px;">
                            <span>PO Ref No</span>
                            <br />
                            <input type="text"
                                   name="txtporefno"
                                   id="txtporefno"
                                   disabled="disabled"
                                   value="@Model.poRefNo"
                                   class="textboxStyle valid" />
                        </td>
                        <td style="padding:10px;">
                            <span>DC No</span>
                            <br />
                            <input type="text"
                                   name="txt_dcno"
                                   class="textboxStyle required"
                                   id="txtdcNo" @ViewBag.viewmode />
                        </td>
                        <td style="padding:10px;">
                            <span>Invoice No</span>
                            <br />
                            <input type="text"
                                   name="txt_invno"
                                   class="textboxStyleBig required"
                                   id="txtinvNo" @ViewBag.viewmode />
                        </td>
                        @*<td>
                            <br />
                            <button class="btn btn-primary"
                                    type="button"
                                    name="command"
                                    value="Add Attachment"
                                    onclick="NewAttachment()" @ViewBag.viewmode>
                                Add Attachment
                            </button>
                        </td>*@
                    </tr>
                    <tr>
                        <td nowrap="nowrap" colspan="3" style="padding:10px;">
                            <span>GRN Remarks</span>
                            <br />
                            <input type="text"
                                   name="txt_grn_remarks"
                                   class="textboxStyleBig required"
                                   id="txt_grn_remarks" @ViewBag.viewmode />
                        </td>
                    </tr>
                </table>
            </div>
              <div>
                  <table style="margin-left: 646px;" class="myTableStyleTabNew">
                      <tr>
                          <td style="padding:10px;">
                              <span></span>
                              <br />
                              <input type="checkbox" id="chk_released" value="Released" name="released" @ViewBag.viewmode /> Same as Released Quantity
                          </td>
                          <td width="10%"></td>
                          <td>
                              <span>Received Date </span>
                              <br />
                              <input type="text"
                                     id="txtrecv_date"
                                     maxlength="10"
                                     class="textboxStyle" @ViewBag.viewmode />
                          </td>
                          <td>
                              <span></span>
                              <br />
                              <button type="button" id="btnUpdate" class="btn btn-primary" value="Cancel" onclick="UpdateQtyDate()" @ViewBag.viewmode>
                                  <span style="color:white;" class="glyphicon glyphicon-floppy-save"></span> Update
                              </button>
                          </td>
                      </tr>
                  </table>
        </div>
            @*<h4>GRN Details</h4>*@
         
            <span style="color: rgb(52, 108, 196);">GRN Details</span>
        
            <div id="grndetailsgrid">
                @if (@ViewBag.podetails != "Second")
                {
                    <div>
                        @Html.Partial("GrnInwardDetails");
                    </div>
                }
                else
                {
                    <div id="pogrid">

                    </div>
                }
            </div>
        }
    </div>

<div>
    <div @*class="container "*@>
        <div id="tabsat4" style="height:400px;">
            <ul>
                @*<li><a href="#tabs4-1">Audit Trail</a></li>*@
                <li><a href="#tabs4-2">Attachments</a></li>
            </ul>
            @*<div id="tabs4-1">
                @Html.Partial("tab_auditrailGRN")
            </div>*@
            <div id="tabs4-2">
                @Html.Partial("BoqAttach")
            </div>

        </div>
    </div>


</div>
<br />

    <div>
        <table class="myTableStyleTabNew" align="center">
            <tr>
                <td>
                    @if(viewfor=="edit")
                    { 
                    <div>
                        <button type="button" id="btnsave" name="command" class="btn btn-primary" onclick="UpdateGrnDetails()" value="Save">
                            <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Save
                        </button>
                        &nbsp;
                        @*<input type="button" value="Save" class="btn btn-success" id="btn_save" onclick="SavePodetails()" />*@
                        <button type="button" id="btn_submitgrn" name="command" class="btn btn-success" onclick="UpdateGrn()" value="Submit">
                            <span class="glyphicon glyphicon-floppy-saved" style="color:white;"></span> Submit
                        </button>
                        &nbsp;
                        @*// <input type="button" value="Submit" class="btn btn-success" id="btn_submit" onclick="SavePo()" />*@
                        <button type="button" id="btncancel" class="btn btn-warning" value="Cancel" onclick="BackToGrnSummary()">
                            <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                        </button>
                    </div>
                    }
                    else if (viewfor=="view")
                    {
                        <div>
                        <button type="button" id="btncancel" class="btn btn-warning" value="Back" onclick="BackToGrnSummary()">
                            <span style="color:white;" class="glyphicon glyphicon-eye-close"></span> Back
                        </button>
                         </div>
                    }
                    else
                    {
                        <div>
                        <button type="button" id="btnsave" name="command" class="btn btn-primary" onclick="SaveGrnDetails()" value="Save">
                            <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Save
                        </button>
                        &nbsp;
                        @*<input type="button" value="Save" class="btn btn-success" id="btn_save" onclick="SavePodetails()" />*@
                        <button type="button" id="btn_submitgrn" name="command" class="btn btn-success" onclick="SaveGrn()" value="Submit">
                            <span class="glyphicon glyphicon-floppy-saved" style="color:white;"></span> Submit
                        </button>
                        &nbsp;
                        @*// <input type="button" value="Submit" class="btn btn-success" id="btn_submit" onclick="SavePo()" />*@
                        <button type="button" id="btncancel" class="btn btn-warning" value="Cancel" onclick="BackToGrnSummary()">
                            <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                        </button>
                    </div>
                    }
                    @*<input type="button" value="Save" class="btn btn-success" id="btn_save" onclick="SavePodetails()" />
                    <input type="button" value="Submit" class="btn btn-success" id="btn_submit" onclick="SavePo()" />
                    <input type="button" class="btn btn-warning " value="Back" onclick= "BackToSelection()" />*@
                </td>
            </tr>
        </table>
    </div>
    <script>
        $(document).ready(function () {
            var invoiceNo = $("#hid_grninvNo").val();
            $("#txtinvNo").val(invoiceNo);
            var dcNo = $("#hid_dcno").val();
            $("#txtdcNo").val(dcNo);
            var grnRefNo = $("#hid_grnRefno").val();
            $("#txtgrnrefno").val(grnRefNo);
            var grnRemarks = $("#hid_grnRemarks").val();
            $("#txt_grn_remarks").val(grnRemarks);

            $("#txtdcNo").keyup(function () {
                var dcno = $("#txtdcNo").val();
                if (dcno.trim() != "") {
                    $("#txtdcNo").removeClass('required');
                    $("#txtdcNo").addClass('valid');
                }
                else {
                    $("#txtdcNo").removeClass('valid');
                    $("#txtdcNo").addClass('required');
                }
            });

            $("#txtinvNo").keyup(function () {
                var invoiceNo = $("#txtinvNo").val();
                if (invoiceNo.trim() != "") {
                    $("#txtinvNo").removeClass('required');
                    $("#txtinvNo").addClass('valid');
                }
                else {
                    $("#txtinvNo").removeClass('valid');
                    $("#txtinvNo").addClass('required');
                }
            });

            $("#txt_grn_remarks").keyup(function () {
                var grn_remarks = $("#txt_grn_remarks").val();
                if (grn_remarks.trim() != "") {
                    $("#txt_grn_remarks").removeClass('required');
                    $("#txt_grn_remarks").addClass('valid');
                }
                else {
                    $("#txt_grn_remarks").removeClass('valid');
                    $("#txt_grn_remarks").addClass('required');
                }
            });
        });
        var pickerOpts = {
            changeMonth: true,
            changeYear: true,
            yearRange: '1950:2100',
            currentText: "Now",
            dateFormat: "dd-mm-yy"
        };

        $("#txtgrndate").datepicker(pickerOpts);

        function SaveGrnDetails() {
            var grnDate = $("#txtgrndate").val();
            //var raisedby = $("#txtraisedby").val();
            var poheadGid = $("#hid_poheadGid").val();
            //var podetailsgid = $("#hid_podetailsgid").val();
            var grndcNo = $("#txtdcNo").val();
            var grnInvNo = $("#txtinvNo").val();
            var grnRemarks = $("#txt_grn_remarks").val();
            //var grnrecdDate=$("#hid_recd_date").val();
            //var grnrecdQty=$("#hid_recd_qty").val();
            var grn = $("#hid_viewfor").val();

            //if (podetailsgid == "" || podetailsgid == null) {
            //    jAlert("Please select line item", "Error");
            //    return false;
            //}
            if(grndcNo=="" || grndcNo==null)
            {
                jAlert("Please enter Dc No", "Error", function (e)
                {
                    if(e==true)
                    {
                        $("#txtdcNo").focus();
                    }
                });
                return false;
            }
            else if (grnInvNo == null || grnInvNo == "") {
                grnInvNo = "";
                //jAlert("Please enter Invoice No", "Error", function (e) {
                //    if (e == true) {
                //        $("#txtinvNo").focus();
                //    }
                //});
                //return false;
            }
            else if(grnRemarks=="" || grnRemarks==null)
            {
                jAlert("Please Enter Remarks", "Error", function (e)
                {
                    if(e==true)
                    {
                        $("#txt_grn_remarks").focus();
                    }
                });
                return false;
            }
            var recdqty = "";
            var recdDate = "";
            var ErrMsg = "";
            var rowcnt = 0; 
            $("#grndetailgrid tbody tr").each(function () {
                var viewfor = document.getElementById("hid_Viewmode").value;
                if (viewfor != "edit") {
                    rowcnt = rowcnt + 1;
                    var vall = $(this).find("#lblunit").text();
                    var val2 = $(this).find("#lbldate").text();

                    if (vall == null || vall == "") {
                        if (recdqty == "") {
                            recdqty = "0";
                        }
                        else {
                            recdqty += "," + "0";
                        }
                    }
                    else {
                        if (recdqty == "") {
                            recdqty = vall.toString();
                        }
                        else {
                            recdqty += "," + vall.toString();
                        }

                    }

                    if (val2 != null && val2 != "") {
                        if (recdDate == "") {
                            recdDate = val2.toString();
                        }
                        else {
                            recdDate += "," + val2.toString();
                        }

                    }
                    if (recdqty.toString() <= 0.00) {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }

                    }

                    if (recdDate == null || recdDate == "") {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                    }
                }
            });
            if (ErrMsg.toString().trim() != "") {
                jAlert(ErrMsg, "Error", function () {
                    return false;
                });
                return false;
            }
            //else if (grnDate == "" || grnDate == null) {
            //    jAlert("Please Select Date", "Error", function (e)
            //    {
            //        if(e==true)
            //        {
            //            $("#txtgrndate").focus();
            //        }
            //    });
            //    return false;
            //}
            //else if(grnrecdQty=="" || grnrecdQty==null)
            //{
            //    jAlert("Please Enter Quantity", "Error");
            //    return false;
            //}
            //else if(grnrecdDate=="" || grnrecdDate==null)
            //{
            //    jAlert("Please Enter Date", "Error");
            //    return false;
            //}
            
           // else {
                var objgrnheader =
                   {
                       "grnDate": grnDate,
                       "grnDcNo": grndcNo,
                       "grnInvoiceNo": grnInvNo,
                       "grnRemarks": grnRemarks,
                       //"podetailsGid": podetailsgid,
                       "poheadGid": poheadGid,
                       "grnType": grn

                   };
                $.post('@Url.Action("SaveGrnDetails", "GrnSelectionPo")', objgrnheader,
                   function (data) {
                       if (data == 0) {
                           jAlert("Error Occured", "Error");
                           return false;
                       }
                       else {
                           if (data == "Inserted Successfully") {
                               jAlert("Inserted Successfully", "Success", function (e) {
                                   if (e == true) {
                                       var viewfor = "refresh";
                                       location = '@Url.Action("GrnInwardSummary", "GRNInward")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   }
                               });
                           }
                           else {
                               jAlert(data, "Error");
                               return false;
                           }
                       }
                   }, 'json');
           // }
        }
        function SaveGrn() {
            var grnDate = $("#txtgrndate").val();
            //var raisedby = $("#txtraisedby").val();
            var poheadGid = $("#hid_poheadGid").val();
            //var podetailsgid = $("#hid_podetailsgid").val();
            var grndcNo = $("#txtdcNo").val();
            var grnInvNo = $("#txtinvNo").val();
            var grnRemarks = $("#txt_grn_remarks").val();
            //var grnrecdDate = $("#hid_recd_date").val();
            var actionName = $("#btn_submitgrn").val();

            //if (podetailsgid == "" || podetailsgid == null) {
            //    jAlert("Please select line item", "Error");
            //    return false;
            //}
            //   var arr = new Array(grndcNo.split(","));
            

            //for (var i = 0; i < arr.length; i++) {
            //    if (parseInt(arr[i]) > 0) {
            //        i = arr.length;
            //    }
            //    else{
            //        if(i == arr.length -1){
            //            if (grndcNo == "" || grndcNo == null) {
            //                jAlert("Please enter Dc No", "Error", function (e) {
            //                    if (e == true) {
            //                        $("#txtdcNo").focus();
            //                    }
            //                });
            //                return false;
            //            }
            //        }
            //    }
            //}
           
            if (grndcNo == "" || grndcNo == null) {
                jAlert("Please enter Dc No", "Error", function (e) {
                    if (e == true) {
                        $("#txtdcNo").focus();
                    }
                });
                return false;
            }
            else if (grnInvNo == null || grnInvNo == "") {
                grnInvNo = "";
                //jAlert("Please enter Invoice No", "Error", function (e) {
                //    if (e == true) {
                //        $("#txtinvNo").focus();
                //    }
                //});
                //return false;
            }

            else if (grnRemarks == "" || grnRemarks == null) {
                jAlert("Please Enter Remarks", "Error", function (e) {
                    if (e == true) {
                        $("#txt_grn_remarks").focus();
                    }
                });
                return false;
            }
            var recdqty ="";
            var recdDate = "";
            var ErrMsg = "";
            var rowcnt = 0;
            $("#grndetailgrid tbody tr").each(function () {
                var viewfor = document.getElementById("hid_Viewmode").value;
                if (viewfor != "edit") {
                    rowcnt = rowcnt + 1;
                    var vall = $(this).find("#lblunit").text();
                    var val2 = $(this).find("#lbldate").text();

                    if (vall == null || vall == "") {
                        if (recdqty == "") {
                            recdqty = "0";
                        }
                        else {
                            recdqty += "," + "0";
                        }
                    }
                    else {
                        if (recdqty == "") {
                            recdqty = vall.toString();
                        }
                        else {
                            recdqty += "," + vall.toString();
                        }

                    }

                    if (val2 != null && val2 != "") {
                        if (recdDate == "") {
                            recdDate = val2.toString();
                        }
                        else {
                            recdDate += "," + val2.toString();
                        }

                    }
                    if (recdqty.toString() <= 0.00) {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }

                    }

                    if (recdDate == null || recdDate == "") {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                    }
                }
            });
            //var arr = new Array(recdqty.split(','));
            //var maxval = Math.max.apply(Math, arr);
            
            //if (recdqty.toString() <= 0) {
            //    jAlert("Please Enter Received Quantity", "Error", function () {
            //        return false;
            //    });
            //    return false;
            //}
            
            //if (recdDate == null || recdDate == "") {
            //    jAlert("Please Enter Received Date", "Error", function () {
            //        return false;
            //    });
            //    return false;
            //}
            if (ErrMsg.toString().trim() != "") {
                jAlert(ErrMsg, "Error", function () {
                    return false;
                });
                return false;
            }
           
            //else if (grnrecdDate == "" || grnrecdDate == null) {
            //    jAlert("Please Enter Date", "Error");
            //    return false;
            //}

                var objgrnheader =
                   {
                       "grnDate": grnDate,
                       "grnDcNo": grndcNo,
                       "grnInvoiceNo": grnInvNo,
                       "grnRemarks": grnRemarks,
                       //"podetailsGid": podetailsgid,
                       "poheadGid": poheadGid,
                       "actionName": actionName

                   };
                $.post('@Url.Action("SaveGrnDetails", "GrnSelectionPo")', objgrnheader,
                   function (data) {
                       if (data == 0) {
                           jAlert("Error Occured", "Error");
                           return false;
                       }
                       else {
                           if (data == "Inserted Successfully") {
                               jAlert("Inserted Successfully", "Success", function (e) {
                                   if (e == true) {
                                       var viewfor = "refresh";
                                       location = '@Url.Action("GrnInwardSummary", "GRNInward")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   }
                               });
                           }
                           else {
                               jAlert(data, "Error");
                               return false;
                           }
                       }
                   }, 'json');
          
        }
        function UpdateGrnDetails()
        {
            var grnDate = $("#txtgrndate").val();
            //var raisedby = $("#txtraisedby").val();
            var poheadGid = $("#hid_poheadGid").val();
            //var podetailsgid = $("#hid_podetailsgid").val();
            var grndcNo = $("#txtdcNo").val();
            var grnInvNo = $("#txtinvNo").val();
            var grnRemarks = $("#txt_grn_remarks").val();
            var grnheadGid = $("#hid_grnheadgid").val();
            var grndetGid = $("#hid_grndetgid").val();

            //if (podetailsgid == "" || podetailsgid == null) {
            //    jAlert("Please select line item", "Error");
            //    return false;
            //}
            
            if (grndcNo == "" || grndcNo == null) {
                jAlert("Please enter Dc No", "Error", function (e) {
                    if (e == true) {
                        $("#txtdcNo").focus();
                    }
                });
                return false;
            }

            else if (grnInvNo == null || grnInvNo == "") {
                grnInvNo = "";
                //jAlert("Please enter Invoice No", "Error", function (e) {
                //    if (e == true) {
                //        $("#txtinvNo").focus();
                //    }
                //});
                //return false;
            }

            //else if (grnDate == "" || grnDate == null) {
            //    jAlert("Please Select Date", "Error", function (e) {
            //        if(e==true)
            //        {
            //            $("#txtgrndate").focus();
            //        }
            //    });
            //    return false;
            //}

           else if (grnRemarks == "" || grnRemarks == null) {
                jAlert("Please Enter Remarks", "Error", function (e) {
                    if (e == true) {
                        $("#txt_grn_remarks").focus();
                    }
                });
                return false;
           }
            var recdqty = "";
            var recdDate = "";
            var ErrMsg = "";
            var rowcnt = 0;
            $("#grndetailgrid tbody tr").each(function () {
                var viewfor = document.getElementById("hid_Viewmode").value;
                if (viewfor != "edit") {
                    rowcnt = rowcnt + 1;
                    var vall = $(this).find("#lblunit").text();
                    var val2 = $(this).find("#lbldate").text();

                    if (vall == null || vall == "") {
                        if (recdqty == "") {
                            recdqty = "0";
                        }
                        else {
                            recdqty += "," + "0";
                        }
                    }
                    else {
                        if (recdqty == "") {
                            recdqty = vall.toString();
                        }
                        else {
                            recdqty += "," + vall.toString();
                        }

                    }

                    if (val2 != null && val2 != "") {
                        if (recdDate == "") {
                            recdDate = val2.toString();
                        }
                        else {
                            recdDate += "," + val2.toString();
                        }

                    }
                    if (recdqty.toString() <= 0.00) {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }

                    }

                    if (recdDate == null || recdDate == "") {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                    }
                }
            });
            if (ErrMsg.toString().trim() != "") {
                jAlert(ErrMsg, "Error", function () {
                    return false;
                });
                return false;
            }
           //else if (grnrecdQty == "" || grnrecdQty == null) {
           //    jAlert("Please Enter Quantity", "Error");
           //    return false;
           //}

           //else if (grnrecdDate == "" || grnrecdDate == null) {
           //    jAlert("Please Enter Date", "Error");
           //    return false;
           //}
         //   else {
                var objgrnheader =
                   {
                       "grnDate": grnDate,
                       "grnDcNo": grndcNo,
                       "grnInvoiceNo": grnInvNo,
                       "grnRemarks": grnRemarks,
                       //"podetailsGid": podetailsgid,
                       "poheadGid": poheadGid,
                       "grnheadGid": grnheadGid,
                       "grndetgid": grndetGid
                   };
                $.post('@Url.Action("SaveGrnEditDetails", "GrnSelectionPo")', objgrnheader,
                   function (data) {
                       if (data == 0) {
                           jAlert("Error Occured", "Error");
                           return false;
                       }
                       else {
                           if (data == "Inserted Successfully") {
                               jAlert("Updated Successfully", "Success", function (e) {
                                   if (e == true) {
                                       var viewfor = "refresh";
                                       location = '@Url.Action("GrnInwardSummary", "GRNInward")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   }
                               });
                           }
                           else {
                               jAlert(data, "Error");
                               return false;
                           }
                       }
                   }, 'json');
        //    }
        }
        function UpdateGrn() {
            var grnDate = $("#txtgrndate").val();
            //var raisedby = $("#txtraisedby").val();
            var poheadGid = $("#hid_poheadGid").val();
            //var podetailsgid = $("#hid_podetailsgid").val();
            var grndcNo = $("#txtdcNo").val();
            var grnInvNo = $("#txtinvNo").val();
            var grnRemarks = $("#txt_grn_remarks").val();
            var grnheadGid = $("#hid_grnheadgid").val();
            var grndetGid = $("#hid_grndetgid").val();
            //var grnrecdDate = $("#hid_recd_date").val();
            //var grnrecdQty = $("#hid_recd_qty").val();
            var actionName = $("#btn_submitgrn").val();
           // var viewfor = "edit";
            //if (podetailsgid == "" || podetailsgid == null) {
            //    jAlert("Please select line item", "Error");
            //    return false;
            //}
            if (grndcNo == "" || grndcNo == null) {
                jAlert("Please enter Dc No", "Error", function (e) {
                    if (e == true) {
                        $("#txtdcNo").focus();
                    }
                });
                return false;
            }
            else if (grnInvNo == null || grnInvNo == "") {
                //jAlert("Please enter Invoice No", "Error",function(e)
                //{
                //    if(e==true)
                //    {
                //        $("#txtinvNo").focus();
                //    }
                //});
                //return false;
                grnInvNo = "";
            }
            //else if (grnDate == "" || grnDate == null) {
            //    jAlert("Please Select Date", "Error", function (e) {
            //        if (e == true) {
            //            $("#txtgrndate").focus();
            //        }
            //    });
            //    return false;
            //}
            else if (grnRemarks == "" || grnRemarks == null) {
                jAlert("Please Enter Remarks", "Error", function (e)
                {
                    if (e == true)
                    {
                        $("#txt_grn_remarks").focus();
                    }
                });
                return false;
            }
            var recdqty = "";
            var recdDate = "";
            var ErrMsg = "";
            var rowcnt = 0;
            $("#grndetailgrid tbody tr").each(function () {
                var viewfor = document.getElementById("hid_Viewmode").value;
                if (viewfor != "edit") {
                    rowcnt = rowcnt + 1;
                    var vall = $(this).find("#lblunit").text();
                    var val2 = $(this).find("#lbldate").text();

                    if (vall == null || vall == "") {
                        if (recdqty == "") {
                            recdqty = "0";
                        }
                        else {
                            recdqty += "," + "0";
                        }
                    }
                    else {
                        if (recdqty == "") {
                            recdqty = vall.toString();
                        }
                        else {
                            recdqty += "," + vall.toString();
                        }

                    }

                    if (val2 != null && val2 != "") {
                        if (recdDate == "") {
                            recdDate = val2.toString();
                        }
                        else {
                            recdDate += "," + val2.toString();
                        }

                    }
                    if (recdqty.toString() <= 0.00) {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Valid Received Quantity (Row Number : " + rowcnt + ").";
                        }

                    }

                    if (recdDate == null || recdDate == "") {
                        if (ErrMsg != "") {
                            ErrMsg += "\nPlease Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                        else {
                            ErrMsg = "Please Enter Received Date (Row Number : " + rowcnt + ").";
                        }
                    }
                }
            });
            if (ErrMsg.toString().trim() != "") {
                jAlert(ErrMsg, "Error", function () {
                    return false;
                });
                return false;
            }
            //else if (grnrecdQty == "" || grnrecdQty == null) {
            //    jAlert("Please Enter Quantity", "Error");
            //    return false;
            //}

            //else if (grnrecdDate == "" || grnrecdDate == null) {
            //    jAlert("Please Enter Date", "Error");
            //    return false;
            //}
          //  else {
                var objgrnheader =
                   {
                       "grnDate": grnDate,
                       "grnDcNo": grndcNo,
                       "grnInvoiceNo": grnInvNo,
                       "grnRemarks": grnRemarks,
                      // "podetailsGid": podetailsgid,
                       "poheadGid": poheadGid,
                       "grnheadGid": grnheadGid,
                       "grndetgid": grndetGid,
                       "actionName": actionName
                   };
                $.post('@Url.Action("UpdateGrnEditDetails", "GrnSelectionPo")', objgrnheader,
                   function (data) {
                       if (data == 0) {
                           jAlert("Error Occured", "Error");
                           return false;
                       }
                       else {
                           if (data == "Inserted Successfully") {
                               jAlert("Submitted Successfully", "Success", function (e) {
                                   if (e == true) {
                                       var viewfor = "refresh";
                                       location = '@Url.Action("GrnInwardSummary", "GRNInward")?viewfor=' + viewfor + '&' + new Date().getTime();
                                   }
                               });
                           }
                           else {
                               jAlert(data, "Error");
                               return false;
                           }
                       }
                   }, 'json');
          //  }
        }
        function BackToGrnSummary()
        {
            location = '@Url.Action("GrnInwardSummary", "GrnInward")?' + new Date().getTime();
        }


        var currentTab4 = 0;
        $(function () {
            $("#tabsat4").tabs({
                select: function (e, i) {
                    currentTab4 = i.index;
                }
            });
        });

    </script>
