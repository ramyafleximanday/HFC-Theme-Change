@model IEM.Areas.FLEXIBUY.Models.PrSumEntity

<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

@{
    ViewBag.Title = "Pr header";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    cursor {
        cursor: pointer;
    }

    panelwidth {
        width: 100%;
    }

    .lblwth {
        width: 170px;
    }

    .txtwth {
        width: 150px;
    }

    .serWidth5 {
        width: 5% !important;
    }

    .serWidth10 {
        width: 10% !important;
        text-align: center;
    }

    .serWidth15 {
        width: 15% !important;
    }

    .serWidth20 {
        width: 20% !important;
    }

    .serWidth30 {
        width: 30% !important;
    }
</style>

<b>
    <span style="color: rgb(52, 108, 196);">PR Raiser</span>
</b>
<div class="well">

    <span style="color: rgb(52, 108, 196);">PR Header</span>

    <div class="borderStyle panel panel-default " style="padding:10px; margin-bottom: 0px;">
        <div>
            <table>
                <tr></tr>
            </table>
        </div>


        <table class="myTableStyleTabNew" align="center" width="100%">
            <tr>

                <td nowrap="nowrap" style="padding:10px; width:20%;">
                    <div>
                        <span>PR Ref No.</span>
                        <br />
                        <input type="text"
                               name="txtprrefno"
                               class="textboxStyle "
                               disabled="disabled"
                               id="prrefno" style="width:100%;" />
                    </div>
                </td>


                <td nowrap="nowrap" style="padding:10px; width:20%;">
                    <div>
                        <span>PR Date</span>
                        <br />

                        <input type="text"
                               name="txtprdate"
                               id="txtprdate"
                               value="@string.Format("{0:yyyy-MM-dd}", Model.prHead.prDate)"
                               class="textboxStyle"
                               style="display:block;width:100%;"
                               disabled="disabled"
                               maxlength="10" />
                    </div>
                </td>


                <td nowrap="nowrap" style="padding:10px; width:20%;">

                    <div>
                        <span>PR Raised by</span>
                        <br />
                        <input type="text"
                               name="txtprraiseby"
                               id="txtprraiseby"
                               value="@Session["employee_name"]"
                               class="textboxStyle"
                               style="display:block;width:100%;"
                               disabled="disabled"
                               maxlength="20" />

                    </div>
                </td>


                <td nowrap="nowrap" style="padding:10px; width:20%;">
                    <div>
                        <span>BSCC</span>
                        <br />
                        <div>
                            @Html.DropDownList("dropFCCC", Model.ddlFCCC, "--Select BSCC--", new { @class = "textboxStyle", @id = "dropFCCC", @style = "width:100%;", @disabled = "disabled" })
                        </div>
                    </div>
                </td>


                <td nowrap="nowrap" style="padding:10px; width:20%;">
                    <div>
                        <span>Request For</span>
                        <br />
                        @Html.DropDownList("dropRequestfor", Model.ddlRequestfor, "--Select Request--", new { @class = "textboxStyle required", @id = "dropRequestfor", @style = "width:100%;" })
                    </div>
                </td>

            </tr>

            <tr>
                <td nowrap="nowrap" style="padding:10px;">
                    <div>
                        <span>Expenses</span>
                        <br />
                        <div class="radio-inline">
                            <span id="lblcapex">
                                <input type="radio" id="id_rdcap" name="mode1" value="Capex" checked="checked" />
                                Capex
                            </span>
                        </div>
                        <div class="radio-inline">
                            <span id="lblopex">
                                <input type="radio" id="id_rdope" name="mode1" value="Opex" />
                                Opex
                            </span>
                        </div>
                    </div>
                </td>


                <td nowrap="nowrap" style="padding:10px;">
                    <div>
                        <span>Branch </span>
                        <br />
                        <div class="radio-inline">
                            <span id="lblsingle">
                                <input type="radio" id="id_rdsing" name="mode2" value="Single" checked="checked" />
                                Single
                            </span>
                        </div>
                        <div class="radio-inline">
                            <span id="lblmultiple">
                                <input type="radio" id="id_rdmult" name="mode2" value="Multiples" />
                                Multiple
                            </span>
                        </div>
                    </div>
                </td>
                <td style="padding-top:30px;padding-left:15px;">
                    <span id="lblprod">
                        <input type="radio" id="id_rdprod" name="modenew" value="Product" checked="checked" onchange="selprocomm()" />
                        Product
                    </span>
                    &nbsp;
                    <span id="lblserv">
                        <input type="radio" id="id_rdserv" name="modenew" value="Service" onchange="selprocomm()" />
                        Service
                    </span>
                </td>

                <td nowrap="nowrap" style="padding:10px;">

                    <div>
                        <span>Branch</span>
                        <br />
                        @Html.DropDownList("dropBranch", Model.ddlBranch, "--Select Branch--", new { @class = "textboxStyle", @id = "dropBranch", @style = "width:100%;", @disabled = "disabled" })
                    </div>
                </td>

                <td nowrap="nowrap" style="padding:10px;">

                    <div>
                        <span>PR Description</span>
                        <br />

                        <input type="text"
                               name="txtprdesc"
                               id="txtprdesc"
                               value=""
                               class="textboxStyle required"
                               style="display:block; width:100%;"
                               maxlength="264" />

                    </div>
                </td>



                @*<td colspan="9" align="right" nowrap="nowrap" style="padding:20px;">
                        <button type="button" id="btnAddAttachment" name="command" class="btn btn-primary" value="Add Attachment">
                            <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Add Attachment
                        </button>
                    </td>*@
            </tr>
            <tr></tr>



        </table>

    </div>



    <input hidden="hidden" id="pp" />
    <input hidden="hidden" id="ss" />
    <input hidden="hidden" id="kk" />

    <div id="ProductDetailgrid" class="hovertable2"></div>
    <div id="tabsat" style="height:100%;font-size:14px;">
        <ul>
            @* <li><a href="#tabs-1">Audit Trail</a></li>*@
            <li><a href="#tabs-1">Attachments</a></li>
        </ul>
        @*<div id="tabs-1">
                @Html.Partial("tab_auditrail")
            </div>*@
        <div id="tabs-1">
            @Html.Partial("PRattach")
        </div>
    </div><br />


    <table class="myTableStyleTabNew" align="center">
        <tr>
            <td>
                <div @*style="padding:10px 10px 0px 0px;text-align:center;"*@>
                    <button type="button" id="btnSave" name="command" class="btn btn-primary" value="Save">
                        <span class="glyphicon glyphicon-floppy-disk" style="color:white;"></span> Save
                    </button>
                    <button type="button" id="btnSubmit" name="command" class="btn btn-success" value="Submit">
                        <span class="glyphicon glyphicon-floppy-saved" style="color:white;"></span> Submit
                    </button>

                    <button type="button" id="btncancel" class="btn btn-warning" value="Cancel" onclick="Cancel()">
                        <span style="color:white;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                    </button>

                </div>
            </td>
        </tr>
    </table>

</div>

<div id="ForPartialViewnew3hh"></div>

<script>
    var currentTab = 0;
    $(function () {
        $("#tabsat").tabs({
            select: function (e, i) {
                currentTab = i.index;
            }
        });
    });


    $('#txtprdate').change(function () {
        if ($('#txtprdate').val() != null) {


            $('#txtprdate').removeClass('required');
            $('#txtprdate').addClass('valid');
        }
        else {
            $('#txtprdate').addClass('required');
            $('#txtprdate').removeClass('valid');
        }
    });
    $('#txtprdesc').keyup(function () {
       
        if ($('#txtprdesc').val() != null && $('#txtprdesc').val()!="") {
            $('#txtprdesc').removeClass('required');
            $('#txtprdesc').addClass('valid');
        }
        else {
            $('#txtprdesc').addClass('required');
            $('#txtprdesc').removeClass('valid');
        }
    });

    $('#dropBranch').change(function () {
        if ($('#dropBranch').val() != null) {


            $('#dropBranch').removeClass('required');
            $('#dropBranch').addClass('valid');
        }
        else {
            $('#dropBranch').addClass('required');
            $('#dropBranch').removeClass('valid');
        }
    });
    $('#dropFCCC').change(function () {
        if ($('#dropFCCC').val() != null) {


            $('#dropFCCC').removeClass('required');
            $('#dropFCCC').addClass('valid');
        }
        else {
            $('#dropFCCC').addClass('required');
            $('#dropFCCC').removeClass('valid');
        }
    });

    $('#dropRequestfor').change(function () {
        if ($('#dropRequestfor').val() != null) {


            $('#dropRequestfor').removeClass('required');
            $('#dropRequestfor').addClass('valid');
        }
        else {
            $('#dropRequestfor').addClass('required');
            $('#dropRequestfor').removeClass('valid');
        }
    });
    function Cancel() {
        location = "@Url.Action("PrSummary1","PrSummary")";
    }
    $(document).ready(function () {
        var url;
        var goid = $('input[name=modenew]:checked').val();

        if (goid == "Product") {

            $.ajax({
                url: "@Url.Action("InsertPro", "PRRaiser")",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    alert("something seems wrong");
                }
            });


        }
        else {
            $.ajax({
                url: "@Url.Action("InsertSer", "PRRaiser")",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    alert("something seems wrong");
                }
            });


        }
        $('#ss').val('');
        $('#pp').val('');
        $('#kk').val('');

        function dateformat() {
            dateformat: 'dd-mm-yyyy';
        }
        $("#txtprdate").datepicker({

            dateFormat: 'dd-mm-yy',
            maxDate: new Date()
        });



    });



    function selprocomm() {

        var url;
        var goid = $('input[name=modenew]:checked').val();
        if (goid == "Product") {
            //$('#id_rdcap').attr('checked', true);
            //$('#id_rdope').attr('checked', false);
            $.ajax({
                url: "@Url.Action("InsertPro", "PRRaiser")",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    alert("something seems wrong");
                }
            });
        }
        else {

            //$('#id_rdcap').attr('checked', false);
            //$('#id_rdope').attr('checked', true);
            $.ajax({
                url: "@Url.Action("InsertSer", "PRRaiser")",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(goid),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#ProductDetailgrid").empty().append(data);
                    }
                },
                error: function () {
                    alert("something seems wrong");
                }
            });
        }


    }
    var objDialog3;

    $("#btnAddAttachment").click(function () {
        if ($("#kk").val() == "") {

            $('#kk').val('anu');

            objDialog3 = $("[id$='ForPartialViewnew3hh']");
            objDialog3.dialog({
                autoOpen: false,
                modal: true,
                show: 'fade-in',
                close: 'fade-out',
                cache: false,
                width: 600,
                height: 400
            });
        }
        objDialog3.load('@Url.Action("PRattach","PRRaiser")?' + new Date().getTime());
        objDialog3.dialog({ title: 'PR Attachment' });
        objDialog3.dialog("open");


    });

    $("#btnSave").click(function () {
        var existrow = $('.save-btnnew').length;
        if (existrow != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var existrow1 = $('.save').length;
        if (existrow1 != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var prdate = $('#txtprdate').val();
        var expense = $('input[name=mode1]:checked').val();
        var branchtype = $("input[name='mode2']:checked").val();
        var prfccc = $("#dropFCCC").val();
        var prbranchgid = $("#dropBranch").val();
        var prrequestforgid = $("#dropRequestfor").val();
        var prdesc = $("#txtprdesc").val();
        var prraisedby = $("#txtprraiseby").val();



        if (prdate == null || prdate == "") {
            jAlert("Please select date!", "Error");
            return false;
        }
        if (prraisedby == null || prraisedby == "") {
            jAlert("Please enter raised by!", "Error");
            return false;
        }
        if (prdesc == null || prdesc == "") {
            jAlert("Please enter description!", "Error");
            return false;
        }

        if (prfccc == null || prfccc == "" || prfccc == 0) {
            jAlert("Please select fccc!", "Error");
            return false;
        }
        if (prbranchgid == null || prbranchgid == "" || prbranchgid == 0) {
            jAlert("Please select branch!", "Error");
            return false;
        }
        if (prrequestforgid == null || prrequestforgid == "" || prrequestforgid == 0) {
            jAlert("Please select request by!", "Error");
            return false;
        }
        if (parseInt($("#grid2 tr").length) < 2) {
            jAlert("Please Add PR Details", "Error", function () {
                return false;
            });
            return false;
        }
        var prheader = {
            "prDate": prdate,
            "prFcc": prfccc,
            "prExpense": expense,
            "prBranchType": branchtype,
            "prBranch": prbranchgid,
            "prDesc": prdesc,
            "prReqFor": prrequestforgid,
            "prRaisedBy": prraisedby,

        }
        // alert('hai');
        showProgress();
        $.post('@Url.Action("saveprraiser", "PRRaiser")', prheader,
         function (data) {
             hideProgress();
             //if (data == 0) { alert("ss"); } else { jAlert("Saved Successfully"); }
             if (data == 0) {
                 //location = location.href;
                 jAlert("Error Occured", "Error", function () {
                     return false;
                 });
                 return false;
             } else {
                 jAlert("Saved Successfully", "Success", function () {
                     location = '@Url.Action("PrSummary1", "PrSummary")?' + new Date().getTime();
                 });
             
             }
         }, 'json');

    });

    $("#btnSubmit").click(function fucntionsubmit() {
        var existrow = $('.save-btnnew').length;
        if (existrow != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var existrow1 = $('.save').length;
        if (existrow1 != 0) {
            jAlert("Please Save All Rows In PR Details Grid", "Error", function () {
                return false;
            });
            return false;
        }
        var prdate = $('#txtprdate').val();
        var expense = $('input[name=mode1]:checked').val();
        var branchtype = $("input[name='mode2']:checked").val();
        var prfccc = $("#dropFCCC").val();
        var prbranchgid = $("#dropBranch").val();
        var prrequestforgid = $("#dropRequestfor").val();
        var prdesc = $("#txtprdesc").val();
        var prraisedby = $("#txtprraiseby").val();
        var prrequestforname = $("#dropRequestfor option:selected").text();

        if (prdate == null || prdate == "") {
            jAlert("Please select date!", "Error");
            return false;
        }
        if (prraisedby == null || prraisedby == "") {
            jAlert("Please enter raised by!", "Error");
            return false;
        }
        if (prdesc == null || prdesc == "") {
            jAlert("Please enter description!", "Error");
            return false;
        }

        if (prfccc == null || prfccc == "" || prfccc == 0) {
            jAlert("Please select bscc!", "Error");
            return false;
        }
        if (prbranchgid == null || prbranchgid == "" || prbranchgid == 0) {
            jAlert("Please select branch!", "Error");
            return false;
        }
        if (prrequestforgid == null || prrequestforgid == "" || prrequestforgid == 0) {
            jAlert("Please select request by!", "Error");
            return false;
        }
        if (parseInt($("#grid2 tr").length) < 2) {
            jAlert("Please Add PR Details", "Error", function () {
                return false;
            });
            return false;
        }
        var prheader = {
            "prDate": prdate,
            "prFcc": prfccc,
            "prExpense": expense,
            "prBranchType": branchtype,
            "prBranch": prbranchgid,
            "prDesc": prdesc,
            "prReqFor": prrequestforgid,
            "prRaisedBy": prraisedby,
            "requestForName": prrequestforname
        }
        showProgress();
        $.post('@Url.Action("submitprraiser", "PRRaiser")?' + new Date().getTime(), prheader,
        function (data) {
            hideProgress();
            if (data == 0) {
                //location = location.href;
                jAlert("Error Occured", "Error", function () {
                    return false;
                });
                return false;
            } else {
                jAlert("Submitted Successfully", "Success", function () {
                    location = '@Url.Action("PrSummary1","PrSummary")?' + new Date().getTime();
                });
                
            }
        }, 'json');

    });

    @*$.ajax({
        url: "@Url.Action("submitprraiser", "PRRaiser")",
        type: 'POST',

    success: function (data) {
        $("#ProductDetailgrid").empty().append(data);
    },
    error: function () {
        jAlert("something seems wrong");
    }
    });*@





</script>


