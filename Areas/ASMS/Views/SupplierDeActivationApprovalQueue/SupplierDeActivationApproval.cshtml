@model IEM.Areas.ASMS.Models.SupplierDeActvation
@using IEM.Common
@{
    ViewBag.Title = "SupplierDeActivationApproval";
    Layout = "~/Views/Shared/_Layout.cshtml";
    CmnFunctions com = new CmnFunctions();
    string Status = Convert.ToString(Session["Dreqstatus"]);
}


<b>
    <span style="color: rgb(52, 108, 196);">Supplier Deactivation Approval</span>
</b>
<br />
@using (Html.BeginForm())
{
    <div class="well">
        <div class="container">
            <table align="center" style="width: 100%;">
                <tr>
                    <td>

                        <div>
                            <table align="center" width="100%" style="width: 50%;" class="myTableStyleTabNew">
                                <tr>
                                    <td>
                                        <span>Supplier Code </span><br />
                                        @*@Html.TextBoxFor(model => model.SupplierCode, new { @class = "form-control" ,@id="txtSupplierCode"})*@
                                        <input type="text" id="txtDeSuppliercode" placeholder="Supplier Code" class="textboxStyle" maxlength="20" name="txtDeSuppliercode" value="@ViewBag.txtDeSuppliercode" />
                                    </td>
                                    @*<td style="width:30px;"></td>*@
                                    <td>
                                        <span>Supplier Name </span><br />
                                        @*@Html.TextBoxFor(model => model.SupplierName, new { @class = "form-control",@id="txtSupplierName" })*@
                                        <input type="text" id="txtDeSupplierName" placeholder="Supplier Name" class="textboxStyle" maxlength="150" style="display: block;" name="txtDeSupplierName" value="@ViewBag.txtDeSupplierName" />
                                    </td>
                                    @*<td style="width:30px;"></td>*@

                                    <td style="padding-top:20px;" align="right">
                                        <button type="submit" name="Common" title="Search" id="btnSearch" value="Search" class="btn btn-primary"><span style="color:white;" class="glyphicon glyphicon-search"></span>Search</button>
                                        <button type="submit" name="Clear" title="Refresh" id="btnClear" value="Clear" class="btn btn-primary"><span style="color:white;" class="glyphicon glyphicon-refresh "></span>Clear</button>
                                    </td>
                                </tr>
                                <tr style="display:none;">
                                    <td style="display:none">
                                        <span>Supplier Status </span>
                                        @*@Html.DropDownList("ddlSupplierStatus", Model.SupplierStatus, new { @class = "form-control",@id="ddlSupplierStatus" })*@
                                        @*@Html.DropDownListFor(model => model.SupplierStatus, new SelectList(
                                                              new List<Object>{
                                                                   new { value = 0 , text = "--Select--"  },
                                                                   new { value = 1 , text = "Active" },
                                                                   new { value = 2 , text = "In Active" },
                                                                   },
                                                              "value",
                                                              "text",
                                                    0),
                                            new { @class = "form-control" }
                                                               )*@
                                        <select class="textboxStyle" name="ddlDeSupplierStatus" id="ddlDeSupplierStatus" disabled="disabled">
                                            <option value="0">--Select--</option>
                                            <option value="Active">Active</option>
                                            <option value="InActive">In Active</option>

                                        </select>
                                    </td>
                                    <td>
                                        <span>Request status </span>
                                        @*@Html.DropDownList("ddlRequestStatus", Model.RequestStatus, new { @class = "form-control", @id = "ddlRequestStatus" })*@
                                        @*@Html.DropDownListFor(model => model.RequestStatus, new SelectList(
                                                              new List<Object>{
                                                                   new { value = 0 , text = "--Select--"  },
                                                                   new { value = 1 , text = "Approved" },
                                                                   new { value = 2 , text = "Pending Approved" },
                                                                   new { value = 3 , text = "Draft" },
                                                                   },
                                                              "value",
                                                              "text",
                                                    0),
                                            new { @class = "form-control" }
                                                               )*@
                                        <select class="textboxStyle" name="ddlDeRequestStatus" id="ddlDeRequestStatus">
                                            <option value="0">--Select--</option>
                                            <option value="Draft">Draft</option>
                                            <option value="In-process">In-process</option>
                                            <option value="Reviewed">Reviewed</option>
                                            <option value="Approved">Approved</option>
                                            <option value="Rejected">Rejected</option>

                                        </select>
                                    </td>
                                    <td>
                                        <span>Supplier Classfication </span>
                                        @Html.DropDownList("ddlDeSup_Clasification", Model.DSupplierClassification, new { @class = "textboxStyle", @id = "ddlDeSup_Clasification" })
                                        @*@Html.DropDownListFor(model => model.SupplierClassification, new SelectList(
                                                              new List<Object>{
                                                                   new { value = 0 , text = "--Select--"  },
                                                                   new { value = 1 , text = "Major" },
                                                                   new { value = 2 , text = "Critical" },
                                                                     new { value = 3 , text = "Ordinary" },
                                                                   },
                                                              "value",
                                                              "text",
                                                               0),
                                            new { @class = "form-control" }
                                                               )*@
                                        @*<select class="form-control" name="ddlDeSup_Clasification" id="ddlDeSup_Clasification">
                                                <option value="0">--Select--</option>
                                                <option value="Major">Major</option>
                                                <option value="Critical">Critical</option>
                                                <option value="Ordinary">Ordinary</option>

                                            </select>*@
                                    </td>
                                    <td style="width:30px;"></td>
                                    <td>
                                        <span>Request Type </span>
                                        @*@Html.DropDownList("ddlRequestType",Model.RequestType, new { @class = "form-control",@id="ddlRequestType" })*@
                                        @*@Html.DropDownListFor(model => model.RequestType, new SelectList(
                                                              new List<Object>{
                                                                   new { value = 0 , text = "--Select--"  },
                                                                   new { value = 1 , text = "Activated" },
                                                                   new { value = 2 , text = "DeActivated" },
                                                                   },
                                                              "value",
                                                              "text",
                                                               0)
                                                    ,
                                            new { @class = "form-control" })*@
                                        <select class="textboxStyle" name="ddlDeRequestType" id="ddlDeRequestType">
                                            <option value="0">--Select--</option>
                                            <option value="Onboarding">Onboarding</option>
                                            <option value="Renewal">Renewal</option>
                                            <option value="Modification">Modification</option>
                                            <option value="Activation">Activation</option>
                                            <option value="Deactivation">Deactivation</option>
                                            <option value="Active">Active</option>

                                        </select>
                                    </td>
                                    <td style="width:30px;"></td>

                                    <td colspan="5" align="center" style="padding-top:20px;">
                                        <button type="submit" name="Common" title="Search" id="btnSearch" value="Search" class="btn btn-primary"><span style="color:white;" class="glyphicon glyphicon-search"></span>Search</button>
                                        <button type="submit" name="Clear" title="Refresh" id="btnClear" value="Clear" class="btn btn-primary"><span style="color:white;" class="glyphicon glyphicon-refresh "></span>Clear</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5" style="height:10px;"></td>
                                </tr>
                                @*<tr>

                                    </tr>*@
                            </table>
                        </div>


                    </td>
                </tr>
                <tr>
                    <td>
                        <div>
                            <div>
                                <table width="100%" align="center" >
                                    <tr>
                                        <td>
                                            <div>
                                              
                                                    @if (@ViewBag.status == "yes")
                                                    {
                                                          var grid = new WebGrid(Model.SupplierDeActiveList, canPage: false, canSort: true);
                                                          <div class="overflowx overflowy" style="max-height:300px;">

                                                        @grid.GetHtml(
                         tableStyle: "tableSmall table-bordered ",
                         htmlAttributes: new { id = "AppDeactivation" },
                         mode: WebGridPagerModes.All,
                         columns: grid.Columns(
                                                            //  grid.Column("DSupplierheadergid", "Supp HeaderGid"),
                        grid.Column(format: @<input type="hidden" name="DSupplierheadergid" value="@item.DSupplierheadergid" /> ),
                        grid.Column("SlNo", format: item => item.WebGrid.Rows.IndexOf(item) + 1),
                        grid.Column("DSupplierCode", com.Sorter("DSupplierCode", "Supplier Code", grid)),
                        grid.Column("DSupplierName", com.Sorter("DSupplierName", "Supplier Name", grid)),
                        grid.Column("DSupplierClassificationName", com.Sorter("DSupplierClassificationName", "Supplier Classification", grid)),
                        //  grid.Column("DRequestTypeName", com.Sorter("DRequestTypeName", "RequestType ", grid)),
                        // grid.Column("DRequestStatusName", com.Sorter("DRequestStatusName", " Status", grid)),
                        grid.Column("DSupplierStatusName", com.Sorter("DSupplierStatusName", "Status", grid)),
                        //grid.Column("DActivityCount", com.Sorter("DActivityCount","Activity Count",grid)),
                        grid.Column(header: "Action", canSort: false, style: "action",
                        format: @<text>
                                            @*@Html.Raw("<input type='button'  title='Edit' onclick='Renewal(" + item.SupplierCode + ")' class='btn btn-primary' value='Renewal' />"*@
                                            @*@Html.Raw("<a data-model='' href='/ASMS/SupplierDeActivation/SpplierDeActive/" + item.DSupplierCode + "' id='" + item.DSupplierCode + "' title='Search'><span>DeActivate</span></a>"*@
                                            @if (Status.ToUpper().ToString() == "REJECTED")
                                            {
                                                <a id="Resubmit"><span onclick="ReProduct(@item.DSupplierheadergid)">Resubmit</span></a>
                                                @*<a id="Edit"><span onclick="EditSupplierHeader(this)">Edit</span></a>*@
                                            }
                                            else if (Status.ToUpper().ToString() == "INPROCESS" || Status.ToUpper().ToString() == "APPROVED")
                                            {
                                                <a id="ViewSub"><span onclick="ViewSub(@item.DSupplierheadergid)">View</span></a>
                                                @*<a id="App_his"><span onclick="App_his(@item.DSupplierheadergid)">Approval History</span></a>*@
                                            }
                                            else
                                            {
                                                <a id="Dactivation"><span onclick="EditProduct(this)">Proceed</span></a>
                                            }



                                        </text>)
      )
      )


                                                    
                                                    @if (Model.SupplierDeActiveList.Count == 0)
                                                    {
                                                        <div style="padding:10px;"><h4>No Record Found</h4></div>
                                                    }
                                                </div>
                                                         <label style="padding:10px;">Page @(grid.PageIndex + 1) of @grid.PageCount - Total No of Records: @grid.TotalRowCount</label>
                                                    }
                                               
                                            </div>

                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
}
<div id="ForPartialViewDe"></div>
<script>
    $("#AppDeactivation td:nth-child(1),#AppDeactivation th:nth-child(1)").hide();
    var objDialog;
    $(document).ready(function () {
        @*var value = '@Request.RequestContext.HttpContext.Session["Dreqstatus"]';
        alert('@Request.RequestContext.HttpContext.Session["Dreqstatus"]');
        if (value == "rejected")
        {
            $("#Dactivation").css("display", "none");
            $("#Resubmit").css("display", "block");
            $("#ViewSub").css("display", "none");
            $("#App_his").css("display", "none");
        }
        else if(value == "inprocess")
        {
            $("#Dactivation").css("display", "none");
            $("#Resubmit").css("display", "none");
            $("#ViewSub").css("display", "block");
            $("#App_his").css("display", "block");
        }
        else
        {
            $("#Resubmit").css("display", "none");
            $("#Dactivation").css("display", "block");
            $("#ViewSub").css("display", "none");
            $("#App_his").css("display", "none");
        }*@
        objDialog = $("[id$='ForPartialViewDe']");
        objDialog.dialog({
            autoOpen: false,
            modal: true,
            cache: false,
            show: 'fade-in',
            close: 'fade-out',
            width: 967,
            height: 690
        });

    });

    function EditProduct(element) {
        var row = $(element).closest('tr');
        var tds = row.find('td');
        var ids = row.find('[name=DSupplierheadergid]').val();

        var supcode = tds.eq(2).text();
        var objSupHeaderDetails = {
            "_SupplierCode": supcode
        };
       
        $.ajax({
            url: '@Url.Action("CheckSupplierIsLocked", "Onboarding")',
            data: JSON.stringify(objSupHeaderDetails),
            type: 'POST',
            async: false,
            cache: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data.length > 0) {
                    var lockedbycode = data[0]._LockedByCode;
                    var lockedbyname = data[0]._LockedByName;
                    var lockeddate = data[0]._LockedDate;
                    var LockedBy = lockedbycode.fontcolor("Navy") + " - " + lockedbyname.fontcolor("Navy");
                    jConfirm("This Supplier Already Locked By " + LockedBy.bold() + " from " + lockeddate.bold().fontcolor("Navy") + ". Are you Interested to view this supplier?", Title_3, function (e) {
                        if (e == true) {
                            location = '../Onboarding/Index?pagefor=5&supid=' + ids + '&' + new Date().getTime();
                        }
                        else {
                            return false;
                        }
                    });
                }
                if (data.length == 0) {
                    $.ajax({
                        url: '@Url.Action("LockMySupplier", "Onboarding")',
                        data: JSON.stringify(objSupHeaderDetails),
                        type: 'POST',
                        async: false,
                        cache: false,
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            objDialog.load('../SupplierDeActivationApprovalQueue/SupplierApproveDeActivation?id=' + ids + '&' + new Date().getTime());
                            objDialog.dialog({ title: 'Supplier Deactivation' });
                            objDialog.dialog("open");
                        },
                        error: function (result) {
                            jAlert("Something went wrong", "Error");
                        }
                    });

                }
            },
            error: function (result) {
                jAlert("Something went wrong", "Error");
            }
        });
       
    }
    function EditSupplierHeader(element) {
        var row = $(element).closest('tr');
        var tds = row.find('td');
        var ids = row.find('[name=DSupplierheadergid]').val();
        location = '../Onboarding/Index?pagefor=2&supid=' + ids + '&' + new Date().getTime();
        @*var supcode = tds.eq(2).text();
        var objSupHeaderDetails = {
            "_SupplierCode": supcode
        };
       
        $.ajax({
            url: '@Url.Action("CheckSupplierIsLocked", "Onboarding")',
            data: JSON.stringify(objSupHeaderDetails),
            type: 'POST',
            async: false,
            cache: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data.length > 0) {
                    var lockedbycode = data[0]._LockedByCode;
                    var lockedbyname = data[0]._LockedByName;
                    var lockeddate = data[0]._LockedDate;
                    var LockedBy = lockedbycode.fontcolor("Navy") + " - " + lockedbyname.fontcolor("Navy");
                    jConfirm("This Supplier Already Locked By " + LockedBy.bold() + " from " + lockeddate.bold().fontcolor("Navy") + ". Are you Interested to view this supplier?", Title_3, function (e) {
                        if (e == true) {
                            location = '../Onboarding/Index?pagefor=5&supid=' + ids + '&' + new Date().getTime();
                        }
                        else {
                            return false;
                        }
                    });
                }
                if (data.length == 0) {
                    $.ajax({
                        url: '@Url.Action("LockMySupplier", "Onboarding")',
                        data: JSON.stringify(objSupHeaderDetails),
                        type: 'POST',
                        async: false,
                        cache: false,
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            location = '../Onboarding/Index?pagefor=2&supid=' + ids + '&' + new Date().getTime();
                        },
                        error: function (result) {
                            jAlert("Something went wrong", "Error");
                        }
                    });

                }
            },
            error: function (result) {
                jAlert("Something went wrong", "Error");
            }
        });*@
    }
    function ReProduct(id) {
       
            objDialog.load('../SupplierDeActivationQueue/SpplierDeActive?id=' + id + '&' + new Date().getTime());
            objDialog.dialog({ title: 'Supplier Deactivation' });
            objDialog.dialog("open");
      
    }
    function ViewSub(id) {
        location = '../Onboarding/Index?pagefor=5&supid=' + id + '&' + new Date().getTime();
        // alert(id);
        //objDialog.load('../SupplierDeActivationQueue/SpplierDeActive?id=' + id + '&' + new Date().getTime());
        //objDialog.dialog({ title: 'Supplier Deactivation' });
        //objDialog.dialog("open");
    }
    function App_his(id) {
        // alert(id);
        objDialog.load('../SupplierDeActivationApprovalQueue/SupplierDeactivationHistory?id=' + id + '&' + new Date().getTime());
        objDialog.dialog({ title: 'Deactivation Approval History' });
        objDialog.dialog("open");
    }
    $(document).ready(function () {

        //$('#btnSearch').click(function () {SupplierDeactivationHistory
        //   // alert('ok');
        //    var supp_code = $('#txtDeSuppliercode').val();
        //    //alert(supp_code);
        //    var supp_name = $('#txtDeSupplierName').val();
        //   // alert(supp_name);
        //    var supp_status = $("#ddlDeSupplierStatus option:selected").text();
        //    var supp_class = $("#ddlDeSup_Clasification option:selected").text();
        //   // alert(supp_class);
        //    var Reqstype = $("#ddlDeRequestType option:selected").text();
        //    var ReqsStatus = $("#ddlDeRequestStatus option:selected").text();

        //  if (supp_code == '' && supp_name == '' && supp_status == '--Select--' && supp_class == '--Select--' && Reqstype == '--Select--' && ReqsStatus == '--Select--')
        // {
        //     alert('Should be fill anyone filter');
        //     return false;
        // }

        //});

        $('#btnClear').click(function () {
            // alert('hh');
            $('#txtDeSuppliercode').val('');
            $('#txtDeSupplierName').val('');
            $("#ddlDeSupplierStatus").val('0');
            // $("#ddlSup_Clasification").attr('selectedIndex', 0);
            $("#ddlDeSup_Clasification").val('0');
            $("#ddlDeRequestType").val('0');
            $("#ddlDeRequestStatus").val('0');

        });

    });
</script>