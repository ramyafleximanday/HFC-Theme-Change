@model IEnumerable<IEM.Areas.EOW.Models.EOW_PO>
@using IEM.Common
@using IEM.Areas.EOW.Models
@{
    CmnFunctions objCmnFunctions = new CmnFunctions();
    EOW_PO poheadder = (EOW_PO)ViewBag.poheaderheader;
    ViewBag.Title = "Index";
    var grid = new WebGrid(source: Model, canSort: false, canPage: false, rowsPerPage: 5, ajaxUpdateContainerId: "searchgridpotems", ajaxUpdateCallback: "fb_employee();");
}
<div id="searchgridpotems">
    <div class="well">
        <center>
            <table class="myTableStyleTabNew">
                <tr>
                    <td>
                        <input type="hidden" id="po_ggid" value="@poheadder.POGid" />
                        <span> PO/ WO Date </span>
                        <input name="po_no"
                               id="po_no"
                               type="text"
                               class="textboxStyle "
                               data-val="true" disabled="disabled"
                               value="@poheadder.POdate" />
                    </td>
                    <td>
                        <span> 	PO/ WO No. </span>
                        <input name="po_date"
                               id="po_date"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@poheadder.PONo" />
                    </td>
                    <td colspan="2">
                        <span>PO/ WO Status </span>
                        <input name="po_no"
                               id="po_no"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@poheadder.POStatus" style="width:95%;" />
                    </td>
                    <td>
                        <span>	Approved Status </span>
                        <input name="po_sdate"
                               id="po_sdate"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@poheadder.POApprovedStatus" />
                    </td>

                </tr>
                <tr>
                    <td>
                        <span> PO Amount </span>
                        <input name="po_amount"
                               id="po_amount"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@poheadder.POUtilizedamount" />
                    </td>
                    <td>
                        <span> Received Qty Amount </span>
                        <input name="po_ramount"
                               id="po_ramount"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@Session["Totalporeceivedamt"]" />
                    </td>
                    <td>
                        <span> Invoiced Qty Amount </span>
                        <input name="po_iamount"
                               id="po_iamount"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@Session["Totalpoinvoicedsamt"]" />
                    </td>
                    <td>
                        <span> Current Qty Amount </span>
                        <input name="po_cramount"
                               id="po_cramount"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@Session["Totalpomapamt"]" />
                    </td>
                    <td>
                        <span> Balance Amount </span>
                        <input name="po_bamount"
                               id="po_bamount"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true"
                               value="@Session["Totalpobalacedamt"]" />
                    </td>
                </tr>
            </table>
            <br />
            <table id="ponewadd" class="myTableStyleTabNew" style="display:none">
                <tr>
                    <td>
                        <span> Product/ Service Code  </span>
                        <input name="po_pscode"
                               id="po_pscode"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                    <td>
                        <span> Product/ Service Description </span>
                        <input name="po_psdesc"
                               id="po_psdesc"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                    <td>
                        <span> Ordered Qty </span>
                        <input name="po_orderqty"
                               id="po_orderqty"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                    <td>
                        <span> Received Qty </span>
                        <input name="po_receqty"
                               id="po_receqty"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                </tr>
                <tr>
                    <td>
                        <span> Rate  </span>
                        <input name="po_Rate"
                               id="po_Rate"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                    <td>
                        <span> Invoiced Qty  </span>
                        <input name="po_Inqty"
                               id="po_Inqty"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                    <td>
                        <span>Current Qty </span>
                        <input name="po_currqty"
                               id="po_currqty"
                               type="text"
                               class="textboxStyle"
                               data-val="true" />
                    </td>
                    <td>
                        <span> Amount </span>
                        <input name="po_Amountpo"
                               id="po_Amountpo"
                               type="text"
                               class="textboxStyle " disabled="disabled"
                               data-val="true" />
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <br />
                        <center>
                            <input type="hidden" id="po_itemgid" />
                            <button type="button" title="Save" name="Save" id="btnsaves" style="font-size:12px;" class="btn btn-primary" onclick="Saveponew()"><span style="color:white;" class="glyphicon glyphicon-floppy-disk"></span> Save</button>
                            <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                            <button type="button" id="btncancels" title="Cancel" name="Cancel" style="font-size:12px;" class="btn btn-warning" onclick="GotoIndexhides()"><span style="color:white;" class="glyphicon glyphicon-remove-sign"></span>Cancel</button>
                        </center>
                    </td>
                </tr>
            </table>
        </center>
        <br />
        <div id="emplgrid">
            <div class="overflowy">
                <div style="max-height: 350px;">
                    @functions {
                        public static string Sorter(string columnName, string columnHeader, WebGrid grid)
                        {
                            return string.Format("{0} {1}", columnHeader, grid.SortColumn == columnName ?
                                grid.SortDirection == SortDirection.Ascending ? "▲" :
                                "▼" : string.Empty);
                        }
                    }
                    @grid.GetHtml(
                    htmlAttributes: new { id = "gridpohead" },
                 mode: WebGridPagerModes.All,
                 tableStyle: "tableSmall table-bordered table-hover table-responsive",
                columns: grid.Columns
                    (
                          grid.Column("Product/ Service Code ", format: @<text>
                        <label style="font-weight:normal;" id="POserprocode_@item.POGid">@item.POserprocode</label>
                        <input type="hidden" id="POserprogid_@item.POGid" name="EmployeeId" value="@item.POserprogid" />
                        </text>),
                         grid.Column("Product/ Service Description ", format: @<text><label style="font-weight:normal;" id="POserprodesc_@item.POGid">@item.POserprodesc</label></text>),
                                           grid.Column("PO Details Description ", format: @<text><label style="font-weight:normal;" id="POdetldesc_@item.POserprogid">@item.POdetldesc</label></text>),
                    grid.Column("Ordered Qty", format: @<text><label style="font-weight:normal;" id="POorderqty_@item.POGid">@item.POorderqty</label></text>),
                         grid.Column("Received Qty ", format: @<text><label style="font-weight:normal;" id="POreceivedqty_@item.POGid">@objCmnFunctions.GetINRAmount(@item.POreceivedqty)</label></text>),
                         grid.Column("Received Qty Amount", format: @<text><label style="font-weight:normal;" id="POreceivedqtyamt_@item.POGid">@objCmnFunctions.GetINRAmount(@item.POreceivedqtyamt)</label></text>),
                    grid.Column("Invoiced Qty ", format: @<text>
                        <label style="font-weight:normal;" id="POinvoiceqty_@item.POGid">
                            @item.POinvoiceqty
                        </label></text>),
                    grid.Column("Invoiced Qty Amount", format: @<text><label style="font-weight:normal;" id="POinvoiceqtyamt_@item.POGid">@objCmnFunctions.GetINRAmount(@item.POinvoiceqtyamt)</label></text>),
                         grid.Column("Current Qty ", format: @<text>
                        <label style="font-weight:normal;" id="POinvoiceqty_@item.POGid">@item.POcurrentqty</label>

                        <input type="hidden" id="ePOserprocode_@item.POGid" name="EmployeeId1" value="@item.POserprocode" />
                        <input type="hidden" id="ePOserprodesc_@item.POGid" name="EmployeeId2" value="@item.POserprodesc" />
                        <input type="hidden" id="ePOorderqty_@item.POGid" name="EmployeeId3" value="@item.POorderqty" />
                        <input type="hidden" id="ePOreceivedqty_@item.POGid" name="EmployeeId4" value="@item.POreceivedqty" />
                        <input type="hidden" id="ePOinvoiceqty_@item.POGid" name="EmployeeId5" value="@item.POinvoiceqty" />
                        <input type="hidden" id="ePOcurrentqty_@item.POGid" name="EmployeeId6" value="@item.POcurrentqty" />
                        <input type="hidden" id="ePOrate_@item.POGid" name="EmployeeId7" value="@item.POrate" />
                        <input type="hidden" id="ePOAmount_@item.POGid" name="EmployeeId8" value="@item.POAmount" />


                        </text>),
                    @*grid.Column("Service Month ", format: @<text><label style="font-weight:normal;" id="POsermonyh_@item.POGid">@item.POsermonyh</label></text>),*@
 grid.Column("Rate ", format: @<text><label style="font-weight:b;" id="POrate_@item.POGid">@objCmnFunctions.GetINRAmount(@item.POrate)</label></text>),
                         grid.Column("Amount ", format: @<text><label style="font-weight:normal;" id="POAmount_@item.POGid">@objCmnFunctions.GetINRAmount(@item.POAmount)</label></text>)))
                </div>
            </div>
        </div>
        <div>
            <table style="width:100%">
                <tr>
                    <td align="right">
                        <span> Total PO Mapped Amount : <b> <label id="potolafnmts">@Session["Totalpomapamt"]</label>  </b></span>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <br />
            <center>
                <button type="button" id="btncanexpNNN" title="Close" name="Close" style="font-size:12px;" class="btn btn-warning" onclick="GotoIndexAttachmentVsu()"><span style="color:white;" class="glyphicon glyphicon-remove-sign"></span>Close</button>
            </center>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#po_currqty").keyup(function () {

            var curramountexrate = $("#po_Rate").val();
            var curramount = $("#po_currqty").val();
            $("#po_Amountpo").val('')
            if (curramount != null || curramount != "" || curramountexrate != null || curramountexrate != "") {

                var tol = $('#po_Rate').val() * ($('#po_currqty').val());
                $('#po_Amountpo').val(tol.toFixed(2));
            }
        });
    });
    $(document).ready(function () {
        $("#ponewadd").hide();
        //var mainbalcedamt = $("#potolafnmts").text();
        //var currentbalcedamt = $("#po_bamount").val();
        //var resultamt = parseFloat(currentbalcedamt) - parseFloat(mainbalcedamt);
        //$("#po_bamount").val(resultamt);
        //$("#po_cramount").val(mainbalcedamt);
    });
    function Editcurrentqty(id) {
        $("#ponewadd").slideToggle(500);

        var POserprocode = $("#ePOserprocode_" + id + "").val();
        var POserprodesc = $("#ePOserprodesc_" + id + "").val();
        var POorderqty = $("#ePOorderqty_" + id + "").val();
        var POreceivedqty = $("#ePOreceivedqty_" + id + "").val();
        var POinvoiceqty = $("#ePOinvoiceqty_" + id + "").val();
        var POcurrentqty = $("#ePOcurrentqty_" + id + "").val();
        var POrate = $("#ePOrate_" + id + "").val();
        var POAmount = $("#ePOAmount_" + id + "").val();

        $('#po_itemgid').val(id);
        $('#po_pscode').val(POserprocode);
        $('#po_psdesc').val(POserprodesc);
        $('#po_orderqty').val(POorderqty);
        $('#po_receqty').val(POreceivedqty);
        $('#po_Inqty').val(POinvoiceqty);
        $('#po_currqty').val(POcurrentqty);
        $('#po_Rate').val(POrate);
        $('#po_Amountpo').val(POAmount);

    }
    function Saveponew() {

        var potolafnmts = $("#potolafnmts").text();
        var POgid = $('#po_ggid').val();
        var POitemid = $('#po_itemgid').val();
        var POserprocode = $('#po_pscode').val();
        var POserprodesc = $('#po_psdesc').val();
        var POorderqty = $('#po_orderqty').val();
        var POreceivedqty = $('#po_receqty').val();
        var POinvoiceqty = $('#po_Inqty').val();
        var POcurrentqty = $('#po_currqty').val();
        var POrate = $('#po_Rate').val();
        var POAmount = $('#po_Amountpo').val();
        if (POcurrentqty == null || POcurrentqty == "") {
            jAlert("Please Enter Curent Qty Greather Then Zero .", "Message");
            return false;
        }
        var curtol = parseFloat(POinvoiceqty) + parseFloat(POcurrentqty);
        if (curtol != POreceivedqty) {
            if (parseFloat(curtol) >= parseFloat(POreceivedqty)) {
                jAlert(" Total Of Invoice Qty & Current Qty Must Not Exceed Received Qty", "Message");
                return false;
            }
        }
        var NewExpensemodel = {
            "POGid": POgid,
            "POserprogid": POitemid,
            "POcurrentqty": POcurrentqty,
            "POrate": POrate,
            "POUtilizedamount": potolafnmts,
            "POMapAmount": POAmount
        };
        $.post('../SupplierInvoiceNew/Updatepomapp', NewExpensemodel,
        function (data) {
            if (data == "success") {
                jAlert("Updated PO-Mapping Successfully.", "Message");
                var url = '@Url.Action("_Pomappingdetail", "SupplierInvoiceNew")?id=' + POgid + '&' + new Date().getTime();
                $("#searchgridpotems").load(url);
                $("#ponewadd").slideToggle(500);
                $("#ponewadd").hide();
            }
            else {
                jAlert(data, "Message");
                return false;
            }
        }, 'json');

    }
    function GotoIndexhides() {
        $("#ponewadd").slideToggle(500);
        $("#ponewadd").hide();
    }
    function fb_employee() {
        $("#grid td:nth-child(2),#grid th:nth-child(2)").show();
    }
</script>