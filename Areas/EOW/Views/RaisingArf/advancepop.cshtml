@model  IEM.Areas.EOW.Models.EOW_arfraising
@using System.Data
@using IEM.Areas.EOW.Models
@{
    var vl = 0;
    var viewfor = (string)ViewBag.viewfor;
    var dis = "";
    var viewsup = "";
    dis = ViewBag.viewfor;
    if (viewfor == "edit")
    {
        ViewBag.viewmode = "";
        vl = 1;
    }
    else if (viewfor == "view")
    {
        ViewBag.viewmode = "disabled";
        vl = 1;
    }
    else if (viewfor == "Delete")
    {
        ViewBag.viewmode = "disabled";
        vl = 1;
    }
    if (vl == 0)
    {
        dis = null;
    }

    if (Convert.ToString(Session["employeesupplier"]) != "")
    {
        viewsup = Session["employeesupplier"].ToString();
    }

    DataTable getadvancetype = new DataTable();
    List<GetAdvancetype> list = new List<GetAdvancetype>();
    //List<EOW_arfraising> getadvancedetails = new List<EOW_arfraising>();
    ArfRaising rais = new ArfRaising();
    //// list = rais.GetAdvancetype().ToList();

    //getadvancedetails = rais.SelectAdvance().ToList();

    //EOW_arfraising get = new EOW_arfraising();
    //get.GetAdvancetype = new SelectList(rais.GetAdvancetype(), "advancetype_gid", "advancetype_name", get.ecfarf_advancetype_gid);

    // WebGrid grid = new WebGrid(source: getadvancedetails, canSort: true, canPage: true, rowsPerPage: 5, ajaxUpdateContainerId: "grid", ajaxUpdateCallback: "grid", selectionFieldName: "SelectedRow");

    //grid.Pager(WebGridPagerModes.All);
    //int rowVal = 0;
}
@using (Html.BeginForm())
{
    <div style="display:none;">
        @if (dis != null)
        {
            <input name="DocNameID" id="ecfarf_gid" type="text" placeholder="DocName ID" data-val="true" value="@Model.ecfarf_gid" />
        }
        else
        {
            <input name="DocNameID" id="ecfarf_gid" type="text" placeholder="DocName ID" data-val="true" value="" />
        }
    </div>
    <div style="display:none;">
        @if (dis != null)
        {
            <input name="DocNameID" id="ecfarf_ecf_gid" type="text" placeholder="DocName ID" data-val="true" value="@Model.ecfarf_ecf_gid" />
        }
        else
        {
            <input name="DocNameID" id="ecfarf_ecf_gid" type="text" placeholder="DocName ID" data-val="true" value="" />
        }
    </div>
    <input type="hidden" id="hdraiserfcc" value="@Session["raiserfcc"]" />
    <input type="hidden" id="hdraiserccc" value="@Session["raiserccc"]" />
    <table class="myTableStyleTabNew" style="width:100%">
        <tr>
            <td style="width:40%">
                <span>Advance Type</span>
                <br />
                @if (dis == null)
                {

                    @Html.DropDownListFor(e => e.advancetype_gid, Model.GetAdvancetype, "---select---", new { @class = "textboxStyle required wthds", @id = "ecfarf_advancetype_gid" })
                }
                @if (viewfor == "edit")
                {

                    @Html.DropDownListFor(e => e.ecfarf_advancetype_gid, Model.GetAdvancetype, "---select---", new { @class = "textboxStyle valid wthds", @id = "ecfarf_advancetype_gid" })

                }
                else if (viewfor == "view")
                {
                    @Html.DropDownListFor(e => e.ecfarf_advancetype_gid, Model.GetAdvancetype, "---select---", new { @class = "textboxStyle valid wthds", @id = "ecfarf_advancetype_gid", @disabled = "disabled" })
                }
                else if (viewfor == "Delete")
                {
                    @Html.DropDownListFor(e => e.ecfarf_advancetype_gid, Model.GetAdvancetype, "---select---", new { @class = "textboxStyle valid wthds", @id = "ecfarf_advancetype_gid", @disabled = "disabled" })
                }

            </td>
            <td style="width:3%">
                <span>&nbsp;&nbsp;</span><br />
                <input type="button" value="?" style="margin-top: 5px;" disabled="disabled" id="Getpolicypopup" onclick="Newpolicypopup()" />
            </td>
            <td style="width: 2%;"></td>
            <td colspan="2" style="width:24%">
                <div id="txtTypeName">
                    <span> Amount </span>
                    <br />
                    @if (dis == null)
                    {
                        <input name="CategoryName" id="amount" class="textboxStyle valid" maxlength="15" type="text" data-val="true" disabled="disabled" value="" />
                    }
                    else
                    {
                        <input name="CategoryName" id="amount" class="textboxStyle valid wthds" maxlength="15" type="text" data-val="true" value="@Model.ecfarf_amount" disabled="disabled" />
                    }
                </div>
            </td>
            <td colspan="2" style="width:24%">
                @if (dis == null)
                {
                    <span>Liquidation Date</span>
                    <br />
                    <input type="text"
                           name="txtliqdate"
                           id="txtliqdate"
                           maxlength="10"
                           class="textboxStyle  required" style="width:100%" />
                }
                @if (viewfor == "edit")
                {
                    <span>Liquidation Date</span>
                    <br />
                    <input type="text"
                           name="txtliqdate"
                           id="txtliqdate"
                           maxlength="10"
                           class="textboxStyle valid" style="width:100%" value="@Model.ecfarf_liq_date" />
                }
                else if (viewfor == "view")
                {
                    <span>Liquidation Date</span>
                    <br />
                    <input type="text"
                           name="txtliqdate"
                           id="txtliqdate"
                           maxlength="10"
                           class="textboxStyle valid" style="width:100%" disabled="disabled" value="@Model.ecfarf_liq_date" />
                }
                else if (viewfor == "Delete")
                {
                    <span>Liquidation Date</span>
                    <br />
                    <input type="text"
                           name="txtliqdate"
                           id="txtliqdate"
                           maxlength="10"
                           class="textboxStyle valid" style="width:100%" disabled="disabled" value="@Model.ecfarf_liq_date" />
                }
            </td>

        </tr>

        <tr>
            <td colspan="2">
                <div id="txtTypeName">
                    <span> Business Segment </span>
                    <br />
                    @Html.DropDownListFor(model => model.ecfarf_fc_code, Model.Getfc, new { @class = "textboxStyle wthds", @id = "fcno", @disabled = "disabled" })
                </div>
            </td>
            <td style="width: 2%;"></td>
            <td colspan="4">
                <div id="txtTypeName">
                    <span>  Cost Center </span>
                    <br />
                    @Html.DropDownListFor(model => model.ecfarf_cc_code, Model.Getcc, new { @class = "textboxStyle wthds", @id = "ccno" })
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <div id="txtTypeName">
                    <span> Product Code </span>
                    <br />
                    <input name="CategoryName" id="productcode" class="textboxStyle valid wthds" type="text" data-val="true" value="@Model.ecfarf_product_code" />
                </div>
            </td>
            <td style="width: 2%;"></td>
            <td colspan="4">
                <div id="txtTypeName">
                    <span> Location Code </span>
                    <br />
                    <input name="CategoryName" id="oucode" class="textboxStyle valid wthds" type="text" data-val="true" value="@Model.ecfarf_ou_code" />
                </div>
            </td>
        </tr>
        @*@if (viewsup == "S" || viewsup == "Supplier")*@

        <tr id="txtsuppopp">
            <td colspan="2">
                <div id="txtTypeName">
                    <span> Proforma Invoice Number</span>
                    <br />
                    @if (dis == null)
                    {
                        <input name="CategoryName" id="_proinvoice" class="textboxStyle" style="width:100%" maxlength="32" type="text" data-val="true" value="" />
                    }
                    else
                    {
                        <input name="CategoryName" id="_proinvoice" class="textboxStyle valid" style="width:100%" maxlength="32" type="text" data-val="true" value="@Model.ecfarf_pi_gl_no" @ViewBag.viewmode />
                    }
                </div>
            </td>
            <td></td>
            <td>
                <div id="txtTypeName">
                    <span> PO No </span>
                    <br />
                    @if (dis == null)
                    {
                        <input name="CategoryName" id="_pono" class="textboxStyle" style="width:100%" maxlength="64" disabled type="text" data-val="true" value="" @ViewBag.viewmode />
                    }
                    else
                    {
                        <input name="CategoryName" id="_pono" class="textboxStyle valid" maxlength="64" style="width:100%" type="text" disabled data-val="true" value="@Model.ecfarf_po_no" @ViewBag.viewmode />
                    }
                </div>
            </td>
            <td>
                <span>&nbsp;&nbsp;</span><br />
                <a title="Search"><span class="glyphicon glyphicon-search" style="margin-top: 5px;" id="btnEmpSearch2" onclick="Employeepoheader()"></span></a>
            </td>
            <td>
                <div id="txtTypeName">
                    <span> CBF No </span>
                    <br />
                    @if (dis == null)
                    {
                        <input name="CategoryName" id="cefno" class="textboxStyle" style="width:100%" maxlength="64" type="text" disabled data-val="true" value="" @ViewBag.viewmode />
                    }
                    else
                    {
                        <input name="CategoryName" id="cefno" class="textboxStyle valid" style="width:100%" maxlength="64" type="text" disabled data-val="true" value="@Model.ecfarf_cbf_no" @ViewBag.viewmode />
                    }
                </div>
            </td>
            <td>
                <span>&nbsp;&nbsp;</span><br />
                <a title="Search"><span class="glyphicon glyphicon-search" style="margin-top: 5px;" id="btnEmpSearch1" onclick="EmployeeSearchPouch()"></span></a>
            </td>
        </tr>
        <tr>
            <td colspan="7">
                <div style="margin-left:0px;">
                    <span> Description </span>
                    <br />
                    @*length fixed by selva*@

                    @if (dis == null)
                    {
                        <textarea name="CategoryName" id="_Delmatdesc" cols="30" rows="5" maxlength="255" class="textboxStyle valid " style="display: block;width:100%; ">@Session["ecfarf_desc"]</textarea>
                        @*<input name="CategoryName" id="_Delmatdesc" class="textboxStyle required" maxlength="255" type="text" data-val="true" value="" />*@
                    }
                    else
                    {
                        <textarea name="CategoryName" id="_Delmatdesc" cols="30" rows="5" maxlength="255" class="textboxStyle valid " style="display: block;width:100%;" @ViewBag.viewmode>@Model.ecfarf_desc</textarea>
                        @*<input name="CategoryName" id="_Delmatdesc" class="textboxStyle valid" maxlength="255" type="text" data-val="true" value="@Model.ecfarf_desc" @ViewBag.viewmode />*@
                    }
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="7">
                <div align="center">
                    <br />
                    @if (viewfor == "edit")
                    {
                        <button type="button" id="btnsaveadvance" class="btn btn-success" value="Submit" onclick="Save()"><span class="glyphicon glyphicon-ok" style="color:white;"></span> Submit</button>
                    }

                    @if (dis == null)
                    {
                        <button type="button" id="btnsaveadvance" class="btn btn-success" value="Submit" disabled onclick="Save()"><span class="glyphicon glyphicon-ok" style="color:white;"></span> Submit</button>
                    }

                    @if (viewfor == "Delete")
                    {
                        <button type="button" id="btndel" class="btn btn-danger" value="Delete" onclick="Deleteadvance()"> <span class="glyphicon glyphicon-trash" style="color:white;"></span>Delete</button>
                    }
                    <button type="button" value="Cancel" class="btn btn-warning" onclick="GotoIndexAdvance()"><span style="color:white;" class="glyphicon glyphicon-remove-sign"></span> Clear</button>
                </div>
            </td>
        </tr>
    </table>
}
<style>
    .wthds {
        width: 100%;
    }

    .wthdsnew {
        width: 95%;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $('#amount').val($('#txtecfamount').val());
        $('#fcno').change(function () {
            var txtFC = $(this).val();
            var hdraiserfcc = $("#hdraiserfcc").val();
            if (txtFC != hdraiserfcc) {
                jAlert("Additional Approval to be attached", "Message");
                return false;
            }
        });
    });
    $(document).ready(function () {
        $('#ccno').change(function () {
            var txtCC = $(this).val();
            var hdraiserccc = $("#hdraiserccc").val();
            if (txtCC != hdraiserccc) {
                jAlert("Additional Approval to be attached", "Message");
                return false;
            }
        });
    });
    $(document).ready(function () {
        $("#oucode").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "../EmployeeClaimNew/AutoCompleteoucode",
                    type: "POST",
                    dataType: "json",
                    data: { term: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { label: item.raiserccName, value: item.raiserccName };
                        }))

                    }
                })
            },
            messages: {
                noResults: "", results: ""
            }
        });
    });
    $(document).ready(function () {
        $("#productcode").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "../EmployeeClaimNew/AutoCompleteproductcode",
                    type: "POST",
                    dataType: "json",
                    data: { term: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { label: item.raiserccName, value: item.raiserccName };
                        }))

                    }
                })
            },
            messages: {
                noResults: "", results: ""
            }
        });
    });
    var objDialogpolicypopupce;
    $(document).ready(function () {


        var objDate = new Date();
        var Presentyear = objDate.getFullYear();
        $("#txtliqdate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd-mm-yy',
            minDate: "-0D",
            maxDate: "+10Y",
        });

        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            $('#_proinvoice').show();
            $('#_pono').show();
            $('#cefno').show();
            $('#btnEmpSearch2').show();
            $('#btnEmpSearch1').show();
            $('#txtsuppopp').show();
        }
        else {
            $('#_proinvoice').hide();
            $('#_pono').hide();
            $('#cefno').hide();
            $('#btnEmpSearch2').hide();
            $('#btnEmpSearch1').hide();

            $('#_proinvoice').val('');
            $('#_pono').val('');
            $('#cefno').val('');
            $('#txtsuppopp').hide();
        }
    });
    $('#ecfarf_advancetype_gid').change(function () {
        var brandID = $(this).val();
        if (brandID != "0") {
            var Student =
           {
               "ecfarf_advancetype_gid": brandID
           };
            $.ajax({
                url: '../RaisingArf/GetSubCategorypolicy/',
                data: JSON.stringify(Student),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {

                    if (data != "") {
                        var stylesSelect = $('#Getpolicypopup');
                        stylesSelect.attr('disabled', false);
                    }
                    else {
                        var stylesSelect = $('#Getpolicypopup');
                        stylesSelect.attr('disabled', true);
                    }
                },
                error: function (result) {
                    jAlert("Error.", "Error");
                    return false;
                }
            });
        }
        else {
            var stylesSelect = $('#Getpolicypopup');
            stylesSelect.attr('disabled', true);
        }
    });
    function Newpolicypopup() {

        var SubCategory = $("#ecfarf_advancetype_gid").val();

        if (SubCategory != "0") {
            if ($('#ss6').val() == "") {

                $('#ss6').val('s6');
                objDialogpolicypopupce = $("[id$='ForPartialViewpolicypopupcre']");

                objDialogpolicypopupce.dialog({
                    autoOpen: false,
                    cache: false,
                    modal: true,
                    cache: false,
                    async: false,
                    show: 'fade-in',
                    close: 'fade-out',
                    title: 'Policy Help',
                    width: 860,
                    height: 400
                });
            }
            var url = '@Url.Action("arfpolicy", "RaisingArf")?id=' + SubCategory + '&' + new Date().getTime();
            objDialogpolicypopupce.load(url);
            objDialogpolicypopupce.dialog("open");
        }
    }
    function Deleteadvance() {
        var id = $("#ecfarf_gid").val();
        //var anmu = $("#amount").val();
        var anmu = $("#amount").val().replace(/,/g, "");
        var taxModel = {
            "ecfarf_gid": id,
            "ecfarf_amount": anmu
        };
        jConfirm("Do you want to delete this Advance ? ", "Delete Advance", function (j) {
            if (j == true) {
                $.post('../RaisingArf/DeleteAdvance', taxModel,
                     function (data) {
                         if (data != "NotExists") {
                             alert(data);
                             return false;
                         }
                         else {
                             //location = '../IEM_TAX/Index';
                             //$("#gridadvance").load('../RaisingArf/ArfAdvance?id=0&viewfor=""');
                             $.post('../RaisingArf/Getdelmatdata',
                   function (data) {
                       var num = 0;
                       var Snumber = 0;
                       var newrow;
                       if (data == 0 || data == "") {
                           var controlToBeRemoved = "#tradvance" + id;
                           $(controlToBeRemoved).remove();
                           GotoIndexAdvance();
                       } else {
                           if (data.length > 0) {
                               var controlToBeRemoved = "#tradvance" + id;
                               $(controlToBeRemoved).remove();
                               for (var gh = 0; gh < data.length ; gh++) {

                                   ++Snumber;
                                   newrow = "<tr id='tradvance" + data[gh].ecfarf_gid + "'>";
                                   newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_advancetype + "' style='font-weight:normal;'> " + data[gh].ecfarf_advancetype + " </label></td>";
                                   newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_desc + "' style='font-weight:normal;'>" + data[gh].ecfarf_desc + "</label></td> ";
                                   newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_liq_date + "' style='font-weight:normal;'> " + data[gh].ecfarf_liq_date + " </label></td>";
                                   newrow += " <td class='cadvance' style='font-weight:normal;'><label for=titlename id='" + data[gh].ecfarf_pi_gl_no+ "' style='font-weight:normal;'> " + data[gh].ecfarf_pi_gl_no+ " </label></td>";
                                   newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_po_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_po_no + " </label></td>";
                                   newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_cbf_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_cbf_no + " </label></td>";
                                   newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_fc_code + "' style='font-weight:normal;'> " + data[gh].ecfarf_fc_code + " </label></td>";
                                   newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_cc_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_cc_code + "</label></td> ";
                                   newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_product_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_product_code + "</label></td> ";
                                   newrow += " <td class='fadvance'><label for=titlename id='" + data[gh].ecfarf_ou_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_ou_code + "</label></td> ";

                                   newrow += " <td class='colamountlarge'><label for=titlename id='" + data[gh].ecfarf_amount + "' style='font-weight:normal;'>" + data[gh].ecfarf_amount + "</label></td> ";
                                   newrow += " <td style='display:none;'><label for=titlename id='" + data[gh].ecfarf_ecf_gid + "'>" + data[gh].ecfarf_ecf_gid + "</label></td> ";
                                   newrow += " <td class='aadvance'></a>&nbsp;&nbsp;&nbsp <a title='View' id=" + data[gh].ecfarf_gid + "  onclick='Viewadvance(this, id)'> <span class='glyphicon glyphicon-eye-open'> </span> </a> </a>&nbsp;&nbsp <a title='Edit' id=" + data[gh].ecfarf_gid + "  onclick='Editadvance(this, id)'> <span class='glyphicon glyphicon-edit'> </span> </a> </a> &nbsp;&nbsp<a title='Delete' id=" + data[gh].ecfarf_gid + "  onclick='Deleteadvancee(this, id)'> <span class='glyphicon glyphicon-trash'> </span> </a> </td></tr>";
                                   var controlToBeRemoved = "#tradvance" + data[gh].ecfarf_gid;
                                   $(controlToBeRemoved).remove();
                                   $('#advancegrid tbody:last').append(newrow);
                                   window.parent.jQuery('#ForPartialViewadvacnce_pop').dialog('close');
                               }
                           }
                           GotoIndexAdvance();
                       }
                   });
                         }
                     }, 'json');
            }
            else { return false; }
        });
    }

    //function isNumberKey(evt) {
    //    var charCode = (evt.which) ? evt.which : event.keyCode
    //    if (charCode > 31 && (charCode < 48 || charCode > 57))
    //        return false;
    //    return true;
    //}
    $("#amount").keypress(function (event) {

        return isNumber1(event);

    });
    $("#ecfarf_advancetype_gid").change(function () {

        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        //var amount = $('#amount').val();
        var amount = $("#amount").val().replace(/,/g, "");

        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#ecfarf_advancetype_gid").val();
        if (txtSupplierName.trim() != "") {
            $("#ecfarf_advancetype_gid").removeClass('required');
            $("#ecfarf_advancetype_gid").addClass('valid');
        }
        else {
            $("#ecfarf_advancetype_gid").removeClass('valid');
            $("#ecfarf_advancetype_gid").addClass('required');
        }
    });


    $("#txtliqdate").change(function () {

        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        var amount = $('#amount').val();
        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#txtliqdate").val();
        if (txtSupplierName.trim() != "") {
            $("#txtliqdate").removeClass('required');
            $("#txtliqdate").addClass('valid');
        }
        else {
            $("#txtliqdate").removeClass('valid');
            $("#txtliqdate").addClass('required');
        }
    });
    $("#amount").keyup(function () {
        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        //var amount = $('#amount').val();
        var amount = $("#amount").val().replace(/,/g, "");

        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#amount").val();
        if (txtSupplierName.trim() != "") {
            $("#amount").removeClass('required');
            $("#amount").addClass('valid');
        }
        else {
            $("#amount").removeClass('valid');
            $("#amount").addClass('required');
        }
    });
    $("#oucode").change(function () {
        var ddlid = $(this).val();
        var verify =
       {
           "ecfarf_ou_code": ddlid
       };

        $.ajax({
            url: '@Url.Action("oucode", "RaisingArf")',

            data: JSON.stringify(verify),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                if (data.length > 0) {

                    $('#oucode').val(data);
                    var depat_gid = $('#ecfarf_advancetype_gid').val();
                    var _Delmatdesc = $('#_Delmatdesc').val();
                    var txtliqdate = $('#txtliqdate').val();
                    var typearf = $('#ddlarftype').val();
                    if (typearf != "Employee" && typearf != "Petty Cash") {
                        var _proinvoice = $('#_proinvoice').val();
                        var _pono = $('#_pono').val();
                        var cefno = $('#cefno').val();
                    }
                    var fcno = $('#fcno').val();
                    var ccno = $('#ccno').val();
                    var productcode = $('#productcode').val();
                    var oucode = $('#oucode').val();
                    //var amount = $('#amount').val();
                    var amount = $("#amount").val().replace(/,/g, "");

                    if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
                        $('#btnsaveadvance').attr('disabled', true);
                    }

                    else {
                        $('#btnsaveadvance').attr('disabled', false);
                    }

                    var txtSupplierName = $("#oucode").val();
                    if (txtSupplierName.trim() != "") {
                        $("#oucode").removeClass('required');
                        $("#oucode").addClass('valid');
                    }
                    else {
                        $("#oucode").removeClass('valid');
                        $("#oucode").addClass('required');
                    }
                }
                else {
                    //jAlert('Please Enter Correct OU Code', "Error");
                    //return;
                    $('#btnsaveadvance').attr('disabled', false);
                    var txtSupplierName = $("#oucode").val();
                    if (txtSupplierName.trim() != "") {
                        $("#oucode").removeClass('required');
                        $("#oucode").addClass('valid');
                    }
                    else {
                        $("#oucode").removeClass('valid');
                        $("#oucode").addClass('required');
                    }
                }
            }
        })

    });
    $("#productcode").change(function () {
        var ddlid = $(this).val();
        var verify =
       {
           "ecfarf_product_code": ddlid
       };

        $.ajax({
            url: '@Url.Action("productcode", "RaisingArf")',

            data: JSON.stringify(verify),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                if (data.length > 0) {

                    $('#productcode').val(data);
                    var depat_gid = $('#ecfarf_advancetype_gid').val();
                    var _Delmatdesc = $('#_Delmatdesc').val();
                    var txtliqdate = $('#txtliqdate').val();
                    var typearf = $('#ddlarftype').val();
                    if (typearf != "Employee" && typearf != "Petty Cash") {
                        var _proinvoice = $('#_proinvoice').val();
                        var _pono = $('#_pono').val();
                        var cefno = $('#cefno').val();
                    }
                    var fcno = $('#fcno').val();
                    var ccno = $('#ccno').val();
                    var productcode = $('#productcode').val();
                    var oucode = $('#oucode').val();
                    //var amount = $('#amount').val();
                    var amount = $("#amount").val().replace(/,/g, "");

                    if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
                        $('#btnsaveadvance').attr('disabled', true);
                    }

                    else {
                        $('#btnsaveadvance').attr('disabled', false);
                    }

                    var txtSupplierName = $("#productcode").val();
                    if (txtSupplierName.trim() != "") {
                        $("#productcode").removeClass('required');
                        $("#productcode").addClass('valid');
                    }
                    else {
                        $("#productcode").removeClass('valid');
                        $("#productcode").addClass('required');
                    }
                }
                else {
                    //jAlert('Please Enter Correct ProductCode', "Error");
                    //return;
                    $('#btnsaveadvance').attr('disabled', false);
                    var txtSupplierName = $("#productcode").val();
                    if (txtSupplierName.trim() != "") {
                        $("#productcode").removeClass('required');
                        $("#productcode").addClass('valid');
                    }
                    else {
                        $("#productcode").removeClass('valid');
                        $("#productcode").addClass('required');
                    }
                }
            }
        })

    });

    $("#ccno").change(function () {
        var ddlid = $(this).val();
        var verify =
       {
           "ecfarf_cc_code": ddlid
       };

        $.ajax({
            url: '@Url.Action("cccode", "RaisingArf")',

            data: JSON.stringify(verify),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                if (data.length > 0) {

                    $('#ccno').val(data);
                    var depat_gid = $('#ecfarf_advancetype_gid').val();
                    var _Delmatdesc = $('#_Delmatdesc').val();
                    var txtliqdate = $('#txtliqdate').val();
                    var typearf = $('#ddlarftype').val();
                    if (typearf != "Employee" && typearf != "Petty Cash") {
                        var _proinvoice = $('#_proinvoice').val();
                        var _pono = $('#_pono').val();
                        var cefno = $('#cefno').val();
                    }
                    var fcno = $('#fcno').val();
                    var ccno = $('#ccno').val();
                    var productcode = $('#productcode').val();
                    var oucode = $('#oucode').val();
                    //var amount = $('#amount').val();
                    var amount = $("#amount").val().replace(/,/g, "");

                    if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
                        $('#btnsaveadvance').attr('disabled', true);
                    }

                    else {
                        $('#btnsaveadvance').attr('disabled', false);
                    }

                    var txtSupplierName = $("#ccno").val();
                    if (txtSupplierName.trim() != "") {
                        $("#ccno").removeClass('required');
                        $("#ccno").addClass('valid');
                    }
                    else {
                        $("#ccno").removeClass('valid');
                        $("#ccno").addClass('required');
                    }
                }
                else {
                    jAlert('Please Enter Correct CC No', "Error");
                    return;
                    $('#btnsaveadvance').attr('disabled', false);
                    var txtSupplierName = $("#ccno").val();
                    if (txtSupplierName.trim() != "") {
                        $("#ccno").removeClass('required');
                        $("#ccno").addClass('valid');
                    }
                    else {
                        $("#ccno").removeClass('valid');
                        $("#ccno").addClass('required');
                    }
                }
            }
        })

    });
    $("#fcno").change(function () {
        var ddlid = $(this).val();
        var verify =
       {
           "ecfarf_fc_code": ddlid
       };

        $.ajax({
            url: '@Url.Action("fccode", "RaisingArf")',

            data: JSON.stringify(verify),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                if (data.length > 0) {

                    $('#fcno').val(data);
                    var depat_gid = $('#ecfarf_advancetype_gid').val();
                    var _Delmatdesc = $('#_Delmatdesc').val();
                    var txtliqdate = $('#txtliqdate').val();
                    var typearf = $('#ddlarftype').val();
                    if (typearf != "Employee" && typearf != "Petty Cash") {
                        var _proinvoice = $('#_proinvoice').val();
                        var _pono = $('#_pono').val();
                        var cefno = $('#cefno').val();
                    }
                    var fcno = $('#fcno').val();
                    var ccno = $('#ccno').val();
                    var productcode = $('#productcode').val();
                    var oucode = $('#oucode').val();
                    //var amount = $('#amount').val();
                    var amount = $("#amount").val().replace(/,/g, "");

                    if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
                        $('#btnsaveadvance').attr('disabled', true);
                    }

                    else {
                        $('#btnsaveadvance').attr('disabled', false);
                    }

                    var txtSupplierName = $("#fcno").val();
                    if (txtSupplierName.trim() != "") {
                        $("#fcno").removeClass('required');
                        $("#fcno").addClass('valid');
                    }
                    else {
                        $("#fcno").removeClass('valid');
                        $("#fcno").addClass('required');
                    }
                }
                else {
                    jAlert('Please Enter Correct FC Code', "Error");
                    return;
                    $('#btnsaveadvance').attr('disabled', false);
                    var txtSupplierName = $("#fcno").val();
                    if (txtSupplierName.trim() != "") {
                        $("#fcno").removeClass('required');
                        $("#fcno").addClass('valid');
                    }
                    else {
                        $("#fcno").removeClass('valid');
                        $("#fcno").addClass('required');
                    }
                }
            }
        })

    });

    $("#cefno").keyup(function () {
        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        //var amount = $('#amount').val();
        var amount = $("#amount").val().replace(/,/g, "");

        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#cefno").val();
        if (txtSupplierName.trim() != "") {
            $("#cefno").removeClass('required');
            $("#cefno").addClass('valid');
        }
        else {
            $("#cefno").removeClass('valid');
            $("#cefno").addClass('required');
        }
    });
    $("#_pono").change(function () {
        var ddlid = $(this).val();
        var verify =
       {
           "ecfarf_po_no": ddlid
       };

        $.ajax({
            url: '@Url.Action("_pono", "RaisingArf")',

            data: JSON.stringify(verify),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                if (data.length > 0) {

                    $('#_pono').val(data);
                    var depat_gid = $('#ecfarf_advancetype_gid').val();
                    var _Delmatdesc = $('#_Delmatdesc').val();
                    var txtliqdate = $('#txtliqdate').val();
                    var typearf = $('#ddlarftype').val();
                    if (typearf != "Employee" && typearf != "Petty Cash") {
                        var _proinvoice = $('#_proinvoice').val();
                        var _pono = $('#_pono').val();
                        var cefno = $('#cefno').val();
                    }
                    var fcno = $('#fcno').val();
                    var ccno = $('#ccno').val();
                    var productcode = $('#productcode').val();
                    var oucode = $('#oucode').val();
                    //var amount = $('#amount').val();
                    var amount = $("#amount").val().replace(/,/g, "");

                    if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
                        $('#btnsaveadvance').attr('disabled', true);
                    }

                    else {
                        $('#btnsaveadvance').attr('disabled', false);
                    }

                    var txtSupplierName = $("#_pono").val();
                    if (txtSupplierName.trim() != "") {
                        $("#_pono").removeClass('required');
                        $("#_pono").addClass('valid');
                    }
                    else {
                        $("#_pono").removeClass('valid');
                        $("#_pono").addClass('required');
                    }
                }
                else {
                    jAlert('Please Enter Correct Po No', "Error");
                    return;
                    $('#btnsaveadvance').attr('disabled', false);
                    var txtSupplierName = $("#_pono").val();
                    if (txtSupplierName.trim() != "") {
                        $("#_pono").removeClass('required');
                        $("#_pono").addClass('valid');
                    }
                    else {
                        $("#_pono").removeClass('valid');
                        $("#_pono").addClass('required');
                    }
                }
            }
        })

    });
    //$("#_pono").keyup(function () {
    //    var depat_gid = $('#ecfarf_advancetype_gid').val();
    //    var _Delmatdesc = $('#_Delmatdesc').val();
    //    //var txtliqdate = $('#txtliqdate').val();
    //    var _proinvoice = $('#_proinvoice').val();
    //    var _pono = $('#_pono').val();
    //    var cefno = $('#cefno').val();
    //    var fcno = $('#fcno').val();
    //    var ccno = $('#ccno').val();
    //    var productcode = $('#productcode').val();
    //    var oucode = $('#oucode').val();
    //    var amount = $('#amount').val();

    //    if (depat_gid == "" || _Delmatdesc == "" ||  _proinvoice == "" || _pono == "" || cefno == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "") {
    //        $('#btnsaveadvance').attr('disabled', true);
    //    }

    //    else {
    //        $('#btnsaveadvance').attr('disabled', false);
    //    }

    //    var txtSupplierName = $("#_pono").val();
    //    if (txtSupplierName.trim() != "") {
    //        $("#_pono").removeClass('required');
    //        $("#_pono").addClass('valid');
    //    }
    //    else {
    //        $("#_pono").removeClass('valid');
    //        $("#_pono").addClass('required');
    //    }
    //});
    $("#_proinvoice").keyup(function () {
        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        //var amount = $('#amount').val();
        var amount = $("#amount").val().replace(/,/g, "");

        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#_proinvoice").val();
        if (txtSupplierName.trim() != "") {
            $("#_proinvoice").removeClass('required');
            $("#_proinvoice").addClass('valid');
        }
        else {
            $("#_proinvoice").removeClass('valid');
            $("#_proinvoice").addClass('required');
        }
    });
    $("#_Delmatdesc").keyup(function () {
        var depat_gid = $('#ecfarf_advancetype_gid').val();
        var _Delmatdesc = $('#_Delmatdesc').val();
        var txtliqdate = $('#txtliqdate').val();
        var typearf = $('#ddlarftype').val();
        var _proinvoice = $('#_proinvoice').val();
        var _pono = $('#_pono').val();
        var cefno = $('#cefno').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            var _proinvoice = $('#_proinvoice').val();
            var _pono = $('#_pono').val();
            var cefno = $('#cefno').val();
        }
        var fcno = $('#fcno').val();
        var ccno = $('#ccno').val();
        var productcode = $('#productcode').val();
        var oucode = $('#oucode').val();
        //var amount = $('#amount').val();
        var amount = $("#amount").val().replace(/,/g, "");

        if (depat_gid == "" || _Delmatdesc == "" || fcno == "" || ccno == "" || productcode == "" || oucode == "" || amount == "" || txtliqdate == "") {
            $('#btnsaveadvance').attr('disabled', true);
        }

        else {
            $('#btnsaveadvance').attr('disabled', false);
        }

        var txtSupplierName = $("#_Delmatdesc").val();
        if (txtSupplierName.trim() != "") {
            $("#_Delmatdesc").removeClass('required');
            $("#_Delmatdesc").addClass('valid');
        }
        else {
            $("#_Delmatdesc").removeClass('valid');
            $("#_Delmatdesc").addClass('required');
        }
    });
    function GotoIndexAdvance() {
        window.parent.jQuery('#ForPartialViewadvacnce_pop').dialog('close');
        $('#btnsaveadvance').attr('disabled', true);
        $('#_Delmatdesc').val("");
        $('#_Delmatdesc').attr('disabled', false);
        $("#_Delmatdesc").removeClass('valid');
        $("#_Delmatdesc").addClass('required');
        $('#txtliqdate').val("");
        $('#txtliqdate').attr('disabled', false);
        $("#txtliqdate").removeClass('valid');
        $("#txtliqdate").addClass('required');
        var typearf = $('#ddlarftype').val();
        if (typearf != "Employee" && typearf != "Petty Cash") {
            $('#_proinvoice').val("");
            $('#_proinvoice').attr('disabled', false);
            $("#_proinvoice").removeClass('valid');
            $("#_proinvoice").addClass('required');
            $('#_pono').val("");
            $('#_pono').attr('disabled', true);
            $("#_pono").removeClass('valid');
            $("#_pono").addClass('required');
            $('#cefno').val("");
            $('#cefno').attr('disabled', true);
            $("#cefno").removeClass('valid');
            $("#cefno").addClass('required');
        }


        $('#amount').attr('disabled', false);
        $('#amount').val("");
        $("#amount").removeClass('valid');
        $("#amount").addClass('required');

        $("#btndel").hide();
        $('#btnsavevl').show();
        $('#ecfarf_gid').val("0");
        var val = 0;
        var Student = {
            "ecfarf_advancetype_gid": val,
        };
        $.ajax({
            url: '@Url.Action("AdvanceType", "RaisingArf")',

            data: JSON.stringify(Student),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {

                $("#ecfarf_advancetype_gid").empty();

                if (data.length > 0) {

                    $("#ecfarf_advancetype_gid").append("<option value='0' >---Select---</option>");
                    for (var i = 0; i < data.length; i++) {

                        $("#ecfarf_advancetype_gid").append("<option value=" + data[i].advancetype_gid + " >" + data[i].advancetype_name + "</option>");
                        $('#ecfarf_advancetype_gid').attr('disabled', false);
                        $("#ecfarf_advancetype_gid").removeClass('valid');
                        $("#ecfarf_advancetype_gid").addClass('required');
                    }
                }

                if (data.length == 0) {
                    $("#ecfarf_advancetype_gid").append("<option value='0' >--Select Exp Cat--</option>");
                    $('#ecfarf_advancetype_gid').attr('disabled', true);
                }
                if (data.length == null) {
                    alert("3");
                }
            },
            error: function (result) {
                alert("Error");
            }
        });


    }

    function Save() {
        var ecfarf_gid = $('#ecfarf_gid').val();
        if (ecfarf_gid == 0) {

            var depat_gid = $('#ecfarf_advancetype_gid').val();
            var _Delmatdesc = $('#_Delmatdesc').val();
            var txtliqdate = $('#txtliqdate').val();
            var typearf = $('#ddlarftype').val();
            if (depat_gid == null || depat_gid == "" || depat_gid == "0") {
                jAlert("Please Select Advance Type.", "Message");
                $("#ecfarf_advancetype_gid").focus();
                return false;
            }
            if (txtliqdate == null || txtliqdate == "") {
                jAlert("Please Select Liquidation Date.", "Message");
                $("#txtliqdate").focus();
                return false;
            }
            if (typearf != "Employee" && typearf != "Petty Cash") {
                var _proinvoice = $('#_proinvoice').val();
                var _pono = $('#_pono').val();
                var cefno = $('#cefno').val();
            }
            else {
                var _proinvoice = "";
                var _pono = "";
                var cefno = "";
            }

            var fcno = $('#fcno').val();
            var ccno = $('#ccno').val();
            var productcode = $('#productcode').val();
            var oucode = $('#oucode').val();
            //var amount = $('#amount').val();
            var amount = $("#amount").val().replace(/,/g, "");

            var Student = {

                "ecfarf_advancetype_gid": depat_gid,
                "ecfarf_desc": _Delmatdesc,
                "ecfarf_liq_date": txtliqdate,
                "ecfarf_promo_invoice": _proinvoice,
                "ecfarf_po_no": _pono,
                "ecfarf_cbf_no": cefno,
                "ecfarf_fc_code": fcno,
                "ecfarf_cc_code": ccno,
                "ecfarf_product_code": productcode,
                "ecfarf_ou_code": oucode,
                "ecfarf_amount": amount
            };

            $.ajax({
                url: '../RaisingArf/SaveAdvance/',
                data: JSON.stringify(Student),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    if (result != "NotExists") {
                        jAlert(result, "Error");
                        return;
                    }
                    if (result == "NotExists") {
                        jAlert('Record Added Sucessfully !', "Information");
                        //   $("#gridadvance").load('../RaisingArf/ArfAdvance?id=' + 0 + '&viewfor=""');
                        //var newrow = "<tr id='tradvance" + Slabrange_Name + "'><td><label for=titlename id='" + Slabrange_Name + "'> " + Slabrange_Name + " </label></td>";
                        //newrow += " <td><label for=titlename id='" + Slabrange_From + "'> " + Slabrange_From + " </label></td>";
                        //newrow += " <td><label for=titlename id='" + Slabrange_To + "'>" + Slabrange_To + "</label></td> </tr>";
                        //$('#gridid tbody:last').append(newrow);

                        $.post('../RaisingArf/Getdelmatdata',
                      function (data) {
                          var num = 0;
                          var Snumber = 0;
                          var newrow;
                          if (data == 0 || data == "") { } else {
                              if (data.length > 0) {

                                  for (var gh = 0; gh < data.length ; gh++) {

                                      ++Snumber;
                                      newrow = "<tr id='tradvance" + data[gh].ecfarf_gid + "'>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_advancetype + "' style='font-weight:normal;'> " + data[gh].ecfarf_advancetype + " </label></td>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_desc + "' style='font-weight:normal;'>" + data[gh].ecfarf_desc + "</label></td> ";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_liq_date + "' style='font-weight:normal;'> " + data[gh].ecfarf_liq_date + " </label></td>";
                                      newrow += " <td class='cadvance' style='font-weight:normal;'><label for=titlename id='" + data[gh].ecfarf_pi_gl_no+ "' style='font-weight:normal;'> " + data[gh].ecfarf_pi_gl_no+ " </label></td>";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_po_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_po_no + " </label></td>";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_cbf_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_cbf_no + " </label></td>";
                                      newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_fc_code + "' style='font-weight:normal;'> " + data[gh].ecfarf_fc_code + " </label></td>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_cc_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_cc_code + "</label></td> ";
                                      newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_product_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_product_code + "</label></td> ";
                                      newrow += " <td class='fadvance'><label for=titlename id='" + data[gh].ecfarf_ou_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_ou_code + "</label></td> ";

                                      newrow += " <td class='colamountlarge'><label for=titlename id='" + data[gh].ecfarf_amount + "' style='font-weight:normal;'>" + data[gh].ecfarf_amount + "</label></td> ";
                                      newrow += " <td style='display:none;'><label for=titlename id='" + data[gh].ecfarf_ecf_gid + "'>" + data[gh].ecfarf_ecf_gid + "</label></td> ";
                                      newrow += " <td class='aadvance'></a>&nbsp;&nbsp;&nbsp <a title='View' id=" + data[gh].ecfarf_gid + "  onclick='Viewadvance(this, id)'> <span class='glyphicon glyphicon-eye-open'> </span> </a> </a>&nbsp;&nbsp <a title='Edit' id=" + data[gh].ecfarf_gid + "  onclick='Editadvance(this, id)'> <span class='glyphicon glyphicon-edit'> </span> </a> </a>&nbsp;&nbsp <a title='Delete' id=" + data[gh].ecfarf_gid + "  onclick='Deleteadvancee(this, id)'> <span class='glyphicon glyphicon-trash'> </span> </a> </td></tr>";
                                      var controlToBeRemoved = "#tradvance" + data[gh].ecfarf_gid;

                                      $(controlToBeRemoved).remove();
                                      $('#advancegrid tbody:last').append(newrow);
                                      window.parent.jQuery('#ForPartialViewadvacnce_pop').dialog('close');
                                      //$('#btnsaveadvance').attr('disabled', true);
                                      //$('#_Delmatdesc').val("");
                                      //$('#_Delmatdesc').attr('disabled', false);
                                      //$("#_Delmatdesc").removeClass('valid');
                                      //$("#_Delmatdesc").addClass('required');
                                      //$('#_proinvoice').val("");
                                      //$('#_proinvoice').attr('disabled', false);
                                      //$("#_proinvoice").removeClass('valid');
                                      //$("#_proinvoice").addClass('required');
                                      //$('#_pono').val("");
                                      //$('#_pono').attr('disabled', false);
                                      //$("#_pono").removeClass('valid');
                                      //$("#_pono").addClass('required');
                                      //$('#cefno').val("");
                                      //$('#cefno').attr('disabled', false);
                                      //$("#cefno").removeClass('valid');
                                      //$("#cefno").addClass('required');

                                      //$('#amount').attr('disabled', false);
                                      //$('#amount').val("");
                                      //$("#amount").removeClass('valid');
                                      //$("#amount").addClass('required');
                                  }
                              }
                              GotoIndexAdvance();
                          }
                      });
                    }
                },
            });
        }
        else {

            var depat_gid = $('#ecfarf_advancetype_gid').val();
            var _Delmatdesc = $('#_Delmatdesc').val();
            var txtliqdate = $('#txtliqdate').val();
            var typearf = $('#ddlarftype').val();

            if (depat_gid == null || depat_gid == "" || depat_gid == "0") {
                jAlert("Please Select Advance Type.", "Message");
                $("#ecfarf_advancetype_gid").focus();
                return false;
            }
            if (txtliqdate == null || txtliqdate == "") {
                jAlert("Please Select Liquidation Date.", "Message");
                $("#txtliqdate").focus();
                return false;
            }

            if (typearf != "Employee" && typearf != "Petty Cash") {
                var _proinvoice = $('#_proinvoice').val();
                var _pono = $('#_pono').val();
                var cefno = $('#cefno').val();
            }
            else {
                var _proinvoice = "";
                var _pono = "";
                var cefno = "";
            }

            var fcno = $('#fcno').val();
            var ccno = $('#ccno').val();
            var productcode = $('#productcode').val();
            var oucode = $('#oucode').val();
            //var amount = $('#amount').val();
            var amount = $("#amount").val().replace(/,/g, "");
            var ecfarf_gid = $('#ecfarf_gid').val();
            var ecfarf_ecf_gid = $('#ecfarf_ecf_gid').val();

            var Student = {
                "ecfarf_gid": ecfarf_gid,
                "ecfarf_ecf_gid": ecfarf_ecf_gid,
                "ecfarf_advancetype_gid": depat_gid,
                "ecfarf_desc": _Delmatdesc,
                "ecfarf_liq_date": txtliqdate,
                "ecfarf_promo_invoice": _proinvoice,
                "ecfarf_po_no": _pono,
                "ecfarf_cbf_no": cefno,
                "ecfarf_fc_code": fcno,
                "ecfarf_cc_code": ccno,
                "ecfarf_product_code": productcode,
                "ecfarf_ou_code": oucode,
                "ecfarf_amount": amount
            };

            $.ajax({
                url: '../RaisingArf/UpdateAdvance/',
                data: JSON.stringify(Student),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    if (result == "Exists") {
                        if (confirm("Duplicate Record !")) {
                            //InsertPouch();
                            return;
                        }
                    }
                    if (result == "NotExists") {
                        jAlert('Record Updated Successfully !', "Information");

                        // $("#gridadvance").load('../RaisingArf/ArfAdvance?id=' + 0 + '&viewfor=""');

                        $.post('../RaisingArf/Getdelmatdata',
                      function (data) {
                          var num = 0;
                          var Snumber = 0;
                          var newrow;
                          if (data == 0 || data == "") { } else {
                              if (data.length > 0) {

                                  for (var gh = 0; gh < data.length ; gh++) {

                                      ++Snumber;
                                      newrow = "<tr id='tradvance" + data[gh].ecfarf_gid + "'>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_advancetype + "' style='font-weight:normal;'> " + data[gh].ecfarf_advancetype + " </label></td>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_desc + "' style='font-weight:normal;'>" + data[gh].ecfarf_desc + "</label></td> ";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_liq_date + "' style='font-weight:normal;'> " + data[gh].ecfarf_liq_date + " </label></td>";
                                      newrow += " <td class='cadvance' style='font-weight:normal;'><label for=titlename id='" + data[gh].ecfarf_pi_gl_no+ "' style='font-weight:normal;'> " + data[gh].ecfarf_pi_gl_no+ " </label></td>";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_po_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_po_no + " </label></td>";
                                      newrow += " <td class='cadvance'><label for=titlename id='" + data[gh].ecfarf_cbf_no + "' style='font-weight:normal;'> " + data[gh].ecfarf_cbf_no + " </label></td>";
                                      newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_fc_code + "' style='font-weight:normal;'> " + data[gh].ecfarf_fc_code + " </label></td>";
                                      newrow += " <td class='dadvance'><label for=titlename id='" + data[gh].ecfarf_cc_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_cc_code + "</label></td> ";
                                      newrow += " <td class='aadvance'><label for=titlename id='" + data[gh].ecfarf_product_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_product_code + "</label></td> ";
                                      newrow += " <td class='fadvance'><label for=titlename id='" + data[gh].ecfarf_ou_code + "' style='font-weight:normal;'>" + data[gh].ecfarf_ou_code + "</label></td> ";

                                      newrow += " <td class='colamountlarge'><label for=titlename id='" + data[gh].ecfarf_amount + "' style='font-weight:normal;'>" + data[gh].ecfarf_amount + "</label></td> ";
                                      newrow += " <td style='display:none;'><label for=titlename id='" + data[gh].ecfarf_ecf_gid + "'>" + data[gh].ecfarf_ecf_gid + "</label></td> ";
                                      newrow += " <td class='aadvance'></a> &nbsp;&nbsp;&nbsp<a title='View' id=" + data[gh].ecfarf_gid + "  onclick='Viewadvance(this, id)'> <span class='glyphicon glyphicon-eye-open'> </span> </a> </a> &nbsp;&nbsp<a title='Edit' id=" + data[gh].ecfarf_gid + "  onclick='Editadvance(this, id)'> <span class='glyphicon glyphicon-edit'> </span> </a> </a>&nbsp;&nbsp <a title='Delete' id=" + data[gh].ecfarf_gid + "  onclick='Deleteadvancee(this, id)'> <span class='glyphicon glyphicon-trash'> </span> </a> </td></tr>";
                                      var controlToBeRemoved = "#tradvance" + data[gh].ecfarf_gid;
                                      $(controlToBeRemoved).remove();
                                      $('#advancegrid tbody:last').append(newrow);
                                      window.parent.jQuery('#ForPartialViewadvacnce_pop').dialog('close');
                                  }
                              }
                              GotoIndexAdvance();
                          }
                      });
                    }
                    else {
                        jAlert(result, "Error");
                    }

                    // window.location.reload();
                },
            });
        }
    }
    $('#oucode').blur(function () {
        var OucodeBussiness = document.getElementById('oucode').value;
        var Student =
       {
           "OUCode": OucodeBussiness
       };
        $.ajax({
            url: '../TravelClaimNew/ChangeBussinessSegment/',
            data: JSON.stringify(Student),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#fcno").val(data[0].OUCode);
            },
            error: function (result) {
                jAlert("Error.", "Error");
                return false;
            }
        });
    });
</script>