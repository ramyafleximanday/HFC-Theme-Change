@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/Rmax_Site.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
<script src="~/Scripts/angular.min.js"></script>
<script src="~/Scripts/asms/ui-bootstrap-tpls-0.11.0.js"></script>
<script>
    $(document).ready(function () {
        $("#txtReceivedDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd-mm-yy',
            maxDate: '-id',
        });
    });
    $(document).keydown(function (e) {
        if (e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA')
            e.preventDefault();
    });
</script>
<style>
    table{
    table-layout:fixed !important;
}
table th th.thfix {
    width:20% !important;
}
table th td.tdfix {
    width:20% !important;
}
</style>
<div class="pageHeadingLayout">
    <span class="pageHeading">Central Team Maker</span>
</div>
<div class="well" style="padding: 1px 1px 0px 1px;">
    <div ng-app="myApp">
        <div ng-controller="PageCtrl">
            <div>
                <table class="tableSmall table-bordered table-hover table-responsive tablefix" style="width:100%;font-family:Tahoma;">
                    <thead style="width:100%;">
                        <tr>
                            <th class="thfix" style="width:0%; display:none;">
                                inward Gid
                            </th>
                            <th class="thfix" style="width:0%; display:none;">
                                Cygnet Gid
                            </th>
                            <th class="thfix" style="width:9.6%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'InwardNo'; sortReversemyreq = !sortReversemyreq">
                                   Inward No
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InwardNo' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InwardNo' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input title="Select Inward No" type="text" id="txtInwardNo" class="textboxStyle" ng-model="search.InwardNo">
                            </th>
                            @*<th class="thfix" style="width:9.6%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'SupplierGSTN'; sortReversemyreq = !sortReversemyreq">
                                    Supplier GSTN
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'SupplierGSTN' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'SupplierGSTN' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input title="Select Supplier GSTN" type="text" id="txtSupplierGSTN" class="textboxStyle" ng-model="search.SupplierGSTN">
                            </th>*@
                            <th class="thfix" style="width:9.6%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'ReceivedDate'; sortReversemyreq = !sortReversemyreq">
                                    Received Date
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'ReceivedDate' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'ReceivedDate' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input title="Select Received Date" type="text" id="txtReceivedDate" class="textboxStyle" ng-model="search.ReceivedDate">
                            </th>
                            <th class="thfix" style="width:14.1%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'SupplierName'; sortReversemyreq = !sortReversemyreq">
                                    Supplier Name
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'SupplierName' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'SupplierName' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input title="Enter Supplier Name" type="text" class="textboxStyle" ng-model="search.SupplierName">
                            </th>
                            <th class="thfix" style="width:9.7%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'RaiserName'; sortReversemyreq = !sortReversemyreq">
                                    Raiser
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'RaiserName' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'RaiserName' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input type="text" title="Enter Raiser Name" class="textboxStyle" ng-model="search.RaiserName">
                            </th>
                            <th class="thfix" style="width:9%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'EmployeeDepartment'; sortReversemyreq = !sortReversemyreq">
                                    Department
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'EmployeeDepartment' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'EmployeeDepartment' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input type="text" title="Enter Department Name" class="textboxStyle" ng-model="search.EmployeeDepartment">
                            </th>
                            <th class="thfix" style="width:8.6%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'InvoiceDate'; sortReversemyreq = !sortReversemyreq">
                                    Invoice Date
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceDate' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceDate' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input type="text" title="Enter Invoice Date" class="textboxStyle" ng-model="search.InvoiceDate">
                            </th>
                            <th class="thfix" style="width:9.4%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'InvoiceNo'; sortReversemyreq = !sortReversemyreq">
                                    Invoice No
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceNo' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceNo' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input type="text" title="Enter Invoice No" class="textboxStyle" ng-model="search.InvoiceNo">
                            </th>
                            <th class="thfix" style="width:9.0%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'InvoiceAmount'; sortReversemyreq = !sortReversemyreq">
                                    Invoice Amount
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceAmount' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'InvoiceAmount' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input id="txtAmountINV" type="text" title="Enter Invoice Amount" class="textboxStyle" ng-model="search.InvoiceAmount">
                            </th>
                            <th class="thfix" style="width:7.8%;">
                                Currency
                                <br />
                                <input type="text" title="Enter Currency Code" class="textboxStyle" ng-model="search.CurrencyName">
                            </th>
                            <th class="thfix" style="width:9.0%;">
                                <a style="text-decoration: none;" href="#" ng-click="sortTypemyreq = 'GSTNStatus'; sortReversemyreq = !sortReversemyreq">
                                    GSTN Status
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'GSTNStatus' && !sortReversemyreq" class="glyphicon glyphicon-chevron-down"></span>
                                    <span style="font-size: 12px;color:white;" ng-show="sortTypemyreq == 'GSTNStatus' && sortReversemyreq" class="glyphicon glyphicon-chevron-up"></span>
                                </a>
                                <br />
                                <input id="txtGSTNStatus" type="text" title="Enter GSTN Status" class="textboxStyle" ng-model="search.GSTNStatus">
                            </th>
                            <th class="thfix" style="width:9.8%;">
                                Remarks
                                <br />
                                <input type="text" title="Enter Remarks " class="textboxStyle" ng-model="search.Remarks">
                            </th>
                            <th class="thfix" style="width:5.3%;">
                                Selection<br />
                                <input type="checkbox" title="Select All" value="0" id="selectAll">
                            </th>
                            <th class="thfix" style="width:7.0%;">Action</th>
                        </tr>
                    </thead>
                </table>
                <div style="height: 600px;overflow-y: scroll;">
                    <table class="tableSmall table-bordered table-hover table-responsive tablefix" style="width:100%;table-layout: fixed;font-family:Tahoma;">
                        <tbody ng-show="filtered.length!=0" ng-repeat="item in filtered = items| orderBy:sortTypemyreq:sortReversemyreq | filter:search | startFrom:(currentPage-1)*entryLimit | limitTo:entryLimit" style="width:100%;">
                            <tr>
                                <td class="tdfix" style="display:none;">
                                    {{item.InwardId}}
                                </td>
                                <td class="tdfix" style="display:none;">
                                    {{item.Cygnet_Gid}}
                                </td>
                                <td title="{{item.InwardNo}}" class="tdfix" style=" width:9.8%;overflow: hidden;">
                                    <span> {{item.InwardNo}}</span>
                                </td>
                                @*<td title="{{item.SupplierGSTN}}" class="tdfix" style=" width:10.3%;overflow: hidden;">
                                    <span> {{item.ProviderGSTN}}</span>
                                </td>*@
                                <td title="{{item.ReceivedDate}}" class="tdfix" style=" width:10.5%;overflow: hidden;">
                                    <span> {{item.ReceivedDate}}</span>
                                </td>
                                <td title="{{item.SupplierName}}" class="tdfix" style=" width:14.3%;overflow: hidden;">
                                    <span> {{item.SupplierName}}</span>
                                </td>
                                <td title="{{item.RaiserName}}" class="tdfix" style=" width:9.8%;overflow: hidden;">
                                    <span> {{item.RaiserName}}</span>
                                </td>
                                <td title="{{item.EmployeeDepartment}}" class="tdfix" style=" width:9%;overflow: hidden;">
                                    <span> {{item.EmployeeDepartment}}</span>
                                </td>
                                <td title="{{item.InvoiceDate}}" class="tdfix" style=" width:8.7%;overflow: hidden;">
                                    <span>{{item.InvoiceDate}}</span>
                                </td>
                                <td title="{{item.InvoiceNo}}" class="tdfix" style=" width:9.5%;overflow: hidden;">
                                    <span> {{item.InvoiceNo}}</span>
                                </td>
                                <td title="{{item.InvoiceAmount}}" class="tdfix" style=" width:9%;overflow: hidden;">
                                    <span> {{item.InvoiceAmount}}</span>
                                </td>
                                <td title="{{item.CurrencyName}}" class="tdfix" style=" width:7.9%;overflow: hidden;">
                                    <span> {{item.CurrencyName}}</span>
                                </td>
                                <td title="{{item.GSTNStatus}}" class="tdfix" style=" width:9%;overflow: hidden;">
                                    <span> {{item.GSTNStatus}}</span>
                                </td>
                                <td title="{{item.Remarks}}" class="tdfix" style=" width:9.9%;overflow: hidden;">
                                    <span> {{item.Remarks}}</span>
                                </td>
                                <td align="center" class="tdfix" style="width:5.4%;overflow: hidden;">
                                    <input type="checkbox" title="Select" id="chkValues" class="case" name="case[]" value="{{item.InwardId}}" />
                                </td>
                                <td class="tdfix" style="width:5.8%;" align="center">
                                    <a title="View"> <span class="glyphicon glyphicon-eye-open" onclick="inwardView(this)"></span></a>
                                    &nbsp;<a title="Log"> <span class="glyphicon glyphicon-book" onclick="View(this)"></span></a>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot ng-show="filtered.length==0">
                            <tr>
                                <td colspan="12" style="text-align:left;"><div class="gridMessage" style="width:100%; border:none;"><center>No Records Found</center></div></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div ng-show="filtered.length>0">
                    <table style="width:100%;">
                        <tr>
                            <td style="padding-left:10px" align="left"> <div class="gridCount" style="text-align:left; font-size:14px;">Total Records : {{totalItems}} of {{filtered.length}}</div></td>
                            <td align="right">
                                <pagination total-items="totalItems"
                                            ng-model="currentPage"
                                            page="currentPage"
                                            max-size="noofsetpages"
                                            boundary-links="true"
                                            items-per-page="entryLimit" class="pagination-sm" style="cursor:pointer;font-size:14px;">
                                </pagination>
                            </td>
                            <td align="right" style="padding-right:5px;width:40%;padding-bottom:6px">
                                <button class="btn btn-primary" type="button" onclick="raiseecfbutton()" id="btnraiseecf"><span style="color:white;font-size: 12px;" class="glyphicon glyphicon-plane"></span> Raise ECF</button>
                                <button class="btn btn-primary" type="button" id="btn" onclick="InwardHold()"><span style="color:white;font-size: 12px;" class="glyphicon glyphicon-header"></span> Hold</button>
                                <button class="btn btn-primary" type="button" onclick="InwardReturn()" id="btn"><span style="color:white;font-size: 12px;" class="glyphicon glyphicon-share-alt"></span> Return Back</button>
                                <button class="btn btn-primary" type="button" id="btn" disabled="disabled"><span style="color:white;font-size: 12px;" class="glyphicon glyphicon-envelope"></span> Send Alert</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="padding:2px;" id="ForPartialViewcentralMaker"></div>
<script>
    $("#txtAmountINV").keyup(function (event) {
        if (event.which >= 37 && event.which <= 40) {
            event.preventDefault();
        }

        var currentval = $("#txtAmountINV").val();
        var testDecimal = testDecimals(currentval);
        if (testDecimal.length > 1) {
            currentval = currentval.slice(0, -1);
        }
        $("#txtAmountINV").val(replaceCommas(currentval));

    });

    function testDecimals(currentval) {
        var count;
        currentval.match(/\./g) === null ? count = 0 : count = currentval.match(/\./g);
        return count;
    }
    function replaceCommas(yourNumber) {
        var components = yourNumber.toString().split(".");
        if (components.length === 1)
            components[0] = yourNumber;
        components[0] = components[0].replace(/\D/g, "").replace(/(\d)(?=(\d\d)+\d$)/g, "$1,");
        if (components.length === 2)
            components[1] = components[1].replace(/\D/g, "");
        return components.join(".");
    }
    function Saveecflogviews() {
        window.parent.jQuery('#ForPartialViewcentral').dialog('close');
    }
    $(document).ready(function () {
        $('#selectAll').on('click', function () {
            if ($(this).is(':checked')) {
                $('.case').each(function () {
                    this.checked = true;
                });
            } else {
                $('.case').each(function () {
                    this.checked = false;
                });
            }
        })
    });
    var app = angular.module('myApp', ['ui.bootstrap']);
    app.filter('startFrom', function () {
        return function (input, start) {
            if (input) {
                start = +start;
                return input.slice(start);
            }
            return [];
        };
    });

    app.controller('PageCtrl', ['$scope', '$http', 'filterFilter', function ($scope, $http, filterFilter) {
        $http.get("../CentralMaker/ToGetctmakerrpt?" + new Date().getTime())
     .then(function (response) {
         $scope.items = response.data;
         $scope.search = {};
         $scope.resetFilters = function () {
             $scope.search = {};
         };
         $scope.currentPage = 1;
         $scope.totalItems = $scope.items.length;
         $scope.entryLimit = 50;
         $scope.noOfPages = Math.ceil($scope.totalItems / $scope.entryLimit);
         $scope.noofsetpages = 5;
         $scope.$watch('search', function (newVal, oldVal) {
             $scope.filtered = filterFilter($scope.items, newVal);
             $scope.totalItems = $scope.filtered.length;
             $scope.noOfPages = Math.ceil($scope.totalItems / $scope.entryLimit);
             $scope.currentPage = 1;
             $scope.noofsetpages = 5;
         }, true);
     });
    }]);

    var objDialogyCentralMaker;
    $(document).ready(function () {
        objDialogyCentralMaker = $("[id$='ForPartialViewcentralMaker']");
        objDialogyCentralMaker.dialog({
            autoOpen: false,
            modal: true,
            show: 'fade-in',
            close: 'fade-out',
            width: 500,
            height: 500
        });
    });

    function inwardView(element) {
        var row = $(element).closest('tr');
        var ecfnum = row.find('td:eq(0)').text();
        ecfnum = ecfnum.toString().trim();

        var url = '@Url.Action("CentralInwardView", "CentralMaker")?id=' + ecfnum + '&' + new Date().getTime();
        objDialogyCentralMaker.load(url);
        objDialogyCentralMaker.dialog({ title: 'View', width: '1135', height: '350' });
        objDialogyCentralMaker.dialog("open");
    }

    function View(element) {
        var row = $(element).closest('tr');
        var ecfnum = row.find('td:eq(0)').text();
        ecfnum = ecfnum.toString().trim();

        var url = '@Url.Action("CentralMakerView", "CentralMaker")?id=' + ecfnum + '&' + new Date().getTime();
        objDialogyCentralMaker.load(url);
        objDialogyCentralMaker.dialog({ title: 'Log', width: '660', height: '400' });
        objDialogyCentralMaker.dialog("open");
    }

    function raiseecfbutton() {
        CheckListVal = [];
        $('input:checkbox:checked').each(function () {
            CheckListVal.push($(this).attr('value'));
        });
        if (CheckListVal == "") {
            jAlert("No More Entry Selected", "Message");
            return false;
        }
        else {
            var Student = {
                "SelectedValues": CheckListVal
            };
            $.ajax({
                url: '../CentralMaker/Raiseecfscreen/',
                data: JSON.stringify(Student),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data == "Success") {
                        @*window.location.href = '@Url.Action("index", "Centralteamecf")';*@
                        window.location.href = '@Url.Action("CtMakerIndex", "SupplierInvoiceNew")';
                    }
                    else {
                        jAlert(data, "Error");
                        return false;
                    }
                },
                error: function (result) {
                    jAlert("Error.", "Error");
                    return false;
                }
            });
        }
    }
    function InwardHold() {
        CheckListVal = [];
        $('input:checkbox:checked').each(function () {
            CheckListVal.push($(this).attr('value'));
        });
        if (CheckListVal == null || CheckListVal == "") {
            jAlert("No More Entry Selected", "Information");
            return false;
        }
        var url = '@Url.Action("HoldView", "CentralMaker")?SelectedValues=' + CheckListVal + '&' + new Date().getTime();
        objDialogyCentralMaker.load(url);
        //objDialogyCentralMaker.load('../CentralMaker/HoldView?SelectedValues=' + CheckListVal);
        objDialogyCentralMaker.dialog({ title: 'Hold Inward', width: '500', height: '245' });
        objDialogyCentralMaker.dialog("open");
    }
    function InwardReturn() {
        CheckListVal = [];
        $('input:checkbox:checked').each(function () {
            CheckListVal.push($(this).attr('value'));
        });
        if (CheckListVal == null || CheckListVal == "") {
            jAlert("No More Entry Selected", "Information");
            return false;
        }
        var url = '@Url.Action("ReturnView", "CentralMaker")?SelectedValues=' + CheckListVal + '&' + new Date().getTime();
        objDialogyCentralMaker.load(url);
        //objDialogyCentralMaker.load('../CentralMaker/ReturnView?SelectedValues=' + CheckListVal);
        objDialogyCentralMaker.dialog({ title: 'Return Inward', width: '500', height: '245' });
        objDialogyCentralMaker.dialog("open");
    }
</script>
