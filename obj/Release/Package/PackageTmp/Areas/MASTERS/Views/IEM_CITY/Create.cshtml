@model IEM.Areas.MASTERS.Models.iem_mst_city

<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>
@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)  
    <table class="myTableStyleTabNew" style="width:100%;">    
        <tr>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span> City Code </span>
                <br />
                <input name="DocNameName" id="_Citycode" type="text" data-val="true" maxlength="20" value=""
                       class="fstextbox required " />

            </td>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span> City Name </span>
                <br />
                <input name="DocNameName" id="_Cityname" type="text" data-val="true" maxlength="70" value=""
                       class="fstextbox required" />

            </td>
        </tr>

        <tr>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span> City Pin Code </span>
                <br />
                <input name="DocNameName" id="_CityPincode" type="text" data-val="true" maxlength="6" value=""
                       onkeypress="return isNumberKey(event)" class="fstextbox required"/>

            </td>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>State</span>
                <br />
                @Html.DropDownListFor(s => s.state_gid, Model.Getstate, "--Select State--", new { @class = "fstextbox  chosen-select", @style = "display: block; ", @id = "state_gid", @onchange = "checkstate()" })

            </td>
        </tr>

        <tr>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Region</span>
                <br />
                @Html.DropDownListFor(r => r.region_gid, Model.Getregion, "--Select Region--", new { @class = "fstextbox  chosen-select", @style = "display: block; ", @id = "region_gid", @onchange = "checkregion()" })

            </td>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Country</span>
                <br />
                @Html.DropDownListFor(c => c.country_gid, Model.Getcountry, "--Select Country--", new { @class = "fstextbox  chosen-select ", @style = "display: block;", @id = "country_gid", @onchange = "checkcountry()" })

            </td>
        </tr>

        <tr>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>City Class</span>
                @Html.DropDownListFor(cl => cl.cityclass_gid, Model.Getcityclass, "--Select City Class--", new { @class = "fstextbox  chosen-select", @style = "display: block;;", @id = "cityclass_gid", @onchange = "checkcityclass()" })

            </td>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Tier</span>
                @Html.DropDownListFor(t => t.tier_gid, Model.Gettier, "--Select Tier--", new { @class = "fstextbox  chosen-select", @style = "display: block; ", @id = "tier_gid", @onchange = "checktier()" })

            </td>
        </tr>
        <tr>
            <td colspan="2" style="width:100%; padding:0px 10px 0px 3px; text-align:center;">               
                <button type="button" id="_save" disabled="disabled" class="btn btn-primary" value="Save" onclick="SAVE()" style="margin-top:10px;  color:white;">
                    <span class="glyphicon glyphicon-floppy-disk" style="color:white;font-size:12px;"></span> Save
                </button>
                             
                <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" style="margin-top:10px;  color:white;">
                    <span style="color:white;font-size:12px;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                </button>
               
            </td>
        </tr>
    </table>
}

        <script type="text/javascript">

            $(document).ready(function () {

                $("#state_gid").chosen({});
                $("#region_gid").chosen({});
                $("#country_gid").chosen({});
                $("#cityclass_gid").chosen({});
                $("#tier_gid").chosen({});

                $("#state_gid_chosen, #region_gid_chosen ,#country_gid_chosen,#cityclass_gid_chosen, #tier_gid_chosen").addClass("mychosen").css('width', '100%');

                $(function () {
                    $("#_Citycode").focus();
                });

                $("#_Citycode").focus();
                $("#_Citycode").keypress(function (event) {
                    return isSplAlphaNumeric(event, this);
                });
                $("#_Cityname").focus();
                $("#_Cityname").keypress(function (event) {
                    return isSplAlphaNumeric(event, this);
                });
                $("#_CityPincode").focus();
                $("#_CityPincode").keypress(function (event) {
                    return isSplAlphaNumeric(event, this);
                });
            });


            function checkstate() {
                if ($("#state_gid").val() == 0) {
                    CheckFieldsHeader();
                    $("#state_gid").removeClass('valid');
                    $("#state_gid").addClass('required');
                    CheckFieldsHeader();
                }
                else {
                    CheckFieldsHeader();
                    $("#state_gid").removeClass('required');
                    $("#state_gid").addClass('valid');
                    CheckFieldsHeader();
                }
            }
            function checkregion() {
                if ($("#region_gid").val() == 0) {
                    CheckFieldsHeader();
                    $("#region_gid").removeClass('valid');
                    $("#region_gid").addClass('required');
                    CheckFieldsHeader();
                }
                else {
                    CheckFieldsHeader();
                    $("#region_gid").removeClass('required');
                    $("#region_gid").addClass('valid');
                    CheckFieldsHeader();
                }
            }
            function checkcountry() {
                if ($("#country_gid").val() == 0) {
                    CheckFieldsHeader();
                    $("#country_gid").removeClass('valid');
                    $("#country_gid").addClass('required');
                    CheckFieldsHeader();
                }
                else {
                    CheckFieldsHeader();
                    $("#country_gid").removeClass('required');
                    $("#country_gid").addClass('valid');
                    CheckFieldsHeader();
                }
            }
            function checkcityclass() {
                if ($("#cityclass_gid").val() == 0) {
                    CheckFieldsHeader();
                    $("#cityclass_gid").removeClass('valid');
                    $("#cityclass_gid").addClass('required');
                    CheckFieldsHeader();
                }
                else {
                    CheckFieldsHeader();
                    $("#cityclass_gid").removeClass('required');
                    $("#cityclass_gid").addClass('valid');
                    CheckFieldsHeader();
                }
            }
            function checktier() {
                
                if ($("#tier_gid").val() == 0) {
                    CheckFieldsHeader();
                    $("#tier_gid").removeClass('valid');
                    $("#tier_gid").addClass('required');
                    CheckFieldsHeader();
                }
                else {
                    CheckFieldsHeader();
                    $("#tier_gid").removeClass('required');
                    $("#tier_gid").addClass('valid');
                    CheckFieldsHeader();
                }
            }


            $("#_Citycode").keyup(function () {
                var txtSupplierName = $("#_Citycode").val();
                if (txtSupplierName.trim() != "") {
                    $("#_Citycode").removeClass('required');
                    $("#_Citycode").addClass('valid');
                    CheckFieldsHeader();
                }
                else {
                    $("#_Citycode").removeClass('valid');
                    $("#_Citycode").addClass('required');
                    CheckFieldsHeader();
                }
            });
            $("#_Cityname").keyup(function () {
                var txtSupplierName = $("#_Cityname").val();
                if (txtSupplierName.trim() != "") {
                    $("#_Cityname").removeClass('required');
                    $("#_Cityname").addClass('valid');
                    CheckFieldsHeader();
                }
                else {
                    $("#_Cityname").removeClass('valid');
                    $("#_Cityname").addClass('required');
                    CheckFieldsHeader();
                }
            });
            $("#_CityPincode").keyup(function () {
                var txtSupplierName = $("#_CityPincode").val();
                if (txtSupplierName.trim() != "") {
                    $("#_CityPincode").removeClass('required');
                    $("#_CityPincode").addClass('valid');
                    CheckFieldsHeader();
                }
                else {
                    $("#_CityPincode").removeClass('valid');
                    $("#_CityPincode").addClass('required');
                    CheckFieldsHeader();
                }
            });
            function isNumberKey(evt) {
                var charCode = (evt.which) ? evt.which : event.keyCode
                if (charCode > 31 && (charCode < 48 || charCode > 57))
                    return false;
                return true;
            }
            $('#state_gid').change(function () {
               
                var ddlid = $(this).val();

                var expensen =
                    {
                        "city_gid": ddlid
                    };

                $.ajax({
                    url: '@Url.Action("City", "IEM_CITY")',

                    data: JSON.stringify(expensen),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',

                    success: function (data) {

                        $("#region_gid").empty();

                        if (data.length > 0) {


                            for (var i = 0; i < data.length; i++) {
                                $('#region_gid').attr('disabled', false);
                                $("#region_gid").append("<option value=" + data[i].regiongid + " >" + data[i].regionname + "</option>");
                            }

                            $("#region_gid").chosen({});
                            $("#region_gid_chosen").css("width", "100%");
                            $("#region_gid").trigger('chosen:updated');
                        }

                        if (data.length == 0) {
                            $("#region_gid").append("<option value='0' >--Select Exp Cat--</option>");
                            $('#region_gid').attr('disabled', true);
                            $("#region_gid").trigger('chosen:updated');
                        }
                        if (data.length == null) {
                            alert("3");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            });

            $('#state_gid').change(function () {

                var ddlid = $(this).val();

                var expensen =
                    {
                        "city_gid": ddlid
                    };

                $.ajax({
                    url: '@Url.Action("City1", "IEM_CITY")',

                    data: JSON.stringify(expensen),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',

                    success: function (data) {

                        $("#country_gid").empty();

                        if (data.length > 0) {

                            for (var i = 0; i < data.length; i++) {
                                $('#country_gid').attr('disabled', false);
                                $("#country_gid").append("<option value=" + data[i].regiongid + " >" + data[i].regionname + "</option>");
                            }

                            $("#country_gid").chosen({});
                            $("#country_gid_chosen").css("width", "100%");
                            $("#country_gid").trigger('chosen:updated');
                        }

                        if (data.length == 0) {
                            $("#country_gid").append("<option value='0' >--Select Exp Cat--</option>");
                            $('#country_gid').attr('disabled', true);
                            $("#country_gid").trigger('chosen:updated');
                        }
                        if (data.length == null) {
                           
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            });
            function SAVE() {
                var citycode = $("#_Citycode").val();

                var cityname = $("#_Cityname").val();

                var citypincode = $("#_CityPincode").val();


                var stategid = $("#state_gid").val();

                var regiongid = $("#region_gid").val();

                var countrygid = $("#country_gid").val();

                var cityclassgid = $("#cityclass_gid").val();

                var tiergid = $("#tier_gid").val();


                if (citycode == "") {
                    jAlert("Please Enter City Code.", "Information")
                    $("#_Citycode").focus();
                    return false;

                }
                if (cityname == "") {
                    jAlert("Please Enter City Name.", "Information")
                    $("#_Cityname").focus();
                    return false;

                }
                if (citypincode == "") {
                    jAlert("Please Enter City Pin Code", "Information")
                    $("#_CityPincode").focus();
                    return false;

                }
                if (stategid == 0) {
                    jAlert("Please Select State", "Information")
                    $("#state_gid").focus();
                    return false;

                }
                if (regiongid == 0) {
                    jAlert("Please Select Region.", "Information")
                    $("#region_gid").focus();
                    return false;

                }
                if (countrygid == 0) {
                    jAlert("Please Select Country.", "Information")
                    $("#country_gid").focus();
                    return false;

                }
                if (cityclassgid == 0) {
                    jAlert("Please Select City Class.", "Information")
                    $("#cityclass_gid").focus();
                    return false;

                }
                if (tiergid == 0) {
                    jAlert("Please Select Tier.", "Information")
                    $("#tier_gid").focus();
                    return false;

                }

                var CityModel = {
                    "city_code": citycode, "city_name": cityname, "city_pincode": citypincode,
                    "state_gid": stategid, "region_gid": regiongid, "country_gid": countrygid,
                    "cityclass_gid": cityclassgid, "tier_gid": tiergid
                };

                $.post('../IEM_CITY/CreateCity', CityModel,
                function (data) {
                    if (data != "success") {
                        jAlert(data);
                        return false;
                    }
                    else {
                        jAlert("Record Inserted Successfully !", "Information", function (r) {
                            if (r == true) {
                                //location = '../IEM_CITY/Index';
                                location = '@Url.Action("Index", "IEM_CITY")?' + new Date().getTime();
                            }
                        });

                    }
                }, 'json');

            }
            function GotoIndex()
            {
                window.parent.jQuery('#ForPartialView').dialog('close');
            }

            function CheckFieldsHeader() {

                var ErrCount = 0;
                if ($("#_Citycode").val().trim() == "" || $("#_Citycode").val() == null) {
                    ErrCount = 1;
                }
                if ($("#_Cityname").val().trim() == "" || $("#_Cityname").val() == null) {
                    ErrCount = 2;
                }
                if ($("#_CityPincode").val().trim() == "" || $("#_CityPincode").val() == null) {
                    ErrCount = 3;
                }
               // else if ($("#state_gid").val() == "--Select State--" || $("#state_gid").val() == 0) {
               //     ErrCount = 4;
               // }
               // else if ($("#region_gid").val() == "--Select Region--" || $("#region_gid").val() == 0) {
               //     ErrCount = 5;
               // }
               //else if ($("#country_gid").val() == "--Select Country--" || $("#country_gid").val() == 0) {
               //     ErrCount = 6;
               // }
               // else if ($("#cityclass_gid").val() == "--Select City Class--" || $("#cityclass_gid").val() == 0) {
               //     ErrCount = 7;
               // }
               // else if ($("#tier_gid").val() == "--Select Tier--" || $("#tier_gid").val() == 0) {
               //     ErrCount = 8;
               // }               
                if (ErrCount == 0) {
                    $("#_save").removeAttr('disabled');
                }
                else {
                    $("#_save").attr('disabled', 'disabled');
                }
            }

        </script>




