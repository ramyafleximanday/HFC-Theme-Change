@model IEM.Areas.MASTERS.Models.iem_mst_city

<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>
@{
    var viewfor = (string)ViewBag.viewfor;
    if (viewfor == "edit")
    {
        ViewBag.viewmode = "";
    }
    else if (viewfor == "view")
    {
        ViewBag.viewmode = "disabled";
    }
    else if (viewfor == "delete")
    {
        ViewBag.viewmode = "disabled";
        ViewBag.deletemode = "disabled";
    }

}


@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    
    <table class="myTableStyleTabNew" style="width:100%;">  
        <tr>
            <td colspan="2" style="width:50%; padding:0px 10px 0px 3px; display:none ;">
                <input name="DocNameID" id="_Citygid"  type="text" placeholder="DocName ID" data-val="true" value="@Model.city_gid" />

            </td>
        </tr>
       
        <tr>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span> City Code </span>
                    <br />
                <input name="DocNameeName" id="_citycode" @ViewBag.viewmode type="text" data-val="true"
                       maxlength="30" value="@Model.city_code" class="fstextbox valid"  />
              
            </td>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span> City Name </span>
                    <br />
                <input name="DocNameeName" id="_Cityname" @ViewBag.viewmode type="text" data-val="true"
                       maxlength="70" value="@Model.city_name" class="fstextbox valid" />
               
            </td>
        </tr>
       
        
        <tr>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span> City Pin Code </span>
                <br />
                <input name="DocNameeName" id="_citypincode" @ViewBag.viewmode type="text" maxlength="8" data-val="true"
                       value="@Model.city_pincode" onkeypress="return isNumberKey(event)" class="fstextbox valid" />

            </td>
            <td style="width:50%; padding:0px 10px 0px 3px;">
                    <span>State</span>
                    @*@Html.DropDownListFor(m => m.selectedstate_gid, Model.Getstate, Model.state_name, new { @class = "textboxStyle ", @style = "display: block", @id = "state_gid", @ViewBag.viewmode })*@
                <select name="depat_gid" id="state_gid" class="fstextbox  chosen-select" @ViewBag.viewmode>
                    <option value="0">Select</option>
                    @foreach (var pitem in Model.Getstate)
                    {
                        var childitemfilter = Model.Getstate.Where(m => m.Value == pitem.Value);
                        if (childitemfilter != null)
                        {
                            foreach (var citem in childitemfilter)
                            {
                                string selectedValueddel = "";
                                if (Model.selectedstate_gid.ToString() == citem.Value)
                                {
                                    selectedValueddel = "selected='selected'";
                                }
                                <option value="@citem.Value" @selectedValueddel>@citem.Text</option>
                            }
                        }
                    }
                </select>

            </td>
        </tr>
       
        <tr>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Region</span>
                @*@Html.DropDownListFor(m => m.selectedregion_gid, Model.Getregion, Model.region_name, new { @class = "textboxStyle ", @style = "display: block", @id = "region_gid", @ViewBag.viewmode })*@
                <select name="depat_gid" id="region_gid" class="fstextbox  chosen-select" @ViewBag.viewmode>
                    <option value="0">Select</option>
                    @foreach (var pitem in Model.Getregion)
                        {
                            var childitemfilter = Model.Getregion.Where(m => m.Value == pitem.Value);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in childitemfilter)
                                {
                                    string selectedValueddel = "";
                                    if (Model.selectedregion_gid.ToString() == citem.Value)
                                    {
                                        selectedValueddel = "selected='selected'";
                                    }
                        <option value="@citem.Value" @selectedValueddel>@citem.Text</option>
                                }
                            }
                        }
                </select>
            </td>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Country</span>
                @*@Html.DropDownListFor(m => m.selectedcountry_gid, Model.Getcountry, Model.country_name, new { @class = "textboxStyle ", @style = "display: block", @id = "country_gid", @ViewBag.viewmode })*@
                <select name="depat_gid" id="country_gid" class="fstextbox  chosen-select" @ViewBag.viewmode>
                    <option value="0">Select</option>
                    @foreach (var pitem in Model.Getcountry)
                        {
                            var childitemfilter = Model.Getcountry.Where(m => m.Value == pitem.Value);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in childitemfilter)
                                {
                                    string selectedValueddel = "";
                                    if (Model.selectedcountry_gid.ToString() == citem.Value)
                                    {
                                        selectedValueddel = "selected='selected'";
                                    }
                        <option value="@citem.Value" @selectedValueddel>@citem.Text</option>
                                }
                            }
                        }
                </select>

            </td>
        </tr>
     
        <tr>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>City Class</span>
                @*@Html.DropDownListFor(m => m.selectedcityclass_gid, Model.Getcityclass, Model.cityclass_name, new { @class = "textboxStyle ", @style = "display: block", @id = "cityclass_gid" })*@
                <select name="depat_gid" id="cityclass_gid" class="fstextbox  chosen-select" @ViewBag.viewmode>
                    <option value="0">Select</option>
                    @foreach (var pitem in Model.Getcityclass)
                        {
                            var childitemfilter = Model.Getcityclass.Where(m => m.Value == pitem.Value);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in childitemfilter)
                                {
                                    string selectedValueddel = "";
                                    if (Model.selectedcityclass_gid.ToString() == citem.Value)
                                    {
                                        selectedValueddel = "selected='selected'";
                                    }
                        <option value="@citem.Value" @selectedValueddel>@citem.Text</option>
                                }
                            }
                        }
                </select>

            </td>

            <td style="width:50%; padding:0px 10px 0px 3px;">
                <span>Tier</span>
                @*@Html.DropDownListFor(m => m.selectedtier_gid, Model.Gettier, Model.tier_name, new { @class = "textboxStyle ", @style = "display: block", @id = "tier_gid" })*@
                <select name="depat_gid" id="tier_gid" class="fstextbox  chosen-select" @ViewBag.viewmode>
                    <option value="0">Select</option>
                    @foreach (var pitem in Model.Gettier)
                        {
                            var childitemfilter = Model.Gettier.Where(m => m.Value == pitem.Value);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in childitemfilter)
                                {
                                    string selectedValueddel = "";
                                    if (Model.selectedtier_gid.ToString() == citem.Value)
                                    {
                                        selectedValueddel = "selected='selected'";
                                    }
                        <option value="@citem.Value" @selectedValueddel>@citem.Text</option>
                                }
                            }
                        }
                </select>

            </td>
        </tr>
        <tr>
            <td colspan="2" style="width:100%; padding:0px 10px 0px 3px; text-align:center ;">
             
                    @if (@ViewBag.viewmode == "")
                    {
                        <button type="button" id="_save" value="Save" class="btn btn-primary" onclick="Update()"
                                style="margin-top:10px;  color:white;">
                            <span class="glyphicon glyphicon-floppy-disk" style="color:white;font-size:12px;"></span> Save
                        </button>
                    }
                    @if (@ViewBag.deletemode == "disabled")
                    {
                        <button type="button" value="Delete" class="btn btn-danger" onclick="DeleteType()"
                                style="margin-top:10px;  color:white;">
                            <span style="color:white;font-size:12px;" class="glyphicon glyphicon-trash"></span> Delete
                        </button>
                    }
               
                    @if (@ViewBag.viewmode == "" || @ViewBag.deletemode == "disabled")
                    {
                        <button type="button" value="Cancel" class="btn btn-warning" onclick="goToIndex()"
                                style="margin-top:10px;  color:white;">
                            <span style="color:white;font-size:12px;" class="glyphicon glyphicon-remove-sign"></span> Cancel
                        </button>
                    }
                    else if (@ViewBag.viewmode == "disabled")
                    {
                        <button type="button" value="Cancel" class="btn btn-warning" onclick="goToIndex()"
                                style="margin-top:10px;  color:white;">
                            <span style="color:white;font-size:12px;" class="glyphicon glyphicon-remove-sign"></span> Close
                        </button>
                    }
            </td>
        </tr>
    </table>

}

<script type="text/javascript">
    $("#state_gid").chosen({});
    $("#region_gid").chosen({});
    $("#country_gid").chosen({});
    $("#cityclass_gid").chosen({});
    $("#tier_gid").chosen({});
    $("#state_gid_chosen, #region_gid_chosen ,#country_gid_chosen,#cityclass_gid_chosen, #tier_gid_chosen").addClass("mychosen").css('width', '100%');

    $(document).ready(function () {

        $("#_citycode").focus();
        $("#_citycode").keypress(function (event) {
            return isSplAlphaNumeric(event, this);
        });
        $("#_cityname").focus();
        $("#_cityname").keypress(function (event) {
            return isSplAlphaNumeric(event, this);
        });
        $("#_citypincode").focus();
        $("#_citypincode").keypress(function (event) {
            return isSplAlphaNumeric(event, this);
        });
    });


    $("#_citycode").keyup(function () {
        var txtSupplierName = $("#_citycode").val();
        if (txtSupplierName.trim() != "") {
            $("#_citycode").removeClass('required');
            $("#_citycode").addClass('valid');
            CheckFieldsHeader();
        }
        else {
            $("#_citycode").removeClass('valid');
            $("#_citycode").addClass('required');
            CheckFieldsHeader();
        }
    });
    $("#_cityname").keyup(function () {
        var txtSupplierName = $("#_cityname").val();
        if (txtSupplierName.trim() != "") {
            $("#_cityname").removeClass('required');
            $("#_cityname").addClass('valid');
            CheckFieldsHeader();
        }
        else {
            $("#_cityname").removeClass('valid');
            $("#_cityname").addClass('required');
            CheckFieldsHeader();
        }
    });
    $("#_citypincode").keyup(function () {
        var txtSupplierName = $("#_citypincode").val();
        if (txtSupplierName.trim() != "") {
            $("#_citypincode").removeClass('required');
            $("#_citypincode").addClass('valid');
            CheckFieldsHeader();
        }
        else {
            $("#_citypincode").removeClass('valid');
            $("#_citypincode").addClass('required');
            CheckFieldsHeader();
        }
    });
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }
    $('#state_gid').change(function () {

        var ddlid = $(this).val();

        var expensen =
            {
                "city_gid": ddlid
            };

        $.ajax({
            url: '@Url.Action("City", "IEM_CITY")',

            data: JSON.stringify(expensen),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {

                $("#region_gid").empty();

                if (data.length > 0) {


                    for (var i = 0; i < data.length; i++) {
                        $('#region_gid').attr('disabled', false);
                        $("#region_gid").append("<option value=" + data[i].regiongid + " >" + data[i].regionname + "</option>");
                    }
                    $('#region_gid_chosen').trigger('chosen:updated')
                }

                if (data.length == 0) {
                    $("#region_gid").append("<option value='0' >--Select Exp Cat--</option>");
                    $('#region_gid').attr('disabled', true);
                    $('#region_gid_chosen').trigger('chosen:updated')
                }
                if (data.length == null) {
                    alert("3");
                }
            },
            error: function (result) {
                alert("Error");
            }
        });
    });
    $('#state_gid').change(function () {

        var ddlid = $(this).val();

        var expensen =
            {
                "city_gid": ddlid
            };

        $.ajax({
            url: '@Url.Action("City1", "IEM_CITY")',

            data: JSON.stringify(expensen),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',

            success: function (data) {

                $("#country_gid").empty();

                if (data.length > 0) {


                    for (var i = 0; i < data.length; i++) {
                        $('#country_gid').attr('disabled', false);
                        $("#country_gid").append("<option value=" + data[i].regiongid + " >" + data[i].regionname + "</option>");
                    }
                    $('#country_gid_chosen').trigger('chosen:updated')
                }

                if (data.length == 0) {
                    $("#country_gid").append("<option value='0' >--Select Exp Cat--</option>");
                    $('#country_gid').attr('disabled', true);
                    $('#country_gid_chosen').trigger('chosen:updated')
                }
                if (data.length == null) {
                    alert("3");
                }
            },
            error: function (result) {
                alert("Error");
            }
        });
    });
    function Update() {

        var citycode = $("#_citycode").val();     
        var cityname = $("#_Cityname").val();      
        var citypincode = $("#_citypincode").val();      
        var citygid = $("#_Citygid").val();       

        var stategid = $("#state_gid").val();        
        var regiongid = $("#region_gid").val();        
        var countrygid = $("#country_gid").val();       
        var cityclassgid = $("#cityclass_gid").val();   
        var tiergid = $("#tier_gid").val();

        if (citycode == "") {
            jAlert("Please Enter City Code.", "Information")
            $("#_citycode").focus();
            return false;

        }
        if (cityname == "") {
            jAlert("Please Enter City Name.", "Information")
            $("#_Cityname").focus();
            return false;

        }
        if (citypincode == "") {
            jAlert("Please Enter City Pin Code", "Information")
            $("#_citypincode").focus();
            return false;

        }
        if (stategid == 0) {
            jAlert("Please Select State", "Information")
            $("#state_gid").focus();
            return false;

        }
        if (regiongid == 0) {
            jAlert("Please Select Region.", "Information")
            $("#region_gid").focus();
            return false;

        }
        if (countrygid == 0) {
            jAlert("Please Select Country.", "Information")
            $("#country_gid").focus();
            return false;

        }
        if (cityclassgid == 0) {
            jAlert("Please Select City Class.", "Information")
            $("#cityclass_gid").focus();
            return false;

        }
        if (tiergid == 0) {
            jAlert("Please Select Tier.", "Information")
            $("#tier_gid").focus();
            return false;

        }

            var City = {
                "city_gid": citygid, "city_code": citycode, "city_name": cityname,
                "city_pincode": citypincode, "selectedstate_gid": stategid, "selectedregion_gid": regiongid,
                "selectedcountry_gid": countrygid, "selectedcityclass_gid": cityclassgid, "selectedtier_gid": tiergid
            };
           
            $.post('../IEM_CITY/EditCity', City,
                 function (data) {                    
                     if (data == "success") {
                         jAlert("Record Updated Successfully !", "Information", function (r) {
                             if (r == true) {
                                 window.parent.jQuery('#ForPartialView').dialog('close');
                                 location = '../IEM_CITY/Index';
                             }
                         });
                     }
                     else
                     {
                         jAlert(data, "Information", function (r) {
                             if(r==true)
                             {
                                 return false;
                             }

                         });                        
                     }                      


                 }, 'json');
        
    }
    $(".ui-icon-closethick").click(function () {

        window.parent.jQuery('#ForPartialView').dialog('close');
        //$('#gridcity').find('tr').css('background', 'none');
    });
    function goToIndex() {

        window.parent.jQuery('#ForPartialView').dialog('close');
        //$('#gridcity').find('tr').css('background', 'none');
        window.parent.jQuery('#ForPartialView').dialog('close');
       // location.reload();
    }
    function DeleteType() {
        var citygid = $("#_Citygid").val();
        jConfirm("Do you want to delete this City ? ", "Delete City", function (j) {
            if (j == true) {
                var model = { "city_gid": citygid }
                $.post('../IEM_CITY/DeleteCity', model,
                     function (data) {
                         if (data == "Record deleted successfully !") {
                             jAlert("Record Deleted Successfully!!!", "Information", function (r) {
                                 window.parent.jQuery('#ForPartialView').dialog('close');
                                 if (r = true) { location = '../IEM_CITY/Index'; }
                             });
                         }
                         else {
                             jAlert("Can Not Delete this, Its Based On Some Other category ! ,", "Information", function (r) {
                                 if (r = true) { location = location.href; }
                             });

                         }
                     }, 'json');
            }
        });

    }

    function CheckFieldsHeader() {

        var ErrCount = 0;
        if ($("#_citycode").val().trim() == "" || $("#_citycode").val() == null) {
            ErrCount = 1;
        }
        if ($("#_Cityname").val().trim() == "" || $("#_Cityname").val() == null) {
            ErrCount = 2;
        }
        if ($("#_citypincode").val().trim() == "" || $("#_citypincode").val() == null) {
            ErrCount = 3;
        }
        if ($("#state_gid").val() == "" || $("#state_gid").val() == 0 || $("#state_gid").val() == null) {
            ErrCount = 4;
        }
        if ($("#region_gid").val() == "" || $("#region_gid").val() == 0 || $("#region_gid").val() == null) {
            ErrCount = 5;
        }
        if ($("#country_gid").val() == "" || $("#country_gid").val() == 0 || $("#country_gid").val() == null) {
            ErrCount = 6;
        }
        if ($("#cityclass_gid").val() == "" || $("#cityclass_gid").val() == 0 || $("#cityclass_gid").val() == null) {
            ErrCount = 7;
        }
        if ($("#tier_gid").val() == "" || $("#tier_gid").val() == 0 || $("#tier_gid").val() == null) {
            ErrCount = 8;
        }

        if (ErrCount == 0) {
            $("#_save").removeAttr('disabled');
        }
        else {
            $("#_save").attr('disabled', 'disabled');
        }
    }

</script>


