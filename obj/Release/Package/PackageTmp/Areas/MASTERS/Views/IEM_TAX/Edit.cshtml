@model IEM.Areas.MASTERS.Models.iem_mst_tax


<link href="@Url.Content("~/Content/RMchosen/chosen.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/RMScript/chosen.jquery.js")" type="text/javascript"></script>
@{
    var viewfor = (string)ViewBag.viewfor;
    if (viewfor == "edit")
    {
        ViewBag.viewmode = "";
    }
    else if (viewfor == "view")
    {
        ViewBag.viewmode = "disabled";
    }
    else if (viewfor == "Delete")
    {
        ViewBag.viewmode = "disabled";
    }
    if (@Model.tax_parent_flag == "Y")
    {
        ViewBag.yes1 = "checked";

    }
    else
    { ViewBag.no1 = "checked"; }
    if (@Model.tax_active == "Y")
    { ViewBag.yes = "checked"; }
    else
    { ViewBag.no = "checked"; }
    if (@Model.tax_withhold_flag == "Y")
    { ViewBag.yes2 = "checked"; }
    if (@Model.tax_payable_flag == "Y")
    { ViewBag.yes3 = "checked"; }
    if (@Model.tax_receivable_flag == "Y")
    { ViewBag.yes4 = "checked"; }
    if (@Model.tax_inputcredit_flag == "Y")
    { ViewBag.yes5 = "checked"; }
    if (@Model.tax_reverse_flag == "Y")
    { ViewBag.yes6 = "checked"; }


}
@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    <table class="myTableStyleTabNew" style="width:100%;">
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px; display:none ;">
                <input name="DocNameID" id="_Taxgid" type="text" placeholder="DocName ID" data-val="true" value="@Model.tax_gid" />

            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocNameName">
                    <span> Tax Code </span>
                    <br />
                    <input name="DocNameName" id="_Taxcode" @ViewBag.viewmode type="text" data-val="true" maxlength="30" 
                           value="@Model.tax_code" class="fstextbox  valid " style="display: block;" />
                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocNameName">
                    <span> Tax</span>
                    <br />
                    <input name="DocNameName" id="_Taxname" @ViewBag.viewmode type="text" data-val="true" maxlength="7"
                            value="@Model.tax_name" class="fstextbox  valid" style="display: block;" />
                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <span> Parent Flag</span>
                <br />
                <input type="radio" id="Yes" value="Y" checked="@ViewBag.yes1" name="Radiotypename1" @ViewBag.viewmode>
                Yes &nbsp;
                <input type="radio" id="No" value="N" checked="@ViewBag.no1" name="Radiotypename1" @ViewBag.viewmode>
                No
            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <div id="txtDocGrpName">
                    <span>Parent Tax</span>
                    @if (viewfor == "view")
                    {
                        @Html.DropDownListFor(e => e.tax_parent_name, Model.Gettax, "--Select Parent Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "tax_parent_name", @disabled = "disabled" })
                    }
                    @if (viewfor == "edit" && ViewBag.no1 == "checked")
                    {
                        @Html.DropDownListFor(e => e.tax_parent_name, Model.Gettax, "--Select Parent Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "tax_parent_name", @disabled = "disabled" })
                    }
                    @if (viewfor == "edit" && ViewBag.no1 != "checked")
                    {
                        @Html.DropDownListFor(e => e.tax_parent_name, Model.Gettax, "--Select Parent Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "tax_parent_name" })
                    }
                    @if (viewfor == "Delete")
                    {
                        @Html.DropDownListFor(e => e.tax_parent_name, Model.Gettax, "--Select Parent Tax--", new { @class = "fstextbox  chosen-select", @style = "display: block", @id = "tax_parent_name", @disabled = "disabled" })
                    }
                </div>
            </td>
        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <input type="checkbox" id="chk_withhold" value="Y" checked="@ViewBag.yes2" name="With Holding Tax" @ViewBag.viewmode><span> With Holding Tax</span>

            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <input type="checkbox" id="chk_payable" value="Y" checked="@ViewBag.yes3" name="checkboxename" @ViewBag.viewmode><span> Tax Payable</span>
            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <input type="checkbox" id="chk_receivable" value="Y" checked="@ViewBag.yes4" name="checkboxename" @ViewBag.viewmode><span> Tax Receivable</span>
            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <input type="checkbox" id="chk_inputcredit" value="Y" checked="@ViewBag.yes5" @ViewBag.viewmode name="checkboxename"><span> Input Credit</span>

            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <input type="checkbox" id="chk_reverse" value="Y" checked="@ViewBag.yes6" @ViewBag.viewmode name="checkboxename"><span> Reverse</span>

            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                <span> Active</span>
                <br />
                <input type="radio" id="Yes" value="Y" checked="@ViewBag.yes" name="Radiotypename" @ViewBag.viewmode>
                Yes &nbsp;
                <input type="radio" id="No" value="N" checked="@ViewBag.no" name="Radiotypename" @ViewBag.viewmode>
                No
            </td>

        </tr>
        <tr>
            <td style="width:100%; padding:0px 10px 0px 3px;">
                @*<input type="button" class="btn btn-primary" value="Save" onclick="update()" @ViewBag.viewmode />
            <input type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" />*@
                @if (viewfor == "view")
                {

                    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" style="margin-top:20px;"> 
                <span class="glyphicon glyphicon-remove" style="color:white; font-size:12px;"></span>Close</button>

                }
                @if (viewfor == "edit")
                {
                    <button type="button" class="btn btn-primary" id="btnsave" value="Save" onclick="update()" style="margin-top:20px;">
                        <span class="glyphicon glyphicon-floppy-save" style="color:white; font-size:12px;"></span>Save
                    </button>
    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" style="margin-top:20px;">
        <span style="color:white; font-size:12px;" class="glyphicon glyphicon-remove-sign"></span>Cancel
    </button>
                }
                @if (viewfor == "Delete")
                {
                    <button type="button" class="btn btn-danger" value="Delete" onclick="Delete()" style="margin-top:20px;">
                        <span class="glyphicon glyphicon-trash" style="color:white; font-size:12px;"></span>Delete
                    </button>
    <button type="button" class="btn btn-warning" value="Cancel" onclick="GotoIndex()" style="margin-top:20px;">
        <span style="color:white; font-size:12px;" class="glyphicon glyphicon-remove-sign"></span>Cancel
    </button>
                }
            </td>
        </tr>
    </table>
}
<script type="text/javascript">
    $(document).ready(function () {

        $("#tax_parent_name").chosen({});
        $("#tax_parent_name_chosen").addClass("mychosen").css('width', '100%');
        //if ($('input[name=Radiotypename1]:checked').val() == 'Y') {

        //    $('#tax_parent_name').attr('disabled', false);
        //}
        //else {
        //    $('#tax_parent_name').attr('disabled', true);
        //}

        $("#_Taxcode").keypress(function (event) {
            return isSplAlphaNumeric(event, this);
        });

        $("#_Taxname").keypress(function (event) {
            return isSplAlphaNumeric(event, this);
        });
    });
    $("#_Taxcode").keyup(function () {
        var taxcode = $("#_Taxcode").val();
        var taxname = $("#_Taxname").val();

        if (taxcode == "" || taxname == "") {
            $("#btnsave").attr("disabled", true);
        }
        else {
            $("#btnsave").removeAttr('disabled');
        }

        var txtSupplierName = $("#_Taxcode").val();
        if (txtSupplierName.trim() != "") {
            $("#_Taxcode").removeClass('required');
            $("#_Taxcode").addClass('valid');
        }
        else {
            $("#_Taxcode").removeClass('valid');
            $("#_Taxcode").addClass('required');
        }
    });
    $("#_Taxname").keyup(function () {
        var taxcode = $("#_Taxcode").val();
        var taxname = $("#_Taxname").val();

        if (taxcode == "" || taxname == "") {
            $("#btnsave").attr("disabled", true);
        }
        else {
            $("#btnsave").removeAttr('disabled');
        }

        var txtSupplierName = $("#_Taxname").val();
        if (txtSupplierName.trim() != "") {
            $("#_Taxname").removeClass('required');
            $("#_Taxname").addClass('valid');
        }
        else {
            $("#_Taxname").removeClass('valid');
            $("#_Taxname").addClass('required');
        }
    });
    $('input[name=Radiotypename1]').change(function () {

        if ($('input[name=Radiotypename1]:checked').val() == 'Y') {

            $('#tax_parent_name').attr('disabled', false);
        }
        else {
            $('#tax_parent_name').attr('disabled', true);
            // $("#tax_parent_name").empty();
            //$("#tax_parent_name").append("<option value='0' >--Select Parent Tax--</option>");
        }
    });
    function Delete() {
        var id = $("#_Taxgid").val();
        var taxModel = {
            "tax_gid": id
        };
        jConfirm("Do you want to delete this Tax ? ", "Delete Tax", function (j) {
            if (j == true) {
                $.post('../IEM_TAX/Delettax', taxModel,
                     function (data) {
                         if (data != "success") {
                             //jAlert("Record Deleted Successfully!!!", "Information", function (r) {
                             //    if (r = true) { location = '../AsmsDocumentGroup/Index'; }
                             //});
                             jAlert(data, "Information");
                             return false;
                         }
                         else {

                             window.parent.jQuery('#ForPartialView').dialog('close');
                             location = '../IEM_TAX/Index';

                         }
                     }, 'json');
            }
            else { return false; }
        });

    }
    function update() {
        var taxcode = $("#_Taxcode").val();
        var taxname = $("#_Taxname").val();
        var taxparentflag = $('input[name=Radiotypename1]:checked').val();
        var taxgid = $("#_Taxgid").val();
        if (taxparentflag == 'Y') {
            var taxparent = $("#tax_parent_name").val();
        }
        else {

            var taxparent = 0;
        }

        var avtive = $('input[name=Radiotypename]:checked').val();

        if ($('#chk_withhold').is(":checked") == true) {
            var taxwithhold = 'Y';
        }
        else {
            var taxwithhold = 'N';
        }

        if ($('#chk_payable').is(":checked") == true) {
            var payable = 'Y';
        }
        else {
            var payable = 'N';
        }

        if ($('#chk_receivable').is(":checked") == true) {
            var checkreceivable = 'Y';
        }
        else {
            var checkreceivable = 'N';
        }
        if ($('#chk_inputcredit').is(":checked") == true) {
            var checkinputcredit = 'Y';
        }
        else {
            var checkinputcredit = 'N';
        }
        if ($('#chk_reverse').is(":checked") == true) {
            var checkreverse = 'Y';
        }
        else {
            var checkreverse = 'N';
        }

        if (taxcode == "" || taxname == "") {
            alert(" TextCode & TextName Cannot Be Empty !");
            return false;
        }
        if (taxparentflag == 'Y') {
            if (taxparent == 0) {
                alert(" Parent Tax Required !");
                return false;
            }

        }
        if (taxcode != "" || taxname != "") {
            var taxModel = {
                "tax_code": taxcode, "tax_name": taxname, "tax_parent_flag": taxparentflag, "tax_gid": taxgid, "tax_parent_name1": taxparent,
                "tax_withhold_flag": taxwithhold, "tax_payable_flag": payable, "tax_receivable_flag": checkreceivable,
                "tax_inputcredit_flag": checkinputcredit, "tax_reverse_flag": checkreverse, "tax_active": avtive
            };

            $.post('../IEM_TAX/Edittax', taxModel,
                 function (data) {
                     //    jAlert('Record Updateted successfully !', "Information", function (r) {
                     //        if (r == true) {
                     //            location = '../IEM_TAX/Index';
                     //        }
                     //    });

                     //}
                     if (data == "success") {
                         jAlert("Record Updated Successfully!!!", "Information", function (r) {
                             if (r = true) {
                                 window.parent.jQuery('#ForPartialView').dialog('close'); location = '../IEM_TAX/Index';
                             }
                         });
                     }
                     else {
                         jAlert(data, "Information", function (r) {
                             if (r = true) {
                                 window.parent.jQuery('#ForPartialView').dialog('close'); location = '../IEM_TAX/Index';
                             }
                         });
                     }
                 }
            , 'json');
        }

    }
    function GotoIndex() {
        window.parent.jQuery('#ForPartialView').dialog('close');
    }
</script>