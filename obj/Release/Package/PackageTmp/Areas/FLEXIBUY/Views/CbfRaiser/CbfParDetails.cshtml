@model IEM.Areas.FLEXIBUY.Models.CbfSumEntity
@{
    var grid = new WebGrid(source: Model.cbfDetails, canPage: true, canSort: false, rowsPerPage: 10, ajaxUpdateContainerId: "grid2", ajaxUpdateCallback: "Dummycbf()");
    int rowNum = 0;
    int add2 = 0;

}
<style>
    cursor {
        cursor: pointer;
    }

    panelwidth {
        width: 100%;
    }

    .lblwth {
        width: 170px;
    }

    .txtwth {
        width: 150px;
    }
</style>
<script type="text/javascript">
    function calll(id) {

        var tr = $(this).parents('tr:first');
        var row = id;
      
        var pargid = $("#pargid").val();
        var productgroup = $("#ProductGroup" + row.trim() + "").val();
        var productgid = $("#ProductGid" + row.trim() + "").val();
        var productcode = $("#productcode" + row.trim() + "").val();
        var prodctname = $("#productname" + row.trim() + "").val();
        var description = $("#description" + row.trim() + "").val();
        var uom = $("#uom_" + row.trim() + "").val();
        var qty = $("#qty_" + row.trim() + "").val();
        var untiprize = $("#unitprize_" + row.trim() + "").val();
        var total = $("#total_" + row.trim() + "").val();
        var remarks = $("#remarks" + row.trim() + "").val();
        var chartofaccount = $("#chartofaccount" + row.trim() + "").val();
        var fccc = $("#fccc" + row.trim() + "").val();
        var budgetline = $("#inbudgetline_" + "fccc" + row.trim() + "").val();
        var attachment = $("#Attach" + row.trim() + "").val();       
        if (productgroup == null || productgroup == "" || productgroup == 0) {
            jAlert("Please Enter Product Group.", "Error");
            return false;
        }
        if (productcode == null || productcode == "") {
            jAlert("Please Enter Product Code.", "Error");
            return false;
        }

        if (prodctname == null || prodctname == "") {
            jAlert("Please Enter Product Name", "Error");
            return false;
        }
        if (description == null || description == "") {
            jAlert("Please Enter Description.", "Error");
            return false;
        }
        if (uom == null || uom == "" || uom == 0) {
            jAlert("Please Select uom", "Error");
            return false;
        }
        if (qty == null || qty == "") {
            jAlert("Please Enter Qty.", "Error");
            return false;
        }
        if (untiprize == null || untiprize == "") {
            jAlert("Please Enter Unit Amount.", "Error");
            return false;
        }

        if (total == null || total == "") {
            jAlert("Total Amount Should Not Be Null", "Error");
            return false;
        }
        var finalamt = 0;

        $("#grid2 tr").each(function () {
            var totalamt = $(this).find('[name=intotalnew]').val();
            if (isNaN(totalamt) == false) {
                finalamt = parseInt(totalamt) + parseInt(finalamt);
            }
            var totalamt1 = $(this).find('[name=intotal]').val();
            if (isNaN(totalamt1) == false) {
                finalamt = parseInt(totalamt1) + parseInt(finalamt);
            }
        });
        if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

            jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                $('#total_' + id + '').val("");
                $('#qty_' + id + '').val("");
                $('#unitprize_' + id + '').val("");
                return false;
            });
            return false;
        }

        if (remarks == null || remarks == "") {
            jAlert("Please Any Remarks.", "Error");
            return false;
        }
        if (chartofaccount == null || chartofaccount == "") {
            jAlert("Please Select Chart of Account in Product and Service Master", "Error");
            return false;
        }
        if (fccc == null || fccc == "" || fccc == 0) {
            jAlert("Please Select FCCC Code.", "Error");
            return false;
        }
        if (budgetline == null || budgetline == "") {
            jAlert("Please Enter Budject Line.", "Error");
            return false;
        }
        $("#cbf_amt").val(total);
        var UserModel =
           {
               "prdetailsGid": pargid,
               "productgroupid": productgroup,
               "productgid": productgid,
               "productcode": productcode,
               "productname": prodctname,
               "description": description,
               "uomGid": uom,
               "qty": qty,
               "unitAmt": untiprize,
               "total": total,
               "remarks": remarks,
               "chartofaccount": chartofaccount,
               "Fccc": fccc,
               "budgetline": budgetline
           };
        $.ajax({
            url: "../CbfRaiser/CbfParSave/",
            type: 'POST',
            data: UserModel,
            success: function (data) {
                if (data == 0) {
                    jAlert("Error Occured", "Error", function () {
                        return false;
                    });
                    return false;
                }
                else {
                    $("#cbfdetailsgridforpar").empty().append(data);
                    jAlert("Inserted Successfully", "Message");
                }
              
            },
            error: function () {
                jAlert("something seems wrong", "Error");
            }

        });
    }
    function cancel(element) {
        var flag = confirm('Are you sure to cancel');
        if (flag) {
            $(element).parents("tr").remove();
        }
    }
    var objDialog1;
    function getprogroup(id, title, value) {
        if (value != "Select") {
            $("#rowid").val(title);
            if (id != 0) {
                if ($("#ss").val() == "") {
                    $("#ss").val('asd');
                    objDialog1 = $("[id$='productserviewpopup']");
                    objDialog1.dialog({
                        autoOpen: false,
                        modal: true,
                        show: 'fade-in',
                        close: 'fade-out',
                        cache: false,
                        width: 800,
                        height: 700
                    });

                }
                var id1 = id.value;
                $("#prodgid").val(id1);
                objDialog1.load('../CbfRaiser/GetProductlist?lnid=' + id1);
                objDialog1.dialog({ title: 'Product List' });
                objDialog1.dialog("open");
            }
        }

    }

    $(function () {
        $('.add').on('click', function () {
            
            var pargid = $(this).val();
            $('#pargid').val(pargid);
            var existrow = $('.save-btn1').length;
            //   debugger
            if (existrow == 0) {
                var index = $("#grid tbody tr").length + 1;
                var productgroup = "ProductGroup" + index;
                var productgid = "ProductGid" + index;
                var productcode = "productcode" + index;
                var productname = "productname" + index;
                var description = "description" + index;
                var uom = "uom_" + index;
                var qty = "qty_" + index;
                var unitprize = "unitprize_" + index;
                var total = "total_" + index;
                var remarks = "remarks" + index;
                var chartofaccount = "chartofaccount" + index;
                var FCCC = "fccc" + index;
                var budgetline = "inbudgetline_" + "fccc" + index;
                var attach = "Attach_" + "1";
                var Save = "Save_" + index;
                var Cancel = "Cancel_" + index;
                $.ajax({
                    url: '../CbfRaiser/GetProductGroup/',
                    data: '{}',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#" + productgroup + "").empty();
                        $("#" + productgroup + "").append("<option value='0' >Select</option>");
                        for (var i = 0; i < data.length; i++) {
                            $("#" + productgroup + "").append("<option value=" + data[i].productGroupId + " >" + data[i].productGroupIdName + "</option>");

                        }
                    },
                    error: function (result) {
                        jAlert("Something Wrong");
                    }

                });
                $.ajax({
                    url: '../CbfRaiser/GetUom/',
                    data: '{}',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        if (data == 0) {
                            jAlert("Error Occured", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        else {
                            $("#" + uom + "").empty();
                            $("#" + uom + "").append("<option value='0' >Select</option>");
                            for (var i = 0; i < data.length; i++) {
                                $("#" + uom + "").append("<option value=" + data[i].uomGid + " >" + data[i].uomCode + "</option>");
                            }
                        }
                       
                    },
                    error: function (result) {
                        jAlert("Something Wrong", "Error");
                    }

                });

            //    var newRow = '<tr class="alternate-row"><td><span></span></td><td><span> <select id="' + productgroup + '" title="' + index + '" class="textboxStyleBig" name="txtstatus" onchange="getprogroup(this,title,value)"  style="display:block;">' + '<option value="select">select</option>' + '</select></span></td>' +
            //         '<td style="MidColumn20;display:none;"><span> <input id="' + productgid + '"  class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
            //        '<td style="MidColumn20"><span> <input id="' + productcode + '"  class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
            //          '<td style="MidColumn20"><span> <input id="' + productname + '"   class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
            //          '<td style="MidColumn20"><span> <input id="' + description + '"   class="textboxStyleBig" type="text" /></span></td>' +
            //          '<td style="MidColumn20"><span> <select id="' + uom + '"  class="textboxStyleBig" name="ddluom"  style="display:block">' + '<option value="select">select</option>' + '</select></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + qty + '"  class="textboxStyleBig" type="text"  onkeypress="return isNumber1(event, this);"  onkeyup="multi(this)"/></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + unitprize + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  onkeyup="multi1(this)" type="text"/></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + total + '"  class="textboxStyleBig" readonly="readonly" onkeypress="return isNumber1(event, this);" name="intotalnew" type="text"/></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + remarks + '"   class="textboxStyleBig" maxlength="256" type="text"/></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + chartofaccount + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  type="text"/></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + FCCC + '"  class="textboxStyleBig" onchange="change(id,value)" onkeypress="return isNumber1(event, this);" type="text"/></span><span class="glyphicon glyphicon-search edit searchpop" id="' + FCCC + '" onclick="NewSearch(id)"></span></td>' +
            //          '<td style="MidColumn20"><span><input id="' + budgetline + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);" type="text"/></span></td> ' +
            //          '<td style="MidColumn20"><span> <input type="button" value="Attach BOQ" class="btn btn-link" onclick="Newboq1(id)"  id="' + attach + '" title="BOQ" /></span></td>' +
            //          '<td style="MidColumn20"><a class="edit save-btn1" id="' + index + '" onclick="calll(id)" ><span class="glyphicon glyphicon-floppy-save " style="cursor:pointer;" title="Save"></span> </a><b class="edit cancel-btn" id="' + index + '" onclick="cancel(this)" > <span class="glyphicon glyphicon-remove edit cancel-btn"  style="cursor:pointer;" title="Cancel"></b></td>' +

                //'</tr>';
                var newRow = '<tr class="alternate-row overflowx"><td class="parsl"><span></span></td><td class="parproductgroup"><span> <select id="' + productgroup + '" title="' + index + '" class="textboxStyleBig" name="txtstatus" onchange="getprogroup(this,title,value)"  style="display:block;">' + '<option value="select">select</option>' + '</select></span></td>' +
                     '<td style="MidColumn20;display:none;"><span> <input id="' + productgid + '"  class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
                    '<td class="parproductCode"><span> <input id="' + productcode + '"  class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
                          '<td class="parproductName"><span> <input id="' + productname + '"   class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
                          '<td class="parDescription"><span> <input id="' + description + '"   class="textboxStyleBig"  type="text" /></span></td>' +
                          '<td class="parProductUOM"><span> <select id="' + uom + '"  class="textboxStyleBig" name="ddluom"  style="display:block">' + '<option value="select">select</option>' + '</select></span></td>' +
                          '<td class="parQTY"><span><input id="' + qty + '"  class="textboxStyleBig" type="text"  onkeypress="return isNumber1(event, this);"  onkeyup="multi(this)"/></span></td>' +
                          '<td class="parunitAmt"><span><input id="' + unitprize + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  onkeyup="multi1(this)" type="text"/></span></td>' +
                          '<td class="parTotal"><span><input id="' + total + '"  class="textboxStyleBig" readonly="readonly" onkeypress="return isNumber1(event, this);" name="intotalnew" type="text"/></span></td>' +
                          '<td class="parRemarks"><span><input id="' + remarks + '"   class="textboxStyleBig" maxlength="256" type="text"/></span></td>' +
                          '<td class="parchartofaccount"><span><input id="' + chartofaccount + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  type="text"/></span></td>' +
                          '<td class="parFCCC"><span><input id="' + FCCC + '"  class="textboxStyleBig" onchange="change(id,value)" onkeypress="return isNumber1(event, this);" type="text"/></span><span class="glyphicon glyphicon-search edit searchpop"  id="' + FCCC + '" onclick="NewSearch(id)"></span></td>' +
                          '<td class="parbudgetline"><span><input id="' + budgetline + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);" type="text"/></span></td> ' +
                          '<td class="parBOQ"><span> <input type="button" value="Attach BOQ" class="btn btn-link" style="padding: 3px;" onclick="Newboq1(this)"  id="' + attach + '" title="BOQ" /></span></td>' +
                          '<td class="parAct"><a class="edit save-btn1" id="' + index + '" onclick="calll(id)" ><span class="glyphicon glyphicon-floppy-save " style="cursor:pointer;" title="Save"></span> </a><b class="edit cancel-btn" id="' + index + '" onclick="cancel(this)" > <span class="glyphicon glyphicon-remove edit cancel-btn"  style="cursor:pointer;" title="Cancel"></b></td>' +

                '</tr>';
                $("#grid2 tbody").append(newRow);
                $('#btnSave').removeAttr('disabled');
            }
            else {
                jAlert("First Save Your Pervious record", "Message");
            }
        });


        $('.edit ').hide();
        $('.edit-btn, .cancel-btn').on('click', function () {
          
            var tr = $(this).parents('tr:first');
            tr.find('.edit, .display').toggle();

        });
        $('.delete-btn').on('click', function () {
            var tr = $(this).parents('tr:first');
            var row = $(this).text();
            var deleteval =
                {
                    "attch_Gid": row
                }
            $.ajax({
                url: "../CbfRaiser/CbfDeletePar/",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(deleteval),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#cbfdetailsgridforpar").empty().append(data);
                    }
                    

                },
                error: function () {
                    jAlert("something seems wrong", "Error");
                }

            });
        })
        $('.save-btn').on('click', function () {
           
            var tr = $(this).parents('tr:first');
            var row = $(this).text();
          
            var productgroup = $("#productgroup_" + row.trim() + "").val();
            var productcode = $("#txtproductcode_" + row.trim() + "").val();
            var prodctname = $("#txtproductname_" + row.trim() + "").val();
            var description = $("#txtdescription_" + row.trim() + "").val();
            var uom = tr.find("#uomddl_" + row.trim() + "").val();
            var qty = tr.find("#inqty_" + row.trim() + "").val();
            var unit = tr.find("#inunit_" + row.trim() + "").val();
            var total = tr.find("#intotal_" + row.trim() + "").val();
            var remark = tr.find("#inremarks").val();

            var charttoaccount = tr.find("#inchartofaccount_" + row.trim() + "").val();

            var Fccc = tr.find("#infcccgetpoup_" + row.trim() + "").val();
          //  var budgetline = tr.find("#inbudgetline_" + row.trim() + "").val();
            var budgetline = "1";
         
            if (productgroup == null || productgroup == "" || productgroup == 0) {
                jAlert("Please Enter Product Group.", "Error");
                return false;
            }
            if (productcode == null || productcode == "") {
                jAlert("Please Enter Product Code.", "Error");
                return false;
            }

            if (prodctname == null || prodctname == "") {
                jAlert("Please Enter Product Name", "Error");
                return false;
            }
            if (description == null || description == "") {
                jAlert("Please Enter Description.", "Error");
                return false;
            }
            if (qty == null || qty == "") {
                jAlert("Please Enter Qty.", "Error");
                return false;
            }
            if (unit == null || unit == "") {
                jAlert("Please Enter Unit Amount.", "Error");
                return false;
            }

            if (total == null || total == "") {
                jAlert("Total Amount Should Not Be Null", "Error");
                return false;
            }
            var finalamt = 0;

            $("#grid2 tr").each(function () {
                var totalamt = $(this).find('[name=intotalnew]').val();
                if (isNaN(totalamt) == false) {
                    finalamt = parseInt(totalamt) + parseInt(finalamt);
                }
                var totalamt1 = $(this).find('[name=intotal]').val();
                if (isNaN(totalamt1) == false) {
                    finalamt = parseInt(totalamt1) + parseInt(finalamt);
                }
            });
            if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

                jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                    $('#total_' + id + '').val("");
                    $('#qty_' + id + '').val("");
                    $('#unitprize_' + id + '').val("");
                    return false;
                });
                return false;
            }

            if (remark == null || remark == "") {
                jAlert("Please Any Remarks.", "Error");
                return false;
            }
            if (charttoaccount == null || charttoaccount == "") {
                jAlert("Please Select Chart of Account in Product and Service Master", "Error");
                return false;
            }
            if (Fccc == null || Fccc == "" || Fccc == 0) {
                jAlert("Please Select FCCC Code.", "Error");
                return false;
            }
            if (budgetline == null || budgetline == "") {
                jAlert("Please Enter Budject Line.", "Error");
                return false;
            }

            $('.edit').hide();
            var UserModel =
            {
                //"prdetails_gid": pargid,
                "productgroupid": productgroup,
                "productcode": productcode,
                "productname": prodctname,
                "description": description,
                "unchecked12": row,
                "uomGid": uom,
                "qty": qty,
                "unitAmt": unit,
                "total": total,
                "remarks": remark,
                "chartofaccount": charttoaccount,
                "Fccc": Fccc,
                "budgetline": budgetline


            };

            $.ajax({
                url: "../CbfRaiser/CbfParSave/",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(UserModel),
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#cbfdetailsgridforpar").empty().append(data);
                    }
                   
                },
                error: function () {
                    jAlert("something seems wrong", "Error");
                }

            });

        });
    });
    function Dummycbf() {
        function calll(id) {
            
            var tr = $(this).parents('tr:first');
            var row = id;
            var pargid = $("#pargid").val();
            var productgroup = $("#ProductGroup" + row.trim() + "").val();
            var productcode = $("#productcode" + row.trim() + "").val();
            var prodctname = $("#productname" + row.trim() + "").val();
            var description = $("#description" + row.trim() + "").val();
            var uom = $("#uom_" + row.trim() + "").val();
            var qty = $("#qty_" + row.trim() + "").val();
            var untiprize = $("#unitprize_" + row.trim() + "").val();
            var total = $("#total_" + row.trim() + "").val();
            var remarks = $("#remarks" + row.trim() + "").val();
            var chartofaccount = $("#chartofaccount" + row.trim() + "").val();
            var fccc = $("#fccc" + row.trim() + "").val();
            var budgetline = $("#inbudgetline_" + "fccc" + row.trim() + "").val();
            var attachment = $("#Attach" + row.trim() + "").val();

            if (productgroup == null || productgroup == "" || productgroup == 0) {
                jAlert("Please Enter Product Group.", "Error");
                return false;
            }
            if (productcode == null || productcode == "") {
                jAlert("Please Enter Product Code.", "Error");
                return false;
            }

            if (prodctname == null || prodctname == "") {
                jAlert("Please Enter Product Name", "Error");
                return false;
            }
            if (description == null || description == "") {
                jAlert("Please Enter Description.", "Error");
                return false;
            }
            if (uom == null || uom == "" || uom == 0) {
                jAlert("Please Select uom", "Error");
                return false;
            }
            if (qty == null || qty == "") {
                jAlert("Please Enter Qty.", "Error");
                return false;
            }
            if (untiprize == null || untiprize == "") {
                jAlert("Please Enter Unit Amount.", "Error");
                return false;
            }

            if (total == null || total == "") {
                jAlert("Total Amount Should Not Be Null", "Error");
                return false;
            }
            var finalamt = 0;

            $("#grid2 tr").each(function () {
                var totalamt = $(this).find('[name=intotalnew]').val();
                if (isNaN(totalamt) == false) {
                    finalamt = parseInt(totalamt) + parseInt(finalamt);
                }
                var totalamt1 = $(this).find('[name=intotal]').val();
                if (isNaN(totalamt1) == false) {
                    finalamt = parseInt(totalamt1) + parseInt(finalamt);
                }
            });
            if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

                jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                    $('#total_' + id + '').val("");
                    $('#qty_' + id + '').val("");
                    $('#unitprize_' + id + '').val("");
                    return false;
                });
                return false;
            }

            if (remarks == null || remarks == "") {
                jAlert("Please Any Remarks.", "Error");
                return false;
            }
            if (chartofaccount == null || chartofaccount == "") {
                jAlert("Please Select Chart of Account in Product and Service Master", "Error");
                return false;
            }
            if (fccc == null || fccc == "" || fccc == 0) {
                jAlert("Please Select FCCC Code.", "Error");
                return false;
            }
            if (budgetline == null || budgetline == "") {
                jAlert("Please Enter Budject Line.", "Error");
                return false;
            }
            $("#cbf_amt").val(total);
            var UserModel =
               {
                   "prdetailsGid": pargid,
                   "productgroupid": productgroup,
                   "productcode": productcode,
                   "productname": prodctname,
                   "description": description,
                   "uomgid": uom,
                   "qty": qty,
                   "unitAmt": untiprize,
                   "total": total,
                   "remarks": remarks,
                   "chartofaccount": chartofaccount,
                   "Fccc": fccc,
                   "budgetline": budgetline
               };
            $.ajax({
                url: "../CbfRaiser/CbfParSave/",
                type: 'POST',
                data: UserModel,
                success: function (data) {
                    if (data == 0) {
                        jAlert("Error Occured", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    else {
                        $("#cbfdetailsgridforpar").empty().append(data);
                        jAlert("Inserted Successfully", "Message");
                    }
                    
                },
                error: function () {
                    jAlert("something seems wrong", "Error");
                }

            });
        }
        function cancel(element) {
            var flag = confirm('Are you sure to cancel');
            if (flag) {
                $(element).parents("tr").remove();
            }
        }
        var objDialog1;
        function getprogroup(id, title, value) {
            if (value != "Select") {
                $("#rowid").val(title);
                if (id != 0) {
                    if ($("#ss").val() == "") {
                        $("#ss").val('asd');
                        objDialog1 = $("[id$='productserviewpopup']");
                        objDialog1.dialog({
                            autoOpen: false,
                            modal: true,
                            show: 'fade-in',
                            close: 'fade-out',
                            cache: false,
                            width: 600,
                            height: 400
                        });

                    }
                    var id1 = id.value;

                    objDialog1.load('../CbfRaiser/GetProductlist?lnid=' + id1);
                    objDialog1.dialog({ title: 'Product List' });
                    objDialog1.dialog("open");
                }
            }

        }

        $(function () {
            $('.add').on('click', function () {
              
                var pargid = $(this).val();
                $('#pargid').val(pargid);
                var existrow = $('.save-btn1').length;
                debugger
                if (existrow == 0) {
                    var index = $("#grid tbody tr").length + 1;
                    var productgroup = "ProductGroup" + index;
                    var productcode = "productcode" + index;
                    var productname = "productname" + index;
                    var description = "description" + index;
                    var uom = "uom_" + index;
                    var qty = "qty_" + index;
                    var unitprize = "unitprize_" + index;
                    var total = "total_" + index;
                    var remarks = "remarks" + index;
                    var chartofaccount = "chartofaccount" + index;
                    var FCCC = "fccc" + index;
                    var budgetline = "inbudgetline_" + FCCC;
                    var attach = "Attach_" + "1";
                    var Save = "Save_" + index;
                    var Cancel = "Cancel_" + index;
                    $.ajax({
                        url: '../CbfRaiser/GetProductGroup/',
                        data: '{}',
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            if (data == 0) {
                                jAlert("Error Occured", "Error", function () {
                                    return false;
                                });
                                return false;
                            }
                            else {
                                $("#" + productgroup + "").empty();
                                $("#" + productgroup + "").append("<option value='Select' >Select</option>");
                                for (var i = 0; i < data.length; i++) {
                                    $("#" + productgroup + "").append("<option value=" + data[i].productGroupId + " >" + data[i].productGroupIdName + "</option>");

                                }
                            }
                           
                        },
                        error: function (result) {
                            jAlert("Something Wrong");
                        }

                    });
                    $.ajax({
                        url: '../CbfRaiser/GetUom/',
                        data: '{}',
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            if (data == 0) {
                                jAlert("Error Occured", "Error", function () {
                                    return false;
                                });
                                return false;
                            }
                            else {
                                $("#" + uom + "").empty();
                                $("#" + uom + "").append("<option value='Select' >Select</option>");
                                for (var i = 0; i < data.length; i++) {
                                    $("#" + uom + "").append("<option value=" + data[i].uomGid + " >" + data[i].uomCode + "</option>");
                                }
                            }
                            
                        },
                        error: function (result) {
                            jAlert("Something Wrong", "Error");
                        }

                    });                    

                    var newRow = '<tr class="alternate-row overflowx"><td class="parsl"><span></span></td><td class="parproductgroup"><span> <select id="' + productgroup + '" title="' + index + '" class="textboxStyleBig" name="txtstatus" onchange="getprogroup(this,title,value)"  style="display:block;">' + '<option value="select">select</option>' + '</select></span></td>' +
                        '<td class="parproductCode"><span> <input id="' + productcode + '"  class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
                          '<td class="parproductName"><span> <input id="' + productname + '"   class="textboxStyleBig" readonly="readonly" type="text" /></span></td>' +
                          '<td class="parDescription"><span> <input id="' + description + '"   class="textboxStyleBig"  type="text" /></span></td>' +
                          '<td class="parProductUOM"><span> <select id="' + uom + '"  class="textboxStyleBig" name="ddluom"  style="display:block">' + '<option value="select">select</option>' + '</select></span></td>' +
                          '<td class="parQTY"><span><input id="' + qty + '"  class="textboxStyleBig" type="text"  onkeypress="return isNumber1(event, this);"  onkeyup="multi(this)"/></span></td>' +
                          '<td class="parunitAmt"><span><input id="' + unitprize + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  onkeyup="multi1(this)" type="text"/></span></td>' +
                          '<td class="parTotal"><span><input id="' + total + '"  class="textboxStyleBig" readonly="readonly" onkeypress="return isNumber1(event, this);" name="intotalnew" type="text"/></span></td>' +
                          '<td class="parRemarks"><span><input id="' + remarks + '"   class="textboxStyleBig" maxlength="256" type="text"/></span></td>' +
                          '<td class="parchartofaccount"><span><input id="' + chartofaccount + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);"  type="text"/></span></td>' +
                          '<td class="parFCCC"><span><input id="' + FCCC + '"  class="textboxStyleBig" onchange="change(id,value)" onkeypress="return isNumber1(event, this);" type="text"/></span><span class="glyphicon glyphicon-search edit searchpop"  id="' + FCCC + '" onclick="NewSearch(id)"></span></td>' +
                          '<td class="parbudgetline"><span><input id="' + budgetline + '"  class="textboxStyleBig" onkeypress="return isNumber1(event, this);" type="text"/></span></td> ' +
                          '<td class="parBOQ"><span> <input type="button" value="Attach BOQ" class="btn btn-link" style="padding: 3px;" onclick="Newboq1(this)"  id="' + attach + '" title="BOQ" /></span></td>' +
                          '<td class="parAct"><a class="edit save-btn1" id="' + index + '" onclick="calll(id)" ><span class="glyphicon glyphicon-floppy-save " style="cursor:pointer;" title="Save"></span> </a><b class="edit cancel-btn" id="' + index + '" onclick="cancel(this)" > <span class="glyphicon glyphicon-remove edit cancel-btn"  style="cursor:pointer;" title="Cancel"></b></td>' +

                '</tr>';

                    $("#grid2 tbody").append(newRow);
                    $('#btnSave').removeAttr('disabled');
                }
                else {
                    jAlert("First Save Your Pervious record", "Message");
                }
            });


            $('.edit ').hide();
            $('.edit-btn, .cancel-btn').on('click', function () {
                var tr = $(this).parents('tr:first');
                tr.find('.edit, .display').toggle();

            });
            $('.delete-btn').on('click', function () {
                var tr = $(this).parents('tr:first');
                var row = $(this).text();
                var deleteval =
                    {
                        "attch_Gid": row
                    }
                $.ajax({
                    url: "../CbfRaiser/CbfDeletePar/",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(deleteval),
                    success: function (data) {
                        if (data == 0) {
                            jAlert("Error Occured", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        else {
                            $("#cbfdetailsgridforpar").empty().append(data);
                        }

                    },
                    error: function () {
                        jAlert("something seems wrong", "Error");
                    }

                });
            })
            $('.save-btn').on('click', function () {
             
                var tr = $(this).parents('tr:first');
                var row = $(this).text();
                var productgroup = $("#productgroup_" + row.trim() + "").val();
                var productcode = $("#txtproductcode_" + row.trim() + "").val();
                var prodctname = $("#txtproductname_" + row.trim() + "").val();
                var description = $("#txtdescription_" + row.trim() + "").val();
                var uom = tr.find("#uomddl_" + row.trim() + "").val();
                var qty = tr.find("#inqty_" + row.trim() + "").val();
                var unit = tr.find("#inunit_" + row.trim() + "").val();
                var total = tr.find("#intotal_" + row.trim() + "").val();
                var remark = tr.find("#inremarks").val();

                var charttoaccount = tr.find("#inchartofaccount_" + row.trim() + "").val();
                var Fccc = tr.find("#infcccgetpoup_" + row.trim() + "").val();
                var budgetline = tr.find("#inbudgetline_" + "fccc" + row.trim() + "").val();
              
                
                if (productgroup == null || productgroup == "" || productgroup == 0) {
                    jAlert("Please Enter Product Group.", "Error");
                    return false;
                }
                if (productcode == null || productcode == "") {
                    jAlert("Please Enter Product Code.", "Error");
                    return false;
                }

                if (prodctname == null || prodctname == "") {
                    jAlert("Please Enter Product Name", "Error");
                    return false;
                }
                if (description == null || description == "") {
                    jAlert("Please Enter Description.", "Error");
                    return false;
                }
                if (qty == null || qty == "") {
                    jAlert("Please Enter Qty.", "Error");
                    return false;
                }
                if (unit == null || unit == "") {
                    jAlert("Please Enter Unit Amount.", "Error");
                    return false;
                }

                if (total == null || total == "") {
                    jAlert("Total Amount Should Not Be Null", "Error");
                    return false;
                }
                var finalamt = 0;

                $("#grid2 tr").each(function () {
                    var totalamt = $(this).find('[name=intotalnew]').val();
                    if (isNaN(totalamt) == false) {
                        finalamt = parseInt(totalamt) + parseInt(finalamt);
                    }
                    var totalamt1 = $(this).find('[name=intotal]').val();
                    if (isNaN(totalamt1) == false) {
                        finalamt = parseInt(totalamt1) + parseInt(finalamt);
                    }
                });
                if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

                    jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                        $('#total_' + id + '').val("");
                        $('#qty_' + id + '').val("");
                        $('#unitprize_' + id + '').val("");
                        return false;
                    });
                    return false;
                }

                if (remark == null || remark == "") {
                    jAlert("Please Any Remarks.", "Error");
                    return false;
                }
                if (charttoaccount == null || charttoaccount == "") {
                    jAlert("Please Select Chart of Account in Product and Service Master", "Error");
                    return false;
                }
                if (Fccc == null || Fccc == "" || Fccc == 0) {
                    jAlert("Please Select FCCC Code.", "Error");
                    return false;
                }
                if (budgetline == null || budgetline == "") {
                    jAlert("Please Enter Budject Line.", "Error");
                    return false;
                }

                $('.edit').hide();
                var UserModel =
                {
                    //"prdetails_gid": pargid,
                    "productgroupid": productgroup,
                    "productcode": productcode,
                    "productname": prodctname,
                    "description": description,
                    "unchecked12": row,
                    "uomGid": uom,
                    "qty": qty,
                    "unitAmt": unit,
                    "total": total,
                    "remarks": remark,
                    "chartofaccount": charttoaccount,
                    "Fccc": Fccc,
                    "budgetline": budgetline


                };

                $.ajax({
                    url: "../CbfRaiser/CbfParSave/",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(UserModel),
                    success: function (data) {
                        if (data == 0) {
                            jAlert("Error Occured", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        else {
                            $("#cbfdetailsgridforpar").empty().append(data);
                        }
                    },
                    error: function () {
                        jAlert("something seems wrong", "Error");
                    }

                });

            });
        });
    }

</script>

<style>
    
</style>
<fieldset>
    <input type="hidden" hidden="hidden" id="pargid">
    <table width="100%">
        <tr>
            <td style="width:50%;">
                <legend style="margin-left:20px; border:0px;">CBF Details</legend>
            </td>
            <td style="width:50%; text-align:right; padding-right:20px;">
                <button class="btn btn-primary add"
                        type="button"
                        name="command"
                        value="@Session["pardetails_gid"]"
                        id="addnewrows"
                        style="font-size:12px; padding:5px 10px;">
                    Add CBF Details
                </button>
            </td>
        </tr>
    </table>
    <div id="cbfdetails">
        @functions{
            public static string sorter(string columnname, string columnheader, WebGrid grid)
            {
                return string.Format("{0} {1}", columnheader, grid.SortColumn == columnname ?
                    grid.SortDirection == SortDirection.Ascending ? "▲" : "▼" : string.Empty);
            }
        }
        
        <div id="grid_details1" style="min-height:100px; max-height:150px; width:100%; overflow-y:auto; padding:5px 10px;">
            <div style="width:100%; overflow-x:auto;">
                <div style="width:100%; overflow-x:auto;">
                    @grid.GetHtml(
                         tableStyle: "tableSmall table-bordered table-hover table-responsive myTab",
                mode: WebGridPagerModes.All,
                htmlAttributes: new { id = "grid2" },
                columns: grid.Columns(
                                  grid.Column("Sl", format: a => rowNum = rowNum + 1, style: "parsl"),
                         grid.Column("productgroup", sorter("productgroup", "Product Group", grid), style: "parproductgroup", format: @<text>
                    <select name="productgroup1" id="productgroup_@item.attch_Gid" disabled="disabled" title="@item.attch_Gid" onchange="getprogroup(this,title,value)" class="textboxStyleBig edit">
                        <option value="0">Select</option>

                        @{
                            var childitemfilter = Model.productGroupList.Where(m => m.Value == @item.productGroupId);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in Model.productGroupList)
                                {
                                    string selectedValue = "";
                                    if (@item.productGroupId == Convert.ToInt32(citem.Value))
                                    {
                                        selectedValue = "selected='selected'";
                                    }
                                    <option value="@citem.Value" @selectedValue>@citem.Text</option>
                                }
                            }
                        }

                    </select>
                    <select name="productgroup1" id="productgroup1" disabled="disabled" class="textboxStyleBig display">
                        <option value="0">Select</option>

                        @{
                            var childitemfilter1 = Model.productGroupList.Where(m => m.Value == @item.productGroupId);
                            if (childitemfilter1 != null)
                            {
                                foreach (var citem in Model.productGroupList)
                                {
                                    string selectedValue = "";
                                    if (@item.productGroupId == Convert.ToInt32(citem.Value))
                                    {
                                        selectedValue = "selected='selected'";
                                    }
                                    <option value="@citem.Value" @selectedValue>@citem.Text</option>
                                }
                            }
                        }

                    </select></text>),
                grid.Column("productgid",format: @<text><span class="display"><label id="lblproductgid">@item.productgid</label></span><input type="text" disabled="disabled" id="txtproductgid_@item.attch_Gid" value="@item.productgid" title="@item.productgid" class="edit textboxStyleBig" /> </text>),
                     grid.Column("productCode", sorter("productCode", "Product Code", grid), style: "parproductCode", format: @<text><span class="display"><label id="lblproductcode">@item.productCode</label></span><input type="text" disabled="disabled" id="txtproductcode_@item.attch_Gid" value="@item.productCode" title="@item.productCode" class="edit textboxStyleBig" /> </text>),
                          grid.Column("productName", sorter("productName", "Product Name", grid), style: "parproductName", format: @<text><span class="display"><label id="lblproductname">@item.productName</label></span><input type="text" disabled="disabled" id="txtproductname_@item.attch_gid" value="@item.productName" class="edit textboxStyleBig" title="@item.productName" /></text>),
                               grid.Column("description", sorter("description", "Product Description", grid), style: "parDescription", format: @<text><span class="display"><label id="lbldescription">@item.description</label></span><input type="text" id="txtdescription_@item.attch_gid" value="@item.description" class="edit textboxStyleBig" title="@item.description" /></text>),
                                    grid.Column("uom", sorter("uom", "UOM ", grid), style: "parProductUOM", format: @<text>
                    <select name="ddluom" id="uomddl_@item.attch_Gid" class="edit textboxStyleBig">
                        <option value="0">Select</option>

                        @{
                            var childitemfilter12 = Model.uomList.Where(m => m.Value == @item.uomGid);
                            if (childitemfilter12 != null)
                            {
                                foreach (var citem in Model.uomList)
                                {
                                    string selectedValue = "";
                                    if (Convert.ToInt32(@item.uomGid) == Convert.ToInt32(citem.Value))
                                    {
                                        selectedValue = "selected='selected'";
                                    }

                                    <option value="@citem.Value" @selectedValue>@citem.Text</option>
                                }
                            }
                        }

                    </select>
                        <select name="ddluom" id="uomddl" disabled="disabled" class="textboxStyleBig display">
                            <option value="0">Select</option>

                            @{
                            var childitemfilter = Model.uomList.Where(m => m.Value == @item.uomGid);
                            if (childitemfilter != null)
                            {
                                foreach (var citem in Model.uomList)
                                {
                                    string selectedValue = "";
                                    if (Convert.ToInt32(@item.uomGid) == Convert.ToInt32(citem.Value))
                                    {
                                        selectedValue = "selected='selected'";
                                    }

                                    <option value="@citem.Value" @selectedValue>@citem.Text</option>
                                }
                            }
                            }

                        </select>

                </text>),
                                 grid.Column("qty", sorter("qty", "QTY", grid), style: "parQTY", format: @<text>  <span class="display"><label id="lblqty">@item.qty</label></span><input type="text" title="@item.qty" id="inqty_@item.attch_gid" name="inqty" class="edit textboxStyleBig" onkeypress="return isNumber1(event, this);" value="@item.qty" href="@item.attch_gid" onkeyup="multInputs(title,value,this)" /> </text> ),
                                                            grid.Column("unitAmt", sorter("unitAmt", "Unit Amount", grid), style: "parunitAmt rightAlign", format: @<text>  <span class="display"><label id="lblunit">@item.unitAmt</label></span> <input type="text" id="inunit_@item.attch_gid" name="inunit" onclick="multInputs1(id, value)" onkeypress="return isNumber1(event, this);" href="@item.attch_gid" value="@item.unitAmt" class="edit textboxStyleBig" /> </text>),
                                                                 grid.Column("total", sorter("total", "Total", grid), style: "parTotal rightAlign", format: @<text>  <span class="display "><label id="lbltotal">@item.total</label> </span> <input type="text" id="intotal_@item.attch_gid" name="intotal" readonly="readonly" href="@item.attch_gid" onkeypress="return isNumber1(event, this);" value="@item.total" class="edit textboxStyleBig" /> </text>),
                     grid.Column("remarks", sorter("remarks", "Remarks", grid), style: "parRemarks", format: @<text>  <span class="display"><label id="lblremarks">@item.remarks</label> </span><input type="text" maxlenth="264" id="inremarks" value="@item.remarks" class="edit textboxStyleBig" />  </text>),
                     grid.Column("chartofaccount", sorter("chartofaccount", "Chart Of Account", grid), style: "parchartofaccount", format: @<text>  <span class="display"><label id="lblchartofaccount">@item.chartOfAccount</label> </span> <input type="text" disabled="disabled" id="inchartofaccount_@item.attch_gid" value="@item.chartOfAccount" onkeypress="return isNumber1(event, this);" readonly="readonly" class="edit textboxStyleBig" /> </text>),
                          grid.Column("Fccc", sorter("Fccc", "FCCC", grid), style: "parFCCC", format: @<text>  <span class="display"><label id="lblfccc">@item.fccc</label> </span><input type="text" id="infcccgetpoup_@item.attch_gid" onkeypress="return isNumber1(event, this);" onchange="change(id,value)" value="@item.fccc" class="edit textboxStyleBig" /><span class="glyphicon glyphicon-search edit searchpop pntrStyle" id="@item.attch_gid" onclick="NewSearch(id)"></span> </text>),
                               grid.Column("budgetline", sorter("budgetline", "Budget line", grid), style: "parbudgetline", format: @<text>  <span class="display"><label id="inbudgetline_@item.attch_gid">@item.budgetLine</label> </span><input type="text" id="inbudgetline_@item.attch_gid" value="@item.budgetLine" onkeypress="return isNumber1(event, this);" class="edit textboxStyleBig" />  </text>),
                                    grid.Column(header: "BOQ", canSort: false, style: "parBOQ",
                format: @<text>
                    <input type="button" value="Attach BOQ" class="btn btn-link" onclick="Newboq1(this)" id="@item.att_identify" title="BOQ" />
                </text>),
                grid.Column(header: "Action", canSort: false, style: "parAct",
                format: @<text>
                    @*<span class="glyphicon glyphicon-floppy-open  display-mode add-btn"><label id="sdf34" hidden="hidden"> @rowNum</label></span>*@
                    <span class='glyphicon glyphicon-floppy-save edit save-btn' style="cursor:pointer;" title="Save"> <label id="sdf34" hidden="hidden">@item.attch_gid</label></span>
                    <span class='glyphicon glyphicon-edit display edit-btn cursor' style="cursor:pointer;" title="Edit"><label id="sdf67" hidden="hidden"> @item.attch_gid</label> </span>
                    <span class='glyphicon glyphicon-trash display delete-btn cursor' style="cursor:pointer;" title="Delete"><label id="sdf8989" hidden="hidden"> @item.attch_gid</label> </span>
                    <span class='glyphicon glyphicon-remove edit cancel-btn cursor' style="cursor:pointer;" title="Cancel"> <label id="sdf000-" hidden="hidden">@item.attch_gid</label></span>

                </text>)))
                    @if (ViewBag.records != null)
                {  <div align="center" class="borderStyle">
                        <h6 class="row" style="font-weight:normal ;">
                            @ViewBag.records
                        </h6>
                    </div>
                }
                </div>
            </div>
        </div>

        <div style="float:right;margin-right:15px;">
            <span>Page: @(grid.PageIndex + 1) of @grid.PageCount</span>  <span> - Total No Of Records:@Model.cbfDetails.Count</span>
        </div>
        <label id="para1" style="margin-left:10px;"></label>
        <p id="add" style="display:none"></p>
        <input type="hidden" id="rowid" />
        <input type="hidden" id="prodgid">
    </div>
</fieldset>

@*}*@
<div id="productserviewpopup"></div>
<div id="forficcnew"></div>
<script>

    $('.search').click(function () {
    });
    var objDialogforficc;
    function change(id, value) {
        var lsFccc = $('#' + id + '').val()

        $.post('../CbfRaiser/fcccsearchtext?lsFccc=' + lsFccc,
              function (data) {
                  if (data == "") {
                      jAlert("Fccc Code Mismatch,Please Enter Correct Correct Fccc Code", "Error");
                      $('#' + id + '').val(data)
                  }
                  else {
                      $('#' + id + '').val(data)
                  }

              }
         , 'json');

    }
    function NewSearch(id) {

        if ($('#hidden').val() == "") {
            $('#hidden').val(id);
            objDialogforficc = $("[id$='forficcnew']");
            objDialogforficc.dialog({
                autoOpen: false,
                modal: true,
                cache: false,
                async: false,
                show: 'fade-in',
                close: 'fade-out',
                width: 1000,
                height: 500
            });
        }
        objDialogforficc.load('../CbfRaiser/CreateSearch?id=' + id + '&' + new Date().getTime());
        objDialogforficc.dialog({ title: 'Select FCCC Code' });
        objDialogforficc.dialog("open");

    }
    function Newboq1(element) {
        var row = $(element).closest('tr');
        var id = row.find('td:eq(0)').text();
        if (id == null || id == "" || isNaN(id)) {
            if (parseInt($("#grid2 tbody tr").length) > 0) {
                var tempid = parseInt($("#grid2 tbody tr").length);
                id = tempid.toString();
            }
        }
        objDialogforboq.load('../CbfRaiser/CBFAttachmentIndex?rowum=' + id + '&viewtype=edit&' + new Date().getTime());
        objDialogforboq.dialog({ title: 'Select BOQ Attachment' });
        objDialogforboq.dialog("open");
    }

    $(document).ready(function () {
        $("#grid2 td:nth-child(3),#grid2 th:nth-child(3)").hide();
        var add = 0;
        if ('@grid.TotalRowCount' > 0) {
            $('#Request').attr("disabled", true);
            $('#id_rdpr').attr("disabled", true);
            $('#id_rdpar').attr("disabled", true);
        }
        else {
            $('#Request').attr("disabled", false);
            $('#id_rdpr').attr("disabled", false);
            $('#id_rdpar').attr("disabled", false);
        }
        $("#inbudgetline").keypress(function (event) {
            return isNumber1(event, this);

        });
        $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
            add += Number($(this).val());
        });
        $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
            add += Number($(this).val());

        });
        $("#para1").text("Grand Total : " + add);
        getadd(add);


    });
    var dat = 0;
    var value1 = 0;
    function multInputs(title, value, element) {
        var id1 = $(element).attr('href');
        $('#intotal_' + id1 + '').val(value * $('#inunit_' + id1 + '').val());

        //if (parseInt($('#intotal_' + id1 + '').val()) > parseInt($('#parcostestimation12').val())) {
        //    jAlert("Amount Should Not Exists", "Error");

        //}
        var finalamt = 0;

        $("#grid2 tr").each(function () {
            var totalamt = $(this).find('[name=intotalnew]').val();
            if (isNaN(totalamt) == false) {
                finalamt = parseInt(totalamt) + parseInt(finalamt);
            }
            var totalamt1 = $(this).find('[name=intotal]').val();
            if (isNaN(totalamt1) == false) {
                finalamt = parseInt(totalamt1) + parseInt(finalamt);
            }
        });
        if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

            jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                $('#total_' + id + '').val("");
                $('#qty_' + id + '').val("");
                $('#unitprize_' + id + '').val("");
                return false;
            });
            return false;
        }

        else {
            var add = 0;
            $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
                add += Number($(this).val());
            });
            $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
                add += Number($(this).val());

            });
            $("#para1").text("Grand Total : " + add);
            getadd(add);

        }

    }
    function multi(element) {
        var add = 0;
        var str = $(element).attr("id").split("_");

        var id = str[1];
        $('#total_' + id + '').val($('#qty_' + id + '').val() * $('#unitprize_' + id + '').val());

        //if (parseInt($('#total_' + id + '').val()) > parseInt($('#parcostestimation12').val())) {
        //    $('#total_' + id + '').val("");
        //    $('#qty_' + id + '').val("");
        //    $('#unitprize_' + id + '').val("");
        //    jAlert("Amount Should Not Exists", "Error");
        //}
        var finalamt = 0;

        $("#grid2 tr").each(function () {
            var totalamt = $(this).find('[name=intotalnew]').val();
            if (isNaN(totalamt) == false) {
                finalamt = parseInt(totalamt) + parseInt(finalamt);
            }
            var totalamt1 = $(this).find('[name=intotal]').val();
            if (isNaN(totalamt1) == false) {
                finalamt = parseInt(totalamt1) + parseInt(finalamt);
            }
        });
        if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

            jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                $('#total_' + id + '').val("");
                $('#qty_' + id + '').val("");
                $('#unitprize_' + id + '').val("");
                return false;
            });
            return false;
        }

        else {
            var add = 0;
            $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
                add += Number($(this).val());
            });
            $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
                add += Number($(this).val());

            });
            $("#para1").text("Grand Total : " + add);
            getadd(add);

        }
        $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
            add += Number($(this).val());

        });
        $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
            add += Number($(this).val());

        });
        $("#para1").text("Grand Total : " + add);
        getadd(add);
    }
    function multi1(element) {

        var add = 0;
        var str = $(element).attr("id").split("_");
        var id = str[1];
        $('#total_' + id + '').val($('#qty_' + id + '').val() * $('#unitprize_' + id + '').val());

        //if (parseInt($('#total_' + id + '').val()) > parseInt($('#parcostestimation12').val())) {
        //    $('#total_' + id + '').val("");
        //    $('#qty_' + id + '').val("");
        //    $('#unitprize_' + id + '').val("");
        //    jAlert("Amount Should Not Exists", "Error");
        //}
        var finalamt = 0;

        $("#grid2 tr").each(function () {
            var totalamt = $(this).find('[name=intotalnew]').val();
            if (isNaN(totalamt) == false) {
                finalamt = parseInt(totalamt) + parseInt(finalamt);
            }
            var totalamt1 = $(this).find('[name=intotal]').val();
            if (isNaN(totalamt1) == false) {
                finalamt = parseInt(totalamt1) + parseInt(finalamt);
            }
        });
        if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

            jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                $('#total_' + id + '').val("");
                $('#qty_' + id + '').val("");
                $('#unitprize_' + id + '').val("");
                return false;
            });
            return false;
        }

        else {
            $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
                add += Number($(this).val());

            });
            $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
                add += Number($(this).val());
            });
            $("#para1").text("Grand Total : " + add);
            getadd(add);
        }
    }
    function multInputs1(id, value) {
        $("#grid2 td").find("input[name=inunit]:text").each(function () {
            var variable = "inunit_"
            var id2 = $(this).attr('href')
            var mult = 0;
            var total = 0;
            var value2 = value;

            $("#inunit_" + id2 + "").keypress(function (event1) {
                return isNumber1(event1, this);
            });
            if (id == variable + id2) {

                $("#inunit_" + id2 + "").keyup(function () {
                    $('#intotal_' + id2 + '').val($('#inqty_' + id2 + '').val() * $('#inunit_' + id2 + '').val());

                    //if (parseInt($('#intotal_' + id1 + '')).val() > parseInt($('#parcostestimation12').val())) {
                    //    jAlert("Amount Should Not Exists", "Error");
                    //}
                    var finalamt = 0;

                    $("#grid2 tr").each(function () {
                        var totalamt = $(this).find('[name=intotalnew]').val();
                        if (isNaN(totalamt) == false) {
                            finalamt = parseInt(totalamt) + parseInt(finalamt);
                        }
                        var totalamt1 = $(this).find('[name=intotal]').val();
                        if (isNaN(totalamt1) == false) {
                            finalamt = parseInt(totalamt1) + parseInt(finalamt);
                        }
                    });
                    if (parseInt(finalamt) > parseInt($('#parcostestimation12').val())) {

                        jAlert("Amount Should not Exceed PAR Value", "Error", function () {
                            $('#total_' + id + '').val("");
                            $('#qty_' + id + '').val("");
                            $('#unitprize_' + id + '').val("");
                            return false;
                        });
                        return false;
                    }

                    else {
                        var add = 0;
                        $("#grid2 td").find("input[name=intotal]:text").each(function add1() {
                            add += Number($(this).val());
                        });
                        $("#grid2 td").find("input[name=intotalnew]:text").each(function add1() {
                            add += Number($(this).val());

                        });
                        $("#para1").text("Grand Total : " + add);
                        getadd(add);
                    }
                });
            }
        });
    }


    function getadd(valu) {
        $("#cbf_amt").val(valu);
    }




</script>
