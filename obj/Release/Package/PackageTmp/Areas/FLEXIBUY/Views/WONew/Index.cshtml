@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/Rmax_Site.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/angular.min.js")" type="text/javascript"></script>
<script src="~/Scripts/asms/ui-bootstrap-tpls-0.11.0.js"></script>
<style>
    .btnStyleNew {
        font-weight: bold;
    }

    .resizenone {
        resize: none;
    }

    .selected {
        background-color: maroon;
        color: white;
        font-weight: bold;
    }

    .bs-example {
        font-family: sans-serif;
        position: relative;
        margin: 100px;
    }

    .ui-autocomplete {
        position: absolute;
        z-index: 1000;
        top: 0;
        left: 0;
        cursor: default;
        background-color: #fff;
        padding: 3px;
        border: 1px solid #ccc;
    }

        .ui-autocomplete > li.ui-state-focus {
            background-color: #FF6C00;
        }

    .typeahead, .tt-query, .tt-hint {
        border: 2px solid #CCCCCC;
        border-radius: 8px;
        font-size: 24px;
        height: 30px;
        line-height: 30px;
        outline: medium none;
        padding: 8px 12px;
        width: 396px;
    }

    .typeahead {
        background-color: #FFFFFF;
    }

        .typeahead:focus {
            border: 2px solid #0097CF;
        }

    .tt-query {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.075) inset;
    }

    .tt-hint {
        color: #999999;
    }

    .tt-dropdown-menu {
        background-color: #FFFFFF;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        margin-top: 12px;
        padding: 8px 0;
        width: 422px;
    }

    .tt-suggestion {
        font-size: 24px;
        line-height: 24px;
        padding: 3px 20px;
    }

        .tt-suggestion.tt-is-under-cursor {
            background-color: #0097CF;
            color: #FFFFFF;
        }

        .tt-suggestion p {
            margin: 0;
        }
</style>

<span class="pageHeading">Raising WO</span>
<div ng-app="WONewapp">

    <br />
    <div class="well" ng-controller="wonewController" id="tabs" ng-init="WODetailQty = 0;WODetailUnitAmount = 0;WOGid=0" style="padding-bottom:50px;">
        <ul>
            <li><a href="#divWOHeader">WO Header</a></li>
            <li><a href="#divAttachmentMain">Attachments</a></li>
            <li><a href="#divWOTerms">Terms & Conditions</a></li>
            <li ng-hide="@ViewBag.viewtype =='0'"><a href="#divWOAudit">Audit Trail</a></li>
        </ul>
        <div id="divWOHeader">
            <div style="width:100%;">
                <fieldset style="padding:10px;background-color:white">
                    <legend>
                        <b style="text-align:left;"><span style="color: rgb(52, 108, 196);padding-top:20px;">WO Header</span></b>
                        <span class="pageHeading" style="font-size:13px; float:right; height:20px; margin:0px !important;">WO Version: <span id="txtVersion">0</span></span>
                    </legend>
                    <div>
                        <div>
                            <input type="hidden" name="txtWOHeaderGid" value="{{::WOGid}}" />
                            <input type="hidden" name="txtProdServiceFlag" value="{{::WOProdServiceFlag}}" />
                            <input type="hidden" id="txtCbfDetailsGid" value="@ViewBag.cbfdetailsgid" />
                            <input type="hidden" id="hdncbfamount" value="{{::CbfTotalAmount}}" />
                            <input type="hidden" id="hdnIsGSTExist" value="{{::IsGSTExist}}" />
                            <input type="hidden" id="hIdWodetailId" />
                            <table class="myTableStyleTabNew" style="width:100%;" ng-disabled="@ViewBag.viewtype =='1'">
                                <tr>
                                    <td style="width:15%;" align="center">
                                        <span>WO Ref Number</span>
                                        <br />
                                        <input type="text" id="txtPORefNo" class="textboxStyle" disabled="disabled" value="{{WORefNumber}}">
                                    </td>
                                    <td style="width:8%;">
                                        <span>WO Date</span>
                                        <br />
                                        <input type="text" id="txtPODate" class="textboxStyle" disabled="disabled" value="{{::WODate}}">
                                    </td>
                                    <td style="width:20%;">
                                        <span>Raised By</span>
                                        <br />
                                        <input type="text" class="textboxStyle" disabled="disabled" value="{{::WORaiserName}}">
                                    </td>
                                    <td style="width:27%;">
                                        <span>Vendor Name</span>
                                        <br />
                                        <input type="hidden" name="txtWOVendorGid" value="{{WOVendorGid}}" />
                                        <input type="hidden" name="txtVendorNameCustomGid">
                                        <input type="text" ng-disabled="@ViewBag.viewtype =='1'" class="textboxStyle100" id="ddlVendorNameWO" value="{{WOVendorName}}">
                                    </td>
                                    <td style="width:27%;">
                                        <span>Vendor Code</span>
                                        <br />
                                        <input type="text" class="textboxStyle" disabled="disabled" id="txtwovendorcode" value="{{WOVendorCode}}">
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:15%;" align="center">
                                        <span>Request For</span>
                                        <br />
                                        <input type="hidden" name="txtRequestForGid" value="{{::WORequestForGid}}">
                                        <input type="text" class="textboxStyle" disabled="disabled" value="{{::WORequestFor}}">
                                    </td>
                                    <td style="width:20%;vertical-align:bottom;">
                                        <span></span>
                                        <br />
                                        <input type="radio" ng-disabled="WORequestFor=='PIP'" ng-model="WOITType" value="A">
                                        Application
                                        &nbsp;
                                        <input type="radio" ng-disabled="WORequestFor=='PIP'" ng-model="WOITType" value="I">
                                        Infrastructure
                                    </td>
                                    <td style="width:20%;" colspan="1">
                                        <span>Description(Vendor Note)</span>
                                        <br />
                                        @*length fixed by selva*@
                                        <input type="text" ng-disabled="@ViewBag.viewtype =='1'" maxlength="255" class="textboxStyle100" ng-model="WODescription">
                                    </td>
                                    <td style="width:20%;" colspan="1">
                                        <span>Vendor Address</span>
                                        <br />
                                        <select id="TxtVendorAddress" style="min-width:100%;max-width:100%;" ng-disabled="@ViewBag.viewtype =='1'" class="textboxStyle100"></select>
                                    </td>
                                    <td style="width:27%;">
                                        <span>PAN No</span>
                                        <br />
                                        <input type="text" class="textboxStyle" id="txtwopanno" disabled="disabled" value="{{WOPanno}}">
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </fieldset>
            </div>
            <br />
            <div style="width:100%;">

                <div style="width:100%;" ng-hide="@ViewBag.viewtype =='1'">
                    <table>
                        <tr>
                            <td>
                                <label id="Lblmaxtotal" style="font-size:12px;
                                   padding-left:5px;"
                                       class="label label-danger">
                                    Maximum Utilizable Amount : {{AvailableAmount}}
                                </label>

                                <input type="hidden" id="TxtAvil" />
                                <input type="hidden" id="TxtCurrentBal" />
                                &nbsp;
                            </td>
                            @*<td>
                                    <label style="font-size:12px;
                                           padding-left:5px;"
                                           class="label label-danger">
                                        OBF Qty :  {{::CBFQuantity}}
                                    </label>
                                    &nbsp;
                                </td>*@
                            <td>
                                <label id="Lblutlamount" style="font-size:12px;
                                   padding-left:5px;"
                                       class="label label-danger">
                                    Utilized Amount : {{WOUtilAmount}}
                                </label>


                            </td>
                        </tr>
                    </table>
                    @*<input type="button" style="float:right;" ng-click="AddWOParentDetails()" class="btn btn-sm btn-primary btnStyleNew" value="Add WO details" />*@
                </div>
                <br />
                <div>
                    Search : &nbsp;&nbsp;  <input ng-model="searchwo.$" class="textboxStyle" placeholder="Enter Search Criteria..." style="width:20%;margin-bottom:5px;" />
                    <br />
                    <div style="width:100%;">

                        <table class="tableSmall table-bordered table-hover table-responsive">
                            <thead>
                                <tr>
                                    <th style="width:3%;">
                                        S.No
                                    </th>
                                    <th style="width:7%;">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Code</span> <span ng-hide="WOProdServiceFlag =='P'">Service Code</span>
                                    </th>
                                    <th style="width:15%;" ng-click="predicate = 'WODetailProductName'; reverse=!reverse">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Name</span> <span ng-hide="WOProdServiceFlag =='P'">Service Name</span>
                                    </th>
                                    <th style="width:20%;" ng-click="predicate = 'WODetailProductDescription'; reverse=!reverse">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Description</span> <span ng-hide="WOProdServiceFlag =='P'">Service Description</span>
                                    </th>
                                    <th style="width:10%">
                                        Service Month
                                    </th>
                                    <th style="width:5%">
                                        Qty
                                    </th>
                                    <th style="width:9%;">
                                        UOM
                                    </th>
                                    <th style="width:9%;">
                                        Unit Amount
                                    </th>
                                    <th style="width:8%">
                                        Tax Amount
                                    </th>
                                    <th style="width:9%;">
                                        Total Amount
                                    </th>
                                    <th style="width:20%; min-width:100px; ">
                                        Description
                                    </th>
                                    <th style="width:30%;">Special Actions</th>
                                    <th style="width:30%;min-width:100px;"> Add GST</th>
                                    <th style="width:20%;min-width:100px;" ng-hide="@ViewBag.viewtype =='1'">Action</th>
                                </tr>
                            </thead>
                            @*<tbody ng-show="filteredItemsWO > 0" ng-repeat="woparentdetail in woparentdetails | filter:searchwo:strict | orderBy:predicate:reverse | Pagestart:(currentPage-1)*PerPageItems | limitTo:PerPageItems" ng-class="{'selected':$index == selectedRow}" ng-click="setClickedRow($index)">*@
                            <tbody ng-show="filteredItemsWO > 0" ng-repeat="woparentdetail in woparentdetails | filter:searchwo:strict | orderBy:predicate:reverse | Pagestart:(currentPage-1)*PerPageItems | limitTo:PerPageItems">
                                <tr>
                                    <td style="width:3%;" align="center">
                                        {{$index+1}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailProductCode}}
                                    </td>
                                    <td style="width:15%;">
                                        {{woparentdetail.WODetailProductName}}
                                    </td>
                                    <td style="width:20%;">
                                        {{woparentdetail.WODetailProductDescription}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailServiceMonth}}
                                    </td>
                                    <td style="width:5%;">
                                        {{woparentdetail.WODetailQty}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailUOM}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailUnitAmount}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailTaxAmount}}
                                    </td>
                                    <td style="width:10%;">
                                        {{woparentdetail.WODetailTotalAmount}}
                                    </td>
                                    <td style="width:20%; min-width:200px;">
                                        {{woparentdetail.WODetailDescription}}
                                    </td>
                                    <td style="width:30%;min-width:100px;" align="center">
                                        <a ng-click="ShipmentWOParent(woparentdetail.WODetailGid)" title="Shipment">
                                            <span class="glyphicon glyphicon-transfer"></span>
                                        </a>
                                        &nbsp;&nbsp;
                                        <a ng-click="SplitWO(woparentdetail.WODetailGid,woparentdetail.WODetailQty)" title="Split">
                                            <span class="glyphicon glyphicon-random"></span>
                                        </a>
                                        @*<a ng-click="AddWOChildDetails()" title="Split">
                                                <span class="glyphicon glyphicon-random"></span>
                                            </a>*@
                                    </td>
                                    <td align="center">
                                        <input type="radio" ng-model="woparentdetail.ChkLstId" ng-value="1" ng-click="GetCheckId(woparentdetail.WODetailGid,woparentdetail.ChkLstId)" ng-disabled="@ViewBag.viewtype =='1'" />Yes @*value="woparentdetail.ChkLstId"*@
                                        <input type="radio" ng-model="woparentdetail.ChkLstId" ng-value="0" ng-click="GetCheckId(woparentdetail.WODetailGid,woparentdetail.ChkLstId)" ng-disabled="@ViewBag.viewtype =='1'" />No
                                        <a style="cursor:pointer; color: #116BAC;" ng-click="GetGstDetails(woparentdetail.WODetailGid,woparentdetail.ChkLstId)">View</a>
                                    </td>
                                    <td style="width:20%;min-width:100px;" align="center" ng-hide="@ViewBag.viewtype =='1'">
                                        <a ng-click="EditWoParent(woparentdetail.WODetailGid)" title="Edit">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>
                                        &nbsp;&nbsp;
                                        <a ng-click="DeleteWoParent(woparentdetail.WODetailGid)" title="Delete">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot ng-show="filteredItemsWO < 1">
                                <tr>
                                    <td colspan="12" style="text-align:center">
                                        No Records Found
                                    </td>
                                </tr>
                            </tfoot>
                        </table>

                    </div>

                    <div style="width:100%;">
                        <div ng-show="filteredItemsWO > PerPageItems" style="float:left;margin:0;padding:0;max-height:50px;">
                            <pagination page="currentPage" style="cursor:pointer;" boundary-links="true" class="pagination-sm" max-size="maxSize" total-items="filteredItemsWO"
                                        previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" ng-model="currentPage" items-per-page="PerPageItems"></pagination>

                        </div>
                        <div style="float:right;">
                            Total Records :  {{filteredItemsWO}}
                        </div>
                        <div style="float:left;">
                            Total Amount:  {{WOUtilAmount}}
                        </div>
                    </div>
                </div>
                <br />

                <div style="display:none;width:100%;" id="AddWODetailsParentDIV">
                    <table class="myTableStyleTabNew">
                        <tr>
                            <td style="width:20%">
                                <input type="hidden" ng-model="WODetailParentGid" />
                                <span ng-hide="WOProdServiceFlag =='S'">Product Code</span> <span ng-hide="WOProdServiceFlag =='P'">Service Code</span>
                                <br />
                                <input type="hidden" name="txtWOProductGidParent" value="{{WOProductGid}}" />
                                <input type="text" class="textboxStyle100" disabled="disabled" value="{{WODetailProductCode}}">
                            </td>
                            <td style="width:30%">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Name</span> <span ng-hide="WOProdServiceFlag =='P'">Service Name</span>
                                <br />
                                <input type="text" class="textboxStyle100" disabled="disabled" title="{{WODetailProductName}}" value="{{WODetailProductName}}">
                            </td>
                            <td style="width:50%" colspan="2">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Description</span> <span ng-hide="WOProdServiceFlag =='P'">Service Description</span>
                                <br />
                                <input type="text" class="textboxStyle100" title="{{WODetailProductDescription}}" value="{{WODetailProductDescription}}">
                            </td>
                        </tr>
                        <tr>
                            <td style="width:30%">
                                <span>Service Month</span>
                                <br />
                                @*<datepicker ng-model="WODetailServiceMonth" min-mode="month" datepicker-mode="'month'"></datepicker>*@
                                <input type="text" ng-disabled="WOProdServiceFlag =='P'" id="txtServMonthParentE" class="textboxStyle100 monthpicker" ng-model="WODetailServiceMonth">
                            </td>
                            <td style="width:25%">
                                <span>UOM</span><br />
                                <select ng-model="WODetailUOM" id="ddlUOMGid" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                        ng-options="uom.PRDetailUOMGid as uom.PRDetailUOMName for uom in uomlist"></select>
                            </td>
                            <td style="width:20%">
                                <span>Qty</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" class="textboxStyle100" maxlength="18" name="txtQtyParentVal" id="txtQtyParentVal" ng-keyup="ValidateWOHeaderAmountAll()" ng-model="WODetailQty">
                            </td>
                            <td style="width:25%">
                                <span>Unit Amount(INR)</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" maxlength="18" class="textboxStyle100" id="txtUnitAmntParentVal" name="txtUnitAmntParentVal" ng-model="WODetailUnitAmount" ng-keyup="ValidateWOHeaderAmountAll()">
                            </td>
                        </tr>
                        <tr>
                            <td style="width:20%">
                                <span>Tax (%)</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" class="textboxStyleMedium50" style="width:48%;vertical-align:bottom;" maxlength="18" name="txtTaxParentVal" id="txtTaxParentVal" ng-keyup="ValidateWOHeaderAmountAll()" ng-model="WODetailTax">
                                <input type="text" style="width:48%;vertical-align:bottom;" id="txtxTaxAmountParent" readonly="readonly" class="textboxStyleMedium50" ng-model="WODetailTaxAmount">
                            </td>
                            <td style="width:20%">
                                <span>Discount(INR)</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" class="textboxStyle100" maxlength="18" name="txtDiscountParentVal" id="txtDiscountParentVal" ng-keyup="ValidateWOHeaderAmountAll()" ng-model="WODetailDiscount">
                            </td>

                            <td style="width:20%">
                                <span>Other Charges(INR)</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" class="textboxStyle100" maxlength="18" name="txtOthersParentVal" id="txtOthersParentVal" ng-keyup="ValidateWOHeaderAmountAll()" ng-model="WODetailOthers">
                            </td>
                            <td style="width:25%">
                                <span>Total Amount(INR)</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" maxlength="18" class="textboxStyle100" readonly="readonly" name="txtTotalAmountWOParent">
                            </td>
                        </tr>
                        <tr>
                            <td style="width:100%" colspan="4">
                                <span>Description</span>
                                <br />
                                @*length fixed by selva*@
                                <textarea cols="2" style="width:100%;" maxlength="255" ng-model="WODetailDescription" class="resizenone"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="5" style="text-align:right">
                                <button type="button" class="btn btn-sm btn-primary" ng-click="SaveWOParentDetails()">
                                    <span class="glyphicon glyphicon-floppy-save" style="color:white;"></span>
                                    Save
                                </button>
                                <button type="button" class="btn btn-sm btn-warning" ng-click="CancelWOParentDetails()">
                                    <span class="glyphicon glyphicon-remove-sign" style="color:white;"></span>
                                    Cancel
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="display:none;width:100%;" id="AddWODetailsChildDIV">
                    <table class="myTableStyleTabNew">
                        <tr>
                            <td colspan="3">
                                <input type="hidden" ng-model="WOParentCBFDetailGid" />
                                <input type="checkbox" ng-model="SameAsParentProd" checked="checked" />
                                Same As Parent <span ng-hide="WOProdServiceFlag =='S'">Product </span> <span ng-hide="WOProdServiceFlag =='P'">Service </span>
                            </td>
                        </tr>
                        <tr ng-show="SameAsParentProd">
                            <td style="width:20%">
                                <input type="hidden" ng-model="WODetailParentGid" />
                                <span ng-hide="WOProdServiceFlag =='S'">Product Code</span> <span ng-hide="WOProdServiceFlag =='P'">Service Code</span>
                                <br />
                                <input type="hidden" name="txtWOProductGidParent" value="{{WOProductGid}}" />
                                <input type="text" class="textboxStyle100" disabled="disabled" value="{{WODetailProductCode}}">
                            </td>
                            <td style="width:30%">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Name</span> <span ng-hide="WOProdServiceFlag =='P'">Service Name</span>
                                <br />
                                <input type="text" class="textboxStyle100" disabled="disabled" title="{{WODetailProductName}}" value="{{WODetailProductName}}">
                            </td>
                            <td style="width:50%" colspan="3">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Description</span> <span ng-hide="WOProdServiceFlag =='P'">Service Description</span>
                                <br />
                                <input type="text" class="textboxStyle100" disabled="disabled" title="{{WODetailProductDescription}}" value="{{WODetailProductDescription}}">
                            </td>
                        </tr>
                        <tr ng-hide="SameAsParentProd">
                            <td style="width:20%">
                                <input type="hidden" ng-model="WODetailChildGid" />
                                <input type="hidden" ng-model="WODetailGid" />
                                <input type="hidden" ng-model="WODetailAmount" />
                                <input type="hidden" ng-model="WODetailQtyParent" />
                                <span ng-hide="WOProdServiceFlag =='S'">Product Group</span> <span ng-hide="WOProdServiceFlag =='P'">Service Group</span>
                                <br />
                                <input type="hidden" name="txtWOProductGidChild" value="{{ChildProductGid}}" />
                                <input type="hidden" name="txtWOProductGroupGidChild" value="{{ChildProductGroupGid}}" />
                                @*<select ng-model="ChildProductGroupGid" id="ddlChildProductGroupGid" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                    ng-change="getProductName()"
                                    ng-options="prodgrp.ChildProductGroupGid as prodgrp.ChildProductGroup for prodgrp in productgrouplist"></select>*@
                                <input type="text" class="textboxStyle100" readonly="readonly" title="{{ChildProductGroup}}" value="{{ChildProductGroup}}">
                            </td>
                            <td style="width:30%">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Name</span> <span ng-hide="WOProdServiceFlag =='P'">Service Name</span>
                                <br />
                                <select ng-model="ChildProductGid" id="ddlChildProductGid" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                        ng-change="getProductDescription()"
                                        ng-options="prod.ChildProductGid as prod.ChildProductName for prod in productlist"></select>
                            </td>
                            <td style="width:50%" colspan="3">
                                <span ng-hide="WOProdServiceFlag =='S'">Product Description</span> <span ng-hide="WOProdServiceFlag =='P'">Service Description</span>
                                <br />
                                <input type="text" class="textboxStyle100" readonly="readonly" title="{{ChildProductDescription}}" value="{{ChildProductDescription}}">
                            </td>
                        </tr>
                        <tr>
                            <td style="width:30%">
                                <span>Service Month</span>
                                <br />
                                @*<datepicker ng-model="WODetailServiceMonth" min-mode="month" datepicker-mode="'month'"></datepicker>*@
                                <input type="text" class="textboxStyle100 monthpicker" ng-model="WODetailServiceMonthParent">
                            </td>
                            <td style="width:25%">
                                <span>UOM</span><br />
                                <select ng-model="WODetailUOM1" id="ddlUOMGid1" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                        ng-options="uom.PRDetailUOMGid as uom.PRDetailUOMName for uom in uomlist"></select>
                            </td>
                            <td style="width:20%;" ng-hide="WOProdServiceFlag =='P'">
                                <span>Percentage</span>
                                <br />
                                <input type="text" ng-hide="WOProdServiceFlag =='P'" id="txtPercentageSplit" readonly="readonly" class="textboxStyle100" ng-model="WODetailPercentage">
                                <input type="hidden" ng-model="EnteredPercentage" />
                            </td>
                            <td style="width:20%">
                                <span>Qty</span>
                                <br />
                                @*length fixed by selva*@
                                <input type="text" id="txtQtySplit" maxlength="18" class="textboxStyle100" ng-model="WODetailQtyChild" ng-keyup="ValidateWOAmount()">
                            </td>

                            @*<td style="width:50%;display:none;" >
                                    <span>Total Amount</span>
                                    <br />
                                    <input type="text" class="textboxStyle100" readonly="readonly" name="txtTotalAmountWOChildP" value="{{WODetailAmount * WODetailQtyChild / WODetailQtyParent}}">
                                </td>*@
                        </tr>
                        <tr>
                            <td style="width:25%">
                                <span>Unit Amount</span>
                                <br />
                                <input type="text" id="txtUnitAmntSplit" class="textboxStyle100" ng-model="WODetailUnitAmount" ng-keyup="ValidateWOAmount()">
                            </td>
                            <td style="width:20%;vertical-align:bottom">
                                <span>Tax (%)</span>
                                <br />
                                <input type="text" class="textboxStyleMedium50" style="width:48%;vertical-align:bottom;" name="txtTaxSplitVal" id="txtTaxSplitVal" ng-keyup="ValidateWOAmount()" ng-model="WODetailTax1">
                                <input type="text" style="width:48%;vertical-align:bottom;" id="txtxTaxAmountSplit" readonly="readonly" class="textboxStyleMedium50" ng-model="WODetailTaxAmount1">
                            </td>
                            <td style="width:20%">
                                <span>Discount(INR)</span>
                                <br />
                                <input type="text" class="textboxStyle100" name="txtDiscountSplitVal" id="txtDiscountSplitVal" ng-keyup="ValidateWOAmount()" ng-model="WODetailDiscount1">
                            </td>

                            <td style="width:20%">
                                <span>Other Charges(INR)</span>
                                <br />
                                <input type="text" class="textboxStyle100" name="txtOthersSplitVal" id="txtOthersSplitVal" ng-keyup="ValidateWOAmount()" ng-model="WODetailOthers1">
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <span>Total Amount</span>
                                <br />
                                @*<input type="text" ng-show="WOProdServiceFlag =='P'" class="textboxStyle100" readonly="readonly" name="txtTotalAmountWOChildP" value="{{WODetailAmount * WODetailQtyChild / WODetailQtyParent}}">*@
                                <input type="text" class="textboxStyle100" readonly="readonly" name="txtTotalAmountWOChildS">
                            </td>

                            <td colspan="4">
                                <span>Description</span>
                                <br />
                                @*length fixed by selva*@
                                <textarea cols="2" maxlength="255" style="width:100%;" ng-model="WODetailDescription" class="resizenone"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="5" style="text-align:right">
                                <button type="button" class="btn btn-sm btn-primary" ng-click="SaveSplit()">
                                    <span class="glyphicon glyphicon-floppy-save" style="color:white;"></span>
                                    Save
                                </button>
                                <button type="button" class="btn btn-sm btn-warning" ng-click="CancelWOChildDetails()">
                                    <span class="glyphicon glyphicon-remove-sign" style="color:white;"></span>
                                    Cancel
                                </button>
                            </td>
                        </tr>
                    </table>
                    <br />

                </div>
                <div style="width:100%" id="divChildDetails">
                    <input type="button" ng-hide="@ViewBag.viewtype =='1'" style="float:right;" ng-click="AddWOChildDetails()" class="btn btn-sm btn-primary btnStyleNew" value="Add Split" />
                    <br />
                    <div style="width:110%;">
                        <table style="" class="tableSmall table-bordered table-hover table-responsive">
                            <thead style="width:100%;">
                                <tr>
                                    <th style="width:3%;">
                                        S.No
                                    </th>
                                    <th style="width:10%;">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Code</span> <span ng-hide="WOProdServiceFlag =='P'">Service Code</span>
                                    </th>
                                    <th style="width:15%;">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Name</span> <span ng-hide="WOProdServiceFlag =='P'">Service Name</span>
                                    </th>
                                    <th style="width:20%;">
                                        <span ng-hide="WOProdServiceFlag =='S'">Product Description</span> <span ng-hide="WOProdServiceFlag =='P'">Service Description</span>
                                    </th>
                                    <th style="width:10%;">
                                        Service Month
                                    </th>
                                    <th style="width:10%;">
                                        Percentage
                                    </th>
                                    <th style="width:5%;">
                                        Qty
                                    </th>
                                    <th style="width:10%;cursor:pointer">
                                        Unit Amount
                                        <span style="font-size: 12px;color:white;"></span>
                                    </th>
                                    <th style="width:10%;cursor:pointer">
                                        Total Amount
                                        <span style="font-size: 12px;color:white;"></span>
                                    </th>
                                    <th style="width:10%;cursor:pointer">
                                        Description
                                        <span style="font-size: 12px;color:white;"></span>
                                    </th>
                                    <th style="width:17%;">Special Actions</th>
                                    <th style="width:15%;" ng-hide="@ViewBag.viewtype =='1'">Action</th>
                                </tr>
                            </thead>
                            @*<tbody ng-show="filteredItemsWO > 0" ng-repeat="woparentdetail in woparentdetails | filter:searchwo:strict | orderBy:predicate:reverse | Pagestart:(currentPage-1)*PerPageItems | limitTo:PerPageItems" ng-class="{'selected':$index == selectedRow}" ng-click="setClickedRow($index)">*@
                            <tbody ng-show="filteredItemsWOChild > 0" ng-repeat="wochilddetail in wochilddetails">
                                <tr>
                                    <td style="width:3%;" align="center">
                                        {{$index+1}}
                                    </td>
                                    <td style="width:10%;">
                                        {{wochilddetail.WODetailProductCode}}
                                    </td>
                                    <td style="width:15%;">
                                        {{wochilddetail.WODetailProductName}}
                                    </td>
                                    <td style="width:20%;">
                                        {{wochilddetail.WODetailProductDescription}}
                                    </td>
                                    <td style="width:10%;">
                                        {{wochilddetail.WODetailServiceMonth}}
                                    </td>
                                    <td style="width:10%;">
                                        {{wochilddetail.WODetailPercentage}}
                                    </td>
                                    <td style="width:5%;">
                                        {{wochilddetail.WODetailQty}}
                                    </td>
                                    <td style="width:10%;">
                                        {{wochilddetail.WODetailUnitAmount}}
                                    </td>
                                    <td style="width:10%;">
                                        {{wochilddetail.WODetailTotalAmount}}
                                    </td>
                                    <td style="width:20%;">
                                        {{wochilddetail.WODetailDescription}}
                                    </td>
                                    <td style="width:17%;" align="center">
                                        <a ng-click="ShipmentWOChild(wochilddetail.WODetailGid,wochilddetail.WODetailQty)" title="Shipment">
                                            Shipment
                                        </a>
                                    </td>
                                    <td style="width:15%;" align="center" ng-hide="@ViewBag.viewtype =='1'">
                                        <a ng-click="EditWoChild(wochilddetail.WODetailGid)" title="Edit">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>
                                        &nbsp;&nbsp;
                                        <a ng-click="DeleteWoChild(wochilddetail.WODetailGid)" title="Delete">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot ng-show="filteredItemsWOChild < 1">
                                <tr>
                                    <td colspan="12" style="text-align:center">
                                        No Records Found
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                </div>
                <div style="display:none;width:100%;" id="divShipmentDetails">
                    <div ng-hide="@ViewBag.viewtype =='1'">
                        <input type="hidden" ng-model="WOShipmentGid" />
                        <table class="myTableStyleTabpopup">
                            <tr>
                                <td>
                                    Branch Name
                                    <br />
                                    <input type="hidden" name="txtWoDetailGidForShipment" />
                                    <input type="hidden" name="txtBranchGid" />
                                    <input type="hidden" name="txtBranchInchargeGid" />
                                    <input type="text" ng-hide="@ViewBag.viewtype =='1'" class="textboxStyle100" id="ddlBranchNameShipment">
                                </td>
                                <td>
                                    Branch Incharge
                                    <br />
                                    <input type="text" ng-hide="@ViewBag.viewtype =='1'" class="textboxStyle100" id="ddlBranchInchargeShipment">
                                </td>
                                <td style="vertical-align:bottom">
                                    <button type="button" class="btn-sm btn-primary" ng-click="SaveWoShipment()">
                                        <span class="glyphicon glyphicon-ok" style="color:white;"></span>
                                        Save
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <br />
                    <table class="tableSmall table-bordered table-hover table-responsive">
                        <thead>
                            <tr>
                                <th style="vertical-align:middle;width:5%">
                                    S.No
                                </th>
                                <th style="width:45%">
                                    Branch Name
                                </th>
                                <th style="width:40%">
                                    Branch Incharge
                                </th>
                                <th style="width:10%">
                                    Action
                                </th>
                            </tr>
                        </thead>
                        <tbody ng-repeat="woshipmentdetail in woshipmentdetails">
                            <tr>
                                <td style="width:5%;" align="center">
                                    {{$index+1}}
                                </td>
                                <td style="width:45%;">
                                    {{woshipmentdetail.WOBranchName}}
                                </td>
                                <td style="width:40%;">
                                    {{woshipmentdetail.WOBranchInchargeName}}
                                </td>
                                <td style="width:10%;" align="center" ng-hide="@ViewBag.viewtype =='1'">
                                    <a ng-click="DeleteWoShipment(woshipmentdetail.WOShipmentGid)" title="Delete">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot ng-show="filteredItemsWOShipment < 1">
                            <tr>
                                <td colspan="11" style="text-align:center">
                                    No Records Found
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <br />
        </div>
        <div style="width:100%;" id="divAttachmentMain">
            <div style="width:100%" ng-hide="@ViewBag.viewtype !='0'">
                <table class="myTableStyleTabpopup">
                    <tr>
                        <td style="vertical-align:bottom;max-width:300px;min-width:100px;">
                            <span>Select File</span><br />
                            <form id="theuploadform1">
                                @Html.AntiForgeryToken()
                                <input type="file" name="UploadFile" id="txtWoAttachmentFile" class="txtWoAttachmentFile" />
                            </form>
                        </td>
                        <td>
                            <span>File Name</span> <br />
                            <input type="text" class="textboxStyle100" id="AttachedActualFileName" readonly="readonly" />
                        </td>
                        <td>
                            <span>Description</span> <br />
                            @*length fixed by selva*@
                            <input type="text" maxlength="255" id="AttachDescription" class="textboxStyle100" />
                        </td>
                        <td style="text-align:right;padding-right:3%;vertical-align:bottom;">
                            <button type="button" class="btn btn-sm btn-primary" ng-click="SaveWOAttachment()">
                                <span class="glyphicon glyphicon-briefcase" style="color:white;"></span>
                                Save
                            </button>
                        </td>
                    </tr>
                </table>
            </div>
            <br />
            <table style="overflow-x:auto;" class="tableSmall table-bordered table-hover table-responsive">
                <thead style="width:100%;">
                    <tr>
                        <th style="width:3%;">
                            S.No
                        </th>
                        <th style="width:28%;cursor:pointer;">
                            File Name
                        </th>
                        <th style="width:22%;cursor:pointer">
                            Attachment Date
                        </th>
                        <th style="width:27%;cursor:pointer">
                            Description
                        </th>
                        <th style="width:20%;cursor:pointer" class="action attdelete" ng-hide="@ViewBag.viewtype =='1'">
                            Action
                        </th>
                    </tr>
                </thead>

                <tbody ng-show="WOAttLenth > 0" style="max-height:300px;overflow-y:auto;" ng-repeat="WOAttachmentlist in WOAttachment">
                    <tr>
                        <td style="width:3%;" align="center">
                            {{$index+1}}
                        </td>
                        <td style="width:10%;" align="center">
                            <a style="color:blue;cursor:pointer;" title="Click Here to Download" ng-click="DownloadAttachment(WOAttachmentlist.TempFileName,WOAttachmentlist.AttachedActualFileName)">
                                <span>
                                    {{WOAttachmentlist.AttachedActualFileName}}
                                </span>

                            </a>
                        </td>
                        <td style="width:22%;">
                            {{WOAttachmentlist.AttachDate}}
                            <span style="visibility:hidden;">
                                {{WOAttachmentlist.TempFileName}}
                            </span>
                        </td>
                        <td style="width:25%;">
                            {{WOAttachmentlist.AttachDescription}}
                        </td>
                        <td style="width:10%;" align="center" ng-hide="@ViewBag.viewtype =='1'">
                            <a ng-click="DeleteAttachment(WOAttachmentlist.AttachmentID)" title="Delete">
                                <span class="glyphicon glyphicon-trash"></span>
                            </a>
                        </td>
                    </tr>
                </tbody>
                @*<tfoot>
                        <tr>
                            <td colspan="5"  style="text-align:center">
                                No Records Found
                            </td>
                        </tr>
                    </tfoot>*@
            </table>
        </div>
        <div id="divWOTerms">
            <div style="width:100%;margin-left:0;">
                <input type="hidden" name="txtTermCondGid" value="{{TermCondGid}}" />
                <div id="divTermsandCond">
                    <table class="myTableStyleTabNew" ng-hide="@ViewBag.viewtype =='1'">
                        <tr>
                            <td style="vertical-align:middle">
                                Select Terms & Conditions
                            </td>
                            <td>
                                <select ng-model="TermsAndCondValue" id="ddlTermsAndCondValueGid" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                        ng-change="getTermCondContent()"
                                        ng-options="Term.TermsAndCondValue as Term.TermsAndCondText for Term in TermsAndCondList"></select>
                            </td>
                            <td style="padding:5px 5px; width:20%; vertical-align:bottom;">
                                <a class="hideStatus" onclick="return AddWOTemplate();" style="cursor:pointer; color: #116BAC;">Create Template</a>
                            </td>

                        </tr>
                    </table>
                    <br />
                    <textarea cols="10" id="txtTermsandCond" style="width:100%;height:300px;overflow-y:auto;" readonly="readonly" class="resizenone">{{TermCondContent}}</textarea>
                    <br />
                    <b>Additional Terms & Conditions</b> <br />
                    <textarea cols="3" style="width:100%;overflow-y:auto;" ng-disabled="@ViewBag.viewtype =='1'" ng-model="AdditionalTermCondContent" class="resizenone"></textarea>
                </div>
            </div>
        </div>
        <div id="divWOAudit">
            <div id="divAuditTrail">
                <table style="overflow-x:auto;" class="tableSmall table-bordered table-hover table-responsive">
                    <thead style="width:100%;">
                        <tr>
                            <th style="width:3%;">
                                S.No
                            </th>
                            <th style="width:20%;cursor:pointer;">
                                Action By
                            </th>
                            <th style="width:22%;cursor:pointer">
                                Action Date
                            </th>
                            <th style="width:25%;cursor:pointer">
                                Approval Stage
                            </th>
                            <th style="width:10%;cursor:pointer">
                                Status
                            </th>
                            <th style="width:20%;cursor:pointer">
                                Remarks
                            </th>
                        </tr>
                    </thead>
                    @*<tbody ng-show="filteredItemsWO > 0" ng-repeat="woparentdetail in woparentdetails | filter:searchwo:strict | orderBy:predicate:reverse | Pagestart:(currentPage-1)*PerPageItems | limitTo:PerPageItems" ng-class="{'selected':$index == selectedRow}" ng-click="setClickedRow($index)">*@
                    <tbody ng-show="filteredItemsWOAuditTrail > 0" style="max-height:300px;overflow-y:auto;" ng-repeat="woaudittraillist in woaudittrail">
                        <tr>
                            <td style="width:3%;" align="center">
                                {{$index+1}}
                            </td>
                            <td style="width:20%;">
                                {{woaudittraillist.employee_code}}
                            </td>
                            <td style="width:22%;">
                                {{woaudittraillist.action_date}}
                            </td>
                            <td style="width:25%;">
                                {{woaudittraillist.queue_to_type}}
                            </td>
                            <td style="width:10%;">
                                {{woaudittraillist.action_status}}
                            </td>
                            <td style="width:20%;">
                                {{woaudittraillist.action_remarks}}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot ng-show="filteredItemsWOAuditTrail < 1">
                        <tr>
                            <td colspan="11" style="text-align:center">
                                No Records Found
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div style="display:none" id="Dialogaddgst">
            <table class="myTableStyleTabNew" style="width:100%;">
                <tr>
                    <td style="padding:10px 5px 10px 0px; width:20%;">
                        <span>Wo No</span>
                        <br />
                        <input type="text" disabled="disabled" class="fstextbox" id="txtgstPORefNo" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Wo Date</span>
                        <br />
                        <input type="text" class="fstextbox" disabled="disabled" id="txtgstPODate" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Wo Amount</span>
                        <br />
                        <input type="text" class="fstextbox disableView" disabled="disabled" id="txtgstPOAmt" />
                    </td>
                    <td style="padding:10px 5px 10px 0px; width:20%;">
                        <span>Base Amount</span>
                        <br />
                        <input type="text" disabled="disabled" class="fstextbox" id="txtgstbtamt" />
                    </td>
                </tr>
                <tr>
                    <td style="padding:10px 5px 10px 0px; width:20%;">
                        <span>Vendor Code</span>
                        <br />
                        <input type="text" disabled="disabled" class="fstextbox" id="txtgstvencode" />
                    </td>
                    <td style="padding:10px 5px; width:20%;" colspan="2">
                        <span>Vendor Name</span>
                        <br />
                        <input type="text" class="fstextbox" disabled="disabled" id="txtgstvename" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Net Amount</span>
                        <br />
                        <input type="text" class="fstextbox disableView" id="txtgstnetamt" disabled="disabled" />
                    </td>
                </tr>
                <tr>
                    <td style="padding:10px 5px 10px 0px; width:20%;">
                        <span>Product Group</span>
                        <br />
                        <input type="text" disabled="disabled" class="fstextbox" id="txtgstprogrp" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Product Code</span>
                        <br />
                        <input type="text" class="fstextbox" disabled="disabled" id="txtgstprocode" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Product Name</span>
                        <br />
                        <input type="text" class="fstextbox disableView" id="txtgstProname" disabled="disabled" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Taxes</span>
                        <br />
                        <input type="text" class="fstextbox" disabled="disabled" id="txtgsttaxes" />
                    </td>
                </tr>
                <tr>
                    <td style="padding:10px 5px 10px 0px; width:20%;">
                        <span>UOM</span>
                        <br />
                        <input type="text" disabled="disabled" class="fstextbox" id="txtgstuom" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Qty</span>
                        <br />
                        <input type="text" class="fstextbox" disabled="disabled" id="txtgstqty" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span>Rate</span>
                        <br />
                        <input type="text" class="fstextbox disableView" id="txtgstrate" disabled="disabled" />
                    </td>
                    <td style="padding:10px 5px; width:20%;">
                        <span></span>
                        @*<button class="btn btn-primary" style="font-size:10px; margin-top:15px; margin-left: 35px; width: 50%;"
                                    data-bind="click: function() { $root.AddTaxdet();}" type="button" title="Add GST Details">
                                <span class="glyphicon glyphicon-plus" style="color:white; font-size: 14px; margin-right: 5px;"> </span>Add Gst
                            </button>*@
                    </td>
                </tr>
            </table>
            <div class="well" id="tabs" style="padding-bottom:50px;">
                <table class="myTableStyleTabNew" style="width:100%;">
                    <tr>
                        <td style="padding:10px 5px 10px 0px; width:20%;">
                            <span>Provider Location</span>
                            <br />
                            <select ng-model="pstate.organization1" id="txtgstproloc" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                    ng-change="GetTaxdetails()"
                                    @*ng-options="State as State.Combo for State in ProviderLocationlist " ng-disabled="@ViewBag.viewtype =='1'">*@
                                    @*<option data-ng-repeat="t in ProviderLocationlist" value="{{t.Id}}">{{t.Combo}}</option>*@
                                    ng-options="pstate as pstate.Combo for pstate in ProviderLocationlist track by pstate.Id"></select>

                            @*<select ng-model="referral.Hsncode" id="txtgstproloc" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                ng-options="HSN as HSN.hsn_gid for HSN in HSNlist track by HSN.hsn_gid"></select>*@

                        </td>
                        <td style="padding:10px 5px; width:19%;">
                            <span>Receiver Location</span>
                            <br />
                            @*<select class="fstextbox disableView required" data-bind="foreach: {data: PoReciverArray},event:{change:$root.changeReveiver}" id="txtgsrecloc">
                                    <option data-bind="attr: {value: Id}, text: Combo"></option>
                                </select>*@
                            <input type="text" class="fstextbox disableView" readonly="readonly" id="txtgsrecloc" />
                            <input type="hidden" id="TxtGstReciverLocionId" />
                        </td>
                        <td style="padding:10px 5px; width:19%;">
                            <span>GSTIN Vendor</span>
                            <br />
                            <input type="text" class="fstextbox disableView" readonly="readonly" id="txtgstinvendor" />
                        </td>
                        <td style="padding:10px 5px; width:19%;">
                            <span>GSTIN FICCL</span>
                            <br />
                            <input type="text" class="fstextbox disableView" readonly="readonly" id="txtgstficcl" />
                        </td>

                        <td style="padding:10px 5px 10px 0px; width:17%;">
                            <span>HSN Code</span>

                            <select ng-model="referral.Hsncode" id="txtHsnCode" style="min-width:100%;max-width:100%;" class="textboxStyle100"
                                    ng-options="HSN.hsn_gid as HSN.hsn_code for HSN in HSNlist track by HSN.hsn_gid"></select>
                        </td>

                        <td style="padding:10px 5px 10px 0px; width:7%;">
                            <br />
                            <button class="btn btn-success hideStatus" style="font-size:11px;" id="btnAddgst" ng-click="AddGstdetails()" type="button" title="AddGst">
                                <span class="glyphicon glyphicon-floppy-saved" style="color:white; font-size: 14px; margin-right: 5px;"> </span>ADDGST
                            </button>
                        </td>


                    </tr>
                </table>
                <div style="height :80%; overflow:hidden;">
                    <div>

                    </div>
                    <div class="table-responsive" style="max-height : 270px; overflow: auto;">
                        <table class="tableSmall table-bordered table-hover" style="width:100%;" id="Taxgsttable">
                            <thead>
                                <tr>
                                    <th style="width:5%; min-width:40px;">
                                        #
                                    </th>
                                    <th style="width:10%; min-width:100px;">
                                        GSN Applicability
                                    </th>
                                    <th style="width:10%; min-width:100px;">
                                        HSN Code
                                    </th>
                                    <th style="width:5%; min-width:100px;">
                                        HSN Description
                                    </th>
                                    <th style="width:30%; min-width:150px;">
                                        TAX Sub Type
                                    </th>
                                    <th style="width:10%; min-width:100px;">
                                        Taxable Amount
                                    </th>
                                    <th style="width:12%; min-width:150px;">
                                        Taxable Rate(%)
                                    </th>
                                    <th style="width:8%; min-width:100px;">
                                        Tax Amount
                                    </th>
                                    @*<th style="width:10%; min-width:100px;" class="hideStatus">
                                            Action
                                        </th>*@
                                </tr>
                            </thead>
                            <tbody ng-show="filteredgstItem>0" ng-repeat="GstItems in GstgridedetailsList">
                                <tr>
                                    <td style="width:3%;" align="center">
                                        {{GstItems.SlNo}}
                                    </td>
                                    <td>
                                        <span>{{GstItems.GstApplicable}}</span>
                                    </td>
                                    <td>
                                        <span>{{GstItems.hsn_code}}</span>
                                    </td>
                                    <td>
                                        <span>{{GstItems.hsn_description}}</span>
                                    </td>
                                    <td>
                                        <span>{{GstItems.TaxsubtypeName}}</span>
                                    </td>
                                    <td>
                                        <input type="text" class="fstextbox" value="{{GstItems.Taxableamt}}" ng-keyup="GetTaxableamt()" />
                                    <td>
                                        <span>{{GstItems.Rate}}</span>
                                    </td>
                                    <td align="center">
                                        <span>{{GstItems.Taxamt}}</span>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot ng-show="filteredgstItem < 1">
                                <tr>
                                    <td colspan="12" style="text-align:center">
                                        No Records Found
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div style="width:100%; text-align:center; margin-top:15px;">
                        <button class="btn btn-success hideStatus" style="font-size:13px;" id="btnsavegst" ng-click="SaveGsttaxDetails()" ng-hide="@ViewBag.viewtype =='1'" type="button" title="Save">
                            <span class="glyphicon glyphicon-floppy-saved" style="color:white; font-size: 14px; margin-right: 5px;"> </span>Submit
                        </button>
                        <button class="btn btn-warning" style="font-size:12px;" type="button" title="Clear" ng-click="CancelGSTDetails()">
                            <span class="glyphicon glyphicon-remove-sign" style="color:white; font-size: 13px; margin-right: 5px;"> </span>Cancel
                        </button>
                    </div>
                    <table>
                        <tr>
                            <td style="padding:10px 300px 5px; margin-left:50%; text-align:center;"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div style="width:100%;text-align:center;">
            <button type="button" ng-hide="@ViewBag.viewtype =='1'" class="btn btn-sm btn-primary" ng-click="SaveAsDraft()">
                <span class="glyphicon glyphicon-briefcase" style="color:white;"></span>
                Save As Draft
            </button>
            <button type="button" ng-hide="@ViewBag.viewtype =='1'" class="btn btn-sm btn-success" ng-click="SubmitWO()">
                <span class="glyphicon glyphicon-ok" style="color:white;"></span>
                Submit
            </button>
            <button type="button" ng-show="@ViewBag.deleteflag =='1'" class="btn btn-sm btn-danger" ng-click="DeleteWO()">
                <span class="glyphicon glyphicon-trash" style="color:white;"></span>
                Delete
            </button>
            <button type="button" class="btn btn-sm btn-warning" ng-hide="@ViewBag.isapprovalMode =='1'" ng-click="CancelWODetails()">
                <span class="glyphicon glyphicon-remove-sign" style="color:white;"></span>
                Cancel
            </button>
        </div>
        <div style="width:100%;text-align:center" ng-show="@ViewBag.isapprovalMode =='1'">
            <table class="myTableStyleTabNew" align="center">
                <tr>
                    <td style="text-align:left">
                        <span>Remarks</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <textarea id="txtApprovalRemarks"
                                  ng-model="WOApprovalRemarks"
                                  name="txtApprovalRemarks"
                                  style="resize:none ;width: 400px; height: 75px;"
                                  maxlength="250"
                                  class="textareaStyle"></textarea>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:center">
                        <button type="button" class="btn btn-sm btn-success" ng-click="ApproveWO()">
                            <span class="glyphicon glyphicon-thumbs-up" style="color:white;"></span>
                            Approve
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" ng-click="RejectWO()">
                            <span class="glyphicon glyphicon-thumbs-down" style="color:white;"></span>
                            Reject
                        </button>
                        <button type="button" class="btn btn-sm btn-warning" ng-click="CancelWODetails()">
                            <span class="glyphicon glyphicon-remove-sign" style="color:white;"></span>
                            Cancel
                        </button>
                    </td>
                </tr>
            </table>
            <div style="width:100%; display:none;" id="CreateTemplateDialog">
                <table class="myTableStyleTab" style="width:100%;">
                    <tr>
                        <td style="padding:5px; width:40%;">
                            <span>Select Template</span>
                            <br />
                            <input type="text" class="fstextbox required" id="txtTemplateName" />
                        </td>
                        <td style="padding:5px; width:60%; vertical-align:bottom;"></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="padding:5px;">
                            <span>Terms and Condtions</span>
                            <br />
                            <textarea rows="7" cols="5" style="height:250px;" id="txtTermsCoditions" class="fstextbox"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="padding:5px; text-align:center;">
                            <button class="btn btn-primary" style="font-size:12px;" ng-click="SetPOTemplate()" type="button" title="Save">
                                <span class="glyphicon glyphicon-floppy-save" style="color:white; font-size: 13px; margin-right: 5px;"> </span>Save
                            </button>
                            <button class="btn btn-warning" onclick="return CloaseDialog();" style="font-size:12px;" type="button" title="Clear">
                                <span class="glyphicon glyphicon-remove-sign" style="color:white; font-size: 13px; margin-right: 5px;"> </span>Cancel
                            </button>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </div>

</div>
<script type="text/javascript">
    var objADDWOParent;
    var objADDWOChild;
    var objADDWOChildAdd;
    var objADDWOShipmentChildAdd;
    var objADDPOGST;
    var WoReciverLocationArray = [];
    //var objAuditTrail;
    var objDate = new Date();
    var Presentyear = objDate.getFullYear();
    var MinYear = parseInt(Presentyear) - 50;
    var MaxYear = parseInt(Presentyear) + 50;
    var objDialogyAddTemplate;

    $(document).ready(function () {
        //  $("[id=divTermsandCond]").hide();

        objADDWOParent = $("[id$='AddWODetailsParentDIV']");
        objADDWOParent.dialog({
            autoOpen: false,
            modal: true,
            width: 780,
            cache: false,
            async: false,
            height: 300,
            duration: 300
            //  resizable:false
        });
        objADDWOChild = $("[id$='divChildDetails']");
        objADDWOChild.dialog({
            autoOpen: false,
            modal: true,
            width: 780,
            height: 300,
            cache: false,
            async: false,
            duration: 300,
            //resizable: false
        });
        objADDWOChildAdd = $("[id$='AddWODetailsChildDIV']");
        objADDWOChildAdd.dialog({
            autoOpen: false,
            modal: true,
            width: 780,
            height: 300,
            cache: false,
            async: false,
            duration: 300
            // resizable: false
        });
        objADDWOShipmentChildAdd = $("[id$='divShipmentDetails']");
        objADDWOShipmentChildAdd.dialog({
            autoOpen: false,
            modal: true,
            width: 780,
            height: 300,
            cache: false,
            async: false,
            duration: 300
            // resizable: false
        });
        objADDPOGST = $("[id$='Dialogaddgst']");
        objADDPOGST.dialog({
            autoOpen: false,
            modal: true,
            width: 780,
            height: 300,
            cache: false,
            async: false,
            duration: 300
            // resizable: false
        });
        //objAuditTrail = $("[id$='divAuditTrail']");
        //objAuditTrail.dialog({
        //    autoOpen: false,
        //    modal: true,
        //    width: 780,
        //    height: 300,
        //    cache: false,
        //    async: false,
        //    duration: 300
        //    // resizable: false
        //});
        $(".monthpicker").datepicker({
            yearRange: MinYear + ':' + MaxYear,
            changeMonth: true,
            changeYear: true,
            // maxDate: 'd',
            dateFormat: 'M-yy'
        });//ddlVendorNameWO
      

        $("#ddlVendorNameWO").focusout(function () {
            var hdfId = $("[name=txtVendorNameCustomGid]").val();
            var txtCurName = $("#ddlVendorNameWO").val();
            if (txtCurName.trim() != "" && (hdfId.trim() == "" || hdfId.trim() == "0")) {
                $("#ddlVendorNameWO").val("");
            }
            if (txtCurName == "") {
                $("#txtwopanno").val("");
                $("#txtwovendorcode").val("");
            }


        });
        $("#ddlBranchNameShipment").keyup(function (e) {
            if (e.which != 13) {
                $("[name=txtBranchGid]").val("0");
            }

            $("#ddlBranchNameShipment").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("GetBranchAutoComplete", "WONew")?' + new Date().getTime(),
                        data: "{ 'searchtext' : '" + $("#ddlBranchNameShipment").val() + "'}",
                        dataType: "json",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            response($.map(data, function (item) {
                                return {
                                    label: item.split('~')[1],
                                    val: item.split('~')[0],
                                    address: item.split('~')[2],
                                    location: item.split('~')[3],
                                    incharge: item.split('~')[4],
                                    empid: item.split('~')[5]
                                }
                            }));
                        },
                        error: function (response) {
                        },
                        failure: function (response) {
                        }
                    });
                },
                select: function (e, i) {
                    $("#ddlBranchInchargeShipment").val(i.item.incharge);
                    $("[name=txtBranchGid]").val(i.item.val);
                    $("[name=txtBranchInchargeGid]").val(i.item.empid);
                    $("#ddlBranchNameShipment").val(i.item.label);
                },
                minLength: 1
            });

        });

        $("#ddlBranchNameShipment").focusout(function () {
            var hdfId = $("[name=txtBranchGid]").val();
            var txtCurName = $("#ddlBranchNameShipment").val();
            if (txtCurName.trim() != "" && (hdfId.trim() == "" || hdfId.trim() == "0")) {
                $("#ddlBranchNameShipment").val("");
            }
        });
        $("#ddlBranchInchargeShipment").keyup(function (e) {
            if (e.which != 13) {
                $("[name=txtBranchInchargeGid]").val("0");
            }

            $("#ddlBranchInchargeShipment").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("GetEmployeeAutoComplete", "WONew")?' + new Date().getTime(),
                        data: "{ 'searchtext' : '" + $("#ddlBranchInchargeShipment").val() + "'}",
                        dataType: "json",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            response($.map(data, function (item) {
                                return {
                                    label: item.split('~')[1],
                                    val: item.split('~')[0]
                                }
                            }));
                        },
                        error: function (response) {
                        },
                        failure: function (response) {
                        }
                    });
                },
                select: function (e, i) {
                    $("[name=txtBranchInchargeGid]").val(i.item.val);
                    $("#ddlBranchInchargeShipment").val(i.item.label);
                },
                minLength: 1
            });

        });

        $("#ddlBranchInchargeShipment").focusout(function () {
            var hdfId = $("[name=txtBranchInchargeGid]").val();
            var txtCurName = $("#ddlBranchInchargeShipment").val();
            if (txtCurName.trim() != "" && (hdfId.trim() == "" || hdfId.trim() == "0")) {
                $("#ddlBranchInchargeShipment").val("");
            }
        });
        var currentTab = 0;
        $("#tabs").tabs({
            select: function (e, i) {
                currentTab = i.index;
            }
        });
        $("#tabs").css("display", "block");

        objDialogyAddTemplate = $("[id$='CreateTemplateDialog']");
        objDialogyAddTemplate.dialog({
            autoOpen: false,
            modal: true,
            width: 1000,
            height: 450,
            duration: 300
        });

        $("#txtWoAttachmentFile").on('change', function (e) {
            var iframe1 = $('<iframe name="postiframe1" id="postiframe1" style="display: none"></iframe>');
            $("body").append(iframe1);
            var form1 = $('#theuploadform1');
            var Attach_list = Attachment_list();
            var Attachment_fomat = Attached_fileformat();
            form1.attr("action", "../WONew/UploadedFiles/?uploadfor=WO&attach=" + Attach_list + '&attaching_format=' + Attachment_fomat);
            //form1.attr("action", '@Url.Action("UploadedFiles", "WONew")?uploadfor=WO');
            form1.attr("method", "post");

            form1.attr("encoding", "multipart/form-data");
            form1.attr("enctype", "multipart/form-data");

            form1.attr("target", "postiframe1");
            form1.attr("file", $('#txtWoAttachmentFile').val());

            var fname = $('#txtWoAttachmentFile').val();
            fname = fname.replace(/^.*[\\\/]/, '');
            $("#AttachedActualFileName").val(fname);
            form1.submit();
            return false;
        });

    });
    var myAppWO = angular.module('WONewapp', ['ui.bootstrap']);

    myAppWO.config(['$httpProvider', function ($httpProvider) {

        $httpProvider.defaults.headers.common["X-Requested-With"] = 'XMLHttpRequest';


        var antiForgeryToken = document.getElementById('antiForgeryForm').childNodes[1].value;

        $httpProvider.defaults.headers.post['__RequestVerificationToken'] = antiForgeryToken;
    }]);

    myAppWO.service("wonewservice", function ($http) {
        this.GetWONewDetailsList = function () {
            var cbfdetailsgid = $("[id=txtCbfDetailsGid]").val();
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWOHeaderDetails", "WONew")?cbfdetid=' + cbfdetailsgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetWONewDetailsList1 = function (woheadergid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWOHeaderDetails1", "WONew")?wogid=' + woheadergid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.AddWOParentDetailsList = function (WoParentDetailsInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoParentDetailsInsert),
                url: '@Url.Action("AddWOParentDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.AddWOParentDetailsList1 = function (WoParentDetailsInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoParentDetailsInsert),
                url: '@Url.Action("AddWOParentDetails1", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetWODetailParent = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWODetailParent", "WONew")?wodetailgid=' + wodetailgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetWODetailChild = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWODetailChild", "WONew")?wodetailgid=' + wodetailgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }

        this.UpdateWOParentDetailsList = function (WoParentDetailsInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoParentDetailsInsert),
                url: '@Url.Action("UpdateWOParentDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetProductGroup = function (prodservflag) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetProductGroup", "WONew")?flag=' + prodservflag + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetProductGroupById = function (prodservflag, prodgroupgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetProductGroupById", "WONew")?flag=' + prodservflag + '&ProdGroupId=' + prodgroupgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetProductDesc = function (prodgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetProductDesc", "WONew")?prodgid=' + prodgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.ADDWOChildDetailsList = function (WoChildDetailsInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoChildDetailsInsert),
                url: '@Url.Action("ADDWOChildDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.UpdateWOChildDetailsList = function (WoChildDetailsInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoChildDetailsInsert),
                url: '@Url.Action("UpdateWOChildDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetWODetailChildById = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWODetailParent", "WONew")?wodetailgid=' + wodetailgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetBranchAutoComplete = function (branchname) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetBranchAutoComplete", "WONew")?searchtext=' + branchname + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetEmployeeAutoComplete = function (empname) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetEmployeeAutoComplete", "WONew")?searchtext=' + empname + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.ADDWOShipmentDetailsList = function (WoShipmentInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoShipmentInsert),
                url: '@Url.Action("ADDWOShipmentDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetWOShipment = function (wodetailgid, vendorid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWOShipment", "WONew")?wodetailgid=' + wodetailgid + '&' + 'vendorid=' + vendorid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.SubmitRaiser = function (ObjWOEntity) {
            var response = $http({
                method: "post",
                data: JSON.stringify(ObjWOEntity),
                url: '@Url.Action("SubmitRaiser", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.SaveAsDraft = function (ObjWOEntity) {
            var response = $http({
                method: "post",
                data: JSON.stringify(ObjWOEntity),
                url: '@Url.Action("SaveAsDraft", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.SubmitApprover = function (ObjWOEntity) {
            var response = $http({
                method: "post",
                data: JSON.stringify(ObjWOEntity),
                url: '@Url.Action("SubmitApprover", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.RejectApprover = function (ObjWOEntity) {
            var response = $http({
                method: "post",
                data: JSON.stringify(ObjWOEntity),
                url: '@Url.Action("RejectApprover", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetAuditTrail = function (woheadergid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetAuditTrail", "WONew")?wogid=' + woheadergid + '&refname=WO&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.DeleteWODetails = function (WoDetailsForDelete) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WoDetailsForDelete),
                url: '@Url.Action("DeleteWOParentDetails", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.ChkWOShipment = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("ChkWOShipment", "WONew")?wodetailgid=' + wodetailgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.ValidateWOShipment = function (woheadergid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("ValidateWOShipment", "WONew")?wogid=' + woheadergid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetTermCondContent = function (termsandcondgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetTermCondContent", "WONew")?TermsAndCodGid=' + termsandcondgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetgstVal = function (POId, ProvId, Basamt, ReciverLocId, HSN_ID) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetTaxdetails", "WONew")?PODetailGId=' + POId + '&' + 'ProvLocId=' + ProvId + '&' + 'Baseamt=' + Basamt + '&' + 'ReciverLocId=' + ReciverLocId + '&' + 'HSN_ID=' + HSN_ID,
                dataType: "json"
            });
            return response;
        }
        this.DeleteWO = function (woheadergid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("DeleteWO", "WONew")?wogid=' + woheadergid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.ChkWOSplitExists = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("ChkWOSplitExists", "WONew")?wodetailgid=' + wodetailgid + '&' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetUOM = function () {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetUOM", "PRNew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.GetReciverLocation = function () {
            var response = $http({
                method: "post",
                url: '@Url.Action("Getgstcbodetls", "FBHelper")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }
        this.AddGstTaxdetails = function (PoGstInsertdetls) {
            var response = $http({
                method: "post",
                url: '@Url.Action("SetPoGstDet", "WONew")?POHeaderGId=' + PoGstInsertdetls.POHeaderGId + '&' + 'PODetilsId=' + PoGstInsertdetls.PODetilsId +
                    '&' + 'ProvLocationId=' + PoGstInsertdetls.ProvLocationId + '&' + 'ReceiverLocationId=' + PoGstInsertdetls.ReceiverLocationId + '&' + 'HsnId=' + PoGstInsertdetls.HsnId
                + '&' + 'TaxsubTypeId=' + PoGstInsertdetls.TaxsubTypeId + '&' + 'TaxablAmt=' + PoGstInsertdetls.TaxablAmt + '&' + 'TaxRate=' + PoGstInsertdetls.TaxRate +
                '&' + 'NetAmt=' + PoGstInsertdetls.NetAmt + '&' + 'Vendorid=' + PoGstInsertdetls.Vendorid + '&' + 'TaxAmt=' + PoGstInsertdetls.TaxAmt,
                dataType: "json"
            });
            return response;
        }
        this.CancelGstDetails = function (wodetailgid) {
            var response = $http({
                method: "post",
                url: '@Url.Action("DeletePoGstDetails", "PO")?POId=' + wodetailgid + '&' + 'Header_type='+ 'D'+ '&' + 'VendorId='+  0 + '&' + 'VendorContactId='+ 0 + '&', 
                dataType: "json"
            });
            return response;
        }

        this.LoadWOAttachment = function (WOHeaderGId) {
            var response = $http({
                method: "post",
                url: '@Url.Action("GetWOAttachments", "WONew")?WOHeaderGId=' + WOHeaderGId,
                dataType: "json"
            });
            return response;
        }

        this.SaveWOAttachment = function (WOAttachmentInsert) {
            var response = $http({
                method: "post",
                data: JSON.stringify(WOAttachmentInsert),
                url: '@Url.Action("CreateWOAttachment", "WONew")?' + new Date().getTime(),
                dataType: "json"
            });
            return response;
        }

        this.DeleteAttachment = function (AttachmentID) {
            var response = $http({
                method: "post",
                url: '@Url.Action("DeleteAttachment", "WONew")?id=' + AttachmentID,
                dataType: "json"
            });
            return response;
        }

    });
    myAppWO.filter('Pagestart', function () {
        return function (input, start) {
            if (input) {
                start = +start;
                return input.slice(start);
            }
            return [];
        }
    });
    myAppWO.controller('wonewController', function ($scope, wonewservice) {
        GetWONewDetails();
        GetNewReviceLoc();
        $scope.filteredItemsWO = 0;
        $scope.filteredgstItem = 0;
        $scope.maxSize = 5;
        $scope.PerPageItems = 5;
        $scope.currentPage = 1;

        $scope.months = [
           { id: 1, name: 'Jan' }, { id: 2, name: 'Feb' }, { id: 3, name: 'Mar' }, { id: 4, name: 'Apr' },
           { id: 5, name: 'May' }, { id: 6, name: 'Jun' }, { id: 7, name: 'Jul' }, { id: 8, name: 'Aug' },
           { id: 9, name: 'Sep' }, { id: 10, name: 'Oct' }, { id: 11, name: 'Nov' }, { id: 12, name: 'Dec' }
        ];

        function GetWONewDetails() {
            var wogid = '@ViewBag.wogid';
            if (wogid != "0")
                $scope.WOGid = wogid;
            else if ($scope.WOGid != null && $scope.WOGid != "" && $scope.WOGid != "0")
                wogid = $scope.WOGid;

            if (wogid == null || wogid == "" || wogid == 0) {
                var getData = wonewservice.GetWONewDetailsList();
                getData.then(function (response) {
                    //var Data0 = "", Data1 = "",Data2 ="";
                    //Data0 = JSON.parse(response.data.data0);
                    //$scope.WOVendorGid = Data0[0].WOVendorGid;
                    //$scope.WOVendorName = Data0[0].WOVendorName;
                    //$scope.WORequestFor = Data0[0].WORequestFor;
                    //$scope.WORaiserName = Data0[0].WORaiserName;
                    //$scope.WODate = Data0[0].WODate;
                    //$scope.WODetailProductCode = Data0[0].WODetailProductCode;
                    //$scope.WODetailProductName = Data0[0].WODetailProductName;
                    //$scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                    //$scope.WOProductGid = Data0[0].WOProductGid;
                    //$scope.WORequestForGid = Data0[0].WORequestForGid;
                    //$scope.WOAmount = Data0[0].WOAmount;
                    //$scope.WOUtilAmount = Data0[0].WOUtilAmount;
                    //$scope.CBFQuantity = Data0[0].CBFQuantity;
                    //$scope.WOProdServiceFlag = Data0[0].WOProdServiceFlag;
                    //$scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                    //$scope.ChildProductGroup = Data0[0].ChildProductGroup;
                    //Data1 = JSON.parse(response.data.data1);
                    //$scope.TermCondGid = Data1[0].TermCondGid;
                    //$scope.TermCondContent = Data1[0].TermCondContent;
                    //Data2 = JSON.parse(response.data.data2);
                    //$scope.TermsAndCondList = Data2;
                    //$scope.TermsAndCondValue = $scope.TermCondGid;
                    var ErrorMsg1 = response.data.ErrorMsg;
                    if (ErrorMsg1 == "1") {
                        jAlert("Invalid OBF", "Error", function () {
                            return false;
                        });
                    }
                    else if (ErrorMsg1 == "2") {
                        jAlert("Error While Save Details", "Error", function () {
                            return false;
                        });
                    }
                    var Data0 = "", Data1 = "", ErrorMsg = "";
                    Data0 = JSON.parse(response.data.data0);
                    $scope.woparentdetails = JSON.parse(response.data.data1);
                    var Totamamountlist = 0.00;
                    for (i = 0; i < $scope.woparentdetails.length; i++) {
                        var tot = ($scope.woparentdetails[i].WODetailTotalAmount);
                        Totamamountlist += Number(tot);
                    }
                    $scope.TotalAmount = Totamamountlist.toFixed(2);
                    $scope.WORefNumber = Data0[0].WORefNumber;
                    $("#txtVersion").text(Data0[0].WOVersion);
                    $scope.WOGid = Data0[0].WOGid;
                    $scope.TermCondGid = Data0[0].TermCondGid;
                    $scope.TermCondContent = Data0[0].TermCondContent;
                    $scope.WOVendorGid = Data0[0].WOVendorGid;
                    $("[name=txtVendorNameCustomGid]").val(Data0[0].WOVendorGid)
                    $scope.WOVendorName = Data0[0].WOVendorName;
                    $scope.WORequestFor = Data0[0].WORequestFor;
                    $scope.WORaiserName = Data0[0].WORaiserName;
                    $scope.WODate = Data0[0].WODate;
                    $scope.CBFQuantity = Data0[0].CBFQuantity;
                    $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                    $scope.WODetailProductName = Data0[0].WODetailProductName;
                    $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                    $scope.WOProductGid = Data0[0].WOProductGid;
                    $scope.WORequestForGid = Data0[0].WORequestForGid;
                    $scope.WOAmount = Data0[0].WOAmount;
                    $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                    $scope.WODescription = Data0[0].WODescription;
                    $scope.AdditionalTermCondContent = Data0[0].AdditionalTermCondContent;
                    $scope.WOProdServiceFlag = Data0[0].WOProdServiceFlag;
                    $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                    $scope.ChildProductGroup = Data0[0].ChildProductGroup;
                    $scope.WOPanno = Data0[0].panno;
                    $scope.WOVendorCode = Data0[0].code;
                   
                    $scope.AvailableAmount = Data0[0].AvailableAmount;
                    if ($scope.WORequestFor == "IT")
                        $scope.WOITType = Data0[0].WOITType;
                    $("[id=txtCbfDetailsGid]").val(Data0[0].CBFDetailGid);
                    $("[name=txtWOHeaderGid]").val($scope.WOGid);
                    $scope.filteredItemsWO = $scope.woparentdetails.length;
                    Data1 = JSON.parse(response.data.data2);
                    $scope.TermsAndCondList = Data1;
                    $scope.TermsAndCondValue = $scope.TermCondGid;
                    if (response.data.data3 != null && response.data.data3 != "" && JSON.parse(response.data.data3) != null) {
                        var Data3 = JSON.parse(response.data.data3);
                        if (Data3.length > 0) {
                            for (var i = 0; i < Data3.length; i++) {
                                $('<option/>').val(Data3[i].ContactId).html(Data3[i].Addresslist).appendTo('#TxtVendorAddress')
                            }
                            // $("#txtvendoraddress").removeClass("required");
                            // $("#txtvendoraddress").addClass("valid");
                        }
                    }
                }, function () {
                    alert('Error in adding record');
                });
            }
            else {
                var getData = wonewservice.GetWONewDetailsList1($scope.WOGid);
                getData.then(function (response) {
                    var Data0 = "", Data1 = "";
                    Data0 = JSON.parse(response.data.data0);
                    $scope.woparentdetails = JSON.parse(response.data.data1);
                    var Totamamountlist = 0.00;
                    for (i = 0; i < $scope.woparentdetails.length; i++) {
                        var tot = ($scope.woparentdetails[i].WODetailTotalAmount);
                        Totamamountlist += Number(tot);
                    }
                    $scope.TotalAmount = Totamamountlist.toFixed(2);
                    $scope.WORefNumber = Data0[0].WORefNumber;
                    $("#txtVersion").text(Data0[0].WOVersion);
                    $scope.WOGid = Data0[0].WOGid;
                    $scope.TermCondGid = Data0[0].TermCondGid;
                    $scope.TermCondContent = Data0[0].TermCondContent;
                    $scope.WOVendorGid = Data0[0].WOVendorGid;
                    $("[name=txtVendorNameCustomGid]").val(Data0[0].WOVendorGid)
                    $scope.WOVendorName = Data0[0].WOVendorName;
                    $scope.WORequestFor = Data0[0].WORequestFor;
                    $scope.WORaiserName = Data0[0].WORaiserName;
                    $scope.WODate = Data0[0].WODate;
                    $scope.CBFQuantity = Data0[0].CBFQuantity;
                    $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                    $scope.WODetailProductName = Data0[0].WODetailProductName;
                    $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                    $scope.WOProductGid = Data0[0].WOProductGid;
                    $scope.WORequestForGid = Data0[0].WORequestForGid;
                    $scope.WOAmount = Data0[0].WOAmount;
                    $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                    $scope.WODescription = Data0[0].WODescription;
                    $scope.AdditionalTermCondContent = Data0[0].AdditionalTermCondContent;
                    $scope.WOProdServiceFlag = Data0[0].WOProdServiceFlag;
                    $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                    $scope.ChildProductGroup = Data0[0].ChildProductGroup;
                    $scope.WOVendorCode = Data0[0].code;
                    $scope.WOPanno = Data0[0].panno;
                    $scope.AvailableAmount = Data0[0].AvailableAmount;
                    if ($scope.WORequestFor == "IT")
                        $scope.WOITType = Data0[0].WOITType;
                    $("[id=txtCbfDetailsGid]").val(Data0[0].CBFDetailGid);
                    $("[name=txtWOHeaderGid]").val($scope.WOGid);
                    $scope.filteredItemsWO = $scope.woparentdetails.length;

                    Data1 = JSON.parse(response.data.data2);
                    $scope.TermsAndCondList = Data1;
                    $scope.TermsAndCondValue = $scope.TermCondGid;
                    $scope.LoadWOAttachment();
                    if (response.data.data3 != null && response.data.data3 != "" && JSON.parse(response.data.data3) != null) {
                        var Data3 = JSON.parse(response.data.data3);
                        if (Data3.length > 0) {
                            for (var i = 0; i < Data3.length; i++) {
                                $('<option/>').val(Data3[i].ContactId).html(Data3[i].Addresslist).appendTo('#TxtVendorAddress')
                            }
                            // $("#txtvendoraddress").removeClass("required");
                            // $("#txtvendoraddress").addClass("valid");
                        }
                    }
                }, function () {
                    alert('Error in adding record');
                });
                var getData33 = wonewservice.GetAuditTrail($scope.WOGid);
                getData33.then(function (response) {
                    $scope.woaudittrail = response.data;
                    $scope.filteredItemsWOAuditTrail = $scope.woaudittrail.length;
                }, function () {
                    alert('Error While Loading Audit Trail');
                });
            }

        }

        //K.Bharathidhasan...

        $("#ddlVendorNameWO").keyup(function (e) {
            var IsExists = $('#txtwovendorcode').val();
            if (e.which != 13) {
                $("[name=txtVendorNameCustomGid]").val("0");
            }

            $("#ddlVendorNameWO").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("GetVendorNameAutoComplete", "WONew")?' + new Date().getTime(),
                        data: "{ 'searchtext' : '" + $("#ddlVendorNameWO").val() + "'}",
                        dataType: "json",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            response($.map(data, function (item) {
                                return {
                                    label: item.split('~')[1],
                                    val: item.split('~')[0],
                                    code: item.split('~')[3],
                                    panno: item.split('~')[2]
                                }
                            }));
                        },
                        error: function (response) {
                        },
                        failure: function (response) {
                        }
                    });
                },
                select: function (e, i) {

                    //if (IsExists != "" && IsExists != undefined) {
                        var POHeaderGId = $("[name=txtWOHeaderGid]").val();
                        var vendAddress = $("#TxtVendorAddress").val();
                        var vendorid = i.item.val;                         
                        var Header_type = 'H';
                        jConfirm("Are you sure? Want to remove Shipment & GST!", "Confirm", function (callback) {
                            if (callback == true) {
                                var inputFilter = {
                                    POId: POHeaderGId,
                                    Header_type: Header_type,
                                    VendorId: vendorid,
                                    VendorContactId: vendAddress

                                };
                                $.ajax({
                                    type: "post",
                                    url: '../PO//DeletePoGstDetails',
                                    data: JSON.stringify(inputFilter),
                                    contentType: "application/json;",
                                    success: function (response) {
                                        var Data1 = "";
                                        if (response.Data1 != null && response.Data1 != "" && JSON.parse(response.Data1) != null) {
                                            Data1 = JSON.parse(response.Data1);
                                            if (Data1[0].clear == true) {
                                                jAlert(Data1[0].Msg, "Success", function () {
                                                   // alert('abc');
                                                    GetWONewDetails();
                                                });
                                            }
                                            else {

                                                GetWONewDetails();
                                                jAlert(Data1[0].Msg, "Message");
                                            }
                                        }
                                    },
                                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                                        //alert(errorThrown);
                                    }
                                });
                                return false;
                            }
                            else {
                                GetWONewDetails();
                            }
                        });
                   // }


                    $("[name=txtVendorNameCustomGid]").val(i.item.val);
                    $("#ddlVendorNameWO").val(i.item.label);
                    $("#txtwopanno").val(i.item.panno);
                    $("#txtwovendorcode").val(i.item.code);
                    var id = {
                        VendorId: i.item.val
                    };
                    $.ajax({
                        type: "post",
                        url: '@Url.Action("GetVendorAddress", "WONew")',
                        data: JSON.stringify(id),
                        contentType: "application/json;",
                        success: function (response) {
                            if (response.Data1 != null && response.Data1 != "" && JSON.parse(response.Data1) != null) {
                                Data1 = JSON.parse(response.Data1);
                                //self.POAddressArray(Data1);
                                if (Data1.length > 0) {
                                    $('#TxtVendorAddress').find('option').remove();
                                    for (var i = 0; i < Data1.length; i++) {
                                        $('<option/>').val(Data1[i].ContactId).html(Data1[i].Addresslist).appendTo('#TxtVendorAddress')
                                    }
                                    // $("#TxtVendorAddress").removeClass("required");
                                    // $("#TxtVendorAddress").addClass("valid");
                                }
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            //alert(errorThrown);
                        }
                    });
                },
                minLength: 1
            });

        });

        //K.Bharathidhasan

        function GetNewReviceLoc() {
            var getData = wonewservice.GetReciverLocation();
            getData.then(function (response) {
                var Data0 = "";
                Data0 = JSON.parse(response.data.Data4);
                WoReciverLocationArray = Data0;
            }, function () {
                alert('Error in adding record');
            });
        }
        $scope.AddWOParentDetails = function () {

            $("#txtServMonthParentE").val("");
            $scope.WODetailParentGid = 0;
            $("#AddWODetailsParentDIV").css("display", "");
            objADDWOParent.dialog({ title: 'Add WO Details', width: '780', height: '300' });
            objADDWOParent.dialog("open");
        }
        $scope.SaveWOParentDetails = function () {
            debugger;
            var cbfamount = $("#hdncbfamount").val();
            var GSTExist = $("#hdnIsGSTExist").val();
            //alert(cbfamount);
            var entunitamnt = $("#txtUnitAmntParentVal").val();
            var ParentProductId = $("[name=txtWOProductGidParent]").val();
            var ParentTotalWOAmount = $("[name=txtTotalAmountWOParent]").val();
            var ParentVendorGid = $("[name=txtWOVendorGid]").val();
            var CustVendorGid = $("[name=txtVendorNameCustomGid]").val();
            var ParentRequestForGid = $("[name=txtRequestForGid]").val();
            var POHeaderGid = $("[name=txtWOHeaderGid]").val();
            var cbfdetailsgid = $("[id=txtCbfDetailsGid]").val();
            var woittype = "";
            if ($scope.WORequestFor == "IT")
                woittype = $scope.WOITType;
            //if ($scope.WOProdServiceFlag == 'P') {
            //    $scope.WODetailServiceMonth = "";
            //}
            //else {
            //    $scope.WODetailQty = "0";
            //    $scope.WODetailUnitAmount = $scope.WOAmount;
            //    ParentTotalWOAmount = $scope.WOAmount;
            //}
            if (ParentTotalWOAmount == null || ParentTotalWOAmount == "" || ParentTotalWOAmount == "0" || ParentTotalWOAmount == 0) {
                jAlert("Enter Valid Amount", "Error", function () {
                    return false;
                });
                return false;
            }
            if (parseInt(cbfamount) < parseInt(ParentTotalWOAmount)) {
                jAlert("Wo Amount Exceeds OBF Amount", "Error", function () {
                    return false;
                });
                return false;
            }


            // bharathidhasan kumar
            if (parseInt($scope.WOUtilAmount) > parseInt($scope.WOAmount)) {
                jAlert("Wo Amount Exceeds OBF Amount", "Error", function () {
                    return false;
                });
                return false;
            }
            var totamnt = 0;
            if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                for (var i = 0; i < $scope.woparentdetails.length; i++) {
                    totamnt += parseInt($scope.woparentdetails[i].WODetailTotalAmount);
                }
                $scope.WOUtilAmount = totamnt;
            }
            if (CustVendorGid != null && CustVendorGid != "" && CustVendorGid != "0") {
                ParentVendorGid = CustVendorGid;
            }
            if ($scope.WOProdServiceFlag == 'P') {
                $scope.WODetailServiceMonth = "";
            }
            var taxamnt = $("#txtxTaxAmountParent").val();
            if (taxamnt == null || taxamnt == "") {
                taxamnt = 0;
            }
            if (POHeaderGid == null || POHeaderGid == "" || POHeaderGid == 0) {

                var WoParentDetailsInsert = {
                    //for header
                    WORequestFor: $scope.WORequestFor,
                    WORequestForGid: ParentRequestForGid,
                    WOVendorGid: ParentVendorGid,
                    WODescription: $scope.WODescription,
                    WOUtilAmount: $scope.WOUtilAmount,
                    TermCondGid: $scope.TermCondGid,
                    AdditionalTermCondContent: $scope.AdditionalTermCondContent,
                    WOITType: woittype,
                    //for details
                    WOProductGid: ParentProductId,
                    WODetailServiceMonth: $scope.WODetailServiceMonth,
                    WODetailQty: $scope.WODetailQty,
                    WODetailUnitAmount: $scope.WODetailUnitAmount,
                    WODetailDescription: $scope.WODetailDescription,
                    WODetailTotalAmount: ParentTotalWOAmount,
                    WODetailUOM: $scope.WODetailUOM,
                    WODetailTax: $scope.WODetailTax,
                    WODetailTaxAmount: taxamnt,
                    WODetailDiscount: $scope.WODetailDiscount,
                    WODetailOthers: $scope.WODetailOthers,
                    CBFDetailGid: cbfdetailsgid
                };

                var getData = wonewservice.AddWOParentDetailsList(WoParentDetailsInsert);
                getData.then(function (response) {
                    var Data0 = "", Data1 = "";
                    var ErrorMsg1 = response.data.ErrorMsg;
                    if (ErrorMsg1 == "1") {
                        jAlert("Error While Save Details", "Error", function () {
                            return false;
                        });
                    }
                    else {
                        Data0 = JSON.parse(response.data.data0);
                        $scope.woparentdetails = JSON.parse(response.data.data1);
                        $scope.WORefNumber = Data0[0].WORefNumber;
                        $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                        $scope.WOGid = Data0[0].WOGid;
                        $scope.TermCondGid = Data0[0].TermCondGid;
                        $scope.TermCondContent = Data0[0].TermCondContent;
                        $("[name=txtWOHeaderGid]").val($scope.WOGid);
                        $scope.filteredItemsWO = $scope.woparentdetails.length;   // Intially when no filter is applied.
                        //     $scope.totalItems = $scope.woparentdetails.length;
                        Data1 = JSON.parse(response.data.data1);
                        $scope.TermsAndCondList = Data1;
                        $scope.TermsAndCondValue = $scope.TermCondGid;
                        var getData = wonewservice.GetWONewDetailsList1($scope.WOGid);
                        jAlert("WO Detail Added Successfully", "Success", function () {
                            return false;
                        });
                    }
                }, function () {
                    alert('Error in adding record');
                });
            }
            else {
                var wodetgid = $scope.WODetailParentGid;
                var WoParentDetailsInsert = {
                    //for header
                    WORequestFor: $scope.WORequestFor,
                    WORequestForGid: ParentRequestForGid,
                    WOVendorGid: ParentVendorGid,
                    WODescription: $scope.WODescription,
                    WOUtilAmount: $scope.WOUtilAmount,
                    TermCondGid: $scope.TermCondGid,
                    AdditionalTermCondContent: $scope.AdditionalTermCondContent,
                    WOITType: woittype,
                    //for details
                    WOProductGid: ParentProductId,
                    WODetailServiceMonth: $scope.WODetailServiceMonth,
                    WODetailQty: $scope.WODetailQty,
                    WODetailUnitAmount: $scope.WODetailUnitAmount,
                    WODetailDescription: $scope.WODetailDescription,
                    WODetailTotalAmount: ParentTotalWOAmount,
                    CBFDetailGid: cbfdetailsgid,
                    WODetailUOM: $scope.WODetailUOM,
                    WODetailTax: $scope.WODetailTax,
                    WODetailTaxAmount: taxamnt,
                    WODetailDiscount: $scope.WODetailDiscount,
                    WODetailOthers: $scope.WODetailOthers,
                    WOGid: $scope.WOGid,
                    WODetailParentGid: $scope.WODetailParentGid
                };

                var getData;
                var AlertMsg = "";
                if (wodetgid == null || wodetgid == "" || wodetgid == 0) {
                    getData = wonewservice.AddWOParentDetailsList1(WoParentDetailsInsert);
                    AlertMsg = "WO Detail Added Successfully";
                }
                else {
                    // bharathidhasan
                    jConfirm("Are you sure, Want to delete GST Tax Details, if Exist?", "Confirm", function (callback) {
                        if (callback == true) {
                            //var inputFilter = {
                            //    WoDetailsId: WoDetailsId
                            //};

                            var getData3 = wonewservice.CancelGstDetails(wodetgid);
                            getData3.then(function (response) {
                                var Data1 = JSON.parse(response.data.Data1);
                                //alert(Data1[0].clear);
                                if (Data1[0].clear == true) {
                                    jAlert(Data1[0].Msg, "Success", function () {
                                        getData = wonewservice.UpdateWOParentDetailsList(WoParentDetailsInsert);
                                        
                                        GetWONewDetails();
                                        AlertMsg = "WO Detail Updated Successfully";

                                        getData.then(function (response) {
                                            var Data0 = "", Data1 = "";
                                            var ErrorMsg1 = response.data.ErrorMsg;
                                            if (ErrorMsg1 == "1") {
                                                jAlert("Error While Save Details", "Error", function () {
                                                    return false;
                                                });
                                            }
                                            else {
                                                Data0 = JSON.parse(response.data.data0);
                                                $scope.woparentdetails = JSON.parse(response.data.data1);
                                                $scope.WORefNumber = Data0[0].WORefNumber;
                                                $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                                                $scope.WOGid = Data0[0].WOGid;
                                                $("[name=txtWOHeaderGid]").val($scope.WOGid);
                                                $scope.TermCondGid = Data0[0].TermCondGid;
                                                $scope.TermCondContent = Data0[0].TermCondContent;
                                                $scope.filteredItemsWO = $scope.woparentdetails.length;   // Intially when no filter is applied.
                                                //$scope.totalItems = $scope.woparentdetails.length;
                                                Data1 = JSON.parse(response.data.data1);
                                                $scope.TermsAndCondList = Data1;
                                                $scope.TermsAndCondValue = $scope.TermCondGid;
                                                jAlert(AlertMsg, "Success", function () {
                                                    CloseParentDialog();
                                                    return false;
                                                });
                                            }
                                        }, function () {
                                            alert('Error in adding record');
                                        });


                                    });

                                }
                                else {
                                    //alert('a');
                                    gstDeleteflag = "Y";
                                    jAlert(Data1[0].Msg, "Message");
                                }

                            }, function () {
                                jAlert("Error While Validating Shipment", "Error", function () {
                                    return false;
                                });
                            });
                        }
                        else {
                            GetWONewDetails();
                        }
                    });
                }

            }
        }
        $scope.SaveGsttaxDetails = function () {
            debugger;
            var TaxsubtypeId = "";
            var Taxablamt = "";
            var TaxAmt = "";
            var netamt = parseFloat($("#txtgstnetamt").val());
            var ProvLocationId = $("#txtgstproloc").val();
            var ReceiverLocationId = $("#TxtGstReciverLocionId").val();
            if (netamt == 0) {
                jAlert("Please Check Net Amount!", "Message");
                return false;
            }
            if (ProvLocationId == 0) {
                jAlert("Provider Location should not be Empty!", "Message");
                return false;
            }
            if (ReceiverLocationId == 0) {
                jAlert("Receiver Location should not be Empty!", "Message");
                return false;
            }
            if ($scope.GstgridedetailsList.length == 0) {
                jAlert("Tax Details should not be Empty!", "Message");
                return false;
            }
            for (var i = 0; i < $scope.GstgridedetailsList.length; i++) {
                TaxsubtypeId = TaxsubtypeId + $scope.GstgridedetailsList[i].TaxsubTypegid + "|";
                Taxablamt = Taxablamt + $scope.GstgridedetailsList[i].Taxableamt + "|";
                TaxAmt = TaxAmt + $scope.GstgridedetailsList[i].Taxamt + "|";
            }
            var POHeaderGId = $("[name=txtWOHeaderGid]").val();
            var PODetilsId = $("#hIdWodetailId").val();
            var HsnId = $scope.GstgridedetailsList[0].hsn_gid;
            var TaxsubTypeId = TaxsubtypeId;
            var TaxablAmt = Taxablamt;
            var TaxRate = $scope.GstgridedetailsList[0].Rate;
            //TaxRate = TaxRate.replace("%", "");
            TaxRate = TaxRate;
            var NetAmt = $("#txtgstnetamt").val();
            var Vendorid = $("[name=txtVendorNameCustomGid]").val();
            var PoGstInsertdetls = {
                POHeaderGId: POHeaderGId,
                PODetilsId: PODetilsId,
                ProvLocationId: ProvLocationId,
                ReceiverLocationId: ReceiverLocationId,
                HsnId: HsnId,
                TaxsubTypeId: TaxsubTypeId,
                TaxablAmt: TaxablAmt,
                TaxRate: TaxRate,
                NetAmt: NetAmt,
                Vendorid: Vendorid,
                TaxAmt: TaxAmt
            };
            var getData = wonewservice.AddGstTaxdetails(PoGstInsertdetls);
            getData.then(function (response) {
                Data1 = JSON.parse(response.data.Data1);
                jAlert(Data1[0].Msg, "Message");
                CloseGSTDialog();
                GetWONewDetails()
            }, function () {
                alert('Error in adding record');
            });
        }
        $scope.filter = function () {
            $scope.filteredItemsWO = $scope.filtered.length;
        };
        $scope.toggleTermsAndCond = function () {
            $("[id=divTermsandCond]").slideToggle();
        }
        $scope.EditWoParent = function (wodetailgid) {
            $scope.WODetailParentGid = wodetailgid;
            var getData3 = wonewservice.ChkWOSplitExists(wodetailgid);
            getData3.then(function (response) {
                var ErrorMsg1 = response.data;
                if (ErrorMsg1 == "1") {
                    ErrorMsg1 = "0";
                }
                if (ErrorMsg1 == "404") {
                    jAlert("Error While Validating with Split..!", "Error", function () {
                        return false;
                    });
                    return false;
                }
                else if (parseInt(ErrorMsg1) > 0) {
                    jAlert("You Can't Edit the parent details.\n(Already split has been done)", "Error", function () {
                        return false;
                    });
                    return false;
                }
                else if (parseInt(ErrorMsg1) == 0) {
                    var getdata1 = wonewservice.GetUOM();
                    getdata1.then(function (response) {
                        var ErrorMsg1 = response.data.ErrorMsg;
                        if (ErrorMsg1 == "1") {
                            jAlert("Error While Loading UOM", "Error", function () {
                                return false;
                            });
                            return false;
                        }
                        $scope.uomlist = JSON.parse(response.data.data0);
                        //$scope.WODetailUOM = 0;
                    }, function () {
                        alert('Error while binding UOM');
                    });
                    var getData = wonewservice.GetWODetailParent(wodetailgid);
                    getData.then(function (response) {
                        var Data0 = "";
                        debugger;
                        Data0 = JSON.parse(response.data.data0);
                        $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                        $scope.WODetailProductName = Data0[0].WODetailProductName;
                        $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                        $scope.WOProductGid = Data0[0].WOProductGid;
                        $scope.WOProdServiceFlag = Data0[0].WOProdServiceFlag;
                        $scope.WODetailServiceMonth = Data0[0].WODetailServiceMonth;
                        $scope.WODetailQty = Data0[0].WODetailQty;
                        $scope.WODetailUnitAmount = Data0[0].WODetailUnitAmount;
                        $scope.WODetailDescription = Data0[0].WODetailDescription;
                        $scope.WODetailTax = Data0[0].WODetailTax;
                        $scope.WODetailTaxAmount = Data0[0].WODetailTaxAmount;
                        $scope.WODetailOthers = Data0[0].WODetailOthers;
                        $scope.WODetailDiscount = Data0[0].WODetailDiscount;
                        $scope.WODetailUOM = Data0[0].WODetailUOM;
                        $scope.CbfTotalAmount = Data0[0].CbfAmount;
                        $scope.IsGSTExist = Data0[0].IsGSTExist;
                        var lblamt = $("#Lblutlamount").text();
                        var lablam = lblamt.trim();
                        var utlit = lablam.substring(17, 2000000);
                        var lblamt1 = $("#Lblmaxtotal").text();
                        var lablam1 = lblamt1.trim();
                        var total = lablam1.substring(27, 2000000);
                        var woamount = Data0[0].WODetailUnitAmount;
                        //var total = $('#Txttotalamount').val();
                        //var utlit = $('#Txtuliamount').val();
                        var balance = utlit - woamount;
                        var totbal = total - balance;
                        $("#TxtAvil").val(totbal);
                        var total = parseFloat(woamount) * parseFloat(Data0[0].WODetailQty);
                        $("#TxtCurrentBal").val(total);
                        $("[name=txtTotalAmountWOParent]").val(Data0[0].WODetailTotalAmount);

                        $("#AddWODetailsParentDIV").css("display", "");
                        objADDWOParent.dialog({ title: 'Edit WO Details', width: '780', height: '450' });
                        objADDWOParent.dialog("open");

                    }, function () {
                        alert('Error in Edit WO');
                    });
                }
            });

        }
        //Add by GST Tax details
        $scope.GetGstDetails = function (wodetailgid, checked) {
            //bharathidhasan kumar
            if (checked == 1) {
                var WoDetailsId = wodetailgid;
                var vendName = $("#ddlVendorNameWO").val();
                var vendorid = $("[name=txtVendorNameCustomGid]").val();
                if (vendorid == "" || vendorid == null || vendorid == 0 || vendorid == "0") {
                    jAlert("Ensure Valid Vendor Name", "Error", function () {
                        return false;
                    });
                    return false;
                }
                var getdata = wonewservice.GetWOShipment(WoDetailsId, vendorid);
                getdata.then(function (response) {
                    debugger;
                    var Data0 = "", Data1 = "", Data2 = "", Data3 = "", Data4 = "";
                    if (response.data.data0 != null && response.data.data0 != "") {

                        var Reciverlocation = WoReciverLocationArray;
                        var shipment = JSON.parse(response.data.data0);
                        for (var i = 0; i < shipment.length; i++) {
                            if (shipment[i].wodetailsid == wodetailgid) {
                                var stategid = shipment[i].Stategid;
                                if (stategid != null) {

                                    for (var j = 0; j < Reciverlocation.length; j++) {
                                        if (Reciverlocation[j].Id == stategid) {
                                            $("#txtgstficcl").val(Reciverlocation[j].BranchGstno);
                                            $("#txtgsrecloc").val(Reciverlocation[j].Combo);
                                            $("#TxtGstReciverLocionId").val(Reciverlocation[j].Id);
                                            //valueChange($("#txtgstficcl"));
                                            //valueChange($("#txtgsrecloc"));
                                            break;
                                        }
                                    }
                                }
                                else {
                                    $("#txtgstficcl").val("");
                                    $("#txtgsrecloc").val("");
                                    $("#TxtGstReciverLocionId").val(0);
                                }

                            }
                        }
                        if (response.data.data1 != null && response.data.data1 != "") {
                            $scope.filteredgstItem = JSON.parse(response.data.data1).length;
                            $scope.GstgridedetailsList = JSON.parse(response.data.data1);
                        }
                        else {
                            $scope.filteredgstItem = 0;
                        }
                        if (response.data.data2 != null && response.data.data2 != "") {
                            var Data1 = JSON.parse(response.data.data2);
                            $("#txtgstPORefNo").val($("#txtPORefNo").val());
                            $("#txtgstPODate").val($("#txtPODate").val());
                            $("#txtgstvename").val($("#ddlVendorNameWO").val());
                            $("#txtgstvencode").val($("#txtwovendorcode").val());
                            var total = $("#Lblmaxtotal").text().trim();
                            total = total.replace("Maximum Utilizable Amount :", "");
                            $("#txtgstPOAmt").val(total);
                            $("#hIdWodetailId").val(Data1[0].PODetailsGId);
                            $("#txtgstprogrp").val((Data1[0].ProductGroup));
                            $("#txtgstprocode").val((Data1[0].ProductCode));
                            $("#txtgstProname").val((Data1[0].ProductName));
                            $("#txtgsttaxes").val((Data1[0].Taxes));
                            $("#txtgstuom").val((Data1[0].UOM));
                            $("#txtgstqty").val((Data1[0].Qty));
                            $("#txtgstrate").val((Data1[0].UnitPrice));
                            $("#txtgstbtamt").val((Data1[0].BaseAmount));
                            $("#txtgstnetamt").val((Data1[0].Total));
                        }
                        if (response.data.data3 != null && response.data.data3 != "") {
                            $scope.ProviderLocationlist = JSON.parse(response.data.data3);
                            $scope.pstate = {
                                organization1: $scope.ProviderLocationlist[0]

                            };


                            var providerlocation = JSON.parse(response.data.data3);
                            if (response.data.data1 != null && response.data.data1 != "" && JSON.parse(response.data.data1) != null) {
                                var Data2 = JSON.parse(response.data.data1);
                                for (var j = 0; j < providerlocation.length; j++) {
                                    if (providerlocation[j].Gsnno == Data2[0].Gsnno) {
                                        $("#txtgstproloc").val(providerlocation[j].Id);
                                        $scope.pstate = {
                                            organization1: $scope.ProviderLocationlist[j]

                                        };
                                        $("#txtgstinvendor").val(providerlocation[j].Gsnno);
                                        // $("#txtgstproloc").text(providerlocation[j].Combo);
                                        //
                                        //valueChange($("#txtgstproloc"));
                                        //valueChange($("#txtgstinvendor"));
                                        break;
                                    }
                                }
                            }

                        }

                        else {
                            $scope.pstate = {
                                organization1: $scope.ProviderLocationlist[1]
                            };
                            $("#txtgstinvendor").val("");
                        }
                        if (response.data.data4 != null && response.data.data4 != "") {
                            $scope.HSNlist = JSON.parse(response.data.data4);
                            var HSNCode = JSON.parse(response.data.data4);
                            for (var j = 0; j < HSNCode.length; j++) {
                                $("#txtHsnCode").val(HSNCode[j].hsn_gid);

                                $scope.referral = {
                                    Hsncode: $scope.HSNlist[j]
                                };

                            }
                        }


                        $("#Dialogaddgst").css("display", "");
                        objADDPOGST.dialog({ title: 'ADD GST Details', width: '900', height: '550' });
                        objADDPOGST.dialog("open");
                    }
                    else {
                        jAlert("Please Add Shipment Details!", "Error", function () {
                            return false;
                        });
                    }
                }, function () {
                    alert('Error while binding shipment details');
                });

            }
            else {
                return false;
            }
        }
        $scope.GetCheckId = function (wodetailgid, ChkLstId) {
            var WoDetailsId = wodetailgid;
            var CheckedId = ChkLstId;
            if (CheckedId == 1) {
                return false;
            }
            else {
                //var GSTExist = $("#hdnIsGSTExist").val();
                //if (GSTExist == "1") {
                jConfirm("Are you sure, Want to delete GST Tax Detail, if exist?", "Confirm", function (callback) {
                    if (callback == true) {
                        //var inputFilter = {
                        //    WoDetailsId: WoDetailsId
                        //};
                        var getData3 = wonewservice.CancelGstDetails(wodetailgid);
                        getData3.then(function (response) {
                            var Data1 = JSON.parse(response.data.Data1);
                            if (Data1[0].Clear == true) {
                                jAlert(Data1[0].Msg, "Success", function () {
                                });
                            }
                            else {
                                jAlert(Data1[0].Msg, "Message");
                            }

                        }, function () {
                            jAlert("Error While Validating Shipment", "Error", function () {
                                return false;
                            });
                        });
                    }
                    else {
                        GetWONewDetails();
                    }
                });
                //}

            }
        }
        $scope.SplitWO = function (wodetailgid, shipqty) {
            $scope.WODetailGid = wodetailgid;
            $scope.WoParentQtyShipment = shipqty;
            var viewtypesplit = '@ViewBag.viewtype';
            if (viewtypesplit != "1") {
                var getData3 = wonewservice.ChkWOShipment(wodetailgid);
                getData3.then(function (response) {
                    var ErrorMsg1 = response.data;
                    if (ErrorMsg1 == "0") {
                        jAlert("Ensure Shipment Before Split", "Error", function () {
                            return false;
                        });
                    }
                    else if (ErrorMsg1 == "404") {
                        jAlert("Error in adding record..!", "Error", function () {
                            return false;
                        });
                    }
                    else {
                        var getData2 = wonewservice.GetWODetailChild(wodetailgid);
                        getData2.then(function (response) {
                            var Data0 = "", Data1 = "";
                            Data0 = JSON.parse(response.data.data0);
                            $scope.WODetailServiceMonthParent = Data0[0].WODetailServiceMonth;
                            $scope.WODetailQtyParent = Data0[0].WODetailQty;
                            $scope.WODetailAmount = Data0[0].WODetailTotalAmount;
                            $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                            $scope.ChildProductGroup = Data0[0].ChildProductGroup;
                            $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                            $scope.WODetailProductName = Data0[0].WODetailProductName;
                            $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                            $scope.WOProductGid = Data0[0].WOProductGid;
                            $scope.WOParentCBFDetailGid = Data0[0].WOParentCBFDetailGid;
                            $scope.WODetailUOM = Data0[0].WODetailUOM;
                            $scope.WODetailPercentage = 0;
                            $scope.WODetailQtyChild = 0;
                            $("[name=txtWOHeaderGid]").val(Data0[0].Woheadergid);
                            if (response.data.data1 != null && response.data.data1 != "")
                                Data1 = JSON.parse(response.data.data1);
                            //$scope.wochilddetails = Data1;
                            // $scope.filteredItemsWOChild = $scope.wochilddetails.length;
                            $scope.AddWOChildDetails();
                            //$("#divChildDetails").css("display", "");
                            //objADDWOChild.dialog({ title: 'Split Details', width: '780', height: '500' });
                            //objADDWOChild.dialog("open");

                        }, function () {
                            alert('Error in adding record');
                        });
                    }
                }, function () {
                    jAlert("Error While Validating Shipment", "Error", function () {
                        return false;
                    });
                });
            }
            else {
                var getData = wonewservice.GetWODetailChild(wodetailgid);
                getData.then(function (response) {
                    var Data0 = "", Data1 = "";
                    //Data0 = JSON.parse(response.data.data0);
                    //$scope.WODetailServiceMonthParent = Data0[0].WODetailServiceMonth;
                    //$scope.WODetailQtyParent = Data0[0].WODetailQty;
                    //$scope.WODetailAmount = Data0[0].WODetailTotalAmount;
                    //$scope.WODetailPercentage = 0;
                    //$scope.WODetailQtyChild = 0;
                    //if (response.data.data1 != null && response.data.data1 != "")
                    //    Data1 = JSON.parse(response.data.data1);
                    //$scope.wochilddetails = Data1;
                    //$scope.filteredItemsWOChild = $scope.wochilddetails.length;
                    //$("#divChildDetails").css("display", "");
                    //objADDWOChild.dialog({ title: 'Split Details', width: '780', height: '500' });
                    //objADDWOChild.dialog("open");

                    //correction by sugumar
                    Data0 = JSON.parse(response.data.data0);
                    $scope.WODetailServiceMonthParent = Data0[0].WODetailServiceMonth;
                    $scope.WODetailQtyParent = Data0[0].WODetailQty;
                    $scope.WODetailAmount = Data0[0].WODetailTotalAmount;
                    $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                    $scope.ChildProductGroup = Data0[0].ChildProductGroup;
                    $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                    $scope.WODetailProductName = Data0[0].WODetailProductName;
                    $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                    $scope.WOProductGid = Data0[0].WOProductGid;
                    $scope.WOParentCBFDetailGid = Data0[0].WOParentCBFDetailGid;
                    $scope.WODetailUOM = Data0[0].WODetailUOM;
                    $scope.WODetailPercentage = 0;
                    $scope.WODetailQtyChild = 0;
                    $("[name=txtWOHeaderGid]").val(Data0[0].Woheadergid);
                    if (response.data.data1 != null && response.data.data1 != "")
                        Data1 = JSON.parse(response.data.data1);
                    //$scope.wochilddetails = Data1;
                    // $scope.filteredItemsWOChild = $scope.wochilddetails.length;
                    // $scope.AddWOChildDetails();
                    //$("#divChildDetails").css("display", "");
                    //objADDWOChild.dialog({ title: 'Split Details', width: '780', height: '500' });
                    //objADDWOChild.dialog("open");

                }, function () {
                    alert('Error in adding record');
                });
            }

        }
        $scope.AddWOChildDetails = function () {
            // var getdata = wonewservice.GetProductGroup($scope.WOProdServiceFlag);
            var getdata = wonewservice.GetProductGroupById($scope.WOProdServiceFlag, $scope.ChildProductGroupGid);
            getdata.then(function (response) {
                // $scope.productgrouplist = JSON.parse(response.data.data0);
                $scope.productlist = JSON.parse(response.data.data0);

                //$('#ddlChildProductGroupGid option[value="0"]').attr("selected", "selected");
                //$scope.ChildProductGroupGid = 0;
            }, function () {
                alert('Error while binding product group');
            });
            var getdata1 = wonewservice.GetUOM();
            getdata1.then(function (response) {
                var ErrorMsg1 = response.data.ErrorMsg;
                if (ErrorMsg1 == "1") {
                    jAlert("Error While Loading UOM", "Error", function () {
                        return false;
                    });
                    return false;
                }
                $scope.uomlist = JSON.parse(response.data.data0);
                //$scope.WODetailUOM = 0;
            }, function () {
                alert('Error while binding UOM');
            });
            $scope.WODetailUOM1 = 0;
            $scope.WODetailTax1 = 0;
            $scope.WODetailTaxAmount1 = 0;
            $scope.WODetailDiscount1 = 0;
            $scope.WODetailOthers1 = 0;

            $scope.WODetailChildGid = 0;
            $("#AddWODetailsChildDIV").css("display", "");
            objADDWOChildAdd.dialog({ title: 'Add Split', width: '780', height: '400' });
            objADDWOChildAdd.dialog("open");
        }
        $scope.getProductName = function () {
            var getdata = wonewservice.GetProductGroupById($scope.WOProdServiceFlag, $scope.ChildProductGroupGid);
            getdata.then(function (response) {
                $scope.productlist = JSON.parse(response.data.data0);
                //$('#ddlChildProductGid option[value="0"]').attr("selected", "selected");
                $scope.ChildProductGid = 0;
            }, function () {
                alert('Error while binding products');
            });
        }
        $scope.getProductDescription = function () {
            var getdata = wonewservice.GetProductDesc($scope.ChildProductGid);
            getdata.then(function (response) {
                var Data0 = "";
                Data0 = JSON.parse(response.data.data0);
                $scope.ChildProductDescription = Data0[0].ChildProductDescription;
            }, function () {
                alert('Error while binding product description');
            });
        }
        $scope.SaveSplit = function () {
            var ParentProductId = $("[name=txtWOProductGidParent]").val();
            var POHeaderGid = $("[name=txtWOHeaderGid]").val();
            var cbfdetailsgid = $("[id=txtCbfDetailsGid]").val();
            var ParentTotalWOAmount = "0";
            if (!$scope.SameAsParentProd) {
                ParentProductId = $scope.ChildProductGid;
            }
            if (ParentProductId == 0 || ParentProductId == null) {
                jAlert("Ensure the valid Product", "Error", function () {
                    return false;
                });
                return false;
            }
            if ($scope.WOProdServiceFlag == "S") {
                if ($scope.WODetailPercentage == 0 || $scope.WODetailPercentage == null) {
                    jAlert("Ensure the valid Percentage", "Error", function () {
                        $("#txtPercentageSplit").focus();
                        return false;
                    });
                    return false;
                }
            }
            if ($scope.WODetailQtyChild == 0 || $scope.WODetailQtyChild == null) {
                jAlert("Ensure the valid Qty", "Error", function () {
                    $("#txtQtySplit").focus();
                    return false;
                });
                return false;
            }
            if ($scope.WODetailUnitAmount == 0 || $scope.WODetailUnitAmount == null) {
                jAlert("Ensure the Unit Amount", "Error", function () {
                    $("#txtUnitAmntSplit").focus();
                    return false;
                });
                return false;
            }

            //if ($scope.WOProdServiceFlag == "P") {
            //    ParentTotalWOAmount = $("[name=txtTotalAmountWOChildP]").val();
            //    if ($scope.WODetailQtyChild > $scope.WODetailQtyParent) {
            //        jAlert("Total Qty Exceeds", "Error", function () {
            //            $("#txtQtySplit").val("");
            //            $("#txtQtySplit").focus();
            //            return false;
            //        });
            //        return false;
            //    }
            //}
            //else {
            //    ParentTotalWOAmount = $("[name=txtTotalAmountWOChildS]").val();
            //}
            //if(parseFloat(ParentTotalWOAmount) > parseFloat($scope.WODetailAmount)){
            //    jAlert("Total Amount Exceeds", "Error", function () {
            //        $("#txtPercentageSplit").val("");
            //        $("#txtPercentageSplit").focus();
            //        return false;
            //    });
            //    return false;
            //}
            //WODetailAmount * WODetailQtyChild / WODetailQtyParent --> QTY Calc
            //WODetailAmount * WODetailPercentage / 100  --> Percentage Calc
            var wodetgid1 = 0;
            if ($scope.WODetailChildGid != null && $scope.WODetailChildGid != "")
                wodetgid1 = parseInt($scope.WODetailChildGid);
            var totalamnt = 0;
            //if ($scope.WOProdServiceFlag == "P") {
            //    totalamnt = $("[name=txtTotalAmountWOChildP]").val();
            //    var qty = $scope.WODetailQtyChild;
            //    var finQty = parseInt(qty);
            //    if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
            //        for (var i = 0; i < $scope.wochilddetails.length; i++) {
            //            if (wodetgid1 > parseInt($scope.wochilddetails[i].WODetailGid))
            //               finQty += parseInt($scope.wochilddetails[i].WODetailQty);
            //        }
            //    }

            //    if (finQty > parseInt($scope.WODetailQtyParent)) {
            //        jAlert("Total Qty Exceeds", "Error", function () {
            //            $scope.WODetailQtyChild = 0;
            //            $("[name=txtTotalAmountWOChildP]").val("0");
            //            $("#txtQtySplit").val("");
            //            $("#txtQtySplit").focus();
            //            return false;
            //        });
            //        return false;
            //    }
            //}
            //else {
            totalamnt = $("[name=txtTotalAmountWOChildS]").val();
            //}
            //if ($scope.WOProdServiceFlag == "S") {
            //    if (parseFloat(totalamnt) != parseFloat($scope.EnteredPercentage)) {
            //        jAlert("Amount Mismatch With Percentage Entered", "Error", function () {
            //            $("#txtPercentageSplit").focus();
            //            return false;
            //        });
            //        return false;
            //    }
            //}
            var finamnt = parseFloat(totalamnt);
            if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
                for (var i = 0; i < $scope.wochilddetails.length; i++) {
                    if (wodetgid1 > parseInt($scope.wochilddetails[i].WODetailGid))
                        finamnt += parseFloat($scope.wochilddetails[i].WODetailTotalAmount);
                }
            }

            if (finamnt > parseFloat($scope.WODetailAmount)) {
                jAlert("Total Amount Exceeds\nSum of Split = " + finamnt + ", Max Limit = " + $scope.WODetailAmount, "Error", function () {
                    $scope.WODetailPercentage = 0;
                    $("[name=txtTotalAmountWOChildS]").val("0");
                    //$("#txtPercentageSplit").val("");
                    //$("#txtPercentageSplit").focus();
                    $("#txtQtySplit").val("0");
                    $("#txtUnitAmntSplit").val("0");
                    $("#txtPercentageSplit").val("0");
                    $("#txtQtySplit").focus();
                    $scope.WODetailQtyChild = 0;
                    $scope.WODetailUnitAmount = 0;
                    return false;
                });
                return false;
            }
            ParentTotalWOAmount = totalamnt;
            var wodetgid = $scope.WODetailChildGid;

            if (ParentTotalWOAmount == 0) {
                jAlert("Ensure the Amount", "Error", function () {
                    return false;
                });
                return false;
            }
            var taxamnt = $("#txtxTaxAmountSplit").val();
            if (taxamnt == null || taxamnt == "") {
                taxamnt = 0;
            }
            $scope.WOGid = POHeaderGid;

            var WoChildDetailsInsert = {
                WOProductGid: ParentProductId,
                WODetailServiceMonth: $scope.WODetailServiceMonthParent,
                WODetailQty: $scope.WODetailQtyChild,
                WODetailUnitAmount: $scope.WODetailUnitAmount,
                WODetailPercentage: $scope.WODetailPercentage,
                WODetailDescription: $scope.WODetailDescription,
                WODetailTotalAmount: ParentTotalWOAmount,
                CBFDetailGid: $scope.WOParentCBFDetailGid,
                WOGid: $scope.WOGid,
                WODetailParentGid: $scope.WODetailGid,
                WODetailUOM: $scope.WODetailUOM1,
                WODetailTax: $scope.WODetailTax1,
                WODetailTaxAmount: taxamnt,
                WODetailDiscount: $scope.WODetailDiscount1,
                WODetailOthers: $scope.WODetailOthers1,
                WODetailGid: $scope.WODetailChildGid
            };

            var getData;
            var AlertMsg = "";
            if (wodetgid == null || wodetgid == "" || wodetgid == 0 || wodetgid == "0") {
                getData = wonewservice.ADDWOChildDetailsList(WoChildDetailsInsert);
                getData.then(function (response) {
                    var Data0 = "", Data1 = "";
                    Data0 = JSON.parse(response.data.data0);
                    $scope.woparentdetails = JSON.parse(response.data.data0);
                    var Totamamountlist = 0.00;
                    for (i = 0; i < $scope.woparentdetails.length; i++) {
                        var tot = ($scope.woparentdetails[i].WODetailTotalAmount);
                        Totamamountlist += Number(tot);
                    }
                    $scope.TotalAmount = Totamamountlist.toFixed(2);
                    $scope.WORefNumber = Data0[0].WORefNumber;
                    $scope.WOGid = Data0[0].WOGid;
                    $scope.TermCondGid = Data0[0].TermCondGid;
                    $scope.TermCondContent = Data0[0].TermCondContent;
                    $scope.WOVendorGid = Data0[0].WOVendorGid;
                    $("[name=txtVendorNameCustomGid]").val(Data0[0].WOVendorGid)
                    $scope.WOVendorName = Data0[0].WOVendorName;
                    $scope.WORequestFor = Data0[0].WORequestFor;
                    $scope.WORaiserName = Data0[0].WORaiserName;
                    $scope.WODate = Data0[0].WODate;
                    $scope.CBFQuantity = Data0[0].CBFQuantity;
                    $scope.WODetailProductCode = Data0[0].WODetailProductCode;
                    $scope.WODetailProductName = Data0[0].WODetailProductName;
                    $scope.WODetailProductDescription = Data0[0].WODetailProductDescription;
                    $scope.WOProductGid = Data0[0].WOProductGid;
                    $scope.WORequestForGid = Data0[0].WORequestForGid;
                    $scope.WOAmount = Data0[0].WOAmount;
                    $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                    $scope.WODescription = Data0[0].WODescription;
                    $scope.AdditionalTermCondContent = Data0[0].AdditionalTermCondContent;
                    $scope.WOProdServiceFlag = Data0[0].WOProdServiceFlag;
                    $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                    $scope.ChildProductGroup = Data0[0].ChildProductGroup;
                    $scope.WOGid = Data0[0].Woheadergid;
                    if ($scope.WORequestFor == "IT")
                        $scope.WOITType = Data0[0].WOITType;
                    $("[id=txtCbfDetailsGid]").val(Data0[0].CBFDetailGid);
                    $("[name=txtWOHeaderGid]").val($scope.WOGid);
                    $scope.filteredItemsWO = $scope.woparentdetails.length;

                    Data1 = JSON.parse(response.data.data2);
                    $scope.TermsAndCondList = Data1;
                    $scope.TermsAndCondValue = $scope.TermCondGid;
                }, function () {
                    alert('Error in adding record');
                });
                AlertMsg = "WO Detail Added Successfully";
            }
            else {
                getData = wonewservice.UpdateWOChildDetailsList(WoChildDetailsInsert);
                AlertMsg = "WO Detail Updated Successfully";
            }
            getData.then(function (response) {
                var ErrorMsg1 = response.data.ErrorMsg;
                if (ErrorMsg1 == "1") {
                    jAlert("Error While Save Details", "Error", function () {
                        return false;
                    });
                }
                else {
                    var Data0 = "";
                    Data0 = JSON.parse(response.data.data0);
                    $scope.WODetailServiceMonth = Data0[0].WODetailServiceMonth;
                    $scope.WODetailQtyParent = Data0[0].WODetailQty;
                    $scope.WODetailAmount = Data0[0].WODetailTotalAmount;
                    $scope.WODetailPercentage = 0;
                    $scope.WODetailQtyChild = 0;
                    $scope.wochilddetails = JSON.parse(response.data.data1);
                    $scope.filteredItemsWOChild = $scope.wochilddetails.length;
                    jAlert(AlertMsg, "Success", function () {
                        CloseChildDialog();
                        return false;
                    });
                }
            }, function () {
                alert('Error in adding record');
            });

        }
        $scope.EditWoChild = function (wodetailgid) {

            $scope.WODetailChildGid = wodetailgid;

            //var getdata = wonewservice.GetProductGroup($scope.WOProdServiceFlag);
            //getdata.then(function (response) {
            //    $scope.productgrouplist = JSON.parse(response.data.data0);
            //    //$('#ddlChildProductGroupGid option[value="0"]').attr("selected", "selected");
            //    $scope.ChildProductGroupGid = 0;
            //}, function () {
            //    alert('Error while binding product group');
            //});

            var getData1 = wonewservice.GetWODetailChildById(wodetailgid);
            getData1.then(function (response) {
                var Data0 = "";
                Data0 = JSON.parse(response.data.data0);
                $scope.ChildProductDescription = Data0[0].WODetailProductDescription;
                $scope.WODetailServiceMonthParent = Data0[0].WODetailServiceMonth;
                $scope.WODetailQtyChild = Data0[0].WODetailQty;
                $scope.WODetailPercentage = Data0[0].WODetailPercentage;
                $scope.WODetailUnitAmount = Data0[0].WODetailUnitAmount;
                $scope.WODetailDescription = Data0[0].WODetailDescription;
                //$("[name=txtTotalAmountWOChildP]").val(Data0[0].WODetailTotalAmount);
                $("[name=txtTotalAmountWOChildS]").val(Data0[0].WODetailTotalAmount);
                if ($scope.WOProductGid == Data0[0].WOProductGid) {
                    $scope.SameAsParentProd = true;
                }
                else {
                    $scope.SameAsParentProd = false;
                }
                //   $('#ddlChildProductGroupGid option[value=' + Data0[0].ChildProductGroupGid + ']').attr("selected", "selected");
                $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                var getdata2 = wonewservice.GetProductGroupById($scope.WOProdServiceFlag, $scope.ChildProductGroupGid);
                getdata2.then(function (response) {
                    $scope.productlist = JSON.parse(response.data.data0);
                    //$('#ddlChildProductGid option[value="0"]').attr("selected", "selected");
                }, function () {
                    alert('Error while binding products');
                });
                var getdata3 = wonewservice.GetUOM();
                getdata3.then(function (response) {
                    var ErrorMsg1 = response.data.ErrorMsg;
                    if (ErrorMsg1 == "1") {
                        jAlert("Error While Loading UOM", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                    $scope.uomlist = JSON.parse(response.data.data0);
                    //$scope.WODetailUOM = 0;
                }, function () {
                    alert('Error while binding UOM');
                });

                $scope.ChildProductGid = Data0[0].WOProductGid;
                $scope.ChildProductGroupGid = Data0[0].ChildProductGroupGid;
                //  $('#ddlChildProductGid option[value=' + Data0[0].WOProductGid + ']').attr("selected", "selected");

                $("#AddWODetailsChildDIV").css("display", "");
                objADDWOChildAdd.dialog({ title: 'Edit Split', width: '780', height: '400' });
                objADDWOChildAdd.dialog("open");

            }, function () {
                alert('Error in adding record');
            });
        }
        $scope.ShipmentWOParent = function (wodetailgid) {
            $scope.ShipChildQty = 0;
            $("[name=txtWoDetailGidForShipment]").val(wodetailgid);
            $("[id=ddlBranchNameShipment]").val("");
            $("[id=ddlBranchInchargeShipment]").val("");

            var getdata = wonewservice.GetWOShipment(wodetailgid);
            getdata.then(function (response) {
                var Data0 = "";
                if (response.data.data0 != null && response.data.data0 != "")
                    Data0 = JSON.parse(response.data.data0);
                $scope.woshipmentdetails = Data0;
                filteredItemsWOShipment = $scope.woshipmentdetails.length;
            }, function () {
                alert('Error while binding shipment details');
            });
            $("#divShipmentDetails").css("display", "");
            objADDWOShipmentChildAdd.dialog({ title: 'Shipment Details', width: '700', height: '300' });
            objADDWOShipmentChildAdd.dialog("open");
        }
        $scope.ShipmentWOChild = function (wodetailgid, qty) {
            $scope.ShipChildQty = parseInt(qty);
            $("[name=txtWoDetailGidForShipment]").val(wodetailgid);
            $("[id=ddlBranchNameShipment]").val("");
            $("[id=ddlBranchInchargeShipment]").val("");

            var getdata = wonewservice.GetWOShipment(wodetailgid);
            getdata.then(function (response) {
                var Data0 = "";
                if (response.data.data0 != null && response.data.data0 != "")
                    Data0 = JSON.parse(response.data.data0);
                $scope.woshipmentdetails = Data0;
                filteredItemsWOShipment = $scope.woshipmentdetails.length;
            }, function () {
                alert('Error while binding shipment details');
            });
            $("#divShipmentDetails").css("display", "");
            objADDWOShipmentChildAdd.dialog({ title: 'Shipment Details', width: '700', height: '300' });
            objADDWOShipmentChildAdd.dialog("open");
        }
        $scope.SaveWoShipment = function () {
            var brName = $("[id=ddlBranchNameShipment]").val();
            var brIncharge = $("[id=ddlBranchInchargeShipment]").val();
            if (brName == null || brName == "") {
                jAlert("Please Choose Branch", "Error", function () {
                    $("[id=ddlBranchNameShipment]").focus();
                    return false;
                });
                return false;
            }
            if (brIncharge == null || brIncharge == "") {
                jAlert("Please Choose Branch Incharge", "Error", function () {
                    $("[id=ddlBranchInchargeShipment]").focus();
                    return false;
                });
                return false;
            }
            var totallength = $scope.woshipmentdetails.length;
            if (parseInt(totallength) > 0) {
                jAlert("You Cannot Add More than One Shipment", "Error", function () {
                    $("[id=ddlBranchNameShipment]").val("");
                    $("[id=ddlBranchInchargeShipment]").val("");
                    return false;
                });
                return false;
            }

            var BranchGid = $("[name=txtBranchGid]").val();
            var BranchInchargeGid = $("[name=txtBranchInchargeGid]").val();
            var wodetailsgid = $("[name=txtWoDetailGidForShipment]").val();
            var woshipmentquantity = 1;
            if ($scope.ShipChildQty > 0)
                woshipmentquantity = $scope.ShipChildQty;

            var WoShipmentInsert = {
                WOShipmentTypeGid: 1,
                WOBranchGid: BranchGid,
                WOShipmentQty: woshipmentquantity,
                WOBranchInchargeGid: BranchInchargeGid,
                WODetailGid: wodetailsgid
            };
            var getData = wonewservice.ADDWOShipmentDetailsList(WoShipmentInsert);
            getData.then(function (response) {
                var ErrorMsg1 = response.data.ErrorMsg;
                if (ErrorMsg1 == "1") {
                    jAlert("Error While Save Details", "Error", function () {
                        $("[id=ddlBranchNameShipment]").val("");
                        $("[id=ddlBranchInchargeShipment]").val("");
                        return false;
                    });
                }
                else {
                    $("[id=ddlBranchNameShipment]").val("");
                    $("[id=ddlBranchInchargeShipment]").val("");
                    var Data0 = "";
                    Data0 = JSON.parse(response.data.data0);
                    $scope.woshipmentdetails = Data0;
                    filteredItemsWOShipment = $scope.woshipmentdetails.length;

                }
            }, function () {
                alert('Error while binding shipment details');
            });
        }
        $scope.DeleteWoParent = function (wodetailgid) {
            jConfirm("Are you sure, want to delete this wo detail?", "Warning", function (e) {
                if (e == true) {
                    var WoDetailsForDelete = {
                        WODetailParentGid: wodetailgid,
                        WORequestFor: "parent"
                    };

                    var getData = wonewservice.DeleteWODetails(WoDetailsForDelete);
                    getData.then(function (response) {
                        var Data0 = "";
                        var ErrorMsg1 = response.data.ErrorMsg;
                        if (ErrorMsg1 == "1") {
                            jAlert("Error While Delete Details", "Error", function () {
                                return false;
                            });
                        }
                        else {
                            if (response.data.data0 != null && response.data.data0 != "") {
                                Data0 = JSON.parse(response.data.data0);
                                $scope.WOUtilAmount = Data0[0].WOUtilAmount;
                            }
                            else {
                                $scope.WOUtilAmount = 0;
                            }
                            $scope.woparentdetails = Data0;
                            $scope.filteredItemsWO = $scope.woparentdetails.length;   // Intially when no filter is applied.
                            //     $scope.totalItems = $scope.woparentdetails.length;
                            jAlert("Deleted Successfully", "Success", function () {
                                return false;
                            });
                        }
                    }, function () {
                        alert('Error in adding record');
                    });
                }
                else {
                    return false;
                }

            });

        }
        $scope.DeleteWoChild = function (wodetailgid) {
            jConfirm("Are you sure, want to delete this wo child details?", "Warning", function (e) {
                if (e == true) {
                    var WoDetailsForDelete = {
                        WODetailParentGid: wodetailgid,
                        WORequestFor: "child"
                    };

                    var getData = wonewservice.DeleteWODetails(WoDetailsForDelete);
                    getData.then(function (response) {
                        var Data0 = "";
                        var ErrorMsg1 = response.data.ErrorMsg;
                        if (ErrorMsg1 == "1") {
                            jAlert("Error While Delete Details", "Error", function () {
                                return false;
                            });
                        }
                        else {
                            if (response.data.data0 != null && response.data.data0 != "")
                                Data0 = JSON.parse(response.data.data0);
                            $scope.wochilddetails = Data0;
                            $scope.filteredItemsWOChild = $scope.wochilddetails.length;  // Intially when no filter is applied.
                            //     $scope.totalItems = $scope.woparentdetails.length;
                            jAlert("Deleted Successfully", "Success", function () {
                                return false;
                            });
                        }
                    }, function () {
                        alert('Error in adding record');
                    });
                }
                else {
                    return false;
                }

            });

        }
        $scope.DeleteWoShipment = function (wodetailgid) {
            jConfirm("Are you sure want to delete this wo shipment", "Warning", function (e) {
                if (e == true) {
                    var WoDetailsForDelete = {
                        WODetailParentGid: wodetailgid,
                        WORequestFor: "shipment"
                    };

                    var getData = wonewservice.DeleteWODetails(WoDetailsForDelete);
                    getData.then(function (response) {
                        var Data0 = "";
                        var ErrorMsg1 = response.data.ErrorMsg;
                        if (ErrorMsg1 == "1") {
                            jAlert("Error While Delete Details", "Error", function () {
                                return false;
                            });
                        }
                        else {
                            if (response.data.data0 != null && response.data.data0 != "")
                                Data0 = JSON.parse(response.data.data0);
                            $scope.woshipmentdetails = Data0;
                            filteredItemsWOShipment = $scope.woshipmentdetails.length;   // Intially when no filter is applied.
                            //     $scope.totalItems = $scope.woparentdetails.length;
                            jAlert("Deleted Successfully", "Success", function () {
                                return false;
                            });
                        }
                    }, function () {
                        alert('Error in adding record');
                    });
                }
                else {
                    return false;
                }

            });

        }
        $scope.ValidateWOAmount = function () {
            if ($scope.WOProdServiceFlag == "S") {
                //if ($scope.WODetailPercentage != null) {
                //    var aa = parseFloat($scope.WODetailPercentage);
                //    if (aa == "" || aa == 0 || aa == 0.00 || Math.round(aa) == 0) {
                //        jAlert("Ensure Percentage", "Error", function () {
                //            $scope.WODetailPercentage = 0;
                //            $("[name=txtTotalAmountWOChildS]").val("0");
                //            $("#txtQtySplit").val("0");
                //            $("#txtUnitAmntSplit").val("0");
                //            $("#txtPercentageSplit").val("0");
                //            $("#txtPercentageSplit").focus();
                //            $scope.WODetailQtyChild = 0;
                //            $scope.WODetailUnitAmount = 0;
                //            return false;
                //        });
                //        return false;
                //    }
                //}
                //else {
                //    jAlert("Ensure Percentage", "Error", function () {
                //        $scope.WODetailPercentage = 0;
                //        $("[name=txtTotalAmountWOChildS]").val("0");
                //        $("#txtQtySplit").val("0");
                //        $("#txtUnitAmntSplit").val("0");
                //        $("#txtPercentageSplit").val("0");
                //        $("#txtPercentageSplit").focus();
                //        $scope.WODetailQtyChild = 0;
                //        $scope.WODetailUnitAmount = 0;
                //        return false;
                //    });
                //    return false;
                //}
            }

            var totalamnt = 0;
            var wodetgid = 0;
            if ($scope.WODetailChildGid != null && $scope.WODetailChildGid != "")
                wodetgid = parseInt($scope.WODetailChildGid);

            totalamnt = $("[name=txtTotalAmountWOChildS]").val();
            //  }
            var entunitamnt = $("#txtUnitAmntSplit").val();
            var entqty = $("#txtQtySplit").val();
            var unitamnt = parseFloat(totalamnt);
            var taxperc = $("#txtTaxSplitVal").val();
            var discountamnt = $("#txtDiscountSplitVal").val();
            var othercharges = $("#txtOthersSplitVal").val();
            var taxamnt = 0;

            if (entunitamnt == null || entunitamnt == "") {
                entunitamnt = 0;
            }
            if (entqty == null || entqty == "") {
                entqty = 0;
            }
            unitamnt = parseFloat(entunitamnt) * parseFloat(entqty);
            if (taxperc == null || taxperc == "") {
                taxperc = 0;
                taxamnt = 0;
            }
            else {
                taxamnt = (parseFloat(unitamnt) * parseFloat(taxperc / 100)).toFixed(2);
                $("#txtxTaxAmountSplit").val(taxamnt);
            }
            if (discountamnt == null || discountamnt == "") {
                discountamnt = 0;
            }
            if (othercharges == null || othercharges == "") {
                othercharges = 0;
            }
            var enteredamnt = (parseFloat(unitamnt) + parseFloat(othercharges) + parseFloat(taxamnt)) - parseFloat(discountamnt);
            enteredamnt = parseFloat(enteredamnt).toFixed(2);
            var percent = ((parseFloat(entunitamnt) / parseFloat($scope.WODetailAmount)) * 100).toFixed(2);
            $scope.WODetailPercentage = percent;
            $("[id=txtPercentageSplit]").val(percent.toString());

            $("[name=txtTotalAmountWOChildS]").val(enteredamnt);
            if (parseFloat(enteredamnt) < 0) {
                jAlert("Please Enter Valid Amount", "Error", function () {
                    $scope.WODetailQty = 0;
                    $("[name=txtTotalAmountWOChildS]").val("0");
                    $("[name=txtQtySplit]").val("0");
                    $("[name=txtQtySplit]").focus();
                    $("#txtDiscountSplitVal").val("0");
                    $("#txtOthersSplitVal").val("0");
                    $("#txtTaxSplitVal").val("0");
                    $("#txtxTaxAmountSplit").val("0");
                    return false;
                });
                return false;
            }

            var lblamt = $("#Lblutlamount").text();
            var lablam = lblamt.trim();
            var utlit = lablam.substring(17, 2000000);
            var lblamt1 = $("#Lblmaxtotal").text();
            var lablam1 = lblamt1.trim();
            var total = lablam1.substring(27, 2000000);
            var finamnt = parseFloat(enteredamnt);

            if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
                for (var i = 0; i < $scope.wochilddetails.length; i++) {
                    if (wodetgid != parseInt($scope.wochilddetails[i].WODetailGid))
                        finamnt += parseFloat($scope.wochilddetails[i].WODetailTotalAmount);
                }
            }
            if (finamnt > total) {
                jAlert("Total Amount Exceeds\nSum of Split = " + finamnt + ", Max Limit = " + $scope.WODetailAmount, "Error", function () {
                    $scope.WODetailPercentage = 0;
                    $("[name=txtTotalAmountWOChildS]").val("0");
                    $("[name=txtQtySplit]").val("0");
                    $("[name=txtQtySplit]").focus();
                    $("#txtDiscountSplitVal").val("0");
                    $("#txtOthersSplitVal").val("0");
                    $("#txtTaxSplitVal").val("0");
                    $("#txtxTaxAmountSplit").val("0");
                    $scope.WODetailQtyChild = 0;
                    return false;
                });
                return false;
            }
            //else
            //{
            //    var totqty = 0;
            //    var childqty = ($scope.WoParentQtyShipment * $scope.WODetailPercentage) / 100;
            //    for (var i = 0; i < $scope.wochilddetails.length; i++) {
            //        if (wodetgid != parseInt($scope.wochilddetails[i].WODetailGid))
            //            totqty += parseInt($scope.wochilddetails[i].WODetailQty);
            //    }
            //    totqty += parseInt(childqty);
            //    $scope.WODetailQtyChild = Math.round(childqty);
            //    if (totqty > parseInt($scope.WoParentQtyShipment)) {
            //        childqty = parseInt($scope.WODetailQtyChild) - 1;
            //    }
            //    $scope.WODetailQtyChild = Math.round(childqty);

            //}
        }
        $scope.ValidateWOAmountP = function () {
            var totalamnt = 0;
            var wodetgid = 0;
            if ($scope.WODetailChildGid != null && $scope.WODetailChildGid != "")
                wodetgid = parseInt($scope.WODetailChildGid);
            var childqty = "1";
            if ($scope.WODetailPercentage > 0) {
                if ($scope.WoParentQtyShipment > 0) {
                    childqty = parseFloat($scope.WoParentQtyShipment) * parseFloat($scope.WODetailPercentage / 100);
                }
                var totpercentage = parseFloat($scope.WODetailPercentage);
                if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
                    for (var i = 0; i < $scope.wochilddetails.length; i++) {
                        if (wodetgid != parseInt($scope.wochilddetails[i].WODetailGid)) {
                            totpercentage += parseFloat($scope.wochilddetails[i].WODetailPercentage);
                        }
                    }
                }
                if (totpercentage > 100) {
                    jAlert("Sum of Percentage Exceeds 100", "Error", function () {
                        $scope.WODetailPercentage = 0;
                        $("[name=txtTotalAmountWOChildS]").val("0");
                        $("#txtQtySplit").val("0");
                        $("#txtUnitAmntSplit").val("0");
                        $("#txtPercentageSplit").val("0");
                        $("#txtPercentageSplit").focus();
                        $scope.WODetailQtyChild = 0;
                        $scope.WODetailUnitAmount = 0;
                        return false;
                    });
                    return false;
                }
            }
            var totqty = parseFloat(childqty);
            if (isNaN(totqty)) {
                totqty = 1;
            }
            if (totqty < 1) {
                totqty = 1;
            }
            $scope.WODetailQtyChild = parseFloat(totqty).toFixed(2);
            var totamntperc = parseFloat($scope.WODetailAmount) * (parseFloat($scope.WODetailPercentage) / 100);
            totamntperc = (parseFloat(totamntperc) / parseFloat($scope.WODetailQtyChild)); // / parseFloat($scope.WODetailQtyChild);
            $scope.WODetailUnitAmount = parseFloat(totamntperc).toFixed(2);
            var curamnt = parseFloat($scope.WODetailUnitAmount) * parseFloat($scope.WODetailQtyChild);
            $scope.EnteredPercentage = curamnt;
            $("[name=txtQtySplit]").val($scope.WODetailQtyChild);
            $("[name=txtUnitAmntSplit]").val($scope.WODetailUnitAmount);

            totalamnt = $("[name=txtTotalAmountWOChildS]").val();
            //  }
            var entunitamnt = $scope.WODetailUnitAmount;
            var entqty = $scope.WODetailQtyChild;
            var unitamnt = 0;
            var taxperc = $("#txtTaxSplitVal").val();
            var discountamnt = $("#txtDiscountSplitVal").val();
            var othercharges = $("#txtOthersSplitVal").val();
            var taxamnt = 0;

            if (entunitamnt == null || entunitamnt == "") {
                entunitamnt = 0;
            }
            if (entqty == null || entqty == "") {
                entqty = 0;
            }
            unitamnt = parseFloat(entunitamnt) * parseFloat(entqty);
            if (taxperc == null || taxperc == "") {
                taxperc = 0;
                taxamnt = 0;
            }
            else {
                taxamnt = (parseFloat(unitamnt) * parseFloat(taxperc / 100)).toFixed(2);
                $("#txtxTaxAmountSplit").val(taxamnt);
            }
            if (discountamnt == null || discountamnt == "") {
                discountamnt = 0;
            }
            if (othercharges == null || othercharges == "") {
                othercharges = 0;
            }
            var enteredamnt = (parseFloat(unitamnt) + parseFloat(othercharges) + parseFloat(taxamnt)) - parseFloat(discountamnt);
            enteredamnt = parseFloat(enteredamnt).toFixed(2);

            $("[name=txtTotalAmountWOChildS]").val(enteredamnt);
            if (parseFloat(enteredamnt) < 0) {
                jAlert("Please Enter Valid Amount", "Error", function () {
                    $scope.WODetailQty = 0;
                    $("[name=txtTotalAmountWOChildS]").val("0");
                    $("[name=txtQtySplit]").val("0");
                    $("[name=txtQtySplit]").focus();
                    $("#txtDiscountSplitVal").val("0");
                    $("#txtOthersSplitVal").val("0");
                    $("#txtTaxSplitVal").val("0");
                    $("#txtxTaxAmountSplit").val("0");
                    $("#txtPercentageSplit").val("0");
                    $("#txtPercentageSplit").focus();
                    return false;
                });
                return false;
            }
            var finamnt = parseFloat(enteredamnt);
            if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
                for (var i = 0; i < $scope.wochilddetails.length; i++) {
                    if (wodetgid != parseInt($scope.wochilddetails[i].WODetailGid))
                        finamnt += parseFloat($scope.wochilddetails[i].WODetailTotalAmount);
                }
            }
            if (finamnt > parseFloat($scope.WODetailAmount)) {
                jAlert("Total Amount Exceeds\nSum of Split = " + parseFloat(finamnt).toFixed(2) + ", Max Limit = " + parseFloat($scope.WODetailAmount).toFixed(2), "Error", function () {
                    $scope.WODetailPercentage = 0;
                    $("[name=txtTotalAmountWOChildS]").val("0");
                    $("[name=txtQtySplit]").val("0");
                    $("[name=txtQtySplit]").focus();
                    $("#txtDiscountSplitVal").val("0");
                    $("#txtOthersSplitVal").val("0");
                    $("#txtTaxSplitVal").val("0");
                    $("#txtxTaxAmountSplit").val("0");
                    $("#txtPercentageSplit").val("0");
                    $("#txtPercentageSplit").focus();
                    $scope.WODetailQtyChild = 0;
                    return false;
                });
                return false;
            }

            //OLD VALIDATION
            //$("[name=txtTotalAmountWOChildS]").val(curamnt);
            //totalamnt = $("[name=txtTotalAmountWOChildS]").val(curamnt);

            //var rtotamnt = parseFloat(totalamnt).toFixed(2);
            //$("[name=txtTotalAmountWOChildS]").val(rtotamnt);

            //var finamnt = parseFloat(totalamnt);
            //if ($scope.wochilddetails != null && $scope.wochilddetails != "") {
            //    for (var i = 0; i < $scope.wochilddetails.length; i++) {
            //        if (wodetgid != parseInt($scope.wochilddetails[i].WODetailGid)) {
            //            finamnt += parseFloat($scope.wochilddetails[i].WODetailTotalAmount);

            //        }

            //    }
            //}
            //if (parseFloat(finamnt) > parseFloat($scope.WODetailAmount)) {
            //    jAlert("Total Amount Exceeds\nSum of Split = " + finamnt + ", Max Limit = " + $scope.WODetailAmount, "Error", function () {
            //        $scope.WODetailPercentage = 0;
            //        $("[name=txtTotalAmountWOChildS]").val("0");
            //        $("#txtQtySplit").val("0");
            //        $("#txtUnitAmntSplit").val("0");
            //        $("#txtPercentageSplit").val("0");
            //        $("#txtPercentageSplit").focus();
            //        $scope.WODetailQtyChild = 0;
            //        $scope.WODetailUnitAmount = 0;
            //        return false;
            //    });
            //    return false;
            //}

        }
        //$scope.selectedRow = null;  // initialize our variable to null
        //$scope.setClickedRow = function (index) {  //function that sets the value of selectedRow to current index
        //    $scope.selectedRow = index;
        //}
        $scope.CancelWOParentDetails = function () {
            //objADDWOParent.dialog("close");
            //$("#AddWODetailsParentDIV").css("display", "none");
            CloseParentDialog();
        }
        $scope.CancelGSTDetails = function () {
            //objADDWOParent.dialog("close");
            //$("#AddWODetailsParentDIV").css("display", "none");
            CloseGSTDialog();
        }
        $scope.CancelWOChildDetails = function () {
            //objADDWOParent.dialog("close");
            //$("#AddWODetailsParentDIV").css("display", "none");
            CloseChildDialog();
        }
        $scope.SaveAsDraft = function () {
            var woittype = "";
            var wolen = $scope.woparentdetails.length;
            if (wolen == 0 || wolen == null) {
                jAlert("Please Add atleast one record in WO Detail", function () {
                    return false;
                });
                return false;
            }
            var ParentVendorGid = $("[name=txtWOVendorGid]").val();
            var CustVendorGid = $("[name=txtVendorNameCustomGid]").val();
            if (CustVendorGid != null && CustVendorGid != "" && CustVendorGid != "0") {
                ParentVendorGid = CustVendorGid;
            }
            if ($scope.WORequestFor == "IT")
                woittype = $scope.WOITType;

            var ObjWOEntity = {
                WOGid: $scope.WOGid,
                WODescription: $scope.WODescription,
                WOVendorGid: ParentVendorGid,
                WOAmount: $scope.WOAmount,
                TermCondGid: $scope.TermCondGid,
                AdditionalTermCondContent: $scope.AdditionalTermCondContent,
                WOITType: woittype
            }
            var getData = wonewservice.SaveAsDraft(ObjWOEntity);
            getData.then(function (response) {
                var ErrorMsg1 = response.data.ErrorMsg;
                if (ErrorMsg1 == "1") {
                    jAlert("WO Saved Successfully", "Success", function () {
                        location = '@Url.Action("WOSummary", "WOSummary")?' + new Date().getTime();
                    });
                }
                else {
                    jAlert("Error While Saving WO", "Error", function () {
                        return false;
                    });
                }
            }, function () {
                alert('Error');
            });
        }
        $scope.SubmitWO = function () {
            var wolen = $scope.woparentdetails.length;
            var vendName = $("#ddlVendorNameWO").val();
            var vendAddress = $("#TxtVendorAddress").val();
            var ParentVendorGid = $("[name=txtWOVendorGid]").val();
            var CustVendorGid = $("[name=txtVendorNameCustomGid]").val();
            if (CustVendorGid != null && CustVendorGid != "" && CustVendorGid != "0") {
                ParentVendorGid = CustVendorGid;
            }
            if (vendAddress == "" || vendAddress == null || vendAddress == "0") {
                jAlert("Ensure Valid Vendor Address", "Error", function () {
                    return false;
                });
                return false;
            }
            if (vendName == "" || vendName == null) {
                jAlert("Ensure Valid Vendor Name", "Error", function () {
                    return false;
                });
                return false;
            }
            else if (ParentVendorGid == "" || ParentVendorGid == null || ParentVendorGid == "0") {
                jAlert("Ensure Valid Vendor", "Error", function () {
                    return false;
                });
                return false;
            }
            if (wolen == 0 || wolen == null) {
                jAlert("Please Add atleast one record in WO Detail", "Error", function () {
                    return false;
                });
                return false;
            }
            else {
                var woittype1 = "";
                if ($scope.WORequestFor == "IT") {
                    woittype1 = $scope.WOITType;
                    if ($.trim(woittype1) == "") {
                        jAlert("Please Select Request Type (Application/Infrastructure)", "Error", function () {
                            return false;
                        });
                        return false;
                    }
                }
                var woheadgid = $scope.WOGid;
                if (woheadgid == undefined) {
                    woheadgid = $("[name=txtWOHeaderGid]").val();
                }
                var getData3 = wonewservice.ValidateWOShipment(woheadgid);
                getData3.then(function (response) {
                    var Data0;
                    var ErrMsgList = "";
                    Data0 = response.data;
                    if (Data0.length > 0) {
                        //alert(Data0);
                        //for (var i = 0; i < wolen; i++) {
                        //    for (var j = 0; j < Data0.length; j++) {
                        //        if (Data0[j] == $scope.woparentdetails[i].WODetailGid) {
                        //            if (ErrMsgList != "") {
                        //                ErrMsgList += "\nEnsure Shipment In Row Number (" + (i + 1) + ")";
                        //            }
                        //            else {
                        //                ErrMsgList = "Ensure Shipment In Row Number (" + (i + 1) + ")";
                        //            }
                        //        }
                        //    }

                        //}
                        jAlert("All line items must have shipment details...", "Error", function () {
                            return false;
                        });
                    }
                        //if (ErrMsgList != "") {
                        //    jAlert(ErrMsgList, "Error", function () {
                        //        return false;
                        //    });
                        //}
                    else {
                        showProgress();
                        var approvedby = '@ViewBag.isapproval';
                        var woittype = "";
                        if ($scope.WORequestFor == "IT")
                            woittype = $scope.WOITType;
                        var ObjWOEntity = {
                            WOGid: $scope.WOGid,
                            WODescription: $scope.WODescription,
                            WOAmount: $scope.WOAmount,
                            WOVendorGid: ParentVendorGid,
                            TermCondGid: $scope.TermCondGid,
                            AdditionalTermCondContent: $scope.AdditionalTermCondContent,
                            WOITType: woittype,
                            vendAddressId: vendAddress
                        }
                        var getData = wonewservice.SubmitRaiser(ObjWOEntity);
                        getData.then(function (response) {
                            var ErrorMsg1 = response.data.ErrorMsg;
                            if (ErrorMsg1 == "1") {
                                hideProgress();
                                jAlert("WO Submitted Successfully", "Success", function () {
                                    location = '@Url.Action("WOSummary", "WOSummary")?' + new Date().getTime();
                                });
                            }
                            else {
                                hideProgress();
                                jAlert(ErrorMsg1, "Error", function () {
                                    return false;
                                });
                            }
                        }, function () {
                            alert('Error');
                        });
                    }
                }, function () {
                    jAlert("Error While Validating Shipment", "Error", function () {
                        return false;
                    });
                });
            }

        }
        $scope.ApproveWO = function () {
            showProgress();
            var approvedby = '@ViewBag.isapproval';
            var ObjWOEntity = {
                WOGid: $scope.WOGid,
                WOApprovedBy: approvedby,
                WOApprovalRemarks: $scope.WOApprovalRemarks
            }
            var getData = wonewservice.SubmitApprover(ObjWOEntity);
            getData.then(function (response) {

                var SplitStr = response.data.ErrorMsg.split('-');

                var ErrorMsg1 = SplitStr[0];

                if (ErrorMsg1 == "1") {
                    hideProgress();
                    jConfirm("WO Approved Successfully! Do you want continue to approve next claim?", "Success", function (r) {
                        if (r == true) {
                            //debugger;
                            //var data2 = SplitStr[1].split(':');
                            var data2 = SplitStr[1];
                            if (data2 == "0") {
                                jAlert("No More records to be Approved", "Success", function () {
                                    @*location = '@Url.Action("Index", "FlexiBuyDashBoard")?' + new Date().getTime();*@
                                  location = '@Url.Action("Index", "Dashboard", new { area = "Dashboard" })';
                                });
                            }
                            else {
                                data2 = SplitStr[1].split(':');
                                var id = data2[0];
                                var name = data2[1];

                                if (name == 2) {
                                    location = '@Url.Action("Index", "WONew")?wogid=' + id + '&viewtype=checker&' + new Date().getTime();
                                }
                                else if (name == 4) {
                                    location = '@Url.Action("Index", "WONew")?wogid=' + id + '&viewtype=delmat&' + new Date().getTime();
                                }
                            }

                        }
                        else {
                            @*location = '@Url.Action("Index", "FlexiBuyDashBoard")?' + new Date().getTime();*@
                          location = '@Url.Action("Index", "Dashboard", new { area = "Dashboard" })';
                        }

                    });
                }
                else {
                    hideProgress();
                    jAlert(ErrorMsg1, "Error", function () {
                        return false;
                    });
                }
            }, function () {
                alert('Error');
            });
        }
        $scope.RejectWO = function () {
            var approvedby = '@ViewBag.isapproval';
            var ObjWOEntity = {
                WOGid: $scope.WOGid,
                WOApprovedBy: approvedby,
                WOApprovalRemarks: $scope.WOApprovalRemarks
            }
            showProgress();
            var getData = wonewservice.RejectApprover(ObjWOEntity);
            getData.then(function (response) {

                var SplitStr = response.data.ErrorMsg.split('-');
                var ErrorMsg1 = SplitStr[0];
                // var ErrorMsg1 = response.data.ErrorMsg;
                if (ErrorMsg1 == "1") {
                    hideProgress();
                    jConfirm("WO Rejected Successfully!!! Do you want continue next Queue", "Success", function (r) {

                        if (r == true) {
                            //debugger;
                            //var data2 = SplitStr[1].split(':');
                            var data2 = SplitStr[1];
                            if (data2 == "0") {
                                jAlert("No approval items pending", "Success", function () {
                                    @*location = '@Url.Action("Index", "FlexiBuyDashBoard")?' + new Date().getTime();*@
                                  location = '@Url.Action("Index", "Dashboard", new { area = "Dashboard" })';
                                });
                            }
                            else {
                                data2 = SplitStr[1].split(':');
                                var id = data2[0];
                                var name = data2[1];

                                if (name == 2) {
                                    location = '@Url.Action("Index", "WONew")?wogid=' + id + '&viewtype=checker&' + new Date().getTime();
                                }
                                else if (name == 4) {
                                    location = '@Url.Action("Index", "WONew")?wogid=' + id + '&viewtype=delmat&' + new Date().getTime();
                                }
                            }

                        }
                        else {
                            //location = '@Url.Action("WOSummary", "WOSummary")?' + new Date().getTime();
                            @*location = '@Url.Action("Index", "FlexiBuyDashBoard")?' + new Date().getTime();*@
                          location = '@Url.Action("Index", "Dashboard", new { area = "Dashboard" })';
                        }
                    });
                }
                else {
                    hideProgress();
                    jAlert("Error While Rejecting WO", "Error", function () {
                        return false;
                    });
                }
            }, function () {
                hideProgress();
                alert('Error');
            });
        }
        $scope.CancelWODetails = function () {
            //location = '@Url.Action("WOSummary", "WOSummary")?' + new Date().getTime();
            location = '@Url.Action("Index", "flexibuydashboard")?' + new Date().getTime();
        }
        $scope.ShowAuditTrail = function () {
            var getData = wonewservice.GetAuditTrail($scope.WOGid);
            getData.then(function (response) {
                $scope.woaudittrail = response.data;
                $scope.filteredItemsWOAuditTrail = $scope.woaudittrail.length;

                $("#divAuditTrail").css("display", "");
                objAuditTrail.dialog({ title: 'Audit Trail', width: '780', height: '300' });
                objAuditTrail.dialog("open");
            }, function () {
                alert('Error');
            });
        }
        $scope.ValidateWOHeaderAmount = function () {
            debugger;
            var unitamnt = $("[name=txtTotalAmountWOParent]").val();
            var totalamnt = $scope.WOAmount;
            var enteredamnt = parseInt(unitamnt);
            var wodetgid = 0;
            if ($scope.WODetailParentGid != null && $scope.WODetailParentGid != "")
                wodetgid = parseInt($scope.WODetailParentGid);
            if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                for (var i = 0; i < $scope.woparentdetails.length; i++) {
                    if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
                        enteredamnt += parseInt($scope.woparentdetails[i].WODetailTotalAmount);
                }
            }
            if (parseInt(enteredamnt) > parseInt(totalamnt)) {
                jAlert("Sum Of WO Details Amount Exceeds OBF Amount", "Error", function () {
                    $scope.WODetailUnitAmount = 0;
                    $("[name=txtTotalAmountWOParent]").val("0");
                    $("[name=txtUnitAmntParentVal]").val("");
                    $("[name=txtUnitAmntParentVal]").focus();
                });
            }
        }
        $scope.ValidateWOHeaderAmountQty = function () {
            debugger;
            var unitamnt = $("[name=txtTotalAmountWOParent]").val();
            var entqty = $("[name=txtQtyParentVal]").val();
            var totalamnt = $scope.WOAmount;
            var totalqty = $scope.CBFQuantity;
            var enteredamnt = parseInt(unitamnt);
            var entqty1 = parseInt(entqty);
            var wodetgid = 0;
            if ($scope.WODetailParentGid != null && $scope.WODetailParentGid != "")
                wodetgid = parseInt($scope.WODetailParentGid);
            //if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
            //    for (var i = 0; i < $scope.woparentdetails.length; i++) {
            //        if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
            //             entqty1 += parseInt($scope.woparentdetails[i].WODetailQty);
            //    }
            //}
            //if (parseInt(entqty1) > parseInt(totalqty)) {
            //    jAlert("Sum of WO Details Quantity Exceeds OBF Quantity", "Error", function () {
            //        $scope.WODetailQty = 0;
            //        $("[name=txtTotalAmountWOParent]").val("0");
            //        $("[name=txtQtyParentVal]").val("");
            //        $("[name=txtQtyParentVal]").focus();
            //    });
            //}
            if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                for (var i = 0; i < $scope.woparentdetails.length; i++) {
                    if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
                        enteredamnt += parseInt($scope.woparentdetails[i].WODetailTotalAmount);
                }
            }
            if (parseInt(enteredamnt) > parseInt(totalamnt)) {
                jAlert("Sum Of WO Details Amount Exceeds OBF Amount", "Error", function () {
                    $scope.WODetailQty = 0;
                    $("[name=txtTotalAmountWOParent]").val("0");
                    $("[name=txtQtyParentVal]").val("");
                    $("[name=txtQtyParentVal]").focus();
                });
            }
        }

        $scope.validationunitamount = function () {
            debugger;
            var cbfamount = $("#hdncbfamount").val();
            var entunitamnt = $("#txtUnitAmntParentVal").val();
            if (parseFloat(entunitamnt) > parseFloat(cbfamount)) {
                jAlert("Sum Of WO Details Amount Exceeds OBF Amount", "Error", function () {
                    $scope.WODetailQty = 0;
                    $("[name=txtTotalAmountWOParent]").val("0");
                    $("[name=txtQtyParentVal]").val("");
                    $("[name=txtQtyParentVal]").focus();
                    $("#txtDiscountParentVal").val("0");
                    $("#txtOthersParentVal").val("0");
                    $("#txtTaxParentVal").val("0");
                    $("#txtxTaxAmountParent").val("0");
                    return false;
                });
                return false;
            }
        } 



        $scope.ValidateWOHeaderAmountAll = function () {
            debugger;
            var cbfamount = $("#hdncbfamount").val();
            //alert(cbfamount);
            var entunitamnt = $("#txtUnitAmntParentVal").val();
            var unitamnt = $("[name=txtTotalAmountWOParent]").val();
            var entqty = $("[name=txtQtyParentVal]").val();
            var taxperc = $("#txtTaxParentVal").val();
            var discountamnt = $("#txtDiscountParentVal").val();
            var othercharges = $("#txtOthersParentVal").val();
            //var aviable = $("#TxtAvil").val();
            //var currentbals = $("#TxtCurrentBal").val();
            var aviable = $("#hdncbfamount").val();
            var currentbals = $("#hdncbfamount").val();
            var _inBit = 0;
            if (parseFloat(currentbals) >= parseFloat(entunitamnt)) {
                var taxamnt = 0;
                if (entunitamnt == null || entunitamnt == "") {
                    entunitamnt = 0;
                }
                if (entqty == null || entqty == "") {
                    entqty = 0;
                }
                unitamnt = parseFloat(entunitamnt) * parseFloat(entqty);

                var lblamt = $("#Lblutlamount").text();
                var lablam = lblamt.trim();
                var utlit = lablam.substring(17, 2000000);
                var lblamt1 = $("#Lblmaxtotal").text();
                var lablam1 = lblamt1.trim();
                var total = lablam1.substring(27, 2000000);
                var woamount = entunitamnt;
                var balance = utlit - woamount;
                var totbal = total - balance;
                var currentbal = $("#TxtCurrentBal").val();
                var Totalbalance = total - utlit;
                var totGidval = parseFloat(currentbal) + parseFloat(Totalbalance);
                var Totalqty = (total - utlit);
                if (parseFloat(totGidval) >= parseFloat(unitamnt)) {

                    if (taxperc == null || taxperc == "") {
                        taxperc = 0;
                        taxamnt = 0;
                    }
                    else {
                        taxamnt = (parseFloat(unitamnt) * parseFloat(taxperc / 100)).toFixed(2);
                        $("#txtxTaxAmountParent").val(taxamnt);
                    }
                    debugger;
                    var totalamnt = $scope.WOAmount;
                    var totalqty = $scope.CBFQuantity;
                    var enteredamnt = parseFloat(unitamnt);
                    var entqty1 = parseFloat(entqty);
                    var wodetgid = 0;
                    if (discountamnt == null || discountamnt == "") {
                        discountamnt = 0;
                    }
                    if (othercharges == null || othercharges == "") {
                        othercharges = 0;
                    }
                    enteredamnt = (parseFloat(enteredamnt) + parseFloat(othercharges) + parseFloat(taxamnt)) - parseFloat(discountamnt);
                    enteredamnt = parseFloat(enteredamnt).toFixed(2);
                    $("[name=txtTotalAmountWOParent]").val(enteredamnt);

                    if (parseFloat(enteredamnt) < 0) {
                        jAlert("Please Enter Valid Amount", "Error", function () {
                            $scope.WODetailQty = 0;
                            $("[name=txtTotalAmountWOParent]").val("0");
                            $("[name=txtQtyParentVal]").val("");
                            $("[name=txtQtyParentVal]").focus();
                            $("#txtDiscountParentVal").val("0");
                            $("#txtOthersParentVal").val("0");
                            $("#txtTaxParentVal").val("0");
                            $("#txtxTaxAmountParent").val("0");
                            return false;
                        });
                        return false;
                    }

                    if ($scope.WODetailParentGid != null && $scope.WODetailParentGid != "")
                        wodetgid = parseInt($scope.WODetailParentGid);
                    if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                        for (var i = 0; i < $scope.woparentdetails.length; i++) {
                            if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
                                enteredamnt += parseFloat($scope.woparentdetails[i].WODetailTotalAmount);
                        }
                    }

                    // alert('available'+ aviable);

                    //if (parseFloat(enteredamnt) > parseFloat(aviable) )
                    //    //  if (parseFloat(enteredamnt) > parseFloat(totalamnt))
                    //{
                    //    alert(parseFloat(enteredamnt));
                    //    alert("avail" + parseFloat(aviable));
                    //    jAlert("Sum Of WO Details Amount Exceeds OBF Amount1d", "Error", function () {
                    //        $scope.WODetailQty = 0;
                    //        $("[name=txtTotalAmountWOParent]").val("0");
                    //        $("[name=txtQtyParentVal]").val("");
                    //        $("[name=txtQtyParentVal]").focus();
                    //        $("#txtDiscountParentVal").val("0");
                    //        $("#txtOthersParentVal").val("0");
                    //        $("#txtTaxParentVal").val("0");
                    //        $("#txtxTaxAmountParent").val("0");
                    //        return false;
                    //    });
                    //    return false;
                    //}
                }
                else {
                    if (parseFloat(aviable) >= parseFloat(entunitamnt)) {
                        var taxamnt = 0;
                        if (entunitamnt == null || entunitamnt == "") {
                            entunitamnt = 0;
                        }
                        if (entqty == null || entqty == "") {
                            entqty = 0;
                        }
                        unitamnt = parseFloat(entunitamnt) * parseFloat(entqty);

                        var lblamt = $("#Lblutlamount").text();
                        var lablam = lblamt.trim();
                        var utlit = lablam.substring(17, 2000000);
                        var lblamt1 = $("#Lblmaxtotal").text();
                        var lablam1 = lblamt1.trim();
                        var total = lablam1.substring(27, 2000000);
                        var woamount = entunitamnt;
                        var balance = utlit - woamount;
                        var totbal = total - balance;
                        var currentbal = $("#TxtCurrentBal").val();
                        var Totalbalance = total - utlit;
                        var totGidval = parseFloat(currentbal) + parseFloat(Totalbalance);
                        var Totalqty = (total - utlit);
                        // if (parseFloat(totGidval) >= parseFloat(unitamnt)) {
                        //if (parseFloat(currentbals) >= parseFloat(unitamnt)) {
                            if (taxperc == null || taxperc == "") {
                                taxperc = 0;
                                taxamnt = 0;
                            }
                            else {
                                taxamnt = (parseFloat(unitamnt) * parseFloat(taxperc / 100)).toFixed(2);
                                $("#txtxTaxAmountParent").val(taxamnt);
                            }
                            debugger;
                            var totalamnt = $scope.WOAmount;
                            var totalqty = $scope.CBFQuantity;
                            var enteredamnt = parseFloat(unitamnt);
                            var entqty1 = parseFloat(entqty);
                            var wodetgid = 0;
                            if (discountamnt == null || discountamnt == "") {
                                discountamnt = 0;
                            }
                            if (othercharges == null || othercharges == "") {
                                othercharges = 0;
                            }
                            enteredamnt = (parseFloat(enteredamnt) + parseFloat(othercharges) + parseFloat(taxamnt)) - parseFloat(discountamnt);
                            enteredamnt = parseFloat(enteredamnt).toFixed(2);
                            $("[name=txtTotalAmountWOParent]").val(enteredamnt);

                            if (parseFloat(enteredamnt) < 0) {
                                jAlert("Please Enter Valid Amount", "Error", function () {
                                    $scope.WODetailQty = 0;
                                    $("[name=txtTotalAmountWOParent]").val("0");
                                    $("[name=txtQtyParentVal]").val("");
                                    $("[name=txtQtyParentVal]").focus();
                                    $("#txtDiscountParentVal").val("0");
                                    $("#txtOthersParentVal").val("0");
                                    $("#txtTaxParentVal").val("0");
                                    $("#txtxTaxAmountParent").val("0");
                                    return false;
                                });
                                return false;
                            }

                            if ($scope.WODetailParentGid != null && $scope.WODetailParentGid != "")
                                wodetgid = parseInt($scope.WODetailParentGid);
                            if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                                for (var i = 0; i < $scope.woparentdetails.length; i++) {
                                    if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
                                        enteredamnt += parseFloat($scope.woparentdetails[i].WODetailTotalAmount);
                                }
                            }

                            if (parseFloat(enteredamnt) > parseFloat(totalamnt)) {
                                jAlert("Sum Of WO Details Amount Exceeds OBF Amount", "Error", function () {
                                    $scope.WODetailQty = 0;
                                    $("[name=txtTotalAmountWOParent]").val("0");
                                    $("[name=txtQtyParentVal]").val("");
                                    $("[name=txtQtyParentVal]").focus();
                                    $("#txtDiscountParentVal").val("0");
                                    $("#txtOthersParentVal").val("0");
                                    $("#txtTaxParentVal").val("0");
                                    $("#txtxTaxAmountParent").val("0");
                                    return false;
                                });
                                return false;
                            }
                        //}
                        //else
                        //{
                        //    alert("asedaf");
                        //}
                         
                    }                  
                }
            }
            else {
                            if (parseFloat(aviable) >= parseFloat(entunitamnt)) {
                                var taxamnt = 0;
                                if (entunitamnt == null || entunitamnt == "") {
                                    entunitamnt = 0;
                                }
                                if (entqty == null || entqty == "") {
                                    entqty = 0;
                                }
                                unitamnt = parseFloat(entunitamnt) * parseFloat(entqty);

                                var lblamt = $("#Lblutlamount").text();
                                var lablam = lblamt.trim();
                                var utlit = lablam.substring(17, 2000000);
                                var lblamt1 = $("#Lblmaxtotal").text();
                                var lablam1 = lblamt1.trim();
                                var total = lablam1.substring(27, 2000000);
                                var woamount = entunitamnt;
                                var balance = utlit - woamount;
                                var totbal = total - balance;
                                var currentbal = $("#TxtCurrentBal").val();
                                var Totalbalance = total - utlit;
                                var totGidval = parseFloat(currentbal) + parseFloat(Totalbalance);
                                var Totalqty = (total - utlit);
                                //if (parseFloat(totGidval) >= parseFloat(unitamnt)) {

                                if (taxperc == null || taxperc == "") {
                                    taxperc = 0;
                                    taxamnt = 0;
                                }
                                else {
                                    taxamnt = (parseFloat(unitamnt) * parseFloat(taxperc / 100)).toFixed(2);
                                    $("#txtxTaxAmountParent").val(taxamnt);
                                }
                                debugger;
                                var totalamnt = $scope.WOAmount;
                                var totalqty = $scope.CBFQuantity;
                                var enteredamnt = parseFloat(unitamnt);
                                var entqty1 = parseFloat(entqty);
                                var wodetgid = 0;
                                if (discountamnt == null || discountamnt == "") {
                                    discountamnt = 0;
                                }
                                if (othercharges == null || othercharges == "") {
                                    othercharges = 0;
                                }
                                enteredamnt = (parseFloat(enteredamnt) + parseFloat(othercharges) + parseFloat(taxamnt)) - parseFloat(discountamnt);
                                enteredamnt = parseFloat(enteredamnt).toFixed(2);
                                $("[name=txtTotalAmountWOParent]").val(enteredamnt);

                                if (parseFloat(enteredamnt) < 0) {
                                    jAlert("Please Enter Valid Amount", "Error", function () {
                                        $scope.WODetailQty = 0;
                                        $("[name=txtTotalAmountWOParent]").val("0");
                                        $("[name=txtQtyParentVal]").val("");
                                        $("[name=txtQtyParentVal]").focus();
                                        $("#txtDiscountParentVal").val("0");
                                        $("#txtOthersParentVal").val("0");
                                        $("#txtTaxParentVal").val("0");
                                        $("#txtxTaxAmountParent").val("0");
                                        return false;
                                    });
                                    return false;
                                }

                                if ($scope.WODetailParentGid != null && $scope.WODetailParentGid != "")
                                    wodetgid = parseInt($scope.WODetailParentGid);
                                if ($scope.woparentdetails != null && $scope.woparentdetails != "") {
                                    for (var i = 0; i < $scope.woparentdetails.length; i++) {
                                        if (wodetgid != parseInt($scope.woparentdetails[i].WODetailGid))
                                            enteredamnt += parseFloat($scope.woparentdetails[i].WODetailTotalAmount);
                                    }
                                }

                                //if (parseFloat(enteredamnt) > parseFloat(totalamnt)) {
                                //    jAlert("Sum Of WO Details Amount Exceeds OBF Amount7", "Error", function () {
                                //        $scope.WODetailQty = 0;
                                //        $("[name=txtTotalAmountWOParent]").val("0");
                                //        $("[name=txtQtyParentVal]").val("");
                                //        $("[name=txtQtyParentVal]").focus();
                                //        $("#txtDiscountParentVal").val("0");
                                //        $("#txtOthersParentVal").val("0");
                                //        $("#txtTaxParentVal").val("0");
                                //        $("#txtxTaxAmountParent").val("0");
                                //        return false;
                                //    });
                                //    return false;
                                //}
                                //}
                                //else {
                                //    jAlert("Sum Of WO Details Amount Exceeds OBF Amount8", "Error", function () {
                                //        $("[name=txtTotalAmountWOParent]").val("0");
                                //        $("[name=txtQtyParentVal]").val("0");
                                //        return false;
                                //    });
                                //    return false;
                                //}
                            }
                            else {
                                jAlert("Sum Of WO Details Amount Exceeds OBF Amount", "Error", function () {
                                    $("[name=txtTotalAmountWOParent]").val("0");
                                    $("[name=txtUnitAmntParentVal]").val("0");
                                    return false;
                                });
                                return false;
                            }
                        }
                        _inBit = 1;
                        //bharathidhasankumar
                    }

                    $scope.getTermCondContent = function () {
                        var getdata = wonewservice.GetTermCondContent($scope.TermsAndCondValue);
                        getdata.then(function (response) {
                            var Data0 = "";
                            Data0 = JSON.parse(response.data.data0);
                            $scope.TermCondContent = Data0[0].TermCondContent;
                            $scope.TermCondGid = Data0[0].TermCondGid;
                        }, function () {
                            jAlert("Error While Binding Terms And Conditions", "Error", function () {
                                return false;
                            });
                        });
                    }
                    $scope.GetTaxdetails = function () {
                        var Data0 = ""; var Data1 = "";
                        for (var i = 0; i < $scope.ProviderLocationlist.length; i++) {
                            if ($scope.ProviderLocationlist[i].Id == $("#txtgstproloc").val()) {
                                $("#txtgstinvendor").val($scope.ProviderLocationlist[i].Gsnno);
                                var ProvId = $("#txtgstproloc").val();
                                var POId = $("#hIdWodetailId").val();
                                var Basamt = $("#txtgstbtamt").val();
                                var ReciverLocId = $("#TxtGstReciverLocionId").val();
                                var HSN_ID = $("#txtHsnCode").val();
                                /*  if (ProvId != 0) {
                                      var getdata = wonewservice.GetgstVal(POId, ProvId, Basamt, ReciverLocId, HSN_ID);
                                      getdata.then(function (response) {
                                          debugger;
                                          if (response.data.Data1 != null && response.data.Data1 != "" && JSON.parse(response.data.Data1) != null) {
                                              Data0 = JSON.parse(response.data.Data1);
                                              if (Data0[0].Clear == 0) {
                                                  jAlert(Data0[0].Msg, "Message");
                                              }
                                              //self.PoGsttatArray(Data2);
                                          }
                                          if (response.data.Data2 != null && response.data.Data2 != "" && JSON.parse(response.data.Data2) != null) {
                                              Data1 = JSON.parse(response.data.Data2);
                                              $scope.filteredgstItem = Data1.length;
                                              $scope.GstgridedetailsList = Data1;
                                              //$scope.referral = {
                                              //    organization: $scope.ProviderLocarionlist[0]
                                              //};
                                          }
                                          // $scope.TermCondContent = Data0[0].TermCondContent;
                                          //$scope.TermCondGid = Data0[0].TermCondGid;
                                      }, function () {
                                          jAlert("Error While Binding Terms And Conditions", "Error", function () {
                                              return false;
                                          });
                                      });
                                  }
                                  else {
                                      $scope.filteredgstItem = Data0.length;
                                      $scope.GstgridedetailsList = Data0;
                                  } */
                            }
                        }
                    }




                    $scope.AddGstdetails = function () {
                        debugger;
                        var Data0 = ""; var Data1 = "";
                        for (var i = 0; i < $scope.ProviderLocationlist.length; i++) {
                            if ($scope.ProviderLocationlist[i].Id == $("#txtgstproloc").val()) {
                                $("#txtgstinvendor").val($scope.ProviderLocationlist[i].Gsnno);
                                var ProvId = $("#txtgstproloc").val();
                                var POId = $("#hIdWodetailId").val();
                                var Basamt = $("#txtgstbtamt").val();
                                var ReciverLocId = $("#TxtGstReciverLocionId").val();
                                var HSN_ID = $("#txtHsnCode").val();

                    if (HSN_ID == "" || HSN_ID == 'undefined' || HSN_ID == '?') {
                        jAlert("HSN Code Not Maintained", "Error", function () {
                            return false;
                        });
                    }
                    if (ReciverLocId == 0) {
                        jAlert("Ensure Receiver Location ", "Error", function (t) {
                            return false;
                        });
                    }

                    if (ProvId != 0 && ReciverLocId != 0) {
                        var getdata = wonewservice.GetgstVal(POId, ProvId, Basamt, ReciverLocId, HSN_ID);
                        getdata.then(function (response) {
                            debugger;
                            if (response.data.Data1 != null && response.data.Data1 != "" && JSON.parse(response.data.Data1) != null) {
                                Data0 = JSON.parse(response.data.Data1);
                                if (Data0[0].clear == false) {
                                    jAlert(Data0[0].Msg, "Message");
                                }
                                //self.PoGsttatArray(Data2);
                            }
                            if (response.data.Data2 != null && response.data.Data2 != "" && JSON.parse(response.data.Data2) != null) {
                                Data1 = JSON.parse(response.data.Data2);
                                $scope.filteredgstItem = Data1.length;
                                $scope.GstgridedetailsList = Data1;
                                //$scope.referral = {
                                //    organization: $scope.ProviderLocarionlist[0]
                                //};
                            }
                            // $scope.TermCondContent = Data0[0].TermCondContent;
                            //$scope.TermCondGid = Data0[0].TermCondGid;
                        }, function () {
                            jAlert("Error While Binding Terms And Conditions", "Error", function () {
                                return false;
                            });
                        });
                    }
                    else {
                        $scope.filteredgstItem = Data0.length;
                        $scope.GstgridedetailsList = Data0;
                    }
                }
            }
            if ($("#txtgstproloc").val() == 'undefined' || $("#txtgstproloc").val() == "") {
                jAlert("  Select the Provider Location", "Message", function () {
                    return false;
                });
            }
        }
        $scope.GetTaxableamt = function () {
            $('#Taxgsttable tr td').change(function () {
                var col = $(this).parent().children().index($(this));
                var row = $(this).parent().parent().children().index($(this).parent());
                var myValue1 = $(this).closest('tr').find('td:eq(6)').text();
                var Taxrate = $.trim(myValue1);
                var str = Taxrate.replace("%", "");
                var val = $(this).closest('tr').find('.fstextbox').val();
                var total = str * (val / 100).toFixed(2);
                $(this).closest('tr').find('td:eq(7)').text("");
                $(this).closest('tr').find('td:eq(7)').append(total.toFixed(2));
                var gridelist = $scope.GstgridedetailsList[row].Taxableamt;
                var slno = parseInt($(this).closest('tr').find('td:eq(0)').text().trim());
                var row = slno - 1;
                if ($scope.GstgridedetailsList[row].SlNo == slno) {
                    var taxable = parseFloat(val) == "" ? 0 : parseFloat(val);
                    taxable = parseFloat(taxable) == NaN ? 0 : parseFloat(taxable);
                    if (taxable.toString() == "NaN") {
                        taxable = 0;
                    }
                    $("#txtgsttaxes").val(total.toFixed(2));
                    $scope.GstgridedetailsList[row].Taxableamt = taxable;
                    // var gridelist = $scope.GstgridedetailsList[row].Taxableamt;
                }

                        });
                        var Netval = 0;
                        $("#Taxgsttable tbody tr").each(function () {
                            debugger;
                            var myValue1 = $(this).closest('tr').find('td:eq(6)').text();
                            var Taxrate = $.trim(myValue1);
                            var baseamt = $("#txtgstbtamt").val();
                            var val = $(this).closest('tr').find('.fstextbox').val();
                            val = parseFloat(val) == NaN ? 0 : parseFloat(val);
                            if (val.toString() == "NaN") {
                                val = 0;
                            }
                            var str = Taxrate.replace("%", "");
                            var total = str * (val / 100).toFixed(2);
                            Netval += parseFloat(total) + parseFloat(val) + parseFloat(baseamt);
                            $("#txtgsttaxes").val(total.toFixed(2));
                            var netamt = parseFloat($("#txtgstnetamt").val());
                            var total = $("#Lblmaxtotal").text().trim();
                            total = total.replace("Maximum Utilizable Amount :", "");
                            var Totamt = parseFloat(total);
                            if (netamt > Totamt) {
                                jAlert("Net Amount is Greater than Total Amount!", "Message");
                                $("#txtgstnetamt").val(0.0);
                            }
                            //selectChange($("#txtgstnetamt"));
                        });
                    }
                    $scope.DeleteWO = function () {
                        var getData = wonewservice.DeleteWO($scope.WOGid);
                        getData.then(function (response) {
                            var ErrorMsg1 = response.data.ErrorMsg;
                            if (ErrorMsg1 == "1") {
                                jAlert("WO Deleted Successfully", "Success", function () {
                                    location = '@Url.Action("WOSummary", "WOSummary")?' + new Date().getTime();
                                });
                            }
                            else {
                                jAlert("Error While Deleting WO", "Error", function () {
                                    return false;
                                });
                            }
                        }, function () {
                            alert('Error While Delete');
                        });
                    }

                    $scope.LoadWOAttachment = function () {
                        var getData = wonewservice.LoadWOAttachment($scope.WOGid);
                        getData.then(function (response) {
                            var ErrorMsg1 = response.data.ErrorMsg;
                            if (ErrorMsg1 == "0") {
                                if (response.data.Data1 != null && response.data.Data1 != "" && JSON.parse(response.data.Data1) != null) {
                                    Data1 = JSON.parse(response.data.Data1);
                                    $scope.WOAttLenth = Data1.length;
                                    $scope.WOAttachment = Data1;
                                }
                            }
                            else {
                                jAlert("Error While Loading Attachment", "Error", function () {
                                    return false;
                                });
                            }
                        }, function () {
                            alert('Error While Delete');
                        });
                    }

                    $scope.DeleteAttachment = function (AttachmentID) {
                        var getData = wonewservice.DeleteAttachment(AttachmentID);
                        getData.then(function (response) {
                            var ErrorMsg1 = response.data.ErrorMsg;
                            if (ErrorMsg1 == "0") {
                                jAlert("Attachment Deleted Successfully", "Success", function () {
                                    $scope.LoadWOAttachment();
                                });
                            }
                            else {
                                jAlert("Error While Deleting Attachment", "Error", function () {
                                    return false;
                                });
                            }
                        }, function () {
                            alert('Error While Delete');
                        });
                    }

                    $scope.DownloadAttachment = function (filename, actualfilename) {

                        location = '@Url.Action("DownloadDocument", "WONew")?filename=' + filename + '&actualfilename=' + actualfilename
                    }
                    $scope.SaveWOAttachment = function () {

                        var WOAttachFileName = "";
                        var WOHeaderGId = $("#txtWOHeaderGid").val();

                        var WOAttachFileName = $("#AttachedActualFileName").val();
                        var AttachDescription = $("#AttachDescription").val();
                        var AttachmentRefGid = $scope.WOGid;

                        if ($.trim(WOAttachFileName) == "" || $.trim(WOAttachFileName) == null) {
                            jAlert("Please Select Valid File", "Error", function () {
                                return false;
                            });
                            return false;
                        }

                        var WOAttachmentInsert = {
                            "AttachedActualFileName": WOAttachFileName,
                            "AttachDescription": AttachDescription,
                            "AttachmentRefGid": AttachmentRefGid,
                            "AttachmentFor": "WO"
                        };

                        var getData = wonewservice.SaveWOAttachment(WOAttachmentInsert);
                        getData.then(function (response) {
                            var ErrorMsg1 = response.data.ErrorMsg;
                            if (ErrorMsg1 == "0") {
                                jAlert("Attachment Added Successfully", "Success", function () {
                                    $scope.LoadWOAttachment();
                                    $('#AttachDescription').val("");
                                    $('#AttachedActualFileName').val("");
                                    $('#txtWoAttachmentFile').val("");
                                });
                            }
                            else {
                                jAlert("Invalid File Format", "Error", function () {
                                    $('#AttachDescription').val("");
                                    $('#AttachedActualFileName').val("");
                                    $('#txtWoAttachmentFile').val("");
                                    return false;
                                });
                            }
                        }, function () {
                            alert('Error While Delete');
                        });
                    }

                    function ClearFields() {
                        $scope.WODetailServiceMonth = "";
                        $scope.WODetailQty = 0;
                        $scope.WODetailUnitAmount = 0;
                        $scope.WODetailDescription = "";
                        $scope.WODetailParentGid = 0;

                        // $scope.WODetailServiceMonthParent = "";
                        $scope.WODetailQtyParent = 0;
                        $scope.WODetailPercentage = 0;
                        $scope.WODetailDescription = "";
                        $scope.ChildProductDescription = "";

                        $scope.WODetailChildGid = 0;
                        $('#ddlChildProductGroupGid option[value="0"]').attr("selected", "selected");
                        $('#ddlChildProductGid option[value="0"]').attr("selected", "selected");
                    }
                    function CloseParentDialog() {
                        ClearFields();
                        objADDWOParent.dialog("close");
                        $("#AddWODetailsParentDIV").css("display", "none");
                    }
                    function CloseGSTDialog() {
                        ClearFields();
                        objADDPOGST.dialog("close");
                        $("#Dialogaddgst").css("display", "none");
                    }
                    function CloseChildDialog() {
                        ClearFields();
                        objADDWOChildAdd.dialog("close");
                        $("#AddWODetailsChildDIV").css("display", "none");
                    }
                    $scope.SetPOTemplate = function () {
                        var TemplateGId = "0";
                        var TemplateName = $("#txtTemplateName").val();
                        var Content = $("#txtTermsCoditions").val();
                        var IsRemoved = "0";

                        if ($.trim(TemplateName) == "") {
                            jAlert("Ensure Template Name!", "Message");
                            return false;
                        }

                        if ($.trim(Content) == "") {
                            jAlert("Ensure Terms And Conditions!", "Message");
                            return false;
                        }

                        var inputFilter = {
                            TemplateGId: TemplateGId,
                            TemplateName: TemplateName,
                            Content: Content,
                            IsRemoved: IsRemoved
                        };
                        $.ajax({
                            type: "post",
                            url: "../WONew/SetWoTemplate",
                            data: JSON.stringify(inputFilter),
                            contentType: "application/json;",
                            success: function (response) {
                                var Data1 = "";
                                if (response.Data1 != null && response.Data1 != "" && JSON.parse(response.Data1) != null) {
                                    Data1 = JSON.parse(response.Data1);
                                    if (Data1[0].Clear == true) {
                                        objDialogyAddTemplate.dialog("close");
                                        jAlert(Data1[0].Message, "Message");
                                        GetWONewDetails();
                                        $("#ddlTemplate").val("0");
                                        $("#txtTemrms").val("");
                                        $("#txtPOTemplate").val("");
                                        //selectChange($("#ddlTermsAndCondValueGid"));
                                        //valueChange($("#txtTermsandCond"));
                                    }
                                    else {
                                        jAlert(Data1[0].Message, "Message");
                                    }

                                }

                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                //alert(errorThrown);
                            }
                        });
                    };
        
    });
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }

                    $("#txtUnitAmntSplit,#txtPercentageSplit,#txtUnitAmntParentVal,#txtTaxParentVal,#txtDiscountParentVal,#txtOthersParentVal,#txtQtyParentVal").on("keypress", function (evt) {
                        var $txtBox = $(this);
                        var charCode = (evt.which) ? evt.which : event.keyCode
                        if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode != 46)
                            return false;
                        else {
                            var len = $txtBox.val().length;
                            var index = $txtBox.val().indexOf('.');

                            if (index > 0 && charCode == 46) {
                                return false;
                            }
                            if (index > 0) {
                                var charAfterdot = (len + 1) - index;
                                if (charAfterdot > 3) {
                                    return false;
                                }
                            }
                        }
                        return $txtBox; //for chaining
                    });

                    function AddWOTemplate() {
                        $('#CreateTemplateDialog').attr("style", "display:block;");
                        $('#txtTemplateName').val("");
                        $('#txtTermsCoditions').val("");
                        objDialogyAddTemplate.dialog({ title: 'Add WO Template', width: '1000', height: '450' });
                        objDialogyAddTemplate.dialog("open");
                        return false;
                    }

                    function CloaseDialog() {
                        objDialogyAddTemplate.dialog("close")
                        return false;
                    }
            
</script>
