@model IEM.Areas.ASMS.Models.SupplierActivation
<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
@{
    ViewBag.Title = "SupplierActivation";
    if (@ViewBag.status == "success")
    {
        <script>jAlert('Successfully Activated', "Message"); </script>
    }
}


@using (Html.BeginForm())
{
    @*<fieldset>
        <legend>SupplierActivation </legend>*@

    <div class="panel panel-default">
        <table align="center">
            <tr style="display:none;">

                <td colspan="4">
                    <span style="font-size:12px;">Supplier HedaerGid </span><br />
                    @Html.TextBoxFor(model => model.Supplierheadergid, new { @class = "textboxStyle", @readonly = "readonly", @id = "txtSupplierheadergid" })
                </td>
                @*<td width="10px"></td>*@
            </tr>
            <tr>
                <td>
                    <span style="font-size:12px;">Supplier Code </span><br />
                    @Html.TextBoxFor(model => model.SupplierCode, new { @class = "textboxStyle", @readonly = "readonly", @id = "txtSupplierCode" })
                </td>
                @*<td width="10px"></td>*@
                <td>
                    <span style="font-size:12px;">Supplier Name </span><br />
                    @Html.TextBoxFor(model => model.SupplierName, new { @class = "textboxStyle", @readonly = "readonly", @id = "txtSupplierName" })
                </td>
                @*<td width="10px"></td>*@
                <td>
                    <span style="font-size:12px;">From Date </span><br />
                    <input id="txtFromDate" type="text" class="textboxStyle" name='@Html.NameFor(x=>x.Fromdate)' maxlength="11" value="@Model.Fromdate" readonly>
                </td>
                @*<td width="10px"></td>*@
                <td align="right">
                    <span style="font-size:12px;">To Date </span><br />
                    <input id="txtTodate" type="text" class="textboxStyle" name='@Html.NameFor(x=>x.Todate)' maxlength="11" value="@Model.Todate" readonly />
                </td>
            </tr>


            @*<tr>
                    <td align="right"></td>

                </tr>
                <tr style="height:15px;"><td></td></tr>
                <tr>
                    <td align="right" style="padding:5px"><</td>

                </tr>*@
            @*<tr style="height:15px;"><td></td></tr>
                <tr>
                    <td align="right" style="padding:5px"></td>

                </tr>
                <tr style="height:15px;"><td></td></tr>
                <tr>
                    <td align="right" style="padding:5px"></td>
                    <td>

                    </td>
                </tr>*@
            <tr style="height:10px;"><td></td></tr>
            <tr>


                <td colspan="2" align="left">
                    @*@Html.TextBoxFor(model => model.ActiveReason, new { @class = "form-control"})*@
                    <span style="font-size:12px;">Activate Reason </span><br />
                    <textarea cols="30" rows="4" style="width:388px" id="txtActiveReason" maxlength="128" name='@Html.NameFor(x=>x.ActiveReason)' value="@Model.ActiveReason" disabled> </textarea>
                </td>
                <td colspan="2" align="left">
                    <span style="font-size:12px;">Comments </span><br />
                    <textarea cols="30" rows="4" id="txtComments" style="width:420px" name='@Html.NameFor(x=>x.comments)' maxlength="128" value="@Model.comments"> </textarea>
                </td>
            </tr>
            @*<tr>
                    <td colspan="2" align="center">
                        <a href="#" id="lnkAdd">Add More Attachments" </a>
                        <button id="lnkAdd" value="Add More Attachments"></button></td>
                </tr>*@
            @*<tr>
                    <td colspan="2" align="right">
                        <div id="dvAttch">
                            @Html.Partial("Attachments")
                        </div>
                    </td>
                </tr>*@
            @*<tr style="height:15px;"><td></td></tr>
                <tr>
                    <td align="right" style="padding:5px"></td>

                </tr>
                <tr style="height:15px;"><td></td></tr>
                <tr>
                    <td align="right" style="padding:5px"></td>
                    <td>
                        @Html.TextBoxFor(model => model.comments, new { @class = "form-control" })

                    </td>
                </tr>*@
            @*<tr style="height:15px;"><td></td></tr>*@
            <tr style="height:10px;"><td></td></tr>
            <tr>
                <td colspan="4" align="left">
                    <div>
                        <table align="left">
                            <tr>
                                <td>
                                    @Html.HiddenFor(i => i.FilesToBeUploaded)
                                </td>
                            </tr>
                            <tr style="height:20px;"><td></td></tr>
                            <tr>

                                <td>
                                    <span style="font-size:12px;">Attachments </span>
                                    <div id="uploaders">
                                        @*<input type="file" id="fileToUpload" name="files[]" style="float: left;" multiple />*@
                                        <input id="fileupsupplier" type="file" name="files[]" multiple>
                                        <br />
                                        @*<input type="submit" id="Upload" value="Upload" name="upload" />
                                            <br />*@
                                        <span id="spnFile" style="float: left; color: #FF0000"></span>
                                        @Html.ValidationMessage("File")
                                        @Html.Hidden("hdnFileUpload")
                                    </div>
                                </td>

                            </tr>
                            <tr style="height:10px;"><td></td></tr>
                            <tr>
                                <td colspan="2" align="left">
                                    <div class="control-section" style="padding: 0px;">
                                        <div id="selectedFiles"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div id="dvAttch">
                                        @Html.Partial("SupplierActiveAttachments")
                                    </div>
                                </td>
                            </tr>

                        </table>
                    </div>

                    @*<input type="file" id="fuldAttach" class="form-control" multiple="multiple" name='@Html.NameFor(x=>x.AttachFileName)' value="@Model.AttachFileName" />*@


                </td>
            </tr>

            @*<tr style="height:10px;"><td></td></tr>
            <tr>
                <td colspan="4">

                    <div>
                        <table align="center">
                            <tr>
                                <td style="padding:10px;"><span style="font-size:12px;">Approver  :</span></td>
                                <td>

                                    @Html.DropDownList("ddlApprover", Model.ApproverList, new { @class = "textboxStyle", @id = "dropProduct" })
                                </td>
                            </tr>
                            <tr style="height:20px;"><td></td></tr>
                            <tr>

                                <td align="center" colspan="2">
                                    <input type="button" name="Push Approval" value="Push Approval" class="btn btn-primary" />
                                </td>
                            </tr>
                        </table>
                    </div>

                </td>
            </tr>*@
            <tr style="height:10px;"><td></td></tr>
            <tr id="trApproval" >
                <td colspan="2" align="center">
                    <div>
                        <table align="center">
                            <tr>
                                <td colspan="2" align="center" style="padding:5px">
                                    <span>Approved</span>
                                    @Html.RadioButtonFor(model => model.Approval, "Approval", new { @id = "rtbApproval", @checked = "checked" })
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                    <label>Reject</label>
                                    @Html.RadioButtonFor(model => model.Reject, "Reject", new { @id = "rtbReject" })
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:10px"><span>Remarks :</span> </td>
                                <td><textarea cols="30" rows="4" style="resize:none ;width:400px;height:50px" class="textareaStyle" name='@Html.NameFor(x=>x.Remarks)' maxlength="128" value="@Model.Remarks"> </textarea></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
            @*<tr style="height:15px;"><td></td></tr>*@
        </table>
    </div>
    <table align="center">
        <tr>
            <td colspan="4" align="center">
                <input type="submit" name="btnactivate" id="btnactivate" value="ACTIVATE" class="btn btn-primary" disabled />
                <input type="submit" name="btnsave" id="btnsave" value="SUBMIT" class="btn btn-primary" style="display:none;" />
                <input type="button" name="BACK" onclick="location.href='@Url.Action("ActivationQueue", "SupplierActivationQueue")'" value="BACK" class="btn btn-primary" />
            </td>
        </tr>
    </table>



    @*</fieldset>*@
}

<script>
    //  var nowTemp = new Date();
    //var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
    var d = new Date();
    var strDate = d.getDate() + "/" + (d.getMonth() + 1) + "/" + d.getFullYear();
    var files;
    var storedFiles = [];
    var upc = 0;
    //function valid()
    //{
    //    var from = document.getElementById('txtFromDate').value;
    //    alert(from);
    //    return false;
    //}


    $(function () {
        //alert('hai');
        $(":file").attr('title', '  ');
        var $loading = $('#loadingDiv').hide();

        $("input[id^='fileToUpload']").change(function (e) {
            doReCreate(e);
        });

        selDiv = $("#selectedFiles");
    });

    $(document).ready(function () {
        $("#fileupsupplier").val('');
        $("#txtFromDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd-mm-yy',
            maxdate: new Date()


        });

        $('#txtActiveReason').change(function () {
            // alert('hellow');
            // $('#btnactivate').enabled = true;
          $('#btnactivate').prop('disabled', false);
        });
    });

    function doReCreate(e) {
        //  alert('hellow');
        upc = upc + 1;
        handleFileSelect(e);
        //  alert('ok');
        $("input[id^='fileToUpload']").hide();

        $('<input>').attr({
            type: 'file',
            multiple: 'multiple',
            id: 'fileToUpload' + upc,
            class: 'fUpload',
            name: 'fileUpload',
            style: 'float: left',
            title: '  ',
            onchange: "doReCreate(event)"

        }).appendTo('#uploaders');
    }


    function handleFileSelect(e) {

        //selDiv.innerHTML = ""; storedFiles = [];
        // alert('welcome');
        selDiv = document.querySelector("#selectedFiles");
        //alert(selDiv);
        if (!e.target.files) return;

        //selDiv.innerHTML = "";
        files = e.target.files;
        //  alert(files);

        for (var i = 0; i < files.length; i++) {
            // alert('yes');
            //if (i == 0) { selDiv.innerHTML = ""; storedFiles = []; }
            var f = files[i];
            //alert(f.name);
            //selDiv.innerHTML += "<div>" + f.name + "<a onclick='removeAtt(this)'> Delete </a></div>";
            storedFiles.push(f.name);
            var sl = i + 1;
            //alert(f.name);
            var rowCount = 1;
            //function addMoreRows(files) {
            rowCount++;
            var recRow = '<div id="rowCount' + sl + '"><tr><td><input name="" value="' + f.name + '" type="text"  maxlength="120" style="margin: 4px 5px 0 5px;"/></td><td><input name="" value="' + strDate + '" type="text" maxlength="120" style="margin: 4px 10px 0 0px;"/></td></tr> <a href="javascript:void(0);" onclick="removeRow(' + sl + ');">Delete</a></div>';
            jQuery('#selectedFiles').append(recRow);
        }
        $('#@Html.IdFor(i => i.FilesToBeUploaded)').val(storedFiles);

    }

    function removeRow(removeNum) {
        // alert('hai');
       // alert(removeNum);
        jQuery('#rowCount' + removeNum).remove();

    }

    function removeAtt(t) {

        var serEle = $(t).parent().text().slice(0, -3);
        var index = storedFiles.indexOf(serEle);
        if (index !== -1) {
            storedFiles.splice(index, 1);
        }
        $(t).parent().remove();

        $('#@Html.IdFor(i => i.FilesToBeUploaded)').val(storedFiles);

    }
    $(document).ready(function () {

        $('#fileupsupplier').on('change', function (e) {
            var files = e.target.files;
            if (files.length > 0) {
                if (window.FormData !== undefined) {
                    var data = new FormData();
                    for (var x = 0; x < files.length; x++) {
                        // alert(files[x].name34);
                        data.append("temp_" + x, files[x]);
                    }
                    $.ajax({
                        type: "POST",
                        url: '../SupplierActivationQueue/SupplierAttachments',
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (result) {
                           // alert(result);
                           // alert(result.length);
                            $("#wgAttachmentsupplier").load('../SupplierActivationQueue/SupplierAttachments');

                        },
                        error: function (xhr, status, p3, p4) {
                            var err = "Error " + " " + status + " " + p3 + " " + p4;
                            if (xhr.responseText && xhr.responseText[0] == "{")
                                err = JSON.parse(xhr.responseText).Message;
                            console.log(err);
                        }
                    });
                } else {
                    alert("This browser doesn't support HTML5 file uploads!");
                }
            }
        });
        $('#Upload').click(function () {
            var att = $("#fileToUpload").val();
             //   alert(att);
                var UserModel =
                 {
                     "FilesToBeUploaded": att

                 };
              //  alert(UserModel);
                $.ajax({
                    url: '../SupplierActivationQueue/SupplierAttachments/',
                    data: JSON.stringify(UserModel),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        // alert(data);
                        $('#dvAttch').empty().append(data);
                    }
                });
               
            });

      

        $('#txtFromDate').val('');
        //$('#btnactivate').disabled();
        // alert($('#FromDate').val());
        $('#txtFromDate').change(function () {
            var dd = $('#txtFromDate').val();
            var Todate;
            var arr = dd.split('-');
            var TDate = arr[0];
            var Tmon = arr[1];
            var NewDate = 0;
            var i;
            // alert(TDate);
            if (TDate == '30' | TDate == '31') {
                // alert('notok');
                Tmon = parseInt(Tmon) + 1;
                TDate = 30;
                Todate = TDate + '-' + Tmon + '-' + arr[2];
            }
            else {
                for (i = parseInt(TDate) ; i < 31; i++) {
                    if (i == 30) {
                        Tmon = parseInt(Tmon) + 1;
                        NewDate = parseInt(TDate);
                    }
                    //NewDate++;
                }
                Todate = NewDate + '-' + Tmon + '-' + arr[2];
                // alert(Todate);
            }

            $('#txtTodate').val(Todate);
           // $('#btnactivate').prop('disabled', false);
            $('#txtActiveReason').prop('disabled', false);
            // alert(Todate);txtActiveReason
        });
        //$('#txtFromDate').datetimepicker({
        //    lang: 'de',
        //    i18n: {
        //        de: {
        //            months: [
        //             'Jan', 'Feb', 'Mar', 'Apr',
        //             'May', 'Jun', 'Jul', 'Aug',
        //             'Sep', 'Oct', 'Nov', 'Dec',
        //            ],
        //            dayOfWeek: [
        //             "Sun", "Mon", "Thu", "wed",
        //             "Thr", "Fri", "Sat.",
        //            ]
        //        }
        //    },
        //    timepicker: false,
        //    format: 'd-m-Y'
        //});

        $("#btnactivate").click(function () {
           
          //  alert($("#txtSupplierCode").val());
            var UserModel =
      {
          "ActiheaderGid":$("#txtSupplierheadergid").val(),
          "SupplierCode": $("#txtSupplierCode").val(),
          "SupplierName": $("#txtSupplierName").val(),
          "Fromdate": $("#txtFromDate").val(),
          "Todate": $("#txtTodate").val(),
          "ActiveReason": $("#txtActiveReason").val(),
          "comments":$("#txtComments").val()
      };
          
           //  alert(UserModel);
            $.ajax({
                url: '../SupplierActivationQueue/SupplierActivation/',
                data: JSON.stringify(UserModel),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    jAlert(data,"Message");
                }
            });


        });
    });
    //function GetToDate()
    //{

    //}
</script>